(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[150],{65859:function(Rr,N,b){"use strict";b.d(N,{zj:function(){return Pt},oI:function(){return fi},ni:function(){return ye},gg:function(){return qr}});var re=b(97671);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function E(Yt,he,Te,Ze){function Oe(Ot){return Ot instanceof Te?Ot:new Te(function(ar){ar(Ot)})}return new(Te||(Te=Promise))(function(Ot,ar){function ur(nn){try{or(Ze.next(nn))}catch(C){ar(C)}}function Pr(nn){try{or(Ze.throw(nn))}catch(C){ar(C)}}function or(nn){nn.done?Ot(nn.value):Oe(nn.value).then(ur,Pr)}or((Ze=Ze.apply(Yt,he||[])).next())})}function p(Yt,he){var Te={label:0,sent:function(){if(Ot[0]&1)throw Ot[1];return Ot[1]},trys:[],ops:[]},Ze,Oe,Ot,ar;return ar={next:ur(0),throw:ur(1),return:ur(2)},typeof Symbol=="function"&&(ar[Symbol.iterator]=function(){return this}),ar;function ur(or){return function(nn){return Pr([or,nn])}}function Pr(or){if(Ze)throw new TypeError("Generator is already executing.");for(;Te;)try{if(Ze=1,Oe&&(Ot=or[0]&2?Oe.return:or[0]?Oe.throw||((Ot=Oe.return)&&Ot.call(Oe),0):Oe.next)&&!(Ot=Ot.call(Oe,or[1])).done)return Ot;switch(Oe=0,Ot&&(or=[or[0]&2,Ot.value]),or[0]){case 0:case 1:Ot=or;break;case 4:return Te.label++,{value:or[1],done:!1};case 5:Te.label++,Oe=or[1],or=[0];continue;case 7:or=Te.ops.pop(),Te.trys.pop();continue;default:if(Ot=Te.trys,!(Ot=Ot.length>0&&Ot[Ot.length-1])&&(or[0]===6||or[0]===2)){Te=0;continue}if(or[0]===3&&(!Ot||or[1]>Ot[0]&&or[1]<Ot[3])){Te.label=or[1];break}if(or[0]===6&&Te.label<Ot[1]){Te.label=Ot[1],Ot=or;break}if(Ot&&Te.label<Ot[2]){Te.label=Ot[2],Te.ops.push(or);break}Ot[2]&&Te.ops.pop(),Te.trys.pop();continue}or=he.call(Yt,Te)}catch(nn){or=[6,nn],Oe=0}finally{Ze=Ot=0}if(or[0]&5)throw or[1];return{value:or[0]?or[1]:void 0,done:!0}}}function me(Yt,he){var Te=typeof Symbol=="function"&&Yt[Symbol.iterator];if(!Te)return Yt;var Ze=Te.call(Yt),Oe,Ot=[],ar;try{for(;(he===void 0||he-- >0)&&!(Oe=Ze.next()).done;)Ot.push(Oe.value)}catch(ur){ar={error:ur}}finally{try{Oe&&!Oe.done&&(Te=Ze.return)&&Te.call(Ze)}finally{if(ar)throw ar.error}}return Ot}function te(){for(var Yt=[],he=0;he<arguments.length;he++)Yt=Yt.concat(me(arguments[he]));return Yt}function ue(Yt){return Yt&&Yt.__esModule&&Object.prototype.hasOwnProperty.call(Yt,"default")?Yt.default:Yt}function ae(Yt,he){return he={exports:{}},Yt(he,he.exports),he.exports}var Ne=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=Te;function Te(Ze){return Ze&&typeof Ze.length=="number"&&Ze.length>=0&&Ze.length%1==0}Yt.exports=he.default});ue(Ne);var K=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=function(Te){return function(){for(var Ze=[],Oe=arguments.length;Oe--;)Ze[Oe]=arguments[Oe];var Ot=Ze.pop();return Te.call(this,Ze,Ot)}},Yt.exports=he.default});ue(K);var Qe=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0}),he.fallback=Oe,he.wrap=Ot;var Te=he.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Ze=he.hasNextTick=typeof re=="object"&&typeof re.nextTick=="function";function Oe(ur){setTimeout(ur,0)}function Ot(ur){return function(Pr){for(var or=[],nn=arguments.length-1;nn-- >0;)or[nn]=arguments[nn+1];return ur(function(){return Pr.apply(void 0,or)})}}var ar;Te?ar=setImmediate:Ze?ar=re.nextTick:ar=Oe,he.default=Ot(ar)});ue(Qe);var xt=Qe.fallback,Ht=Qe.wrap,$t=Qe.hasSetImmediate,Jt=Qe.hasNextTick,Ft=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=Ot;var Te=Oe(K),Ze=Oe(Qe);function Oe(Pr){return Pr&&Pr.__esModule?Pr:{default:Pr}}function Ot(Pr){return(0,Gt.isAsync)(Pr)?function(){for(var or=[],nn=arguments.length;nn--;)or[nn]=arguments[nn];var C=or.pop(),V=Pr.apply(this,or);return ar(V,C)}:(0,Te.default)(function(or,nn){var C;try{C=Pr.apply(this,or)}catch(V){return nn(V)}if(C&&typeof C.then=="function")return ar(C,nn);nn(null,C)})}function ar(Pr,or){return Pr.then(function(nn){ur(or,null,nn)},function(nn){ur(or,nn&&nn.message?nn:new Error(nn))})}function ur(Pr,or,nn){try{Pr(or,nn)}catch(C){(0,Ze.default)(function(V){throw V},C)}}Yt.exports=he.default});ue(Ft);var Gt=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0}),he.isAsyncIterable=he.isAsyncGenerator=he.isAsync=void 0;var Te=Ze(Ft);function Ze(Pr){return Pr&&Pr.__esModule?Pr:{default:Pr}}function Oe(Pr){return Pr[Symbol.toStringTag]==="AsyncFunction"}function Ot(Pr){return Pr[Symbol.toStringTag]==="AsyncGenerator"}function ar(Pr){return typeof Pr[Symbol.asyncIterator]=="function"}function ur(Pr){if(typeof Pr!="function")throw new Error("expected a function");return Oe(Pr)?(0,Te.default)(Pr):Pr}he.default=ur,he.isAsync=Oe,he.isAsyncGenerator=Ot,he.isAsyncIterable=ar});ue(Gt);var At=Gt.isAsyncIterable,Et=Gt.isAsyncGenerator,bt=Gt.isAsync,er=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=Te;function Te(Ze,Oe){if(Oe===void 0&&(Oe=Ze.length),!Oe)throw new Error("arity is undefined");function Ot(){for(var ar=this,ur=[],Pr=arguments.length;Pr--;)ur[Pr]=arguments[Pr];return typeof ur[Oe-1]=="function"?Ze.apply(this,ur):new Promise(function(or,nn){ur[Oe-1]=function(C){for(var V=[],Ve=arguments.length-1;Ve-- >0;)V[Ve]=arguments[Ve+1];if(C)return nn(C);or(V.length>1?V:V[0])},Ze.apply(ar,ur)})}return Object.defineProperty(Ot,"name",{configurable:!0,value:"awaitable("+Ze.name+")"}),Ot}Yt.exports=he.default});ue(er);var q=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0});var Te=Ot(Ne),Ze=Ot(Gt),Oe=Ot(er);function Ot(ar){return ar&&ar.__esModule?ar:{default:ar}}he.default=(0,Oe.default)(function(ar,ur,Pr){var or=(0,Te.default)(ur)?[]:{};ar(ur,function(nn,C,V){(0,Ze.default)(nn)(function(Ve){for(var $e,ct=[],Ct=arguments.length-1;Ct-- >0;)ct[Ct]=arguments[Ct+1];ct.length<2&&($e=ct,ct=$e[0]),or[C]=ct,V(Ve)})},function(nn){return Pr(nn,or)})},3),Yt.exports=he.default});ue(q);var Bt=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=Te;function Te(Ze){function Oe(){for(var Ot=[],ar=arguments.length;ar--;)Ot[ar]=arguments[ar];if(Ze!==null){var ur=Ze;Ze=null,ur.apply(this,Ot)}}return Object.assign(Oe,Ze),Oe}Yt.exports=he.default});ue(Bt);var et=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=function(Te){return Te[Symbol.iterator]&&Te[Symbol.iterator]()},Yt.exports=he.default});ue(et);var je=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=Pr;var Te=Oe(Ne),Ze=Oe(et);function Oe(or){return or&&or.__esModule?or:{default:or}}function Ot(or){var nn=-1,C=or.length;return function(){return++nn<C?{value:or[nn],key:nn}:null}}function ar(or){var nn=-1;return function(){var V=or.next();return V.done?null:(nn++,{value:V.value,key:nn})}}function ur(or){var nn=or?Object.keys(or):[],C=-1,V=nn.length;return function(){var $e=nn[++C];return C<V?{value:or[$e],key:$e}:null}}function Pr(or){if((0,Te.default)(or))return Ot(or);var nn=(0,Ze.default)(or);return nn?ar(nn):ur(or)}Yt.exports=he.default});ue(je);var nt=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=Te;function Te(Ze){return function(){for(var Oe=[],Ot=arguments.length;Ot--;)Oe[Ot]=arguments[Ot];if(Ze===null)throw new Error("Callback was already called.");var ar=Ze;Ze=null,ar.apply(this,Oe)}}Yt.exports=he.default});ue(nt);var De=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0});var Te={};he.default=Te,Yt.exports=he.default});ue(De);var It=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=Oe;var Te=Ze(De);function Ze(Ot){return Ot&&Ot.__esModule?Ot:{default:Ot}}function Oe(Ot,ar,ur,Pr){var or=!1,nn=!1,C=!1,V=0,Ve=0;function $e(){V>=ar||C||or||(C=!0,Ot.next().then(function(J){var Wt=J.value,Tr=J.done;if(!(nn||or)){if(C=!1,Tr){or=!0,V<=0&&Pr(null);return}V++,ur(Wt,Ve,ct),Ve++,$e()}}).catch(Ct))}function ct(J,Wt){if(V-=1,!nn){if(J)return Ct(J);if(J===!1){or=!0,nn=!0;return}if(Wt===Te.default||or&&V<=0)return or=!0,Pr(null);$e()}}function Ct(J){nn||(C=!1,or=!0,Pr(J))}$e()}Yt.exports=he.default});ue(It);var hr=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0});var Te=ur(Bt),Ze=ur(je),Oe=ur(nt),Ot=ur(It),ar=ur(De);function ur(Pr){return Pr&&Pr.__esModule?Pr:{default:Pr}}he.default=function(Pr){return function(or,nn,C){if(C=(0,Te.default)(C),Pr<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!or)return C(null);if((0,Gt.isAsyncGenerator)(or))return(0,Ot.default)(or,Pr,nn,C);if((0,Gt.isAsyncIterable)(or))return(0,Ot.default)(or[Symbol.asyncIterator](),Pr,nn,C);var V=(0,Ze.default)(or),Ve=!1,$e=!1,ct=0,Ct=!1;function J(Tr,Mr){if(!$e)if(ct-=1,Tr)Ve=!0,C(Tr);else if(Tr===!1)Ve=!0,$e=!0;else{if(Mr===ar.default||Ve&&ct<=0)return Ve=!0,C(null);Ct||Wt()}}function Wt(){for(Ct=!0;ct<Pr&&!Ve;){var Tr=V();if(Tr===null){Ve=!0,ct<=0&&C(null);return}ct+=1,nn(Tr.value,Tr.key,(0,Oe.default)(J))}Ct=!1}Wt()}},Yt.exports=he.default});ue(hr);var tr=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0});var Te=Ot(hr),Ze=Ot(Gt),Oe=Ot(er);function Ot(ur){return ur&&ur.__esModule?ur:{default:ur}}function ar(ur,Pr,or,nn){return(0,Te.default)(Pr)(ur,(0,Ze.default)(or),nn)}he.default=(0,Oe.default)(ar,4),Yt.exports=he.default});ue(tr);var j=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0});var Te=Oe(tr),Ze=Oe(er);function Oe(ar){return ar&&ar.__esModule?ar:{default:ar}}function Ot(ar,ur,Pr){return(0,Te.default)(ar,1,ur,Pr)}he.default=(0,Ze.default)(Ot,3),Yt.exports=he.default});ue(j);var ie=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=Ot;var Te=Oe(q),Ze=Oe(j);function Oe(ar){return ar&&ar.__esModule?ar:{default:ar}}function Ot(ar,ur){return(0,Te.default)(Ze.default,ar,ur)}Yt.exports=he.default}),Me=ue(ie),ye=function(){function Yt(){for(var he=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=he[Ze];this.args=[],this.tasks=[]}return Yt.prototype.call=function(){for(var he=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=he[Ze];return this.args=Te,Me(this.tasks)},Yt.prototype.tap=function(he,Te){var Ze=this;this.tasks.push(function(Oe){Te.apply(void 0,te(Ze.args)),Oe(null,he)})},Yt}(),it=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0});var Te=or(Ne),Ze=or(De),Oe=or(tr),Ot=or(Bt),ar=or(nt),ur=or(Gt),Pr=or(er);function or(Ve){return Ve&&Ve.__esModule?Ve:{default:Ve}}function nn(Ve,$e,ct){ct=(0,Ot.default)(ct);var Ct=0,J=0,Wt=Ve.length,Tr=!1;Wt===0&&ct(null);function Mr(Ke,ht){Ke===!1&&(Tr=!0),Tr!==!0&&(Ke?ct(Ke):(++J===Wt||ht===Ze.default)&&ct(null))}for(;Ct<Wt;Ct++)$e(Ve[Ct],Ct,(0,ar.default)(Mr))}function C(Ve,$e,ct){return(0,Oe.default)(Ve,Infinity,$e,ct)}function V(Ve,$e,ct){var Ct=(0,Te.default)(Ve)?nn:C;return Ct(Ve,(0,ur.default)($e),ct)}he.default=(0,Pr.default)(V,3),Yt.exports=he.default});ue(it);var lt=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=Ot;var Te=Oe(it),Ze=Oe(q);function Oe(ar){return ar&&ar.__esModule?ar:{default:ar}}function Ot(ar,ur){return(0,Ze.default)(Te.default,ar,ur)}Yt.exports=he.default}),Lt=ue(lt),Pt=function(){function Yt(){for(var he=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=he[Ze];this.tasks=[]}return Yt.prototype.promise=function(){for(var he=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=he[Ze];return Lt(this.tasks)},Yt.prototype.tapPromise=function(he,Te){var Ze=this;this.tasks.push(function(Oe){return E(Ze,void 0,void 0,function(){return p(this,function(Ot){switch(Ot.label){case 0:return[4,Te()];case 1:return Ot.sent(),Oe(null,he),[2]}})})})},Yt}(),Lr=ae(function(Yt,he){Object.defineProperty(he,"__esModule",{value:!0});var Te=ar(Bt),Ze=ar(nt),Oe=ar(Gt),Ot=ar(er);function ar(Pr){return Pr&&Pr.__esModule?Pr:{default:Pr}}function ur(Pr,or){if(or=(0,Te.default)(or),!Array.isArray(Pr))return or(new Error("First argument to waterfall must be an array of functions"));if(!Pr.length)return or();var nn=0;function C(Ve){var $e=(0,Oe.default)(Pr[nn++]);$e.apply(void 0,Ve.concat([(0,Ze.default)(V)]))}function V(Ve){for(var $e=[],ct=arguments.length-1;ct-- >0;)$e[ct]=arguments[ct+1];if(Ve!==!1){if(Ve||nn===Pr.length)return or.apply(void 0,[Ve].concat($e));C($e)}}C([])}he.default=(0,Ot.default)(ur),Yt.exports=he.default}),cn=ue(Lr),qr=function(){function Yt(){for(var he=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=he[Ze];this.tasks=[]}return Yt.prototype.call=function(){for(var he=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=he[Ze];return cn(this.tasks)},Yt.prototype.tap=function(he,Te){this.tasks.length===0?this.tasks.push(function(Ze){var Oe=Te();Ze(Oe?null:!1,Oe)}):this.tasks.push(function(Ze,Oe){var Ot=Te();Oe(Ot?null:!1,he)})},Yt}(),fi=function(){function Yt(){for(var he=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=he[Ze];this.tasks=[]}return Yt.prototype.call=function(){for(var he=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=he[Ze];return Me(this.tasks)},Yt.prototype.tap=function(he,Te){this.tasks.push(function(Ze){var Oe=Te();Ze(Oe,he)})},Yt}()},75530:function(Rr,N,b){"use strict";b.d(N,{nC:function(){return re.ZP},Hp:function(){return re.Hp},e7:function(){return re.e7},yT:function(){return re.yT},vK:function(){return p.v},BlendType:function(){return te.h},AttributeType:function(){return ue.GC},ScaleTypes:function(){return ue.vY},StyleScaleType:function(){return ue.ee},MapServiceEvent:function(){return K.I},CoordinateSystem:function(){return Qe.l},CoordinateUniform:function(){return Qe.k},CameraUniform:function(){return $t.l},SceneEventList:function(){return Gt.P},PositionType:function(){return et.d},gl:function(){return ar.gl}});var re=b(34830),E=b(16546),p=b(61931),me=b(28497),te=b(65046),ue=b(74578),ae=b(96548),Ne=b.n(ae);b.o(ae,"CameraUniform")&&b.d(N,{CameraUniform:function(){return ae.CameraUniform}}),b.o(ae,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return ae.CityBuildingLayer}}),b.o(ae,"CoordinateSystem")&&b.d(N,{CoordinateSystem:function(){return ae.CoordinateSystem}}),b.o(ae,"CoordinateUniform")&&b.d(N,{CoordinateUniform:function(){return ae.CoordinateUniform}}),b.o(ae,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return ae.HeatmapLayer}}),b.o(ae,"ImageLayer")&&b.d(N,{ImageLayer:function(){return ae.ImageLayer}}),b.o(ae,"LineLayer")&&b.d(N,{LineLayer:function(){return ae.LineLayer}}),b.o(ae,"MapServiceEvent")&&b.d(N,{MapServiceEvent:function(){return ae.MapServiceEvent}}),b.o(ae,"Marker")&&b.d(N,{Marker:function(){return ae.Marker}}),b.o(ae,"PointLayer")&&b.d(N,{PointLayer:function(){return ae.PointLayer}}),b.o(ae,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return ae.PolygonLayer}}),b.o(ae,"Popup")&&b.d(N,{Popup:function(){return ae.Popup}}),b.o(ae,"PositionType")&&b.d(N,{PositionType:function(){return ae.PositionType}}),b.o(ae,"RasterLayer")&&b.d(N,{RasterLayer:function(){return ae.RasterLayer}}),b.o(ae,"Scene")&&b.d(N,{Scene:function(){return ae.Scene}}),b.o(ae,"SceneEventList")&&b.d(N,{SceneEventList:function(){return ae.SceneEventList}}),b.o(ae,"gl")&&b.d(N,{gl:function(){return ae.gl}});var K=b(77301),Qe=b(87544),xt=b(87814),Ht=b.n(xt);b.o(xt,"CameraUniform")&&b.d(N,{CameraUniform:function(){return xt.CameraUniform}}),b.o(xt,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return xt.CityBuildingLayer}}),b.o(xt,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return xt.HeatmapLayer}}),b.o(xt,"ImageLayer")&&b.d(N,{ImageLayer:function(){return xt.ImageLayer}}),b.o(xt,"LineLayer")&&b.d(N,{LineLayer:function(){return xt.LineLayer}}),b.o(xt,"Marker")&&b.d(N,{Marker:function(){return xt.Marker}}),b.o(xt,"PointLayer")&&b.d(N,{PointLayer:function(){return xt.PointLayer}}),b.o(xt,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return xt.PolygonLayer}}),b.o(xt,"Popup")&&b.d(N,{Popup:function(){return xt.Popup}}),b.o(xt,"PositionType")&&b.d(N,{PositionType:function(){return xt.PositionType}}),b.o(xt,"RasterLayer")&&b.d(N,{RasterLayer:function(){return xt.RasterLayer}}),b.o(xt,"Scene")&&b.d(N,{Scene:function(){return xt.Scene}}),b.o(xt,"SceneEventList")&&b.d(N,{SceneEventList:function(){return xt.SceneEventList}}),b.o(xt,"gl")&&b.d(N,{gl:function(){return xt.gl}});var $t=b(36868),Jt=b(58782),Ft=b.n(Jt);b.o(Jt,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return Jt.CityBuildingLayer}}),b.o(Jt,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return Jt.HeatmapLayer}}),b.o(Jt,"ImageLayer")&&b.d(N,{ImageLayer:function(){return Jt.ImageLayer}}),b.o(Jt,"LineLayer")&&b.d(N,{LineLayer:function(){return Jt.LineLayer}}),b.o(Jt,"Marker")&&b.d(N,{Marker:function(){return Jt.Marker}}),b.o(Jt,"PointLayer")&&b.d(N,{PointLayer:function(){return Jt.PointLayer}}),b.o(Jt,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return Jt.PolygonLayer}}),b.o(Jt,"Popup")&&b.d(N,{Popup:function(){return Jt.Popup}}),b.o(Jt,"PositionType")&&b.d(N,{PositionType:function(){return Jt.PositionType}}),b.o(Jt,"RasterLayer")&&b.d(N,{RasterLayer:function(){return Jt.RasterLayer}}),b.o(Jt,"Scene")&&b.d(N,{Scene:function(){return Jt.Scene}}),b.o(Jt,"SceneEventList")&&b.d(N,{SceneEventList:function(){return Jt.SceneEventList}}),b.o(Jt,"gl")&&b.d(N,{gl:function(){return Jt.gl}});var Gt=b(24),At=b(54559),Et=b.n(At);b.o(At,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return At.CityBuildingLayer}}),b.o(At,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return At.HeatmapLayer}}),b.o(At,"ImageLayer")&&b.d(N,{ImageLayer:function(){return At.ImageLayer}}),b.o(At,"LineLayer")&&b.d(N,{LineLayer:function(){return At.LineLayer}}),b.o(At,"Marker")&&b.d(N,{Marker:function(){return At.Marker}}),b.o(At,"PointLayer")&&b.d(N,{PointLayer:function(){return At.PointLayer}}),b.o(At,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return At.PolygonLayer}}),b.o(At,"Popup")&&b.d(N,{Popup:function(){return At.Popup}}),b.o(At,"PositionType")&&b.d(N,{PositionType:function(){return At.PositionType}}),b.o(At,"RasterLayer")&&b.d(N,{RasterLayer:function(){return At.RasterLayer}}),b.o(At,"Scene")&&b.d(N,{Scene:function(){return At.Scene}}),b.o(At,"gl")&&b.d(N,{gl:function(){return At.gl}});var bt=b(52443),er=b.n(bt);b.o(bt,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return bt.CityBuildingLayer}}),b.o(bt,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return bt.HeatmapLayer}}),b.o(bt,"ImageLayer")&&b.d(N,{ImageLayer:function(){return bt.ImageLayer}}),b.o(bt,"LineLayer")&&b.d(N,{LineLayer:function(){return bt.LineLayer}}),b.o(bt,"Marker")&&b.d(N,{Marker:function(){return bt.Marker}}),b.o(bt,"PointLayer")&&b.d(N,{PointLayer:function(){return bt.PointLayer}}),b.o(bt,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return bt.PolygonLayer}}),b.o(bt,"Popup")&&b.d(N,{Popup:function(){return bt.Popup}}),b.o(bt,"PositionType")&&b.d(N,{PositionType:function(){return bt.PositionType}}),b.o(bt,"RasterLayer")&&b.d(N,{RasterLayer:function(){return bt.RasterLayer}}),b.o(bt,"Scene")&&b.d(N,{Scene:function(){return bt.Scene}}),b.o(bt,"gl")&&b.d(N,{gl:function(){return bt.gl}});var q=b(83966),Bt=b.n(q);b.o(q,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return q.CityBuildingLayer}}),b.o(q,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return q.HeatmapLayer}}),b.o(q,"ImageLayer")&&b.d(N,{ImageLayer:function(){return q.ImageLayer}}),b.o(q,"LineLayer")&&b.d(N,{LineLayer:function(){return q.LineLayer}}),b.o(q,"Marker")&&b.d(N,{Marker:function(){return q.Marker}}),b.o(q,"PointLayer")&&b.d(N,{PointLayer:function(){return q.PointLayer}}),b.o(q,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return q.PolygonLayer}}),b.o(q,"Popup")&&b.d(N,{Popup:function(){return q.Popup}}),b.o(q,"PositionType")&&b.d(N,{PositionType:function(){return q.PositionType}}),b.o(q,"RasterLayer")&&b.d(N,{RasterLayer:function(){return q.RasterLayer}}),b.o(q,"Scene")&&b.d(N,{Scene:function(){return q.Scene}}),b.o(q,"gl")&&b.d(N,{gl:function(){return q.gl}});var et=b(87571),je=b(85398),nt=b.n(je);b.o(je,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return je.CityBuildingLayer}}),b.o(je,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return je.HeatmapLayer}}),b.o(je,"ImageLayer")&&b.d(N,{ImageLayer:function(){return je.ImageLayer}}),b.o(je,"LineLayer")&&b.d(N,{LineLayer:function(){return je.LineLayer}}),b.o(je,"Marker")&&b.d(N,{Marker:function(){return je.Marker}}),b.o(je,"PointLayer")&&b.d(N,{PointLayer:function(){return je.PointLayer}}),b.o(je,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return je.PolygonLayer}}),b.o(je,"Popup")&&b.d(N,{Popup:function(){return je.Popup}}),b.o(je,"RasterLayer")&&b.d(N,{RasterLayer:function(){return je.RasterLayer}}),b.o(je,"Scene")&&b.d(N,{Scene:function(){return je.Scene}}),b.o(je,"gl")&&b.d(N,{gl:function(){return je.gl}});var De=b(26273),It=b.n(De);b.o(De,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return De.CityBuildingLayer}}),b.o(De,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return De.HeatmapLayer}}),b.o(De,"ImageLayer")&&b.d(N,{ImageLayer:function(){return De.ImageLayer}}),b.o(De,"LineLayer")&&b.d(N,{LineLayer:function(){return De.LineLayer}}),b.o(De,"Marker")&&b.d(N,{Marker:function(){return De.Marker}}),b.o(De,"PointLayer")&&b.d(N,{PointLayer:function(){return De.PointLayer}}),b.o(De,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return De.PolygonLayer}}),b.o(De,"Popup")&&b.d(N,{Popup:function(){return De.Popup}}),b.o(De,"RasterLayer")&&b.d(N,{RasterLayer:function(){return De.RasterLayer}}),b.o(De,"Scene")&&b.d(N,{Scene:function(){return De.Scene}}),b.o(De,"gl")&&b.d(N,{gl:function(){return De.gl}});var hr=b(57699),tr=b(92175),j=b.n(tr);b.o(tr,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return tr.CityBuildingLayer}}),b.o(tr,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return tr.HeatmapLayer}}),b.o(tr,"ImageLayer")&&b.d(N,{ImageLayer:function(){return tr.ImageLayer}}),b.o(tr,"LineLayer")&&b.d(N,{LineLayer:function(){return tr.LineLayer}}),b.o(tr,"Marker")&&b.d(N,{Marker:function(){return tr.Marker}}),b.o(tr,"PointLayer")&&b.d(N,{PointLayer:function(){return tr.PointLayer}}),b.o(tr,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return tr.PolygonLayer}}),b.o(tr,"Popup")&&b.d(N,{Popup:function(){return tr.Popup}}),b.o(tr,"RasterLayer")&&b.d(N,{RasterLayer:function(){return tr.RasterLayer}}),b.o(tr,"Scene")&&b.d(N,{Scene:function(){return tr.Scene}}),b.o(tr,"gl")&&b.d(N,{gl:function(){return tr.gl}});var ie=b(30658),Me=b.n(ie);b.o(ie,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return ie.CityBuildingLayer}}),b.o(ie,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return ie.HeatmapLayer}}),b.o(ie,"ImageLayer")&&b.d(N,{ImageLayer:function(){return ie.ImageLayer}}),b.o(ie,"LineLayer")&&b.d(N,{LineLayer:function(){return ie.LineLayer}}),b.o(ie,"Marker")&&b.d(N,{Marker:function(){return ie.Marker}}),b.o(ie,"PointLayer")&&b.d(N,{PointLayer:function(){return ie.PointLayer}}),b.o(ie,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return ie.PolygonLayer}}),b.o(ie,"Popup")&&b.d(N,{Popup:function(){return ie.Popup}}),b.o(ie,"RasterLayer")&&b.d(N,{RasterLayer:function(){return ie.RasterLayer}}),b.o(ie,"Scene")&&b.d(N,{Scene:function(){return ie.Scene}}),b.o(ie,"gl")&&b.d(N,{gl:function(){return ie.gl}});var ye=b(63500),it=b.n(ye);b.o(ye,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return ye.CityBuildingLayer}}),b.o(ye,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return ye.HeatmapLayer}}),b.o(ye,"ImageLayer")&&b.d(N,{ImageLayer:function(){return ye.ImageLayer}}),b.o(ye,"LineLayer")&&b.d(N,{LineLayer:function(){return ye.LineLayer}}),b.o(ye,"Marker")&&b.d(N,{Marker:function(){return ye.Marker}}),b.o(ye,"PointLayer")&&b.d(N,{PointLayer:function(){return ye.PointLayer}}),b.o(ye,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return ye.PolygonLayer}}),b.o(ye,"Popup")&&b.d(N,{Popup:function(){return ye.Popup}}),b.o(ye,"RasterLayer")&&b.d(N,{RasterLayer:function(){return ye.RasterLayer}}),b.o(ye,"Scene")&&b.d(N,{Scene:function(){return ye.Scene}}),b.o(ye,"gl")&&b.d(N,{gl:function(){return ye.gl}});var lt=b(86485),Lt=b.n(lt);b.o(lt,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return lt.CityBuildingLayer}}),b.o(lt,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return lt.HeatmapLayer}}),b.o(lt,"ImageLayer")&&b.d(N,{ImageLayer:function(){return lt.ImageLayer}}),b.o(lt,"LineLayer")&&b.d(N,{LineLayer:function(){return lt.LineLayer}}),b.o(lt,"Marker")&&b.d(N,{Marker:function(){return lt.Marker}}),b.o(lt,"PointLayer")&&b.d(N,{PointLayer:function(){return lt.PointLayer}}),b.o(lt,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return lt.PolygonLayer}}),b.o(lt,"Popup")&&b.d(N,{Popup:function(){return lt.Popup}}),b.o(lt,"RasterLayer")&&b.d(N,{RasterLayer:function(){return lt.RasterLayer}}),b.o(lt,"Scene")&&b.d(N,{Scene:function(){return lt.Scene}}),b.o(lt,"gl")&&b.d(N,{gl:function(){return lt.gl}});var Pt=b(23487),Lr=b.n(Pt);b.o(Pt,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return Pt.CityBuildingLayer}}),b.o(Pt,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return Pt.HeatmapLayer}}),b.o(Pt,"ImageLayer")&&b.d(N,{ImageLayer:function(){return Pt.ImageLayer}}),b.o(Pt,"LineLayer")&&b.d(N,{LineLayer:function(){return Pt.LineLayer}}),b.o(Pt,"Marker")&&b.d(N,{Marker:function(){return Pt.Marker}}),b.o(Pt,"PointLayer")&&b.d(N,{PointLayer:function(){return Pt.PointLayer}}),b.o(Pt,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return Pt.PolygonLayer}}),b.o(Pt,"Popup")&&b.d(N,{Popup:function(){return Pt.Popup}}),b.o(Pt,"RasterLayer")&&b.d(N,{RasterLayer:function(){return Pt.RasterLayer}}),b.o(Pt,"Scene")&&b.d(N,{Scene:function(){return Pt.Scene}}),b.o(Pt,"gl")&&b.d(N,{gl:function(){return Pt.gl}});var cn=b(51591),qr=b.n(cn);b.o(cn,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return cn.CityBuildingLayer}}),b.o(cn,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return cn.HeatmapLayer}}),b.o(cn,"ImageLayer")&&b.d(N,{ImageLayer:function(){return cn.ImageLayer}}),b.o(cn,"LineLayer")&&b.d(N,{LineLayer:function(){return cn.LineLayer}}),b.o(cn,"Marker")&&b.d(N,{Marker:function(){return cn.Marker}}),b.o(cn,"PointLayer")&&b.d(N,{PointLayer:function(){return cn.PointLayer}}),b.o(cn,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return cn.PolygonLayer}}),b.o(cn,"Popup")&&b.d(N,{Popup:function(){return cn.Popup}}),b.o(cn,"RasterLayer")&&b.d(N,{RasterLayer:function(){return cn.RasterLayer}}),b.o(cn,"Scene")&&b.d(N,{Scene:function(){return cn.Scene}}),b.o(cn,"gl")&&b.d(N,{gl:function(){return cn.gl}});var fi=b(35951),Yt=b(25001),he=b.n(Yt);b.o(Yt,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return Yt.CityBuildingLayer}}),b.o(Yt,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return Yt.HeatmapLayer}}),b.o(Yt,"ImageLayer")&&b.d(N,{ImageLayer:function(){return Yt.ImageLayer}}),b.o(Yt,"LineLayer")&&b.d(N,{LineLayer:function(){return Yt.LineLayer}}),b.o(Yt,"Marker")&&b.d(N,{Marker:function(){return Yt.Marker}}),b.o(Yt,"PointLayer")&&b.d(N,{PointLayer:function(){return Yt.PointLayer}}),b.o(Yt,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return Yt.PolygonLayer}}),b.o(Yt,"Popup")&&b.d(N,{Popup:function(){return Yt.Popup}}),b.o(Yt,"RasterLayer")&&b.d(N,{RasterLayer:function(){return Yt.RasterLayer}}),b.o(Yt,"Scene")&&b.d(N,{Scene:function(){return Yt.Scene}}),b.o(Yt,"gl")&&b.d(N,{gl:function(){return Yt.gl}});var Te=b(16853),Ze=b.n(Te);b.o(Te,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return Te.CityBuildingLayer}}),b.o(Te,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return Te.HeatmapLayer}}),b.o(Te,"ImageLayer")&&b.d(N,{ImageLayer:function(){return Te.ImageLayer}}),b.o(Te,"LineLayer")&&b.d(N,{LineLayer:function(){return Te.LineLayer}}),b.o(Te,"Marker")&&b.d(N,{Marker:function(){return Te.Marker}}),b.o(Te,"PointLayer")&&b.d(N,{PointLayer:function(){return Te.PointLayer}}),b.o(Te,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return Te.PolygonLayer}}),b.o(Te,"Popup")&&b.d(N,{Popup:function(){return Te.Popup}}),b.o(Te,"RasterLayer")&&b.d(N,{RasterLayer:function(){return Te.RasterLayer}}),b.o(Te,"Scene")&&b.d(N,{Scene:function(){return Te.Scene}}),b.o(Te,"gl")&&b.d(N,{gl:function(){return Te.gl}});var Oe=b(25831),Ot=b.n(Oe);b.o(Oe,"CityBuildingLayer")&&b.d(N,{CityBuildingLayer:function(){return Oe.CityBuildingLayer}}),b.o(Oe,"HeatmapLayer")&&b.d(N,{HeatmapLayer:function(){return Oe.HeatmapLayer}}),b.o(Oe,"ImageLayer")&&b.d(N,{ImageLayer:function(){return Oe.ImageLayer}}),b.o(Oe,"LineLayer")&&b.d(N,{LineLayer:function(){return Oe.LineLayer}}),b.o(Oe,"Marker")&&b.d(N,{Marker:function(){return Oe.Marker}}),b.o(Oe,"PointLayer")&&b.d(N,{PointLayer:function(){return Oe.PointLayer}}),b.o(Oe,"PolygonLayer")&&b.d(N,{PolygonLayer:function(){return Oe.PolygonLayer}}),b.o(Oe,"Popup")&&b.d(N,{Popup:function(){return Oe.Popup}}),b.o(Oe,"RasterLayer")&&b.d(N,{RasterLayer:function(){return Oe.RasterLayer}}),b.o(Oe,"Scene")&&b.d(N,{Scene:function(){return Oe.Scene}}),b.o(Oe,"gl")&&b.d(N,{gl:function(){return Oe.gl}});var ar=b(65270)},34830:function(Rr,N,b){"use strict";b.d(N,{e7:function(){return Vi},Hp:function(){return Ci},ZP:function(){return Hi},yT:function(){return Hn}});var re=b(78892),E=b(40666),p=b.n(E),me=b(99311),te=b(11922),ue=b(61931),ae=b(51548),Ne=b(46893),K=b(19297),Qe=b(28157),xt=b(52155),Ht=b.n(xt);function $t(X,Q){var D=Object.keys(X);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(X);Q&&(k=k.filter(function(le){return Object.getOwnPropertyDescriptor(X,le).enumerable})),D.push.apply(D,k)}return D}function Jt(X){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?$t(Object(D),!0).forEach(function(k){(0,K.Z)(X,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(D)):$t(Object(D)).forEach(function(k){Object.defineProperty(X,k,Object.getOwnPropertyDescriptor(D,k))})}return X}function Ft(X,Q){var D=typeof Symbol!="undefined"&&X[Symbol.iterator]||X["@@iterator"];if(!D){if(Array.isArray(X)||(D=Gt(X))||Q&&X&&typeof X.length=="number"){D&&(X=D);var k=0,le=function(){};return{s:le,n:function(){return k>=X.length?{done:!0}:{done:!1,value:X[k++]}},e:function(cr){throw cr},f:le}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ce=!0,ft=!1,Rt;return{s:function(){D=D.call(X)},n:function(){var cr=D.next();return Ce=cr.done,cr},e:function(cr){ft=!0,Rt=cr},f:function(){try{!Ce&&D.return!=null&&D.return()}finally{if(ft)throw Rt}}}}function Gt(X,Q){if(!!X){if(typeof X=="string")return At(X,Q);var D=Object.prototype.toString.call(X).slice(8,-1);if(D==="Object"&&X.constructor&&(D=X.constructor.name),D==="Map"||D==="Set")return Array.from(X);if(D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D))return At(X,Q)}}function At(X,Q){(Q==null||Q>X.length)&&(Q=X.length);for(var D=0,k=new Array(Q);D<Q;D++)k[D]=X[D];return k}var Et=30;function bt(X){var Q=X.characterSet,D=X.getFontWidth,k=X.fontHeight,le=X.buffer,Ce=X.maxCanvasWidth,ft=X.mapping,Rt=ft===void 0?{}:ft,Tt=X.xOffset,cr=Tt===void 0?0:Tt,Kr=X.yOffset,Nn=Kr===void 0?0:Kr,ni=0,li=cr;Array.from(Q).forEach(function(Mi,aa){if(!Rt[Mi]){var xa=D(Mi,aa);li+Et>Ce&&(li=0,ni++),Rt[Mi]={x:li,y:Nn+ni*Et,width:Et,height:Et,advance:xa},li+=Et}});var Li=k+le*2;return{mapping:Rt,xOffset:li,yOffset:Nn+ni*Li,canvasHeight:Bt(Nn+(ni+1)*Li)}}function er(X,Q,D){var k=0,le=0,Ce=0,ft=[],Rt={},Tt=Ft(X),cr;try{for(Tt.s();!(cr=Tt.n()).done;){var Kr=cr.value;if(!Rt[Kr.id]){var Nn=Kr.size;k+Nn+Q>D&&(q(Rt,ft,le),k=0,le=Ce+le+Q,Ce=0,ft=[]),ft.push({icon:Kr,xOffset:k}),k=k+Nn+Q,Ce=Math.max(Ce,Nn)}}}catch(li){Tt.e(li)}finally{Tt.f()}ft.length>0&&q(Rt,ft,le);var ni=Bt(Ce+le+Q);return{mapping:Rt,canvasHeight:ni}}function q(X,Q,D){var k=Ft(Q),le;try{for(k.s();!(le=k.n()).done;){var Ce=le.value,ft=Ce.icon,Rt=Ce.xOffset;X[ft.id]=Jt(Jt({},ft),{},{x:Rt,y:D,image:ft.image,width:ft.width,height:ft.height})}}catch(Tt){k.e(Tt)}finally{k.f()}}function Bt(X){return Math.pow(2,Math.ceil(Math.log2(X)))}var et,je;function nt(X,Q){var D=typeof Symbol!="undefined"&&X[Symbol.iterator]||X["@@iterator"];if(!D){if(Array.isArray(X)||(D=De(X))||Q&&X&&typeof X.length=="number"){D&&(X=D);var k=0,le=function(){};return{s:le,n:function(){return k>=X.length?{done:!0}:{done:!1,value:X[k++]}},e:function(cr){throw cr},f:le}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ce=!0,ft=!1,Rt;return{s:function(){D=D.call(X)},n:function(){var cr=D.next();return Ce=cr.done,cr},e:function(cr){ft=!0,Rt=cr},f:function(){try{!Ce&&D.return!=null&&D.return()}finally{if(ft)throw Rt}}}}function De(X,Q){if(!!X){if(typeof X=="string")return It(X,Q);var D=Object.prototype.toString.call(X).slice(8,-1);if(D==="Object"&&X.constructor&&(D=X.constructor.name),D==="Map"||D==="Set")return Array.from(X);if(D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D))return It(X,Q)}}function It(X,Q){(Q==null||Q>X.length)&&(Q=X.length);for(var D=0,k=new Array(Q);D<Q;D++)k[D]=X[D];return k}function hr(X,Q){var D=Object.keys(X);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(X);Q&&(k=k.filter(function(le){return Object.getOwnPropertyDescriptor(X,le).enumerable})),D.push.apply(D,k)}return D}function tr(X){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?hr(Object(D),!0).forEach(function(k){(0,K.Z)(X,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(D)):hr(Object(D)).forEach(function(k){Object.defineProperty(X,k,Object.getOwnPropertyDescriptor(D,k))})}return X}var j=Yt(),ie="sans-serif",Me="normal",ye=24,it=3,lt=.25,Lt=8,Pt=1024,Lr=1,cn=1,qr=3,fi=null;function Yt(){for(var X=[],Q=32;Q<128;Q++)X.push(String.fromCharCode(Q));return X}function he(X,Q,D,k){X.font="".concat(k," ").concat(D,"px ").concat(Q),X.fillStyle="black",X.textBaseline="middle"}function Te(X,Q){for(var D=0;D<X.length;D++)Q.data[4*D+3]=X[D]}var Ze=(et=(0,me.b2)(),et(je=function(){function X(){(0,ae.Z)(this,X),(0,K.Z)(this,"fontAtlas",void 0),(0,K.Z)(this,"iconFontMap",void 0),(0,K.Z)(this,"iconFontGlyphs",{}),(0,K.Z)(this,"fontOptions",void 0),(0,K.Z)(this,"key",void 0),(0,K.Z)(this,"cache",new Qe.z6(qr))}return(0,Ne.Z)(X,[{key:"scale",get:function(){return cn}},{key:"canvas",get:function(){var D=this.cache.get(this.key);return D&&D.data}},{key:"mapping",get:function(){var D=this.cache.get(this.key);return D&&D.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:ie,fontWeight:Me,characterSet:j,fontSize:ye,buffer:it,sdf:!0,cutoff:lt,radius:Lt,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(D){var k=this;D.forEach(function(le){k.iconFontGlyphs[le.name]=le.unicode})}},{key:"addIconFont",value:function(D,k){this.iconFontMap.set(D,k)}},{key:"getIconFontKey",value:function(D){return this.iconFontMap.get(D)||D}},{key:"getGlyph",value:function(D){return this.iconFontGlyphs[D]?String.fromCharCode(parseInt(this.iconFontGlyphs[D],16)):""}},{key:"setFontOptions",value:function(D){this.fontOptions=tr(tr({},this.fontOptions),D),this.key=this.getKey();var k=this.getNewChars(this.key,this.fontOptions.characterSet),le=this.cache.get(this.key);if(!(le&&k.length===0)){var Ce=this.generateFontAtlas(this.key,k,le);this.fontAtlas=Ce,this.cache.set(this.key,Ce)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(D,k,le){var Ce=this.fontOptions,ft=Ce.fontFamily,Rt=Ce.fontWeight,Tt=Ce.fontSize,cr=Ce.buffer,Kr=Ce.sdf,Nn=Ce.radius,ni=Ce.cutoff,li=Ce.iconfont,Li=le&&le.data;Li||(Li=document.createElement("canvas"),Li.width=Pt);var Mi=Li.getContext("2d");he(Mi,ft,Tt,Rt);var aa=bt(tr({getFontWidth:function(Ou){return Mi.measureText(Ou).width},fontHeight:Tt*cn,buffer:cr,characterSet:k,maxCanvasWidth:Pt},le&&{mapping:le.mapping,xOffset:le.xOffset,yOffset:le.yOffset})),xa=aa.mapping,Ca=aa.canvasHeight,Va=aa.xOffset,Ga=aa.yOffset,to=Mi.getImageData(0,0,Li.width,Li.height);if(Li.height=Ca,Mi.putImageData(to,0,0),he(Mi,ft,Tt,Rt),Kr){var ca=new(Ht())(Tt,cr,Nn,ni,ft,Rt),da=Mi.getImageData(0,0,ca.size,ca.size),va=nt(k),vo;try{for(va.s();!(vo=va.n()).done;){var Fi=vo.value;if(li){var Ia=String.fromCharCode(parseInt(Fi.replace("&#x","").replace(";",""),16)),Ka=ca.draw(Ia);Te(Ka,da)}else Te(ca.draw(Fi),da);Mi.putImageData(da,xa[Fi].x,xa[Fi].y)}}catch(Es){va.e(Es)}finally{va.f()}}else{var Oo=nt(k),ac;try{for(Oo.s();!(ac=Oo.n()).done;){var bu=ac.value;Mi.fillText(bu,xa[bu].x,xa[bu].y+Tt*Lr)}}catch(Es){Oo.e(Es)}finally{Oo.f()}}return{xOffset:Va,yOffset:Ga,mapping:xa,data:Li,width:Li.width,height:Li.height}}},{key:"getKey",value:function(){return"key";var D,k,le,Ce,ft,Rt,Tt,cr}},{key:"getNewChars",value:function(D,k){var le=this.cache.get(D);if(!le)return k;var Ce=[],ft=le.mapping,Rt=new Set(Object.keys(ft)),Tt=new Set(k);return Tt.forEach(function(cr){Rt.has(cr)||Ce.push(cr)}),Ce}}]),X}())||je),Oe=b(67708),Ot=b(37150),ar=b(87896),ur=b(74415),Pr,or;function nn(X){var Q=C();return function(){var k=(0,ur.Z)(X),le;if(Q){var Ce=(0,ur.Z)(this).constructor;le=Reflect.construct(k,arguments,Ce)}else le=k.apply(this,arguments);return(0,ar.Z)(this,le)}}function C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(X){return!1}}var V=3,Ve=1024,$e=64,ct=(Pr=(0,me.b2)(),Pr(or=function(X){(0,Ot.Z)(D,X);var Q=nn(D);function D(){var k;(0,ae.Z)(this,D);for(var le=arguments.length,Ce=new Array(le),ft=0;ft<le;ft++)Ce[ft]=arguments[ft];return k=Q.call.apply(Q,[this].concat(Ce)),(0,K.Z)((0,Oe.Z)(k),"canvasHeight",128),(0,K.Z)((0,Oe.Z)(k),"texture",void 0),(0,K.Z)((0,Oe.Z)(k),"canvas",void 0),(0,K.Z)((0,Oe.Z)(k),"iconData",void 0),(0,K.Z)((0,Oe.Z)(k),"iconMap",void 0),(0,K.Z)((0,Oe.Z)(k),"ctx",void 0),(0,K.Z)((0,Oe.Z)(k),"loadingImageCount",0),k}return(0,Ne.Z)(D,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(le,Ce){var ft=this,Rt=new Image;if(this.loadingImageCount++,this.hasImage(le))throw new Error("Image Id already exists");this.iconData.push({id:le,size:$e}),this.updateIconMap(),this.loadImage(Ce).then(function(Tt){Rt=Tt;var cr=ft.iconData.find(function(Kr){return Kr.id===le});cr&&(cr.image=Rt,cr.width=Rt.width,cr.height=Rt.height),ft.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(le){return this.iconMap.hasOwnProperty(le)}},{key:"removeImage",value:function(le){this.hasImage(le)&&(this.iconData=this.iconData.filter(function(Ce){return Ce.id!==le}),delete this.iconMap[le],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var le=this;this.canvas.width=Ve,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(Ce){var ft=le.iconMap[Ce],Rt=ft.x,Tt=ft.y,cr=ft.image,Kr=ft.width,Nn=Kr===void 0?64:Kr,ni=ft.height,li=ni===void 0?64:ni,Li=Math.max(Nn,li),Mi=Li/$e,aa=li/Mi,xa=Nn/Mi;cr&&le.ctx.drawImage(cr,Rt+($e-xa)/2,Tt+($e-aa)/2,xa,aa)})}},{key:"updateIconMap",value:function(){var le=er(this.iconData,V,Ve),Ce=le.mapping,ft=le.canvasHeight;this.iconMap=Ce,this.canvasHeight=ft}},{key:"loadImage",value:function(le){return new Promise(function(Ce,ft){if(le instanceof HTMLImageElement){Ce(le);return}var Rt=new Image;Rt.crossOrigin="anonymous",Rt.onload=function(){Ce(Rt)},Rt.onerror=function(){ft(new Error("Could not load image at "+le))},Rt.src=le instanceof File?URL.createObjectURL(le):le})}}]),D}(E.EventEmitter))||or),Ct=b(83405),J=b(74768),Wt,Tr,Mr=(Wt=(0,me.b2)(),Wt(Tr=function(){function X(){(0,ae.Z)(this,X),(0,K.Z)(this,"viewport",void 0),(0,K.Z)(this,"overridedViewProjectionMatrix",void 0),(0,K.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,K.Z)(this,"jitteredProjectionMatrix",void 0),(0,K.Z)(this,"viewMatrixInverse",void 0),(0,K.Z)(this,"cameraPosition",void 0)}return(0,Ne.Z)(X,[{key:"init",value:function(){}},{key:"update",value:function(D){this.viewport=D,this.viewMatrixInverse=J.create(),J.invert(this.viewMatrixInverse,D.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var D=this.viewport.getCenter(),k=(0,Ct.Z)(D,2),le=k[0],Ce=k[1];return[le,Ce]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(D,k){return this.viewport.projectFlat(D,k)}},{key:"setViewProjectionMatrix",value:function(D){this.overridedViewProjectionMatrix=D}},{key:"jitterProjectionMatrix",value:function(D,k){var le=J.fromTranslation(J.create(),[D,k,0]);this.jitteredProjectionMatrix=J.multiply(J.create(),le,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=J.multiply(J.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),X}())||Tr),Ke,ht;function Mt(X,Q){var D=typeof Symbol!="undefined"&&X[Symbol.iterator]||X["@@iterator"];if(!D){if(Array.isArray(X)||(D=Nt(X))||Q&&X&&typeof X.length=="number"){D&&(X=D);var k=0,le=function(){};return{s:le,n:function(){return k>=X.length?{done:!0}:{done:!1,value:X[k++]}},e:function(cr){throw cr},f:le}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ce=!0,ft=!1,Rt;return{s:function(){D=D.call(X)},n:function(){var cr=D.next();return Ce=cr.done,cr},e:function(cr){ft=!0,Rt=cr},f:function(){try{!Ce&&D.return!=null&&D.return()}finally{if(ft)throw Rt}}}}function Nt(X,Q){if(!!X){if(typeof X=="string")return br(X,Q);var D=Object.prototype.toString.call(X).slice(8,-1);if(D==="Object"&&X.constructor&&(D=X.constructor.name),D==="Map"||D==="Set")return Array.from(X);if(D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D))return br(X,Q)}}function br(X,Q){(Q==null||Q>X.length)&&(Q=X.length);for(var D=0,k=new Array(Q);D<Q;D++)k[D]=X[D];return k}var Sr=(Ke=(0,me.b2)(),Ke(ht=function(){function X(){(0,ae.Z)(this,X),(0,K.Z)(this,"container",void 0),(0,K.Z)(this,"controlCorners",void 0),(0,K.Z)(this,"controlContainer",void 0),(0,K.Z)(this,"scene",void 0),(0,K.Z)(this,"mapsService",void 0),(0,K.Z)(this,"controls",[]),(0,K.Z)(this,"unAddControls",[])}return(0,Ne.Z)(X,[{key:"init",value:function(D,k){this.container=D.container,this.scene=k,this.mapsService=k.get(ue.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(D,k){var le=k.get(ue.v.IMapService);le.map?(D.addTo(this.scene),this.controls.push(D)):this.unAddControls.push(D)}},{key:"getControlByName",value:function(D){return this.controls.find(function(k){return k.controlOption.name===D})}},{key:"removeControl",value:function(D){var k=this.controls.indexOf(D);return k>-1&&this.controls.splice(k,1),D.remove(),this}},{key:"addControls",value:function(){var D=this;this.unAddControls.forEach(function(k){k.addTo(D.scene),D.controls.push(k)}),this.unAddControls=[]}},{key:"destroy",value:function(){var D=Mt(this.controls),k;try{for(D.s();!(k=D.n()).done;){var le=k.value;le.remove()}}catch(Ce){D.e(Ce)}finally{D.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var D=this.controlCorners={},k="l7-",le=this.controlContainer=Qe.SO.create("div",k+"control-container",this.container);function Ce(){var ft=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],Rt=ft.map(function(Tt){return k+Tt}).join(" ");D[ft.join("")]=Qe.SO.create("div",Rt,le)}Ce(["top","left"]),Ce(["top","right"]),Ce(["bottom","left"]),Ce(["bottom","right"]),Ce(["top","center"]),Ce(["right","center"]),Ce(["left","center"]),Ce(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var D in this.controlCorners)this.controlCorners[D]&&Qe.SO.remove(this.controlCorners[D]);this.controlContainer&&Qe.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),X}())||ht),Je,Hr,Xr=(Je=(0,me.b2)(),Je(Hr=function(){function X(){(0,ae.Z)(this,X),(0,K.Z)(this,"container",void 0),(0,K.Z)(this,"scene",void 0),(0,K.Z)(this,"mapsService",void 0),(0,K.Z)(this,"markers",[]),(0,K.Z)(this,"markerLayers",[]),(0,K.Z)(this,"unAddMarkers",[]),(0,K.Z)(this,"unAddMarkerLayers",[])}return(0,Ne.Z)(X,[{key:"addMarkerLayer",value:function(D){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(D),D.addTo(this.scene)):this.unAddMarkerLayers.push(D)}},{key:"removeMarkerLayer",value:function(D){D.destroy(),this.markerLayers.indexOf(D);var k=this.markerLayers.indexOf(D);k>-1&&this.markerLayers.splice(k,1)}},{key:"addMarker",value:function(D){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(D),D.addTo(this.scene)):this.unAddMarkers.push(D)}},{key:"addMarkers",value:function(){var D=this;this.unAddMarkers.forEach(function(k){k.addTo(D.scene),D.markers.push(k)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var D=this;this.unAddMarkerLayers.forEach(function(k){D.markerLayers.push(k),k.addTo(D.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(D){D.remove(),this.markers.indexOf(D);var k=this.markers.indexOf(D);k>-1&&this.markers.splice(k,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(D){this.scene=D,this.mapsService=D.get(ue.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(D){D.remove()}),this.markers=[],this.markerLayers.forEach(function(D){D.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(D){D.destroy()}}]),X}())||Hr),yn,vr,Or=(yn=(0,me.b2)(),yn(vr=function(){function X(){(0,ae.Z)(this,X),(0,K.Z)(this,"scene",void 0),(0,K.Z)(this,"popup",void 0),(0,K.Z)(this,"mapsService",void 0),(0,K.Z)(this,"unAddPopup",void 0)}return(0,Ne.Z)(X,[{key:"removePopup",value:function(D){D.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(D){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(D.addTo(this.scene),this.popup=D):this.unAddPopup=D}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(D){this.scene=D,this.mapsService=D.get(ue.v.IMapService)}}]),X}())||vr),St=b(28440),Kn=b.n(St),Ln={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},zr=Ln,Y,ce;function ve(X,Q){var D=Object.keys(X);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(X);Q&&(k=k.filter(function(le){return Object.getOwnPropertyDescriptor(X,le).enumerable})),D.push.apply(D,k)}return D}function B(X){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?ve(Object(D),!0).forEach(function(k){(0,K.Z)(X,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(D)):ve(Object(D)).forEach(function(k){Object.defineProperty(X,k,Object.getOwnPropertyDescriptor(D,k))})}return X}var ee={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},pe={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Ae=(Y=(0,me.b2)(),Y(ce=function(){function X(){(0,ae.Z)(this,X),(0,K.Z)(this,"sceneConfigCache",{}),(0,K.Z)(this,"layerConfigCache",{})}return(0,Ne.Z)(X,[{key:"getSceneConfig",value:function(D){return this.sceneConfigCache[D]}},{key:"getSceneWarninfo",value:function(D){return zr[D]}},{key:"setSceneConfig",value:function(D,k){this.sceneConfigCache[D]=B(B({},ee),k)}},{key:"getLayerConfig",value:function(D){return this.layerConfigCache[D]}},{key:"setLayerConfig",value:function(D,k,le){this.layerConfigCache[k]=B({},Kn()({},this.sceneConfigCache[D],pe,le))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),X}())||ce),oe=b(84904),_e=b(7273),dt=b(93311),Er=Math.PI/180,Kt=512,ir=4003e4;function Zr(X){var Q=X.latitude,D=Q===void 0?0:Q,k=X.zoom,le=k===void 0?0:k,Ce=X.scale,ft=X.highPrecision,Rt=ft===void 0?!1:ft,Tt=X.flipY,cr=Tt===void 0?!1:Tt;Ce=Ce!==void 0?Ce:Math.pow(2,le);var Kr={},Nn=Kt*Ce,ni=Math.cos(D*Er),li=Nn/360,Li=li/ni,Mi=Nn/ir/ni;if(Kr.pixelsPerMeter=[Mi,-Mi,Mi],Kr.metersPerPixel=[1/Mi,-1/Mi,1/Mi],Kr.pixelsPerDegree=[li,-Li,Mi],Kr.degreesPerPixel=[1/li,-1/Li,1/Mi],Rt){var aa=Er*Math.tan(D*Er)/ni,xa=li*aa/2,Ca=Nn/ir*aa,Va=Ca/Li*Mi;Kr.pixelsPerDegree2=[0,-xa,Ca],Kr.pixelsPerMeter2=[Va,0,Va],cr&&(Kr.pixelsPerDegree2[1]=-Kr.pixelsPerDegree2[1],Kr.pixelsPerMeter2[1]=-Kr.pixelsPerMeter2[1])}return cr&&(Kr.pixelsPerMeter[1]=-Kr.pixelsPerMeter[1],Kr.metersPerPixel[1]=-Kr.metersPerPixel[1],Kr.pixelsPerDegree[1]=-Kr.pixelsPerDegree[1],Kr.degreesPerPixel[1]=-Kr.degreesPerPixel[1]),Kr}var Bn=b(87544),Fn,nr,In,vn,xn,zi=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Tn=(Fn=(0,me.b2)(),nr=(0,me.f3)(ue.v.ICameraService),Fn(In=(vn=function(){function X(){(0,ae.Z)(this,X),(0,K.Z)(this,"needRefresh",!0),(0,oe.Z)(this,"cameraService",xn,this),(0,K.Z)(this,"coordinateSystem",void 0),(0,K.Z)(this,"viewportCenter",void 0),(0,K.Z)(this,"viewportCenterProjection",void 0),(0,K.Z)(this,"pixelsPerDegree",void 0),(0,K.Z)(this,"pixelsPerDegree2",void 0),(0,K.Z)(this,"pixelsPerMeter",void 0)}return(0,Ne.Z)(X,[{key:"refresh",value:function(){var D=this.cameraService.getZoom(),k=this.cameraService.getZoomScale(),le=this.cameraService.getCenter(),Ce=Zr({latitude:le[1],zoom:D}),ft=Ce.pixelsPerMeter,Rt=Ce.pixelsPerDegree;this.viewportCenter=le,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=ft,this.pixelsPerDegree=Rt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Bn.l.LNGLAT||this.coordinateSystem===Bn.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Bn.l.LNGLAT_OFFSET?this.calculateLnglatOffset(le,D):this.coordinateSystem===Bn.l.P20_OFFSET&&this.calculateLnglatOffset(le,D,k,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(D){this.coordinateSystem=D}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(D,k,le,Ce){var ft=Zr({latitude:D[1],zoom:k,scale:le,flipY:Ce,highPrecision:!0}),Rt=ft.pixelsPerMeter,Tt=ft.pixelsPerDegree,cr=ft.pixelsPerDegree2,Kr=this.cameraService.getViewMatrix(),Nn=this.cameraService.getProjectionMatrix(),ni=J.multiply([],Nn,Kr),li=this.cameraService.projectFlat([Math.fround(D[0]),Math.fround(D[1])],Math.pow(2,k));this.viewportCenterProjection=dt.fF([],[li[0],li[1],0,1],ni),Kr=this.cameraService.getViewMatrixUncentered()||Kr,ni=J.multiply([],Nn,Kr),ni=J.multiply([],ni,zi),this.cameraService.setViewProjectionMatrix(ni),this.pixelsPerMeter=Rt,this.pixelsPerDegree=Tt,this.pixelsPerDegree2=cr}}]),X}(),xn=(0,_e.Z)(vn.prototype,"cameraService",[nr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vn))||In),Di=b(83959),ra=b.n(Di),hi=b(57699),na,Yi,Ii,ya,Fa;function Ki(X){var Q=Zi();return function(){var k=(0,ur.Z)(X),le;if(Q){var Ce=(0,ur.Z)(this).constructor;le=Reflect.construct(k,arguments,Ce)}else le=k.apply(this,arguments);return(0,ar.Z)(this,le)}}function Zi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(X){return!1}}var $i={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},so=(na=(0,me.b2)(),Yi=(0,me.f3)(ue.v.IMapService),na(Ii=(ya=function(X){(0,Ot.Z)(D,X);var Q=Ki(D);function D(){var k;(0,ae.Z)(this,D);for(var le=arguments.length,Ce=new Array(le),ft=0;ft<le;ft++)Ce[ft]=arguments[ft];return k=Q.call.apply(Q,[this].concat(Ce)),(0,oe.Z)((0,Oe.Z)(k),"mapService",Fa,(0,Oe.Z)(k)),(0,K.Z)((0,Oe.Z)(k),"hammertime",void 0),(0,K.Z)((0,Oe.Z)(k),"lastClickTime",0),(0,K.Z)((0,Oe.Z)(k),"lastClickXY",[-1,-1]),(0,K.Z)((0,Oe.Z)(k),"clickTimer",void 0),(0,K.Z)((0,Oe.Z)(k),"$containter",void 0),(0,K.Z)((0,Oe.Z)(k),"onDrag",function(Rt){var Tt=k.interactionEvent(Rt);Tt.type=$i[Tt.type],k.emit(hi.s.Drag,Tt)}),(0,K.Z)((0,Oe.Z)(k),"onHammer",function(Rt){Rt.srcEvent.stopPropagation();var Tt=k.interactionEvent(Rt);k.emit(hi.s.Hover,Tt)}),(0,K.Z)((0,Oe.Z)(k),"onTouch",function(Rt){var Tt=Rt.touches[0];k.onHover({x:Tt.pageX,y:Tt.pageY,type:"touch"})}),(0,K.Z)((0,Oe.Z)(k),"onHover",function(Rt){var Tt=Rt.clientX,cr=Rt.clientY,Kr=Tt,Nn=cr,ni=Rt.type,li=k.mapService.getMapContainer();if(li){var Li=li.getBoundingClientRect(),Mi=Li.top,aa=Li.left;Kr=Kr-aa-li.clientLeft,Nn=Nn-Mi-li.clientTop}var xa=k.mapService.containerToLngLat([Kr,Nn]);if(ni==="click"){if("ontouchstart"in document.documentElement)return;k.isDoubleTap(Kr,Nn,xa);return}if(ni==="touch"){k.isDoubleTap(Kr,Nn,xa);return}ni!=="click"&&ni!=="dblclick"&&k.emit(hi.s.Hover,{x:Kr,y:Nn,lngLat:xa,type:ni,target:Rt})}),k}return(0,Ne.Z)(D,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(hi.s.Hover)}},{key:"triggerHover",value:function(le){var Ce=le.x,ft=le.y;this.emit(hi.s.Hover,{x:Ce,y:ft})}},{key:"triggerSelect",value:function(le){this.emit(hi.s.Select,{featureId:le})}},{key:"triggerActive",value:function(le){this.emit(hi.s.Active,{featureId:le})}},{key:"addEventListenerOnMap",value:function(){var le=this.mapService.getMapContainer();if(le){var Ce=new(ra()).Manager(le);Ce.add(new(ra()).Tap({event:"dblclick",taps:2})),Ce.add(new(ra()).Tap({event:"click"})),Ce.add(new(ra()).Pan({threshold:0,pointers:0})),Ce.add(new(ra()).Press({})),Ce.on("dblclick click",this.onHammer),Ce.on("panstart panmove panend pancancel",this.onDrag),le.addEventListener("mousemove",this.onHover),le.addEventListener("mousedown",this.onHover,!0),le.addEventListener("mouseup",this.onHover),le.addEventListener("contextmenu",this.onHover),this.hammertime=Ce}}},{key:"removeEventListenerOnMap",value:function(){var le=this.mapService.getMapContainer();le&&(le.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),le.removeEventListener("mousedown",this.onHover),le.removeEventListener("mouseup",this.onHover),le.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(le){var Ce=le.type,ft=le.pointerType,Rt,Tt;ft==="touch"?(Tt=Math.floor(le.pointers[0].clientY),Rt=Math.floor(le.pointers[0].clientX)):(Tt=Math.floor(le.srcEvent.y),Rt=Math.floor(le.srcEvent.x));var cr=this.mapService.getMapContainer();if(cr){var Kr=cr.getBoundingClientRect(),Nn=Kr.top,ni=Kr.left;Rt-=ni,Tt-=Nn}var li=this.mapService.containerToLngLat([Rt,Tt]);return{x:Rt,y:Tt,lngLat:li,type:Ce,target:le.srcEvent}}},{key:"isDoubleTap",value:function(le,Ce,ft){var Rt=this,Tt=new Date().getTime(),cr="click";Tt-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-le)<10&&Math.abs(this.lastClickXY[1]-Ce)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),cr="dblclick",this.emit(hi.s.Hover,{x:le,y:Ce,lngLat:ft,type:cr})):(this.lastClickTime=Tt,this.lastClickXY=[le,Ce],this.clickTimer=setTimeout(function(){cr="click",Rt.emit(hi.s.Hover,{x:le,y:Ce,lngLat:ft,type:cr})},400))}}]),D}(p()),Fa=(0,_e.Z)(ya.prototype,"mapService",[Yi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ya))||Ii),Jo=b(30513),za=b(90122),qi=b.n(za),ou=window.document.documentElement.style,Cu=0;function Ji(X){var Q=X;if(typeof X=="string"&&(Q=document.getElementById(X)),Q){var D=document.createElement("div");return D.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,D.id="l7-scene-".concat(Cu++),D.classList.add("l7-scene"),Q.appendChild(D),D}return null}function xo(X){var Q,D,k=!0;return X==null||(Q=X.target)===null||Q===void 0||(D=Q.path)===null||D===void 0||D.map(function(le){if(le!=null&&le.classList){var Ce;le==null||(Ce=le.classList)===null||Ce===void 0||Ce.forEach(function(ft){(ft==="l7-marker"||ft==="l7-popup")&&(k=!1)})}}),k}var Qi=b(65270),Ja,Qo,Ea,Do,ko,ks,yo,Go,Ba,ho,as;function Fo(X,Q){var D=Object.keys(X);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(X);Q&&(k=k.filter(function(le){return Object.getOwnPropertyDescriptor(X,le).enumerable})),D.push.apply(D,k)}return D}function Se(X){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?Fo(Object(D),!0).forEach(function(k){(0,K.Z)(X,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(D)):Fo(Object(D)).forEach(function(k){Object.defineProperty(X,k,Object.getOwnPropertyDescriptor(D,k))})}return X}var ke=(Ja=(0,me.b2)(),Qo=(0,me.f3)(ue.v.IRendererService),Ea=(0,me.f3)(ue.v.IGlobalConfigService),Do=(0,me.f3)(ue.v.IInteractionService),ko=(0,me.f3)(ue.v.ILayerService),Ja(ks=(yo=function(){function X(){var Q=this;(0,ae.Z)(this,X),(0,oe.Z)(this,"rendererService",Go,this),(0,oe.Z)(this,"configService",Ba,this),(0,oe.Z)(this,"interactionService",ho,this),(0,oe.Z)(this,"layerService",as,this),(0,K.Z)(this,"pickingFBO",void 0),(0,K.Z)(this,"width",0),(0,K.Z)(this,"height",0),(0,K.Z)(this,"alreadyInPicking",!1),(0,K.Z)(this,"pickBufferScale",1),(0,K.Z)(this,"pickFromPickingFBO",function(D,k){var le,Ce=k.x,ft=k.y,Rt=k.lngLat,Tt=k.type,cr=k.target,Kr=!1,Nn=Q.rendererService,ni=Nn.getViewportSize,li=Nn.readPixels,Li=Nn.getContainer,Mi=Li().getBoundingClientRect(),aa=Mi.width,xa=Mi.height;aa*=Qe.SO.DPR,xa*=Qe.SO.DPR;var Ca=D.getLayerConfig(),Va=Ca.enableHighlight,Ga=Ca.enableSelect,to=Ce*Qe.SO.DPR,ca=ft*Qe.SO.DPR;if(to>aa-1*Qe.SO.DPR||to<0||ca>xa-1*Qe.SO.DPR||ca<0)return!1;var da;if(da=li({x:Math.floor(to/Q.pickBufferScale),y:Math.floor((xa-(ft+1)*Qe.SO.DPR)/Q.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:Q.pickingFBO}),da[0]!==0||da[1]!==0||da[2]!==0){var va=(0,Qe.W0)(da),vo=D.getSource().getFeatureById(va);va!==D.getCurrentPickId()&&Tt==="mousemove"&&(Tt="mouseenter");var Fi={x:Ce,y:ft,type:Tt,lngLat:Rt,featureId:va,feature:vo,target:cr};vo&&(Kr=!0,D.setCurrentPickId(va),Q.triggerHoverOnLayer(D,Fi))}else{var Ia={x:Ce,y:ft,lngLat:Rt,type:D.getCurrentPickId()!==null&&Tt==="mousemove"?"mouseout":"un"+Tt,featureId:null,target:cr,feature:null};Q.triggerHoverOnLayer(D,Se(Se({},Ia),{},{type:"unpick"})),Q.triggerHoverOnLayer(D,Ia),D.setCurrentPickId(null)}if(Va&&Q.highlightPickedFeature(D,da),Ga&&Tt==="click"&&((le=da)===null||le===void 0?void 0:le.toString())!==[0,0,0,0].toString()){var Ka=(0,Qe.W0)(da);D.getCurrentSelectedId()===null||Ka!==D.getCurrentSelectedId()?(Q.selectFeature(D,da),D.setCurrentSelectedId(Ka)):(Q.selectFeature(D,new Uint8Array([0,0,0,0])),D.setCurrentSelectedId(null))}return Kr})}return(0,Ne.Z)(X,[{key:"init",value:function(D){var k=this.rendererService,le=k.createTexture2D,Ce=k.createFramebuffer,ft=k.getViewportSize,Rt=k.getContainer,Tt=Rt().getBoundingClientRect(),cr=Tt.width,Kr=Tt.height;cr*=Qe.SO.DPR,Kr*=Qe.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(D).pickBufferScale||1,this.pickingFBO=Ce({color:le({width:Math.round(cr/this.pickBufferScale),height:Math.round(Kr/this.pickBufferScale),wrapS:Qi.gl.CLAMP_TO_EDGE,wrapT:Qi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(hi.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var Q=(0,Jo.Z)(qi().mark(function k(le,Ce,ft){var Rt=this,Tt,cr,Kr,Nn;return qi().wrap(function(li){for(;;)switch(li.prev=li.next){case 0:Tt=this.rendererService,cr=Tt.useFramebuffer,Kr=Tt.clear,Nn=Tt.getContainer,this.resizePickingFBO(),cr(this.pickingFBO,function(){Kr({framebuffer:Rt.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),le.hooks.beforePickingEncode.call(),le.renderModels(),le.hooks.afterPickingEncode.call();var Li=Rt.pickBox(le,Ce);ft(Li)});case 3:case"end":return li.stop()}},k,this)}));function D(k,le,Ce){return Q.apply(this,arguments)}return D}()},{key:"pickBox",value:function(D,k){var le=this,Ce=k.map(function(Ia){var Ka=Ia<0?0:Ia;return Math.floor(Ka*Qe.SO.DPR/le.pickBufferScale)}),ft=(0,Ct.Z)(Ce,4),Rt=ft[0],Tt=ft[1],cr=ft[2],Kr=ft[3],Nn=this.rendererService,ni=Nn.getViewportSize,li=Nn.readPixels,Li=Nn.getContainer,Mi=Li().getBoundingClientRect(),aa=Mi.width,xa=Mi.height;if(aa*=Qe.SO.DPR,xa*=Qe.SO.DPR,Rt>(aa-1)*Qe.SO.DPR/this.pickBufferScale||cr<0||Tt>(xa-1)*Qe.SO.DPR/this.pickBufferScale||Kr<0)return[];var Ca,Va=Math.min(aa/this.pickBufferScale,cr)-Rt,Ga=Math.min(xa/this.pickBufferScale,Kr)-Tt;Ca=li({x:Rt,y:Math.floor(xa/this.pickBufferScale-(Kr+1)),width:Va,height:Ga,data:new Uint8Array(Va*Ga*4),framebuffer:this.pickingFBO});for(var to=[],ca={},da=0;da<Ca.length/4;da=da+1){var va=Ca.slice(da*4,da*4+4),vo=(0,Qe.W0)(va);if(vo!==-1&&!ca[vo]){var Fi=D.getSource().getFeatureById(vo);to.push(Fi),ca[vo]=!0}}return to}},{key:"pickingAllLayer",value:function(){var Q=(0,Jo.Z)(qi().mark(function k(le){return qi().wrap(function(ft){for(;;)switch(ft.prev=ft.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){ft.next=2;break}return ft.abrupt("return");case 2:return this.alreadyInPicking=!0,ft.next=5,this.pickingLayers(le);case 5:this.layerService.renderLayers("picking"),this.alreadyInPicking=!1;case 7:case"end":return ft.stop()}},k,this)}));function D(k){return Q.apply(this,arguments)}return D}()},{key:"resizePickingFBO",value:function(){var D=this.rendererService.getContainer,k=D().getBoundingClientRect(),le=k.width,Ce=k.height;le*=Qe.SO.DPR,Ce*=Qe.SO.DPR,(this.width!==le||this.height!==Ce)&&(this.pickingFBO.resize({width:Math.round(le/this.pickBufferScale),height:Math.round(Ce/this.pickBufferScale)}),this.width=le,this.height=Ce)}},{key:"pickingLayers",value:function(){var Q=(0,Jo.Z)(qi().mark(function k(le){var Ce=this,ft,Rt,Tt,cr,Kr;return qi().wrap(function(ni){for(;;)switch(ni.prev=ni.next){case 0:ft=this.rendererService,Rt=ft.getViewportSize,Tt=ft.useFramebuffer,cr=ft.clear,Kr=ft.getContainer,this.resizePickingFBO(),Tt(this.pickingFBO,function(){var li=Ce.layerService.getLayers();li.filter(function(Li){return Li.needPick(le.type)}).reverse().some(function(Li){cr({framebuffer:Ce.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),Li.hooks.beforePickingEncode.call(),Li.renderModels(),Li.hooks.afterPickingEncode.call();var Mi=Ce.pickFromPickingFBO(Li,le);return Mi&&!Li.getLayerConfig().enablePropagation})});case 3:case"end":return ni.stop()}},k,this)}));function D(k){return Q.apply(this,arguments)}return D}()},{key:"triggerHoverOnLayer",value:function(D,k){xo(k)&&D.emit(k.type,k)}},{key:"highlightPickedFeature",value:function(D,k){var le=(0,Ct.Z)(k,3),Ce=le[0],ft=le[1],Rt=le[2];D.hooks.beforeHighlight.call([Ce,ft,Rt])}},{key:"selectFeature",value:function(D,k){var le=(0,Ct.Z)(k,3),Ce=le[0],ft=le[1],Rt=le[2];D.hooks.beforeSelect.call([Ce,ft,Rt])}}]),X}(),Go=(0,_e.Z)(yo.prototype,"rendererService",[Qo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ba=(0,_e.Z)(yo.prototype,"configService",[Ea],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ho=(0,_e.Z)(yo.prototype,"interactionService",[Do],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),as=(0,_e.Z)(yo.prototype,"layerService",[ko],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yo))||ks),yt=function(){function X(){var Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ae.Z)(this,X),(0,K.Z)(this,"autoStart",void 0),(0,K.Z)(this,"startTime",0),(0,K.Z)(this,"oldTime",0),(0,K.Z)(this,"running",!1),(0,K.Z)(this,"elapsedTime",0),this.autoStart=Q}return(0,Ne.Z)(X,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var D=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var k=(typeof performance=="undefined"?Date:performance).now();D=(k-this.oldTime)/1e3,this.oldTime=k,this.elapsedTime+=D}return D}}]),X}(),O,Qr,oi,Ai,po,Qa,Wa,os,su,wu=(O=(0,me.b2)(),Qr=(0,me.f3)(ue.v.IRendererService),oi=(0,me.f3)(ue.v.IMapService),Ai=(0,me.f3)(ue.v.IGlobalConfigService),O(po=(Qa=function(){function X(){(0,ae.Z)(this,X),(0,K.Z)(this,"clock",new yt),(0,K.Z)(this,"alreadyInRendering",!1),(0,K.Z)(this,"layers",[]),(0,K.Z)(this,"layerRenderID",void 0),(0,K.Z)(this,"sceneInited",!1),(0,K.Z)(this,"animateInstanceCount",0),(0,K.Z)(this,"lastRenderType",void 0),(0,K.Z)(this,"lastPickRenderTime",void 0),(0,oe.Z)(this,"renderService",Wa,this),(0,oe.Z)(this,"mapService",os,this),(0,oe.Z)(this,"configService",su,this)}return(0,Ne.Z)(X,[{key:"add",value:function(D){this.sceneInited&&D.init(),this.layers.push(D)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(D){D.inited||D.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(D){return this.layers.find(function(k){return k.id===D})}},{key:"getLayerByName",value:function(D){return this.layers.find(function(k){return k.name===D})}},{key:"remove",value:function(D){var k=this.layers.indexOf(D);k>-1&&this.layers.splice(k,1),D.emit("remove",null),D.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(D){!this.renderTest(D)||this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(k){return k.inited}).filter(function(k){return k.isVisible()}).forEach(function(k){k.hooks.beforeRenderData.call(),k.hooks.beforeRender.call(),k.render(),k.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(D,k){return D.zIndex-k.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(D){return D.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"renderTest",value:function(D){var k=new Date().getTime(),le=k-this.lastPickRenderTime;if(D==="picking"&&(this.lastPickRenderTime=new Date().getTime()),D)switch(D){case"picking":return this.lastRenderType==="mapRender"||this.lastRenderType==="animate"?(this.lastRenderType="picking",le>48):(this.lastRenderType="picking",!0);case"animate":return this.lastRenderType==="mapRender"?(this.lastRenderType="animate",!1):(this.lastRenderType="animate",!0);case"mapRender":return this.lastRenderType="mapRender",!0;default:return!0}return!0}},{key:"clear",value:function(){var D=(0,Qe.CI)(this.mapService.bgColor);this.renderService.clear({color:D,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers("animate"),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),X}(),Wa=(0,_e.Z)(Qa.prototype,"renderService",[Qr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),os=(0,_e.Z)(Qa.prototype,"mapService",[oi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),su=(0,_e.Z)(Qa.prototype,"configService",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qa))||po),Qu=b(96320),qo=b(10971),es=b(93544),ss=b.n(es),As=function(){function X(Q){var D=this;(0,ae.Z)(this,X),(0,K.Z)(this,"name",void 0),(0,K.Z)(this,"type",void 0),(0,K.Z)(this,"scale",void 0),(0,K.Z)(this,"descriptor",void 0),(0,K.Z)(this,"featureBufferLayout",[]),(0,K.Z)(this,"needRescale",!1),(0,K.Z)(this,"needRemapping",!1),(0,K.Z)(this,"needRegenerateVertices",!1),(0,K.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,K.Z)(this,"vertexAttribute",void 0),(0,K.Z)(this,"defaultCallback",function(k){if(k.length===0){var le;return((le=D.scale)===null||le===void 0?void 0:le.defaultValues)||[]}return k.map(function(Ce,ft){var Rt,Tt=(Rt=D.scale)===null||Rt===void 0?void 0:Rt.scalers[ft].func,cr=Tt(Ce);return cr})}),this.setProps(Q)}return(0,Ne.Z)(X,[{key:"setProps",value:function(D){Object.assign(this,D)}},{key:"mapping",value:function(D){var k;if((k=this.scale)!==null&&k!==void 0&&k.callback){var le,Ce=(le=this.scale)===null||le===void 0?void 0:le.callback.apply(le,(0,qo.Z)(D));if(!ss()(Ce))return[Ce]}return this.defaultCallback(D)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),X}(),us,Zs,Ys,Ts,Aa,wo;function ml(X,Q){var D=Object.keys(X);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(X);Q&&(k=k.filter(function(le){return Object.getOwnPropertyDescriptor(X,le).enumerable})),D.push.apply(D,k)}return D}function yl(X){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?ml(Object(D),!0).forEach(function(k){(0,K.Z)(X,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(D)):ml(Object(D)).forEach(function(k){Object.defineProperty(X,k,Object.getOwnPropertyDescriptor(D,k))})}return X}function qu(X){return new Promise(function(Q){return setTimeout(Q,X)})}var Jl=(us={},(0,K.Z)(us,Qi.gl.FLOAT,4),(0,K.Z)(us,Qi.gl.UNSIGNED_BYTE,1),(0,K.Z)(us,Qi.gl.UNSIGNED_SHORT,2),us),gl=(Zs=(0,me.b2)(),Ys=(0,me.f3)(ue.v.IRendererService),Zs(Ts=(Aa=function(){function X(){(0,ae.Z)(this,X),(0,K.Z)(this,"attributesAndIndices",void 0),(0,oe.Z)(this,"rendererService",wo,this),(0,K.Z)(this,"attributes",[]),(0,K.Z)(this,"triangulation",void 0),(0,K.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Ne.Z)(X,[{key:"registerStyleAttribute",value:function(D){var k=this.getLayerStyleAttribute(D.name||"");return k?k.setProps(D):(k=new As(D),this.attributes.push(k)),k}},{key:"updateStyleAttribute",value:function(D,k,le){var Ce=this.getLayerStyleAttribute(D);Ce||(Ce=this.registerStyleAttribute(yl(yl({},k),{},{name:D})));var ft=k.scale;ft&&Ce&&(Ce.scale=ft,Ce.needRescale=!0,Ce.needRemapping=!0,Ce.needRegenerateVertices=!0,le&&le.featureRange&&(Ce.featureRange=le.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(D){return this.attributes.find(function(k){return k.name===D})}},{key:"getLayerAttributeScale",value:function(D){var k,le=this.getLayerStyleAttribute(D),Ce=le==null||(k=le.scale)===null||k===void 0?void 0:k.scalers;return Ce&&Ce[0]?Ce[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(D,k){var le=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,Ce=arguments.length>3?arguments[3]:void 0,ft=this.attributes.find(function(Ga){return Ga.name===D});if(ft&&ft.descriptor){var Rt=ft.descriptor,Tt=Rt.update,cr=Rt.buffer,Kr=Rt.size,Nn=Kr===void 0?0:Kr,ni=Jl[cr.type||Qi.gl.FLOAT];if(Tt){var li=this.featureLayout,Li=li.elements,Mi=li.sizePerElement,aa=Li.slice(le,Ce);if(!aa.length)return;var xa=aa[0].offset,Ca=xa*Nn*ni,Va=aa.map(function(Ga,to){for(var ca=Ga.featureIdx,da=Ga.vertices,va=Ga.normals,vo=da.length/Mi,Fi=[],Ia=0;Ia<vo;Ia++){var Ka=va?va.slice(Ia*3,Ia*3+3):[];Fi.push.apply(Fi,(0,qo.Z)(Tt(k[ca],ca,da.slice(Ia*Mi,Ia*Mi+Mi),to,Ka)))}return Fi}).reduce(function(Ga,to){return Ga.push.apply(Ga,(0,qo.Z)(to)),Ga},[]);ft.vertexAttribute.updateBuffer({data:Va,offset:Ca})}}}},{key:"createAttributesAndIndices",value:function(D,k,le){var Ce=this;this.featureLayout={sizePerElement:0,elements:[]},k&&(this.triangulation=k);var ft=this.attributes.map(function(Ca){return Ca.resetDescriptor(),Ca.descriptor}),Rt=0,Tt=[],cr=[],Kr=[],Nn=3;D.forEach(function(Ca,Va){var Ga=Ce.triangulation(Ca,le),to=Ga.indices,ca=Ga.vertices,da=Ga.normals,va=Ga.size;to.forEach(function(Ka){cr.push(Ka+Rt)}),Nn=va;var vo=ca.length/va;Ce.featureLayout.sizePerElement=Nn,Ce.featureLayout.elements.push({featureIdx:Va,vertices:ca,normals:da,offset:Rt}),Rt+=vo;for(var Fi=function(Oo){var ac=(da==null?void 0:da.slice(Oo*3,Oo*3+3))||[],bu=ca.slice(Oo*va,Oo*va+va);ft.forEach(function(Es,Ou){if(Es&&Es.update){var Wu;(Wu=Es.buffer.data).push.apply(Wu,(0,qo.Z)(Es.update(Ca,Va,bu,Oo,ac)))}})},Ia=0;Ia<vo;Ia++)Fi(Ia)});var ni=this.rendererService,li=ni.createAttribute,Li=ni.createBuffer,Mi=ni.createElements,aa={};ft.forEach(function(Ca,Va){if(Ca){var Ga=Ca.buffer,to=Ca.update,ca=Ca.name,da=(0,Qu.Z)(Ca,["buffer","update","name"]),va=li(yl({buffer:Li(Ga)},da));aa[Ca.name||""]=va,Ce.attributes[Va].vertexAttribute=va}});var xa=Mi({data:cr,type:Qi.gl.UNSIGNED_INT,count:cr.length});return this.attributesAndIndices={attributes:aa,elements:xa},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var D;this.attributes.forEach(function(k){k.vertexAttribute&&k.vertexAttribute.destroy()}),(D=this.attributesAndIndices)===null||D===void 0||D.elements.destroy(),this.attributes=[]}}]),X}(),wo=(0,_e.Z)(Aa.prototype,"rendererService",[Ys],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aa))||Ts),Lu=b(65859),Us=b(67499),_l=b.n(Us),m,w,z,I,fe,Le,pt,Zt,jt,Fr,Wr,hn,Oi,Ei,pa,Ma,ga,_i,go,Ao,Ks,uu,$s,Ru,Ho,_s,uo,La,Js,xl,xs,kl,Qs;function qs(X){var Q=mc();return function(){var k=(0,ur.Z)(X),le;if(Q){var Ce=(0,ur.Z)(this).constructor;le=Reflect.construct(k,arguments,Ce)}else le=k.apply(this,arguments);return(0,ar.Z)(this,le)}}function mc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(X){return!1}}var Du=(m=(0,me.b2)(),w=(0,me.f3)(ue.v.SceneID),z=(0,me.f3)(ue.v.IIconService),I=(0,me.f3)(ue.v.IFontService),fe=(0,me.f3)(ue.v.IControlService),Le=(0,me.f3)(ue.v.IGlobalConfigService),pt=(0,me.f3)(ue.v.IMapService),Zt=(0,me.f3)(ue.v.ICoordinateSystemService),jt=(0,me.f3)(ue.v.IRendererService),Fr=(0,me.f3)(ue.v.ILayerService),Wr=(0,me.f3)(ue.v.ICameraService),hn=(0,me.f3)(ue.v.IInteractionService),Oi=(0,me.f3)(ue.v.IPickingService),Ei=(0,me.f3)(ue.v.IShaderModuleService),pa=(0,me.f3)(ue.v.IMarkerService),Ma=(0,me.f3)(ue.v.IPopupService),m(ga=(_i=function(X){(0,Ot.Z)(D,X);var Q=qs(D);function D(){var k;return(0,ae.Z)(this,D),k=Q.call(this),(0,K.Z)((0,Oe.Z)(k),"destroyed",!1),(0,K.Z)((0,Oe.Z)(k),"loaded",!1),(0,K.Z)((0,Oe.Z)(k),"loadFont",!1),(0,K.Z)((0,Oe.Z)(k),"fontFamily",""),(0,oe.Z)((0,Oe.Z)(k),"id",go,(0,Oe.Z)(k)),(0,oe.Z)((0,Oe.Z)(k),"iconService",Ao,(0,Oe.Z)(k)),(0,oe.Z)((0,Oe.Z)(k),"fontService",Ks,(0,Oe.Z)(k)),(0,oe.Z)((0,Oe.Z)(k),"controlService",uu,(0,Oe.Z)(k)),(0,oe.Z)((0,Oe.Z)(k),"configService",$s,(0,Oe.Z)(k)),(0,oe.Z)((0,Oe.Z)(k),"map",Ru,(0,Oe.Z)(k)),(0,oe.Z)((0,Oe.Z)(k),"coordinateSystemService",Ho,(0,Oe.Z)(k)),(0,oe.Z)((0,Oe.Z)(k),"rendererService",_s,(0,Oe.Z)(k)),(0,oe.Z)((0,Oe.Z)(k),"layerService",uo,(0,Oe.Z)(k)),(0,oe.Z)((0,Oe.Z)(k),"cameraService",La,(0,Oe.Z)(k)),(0,oe.Z)((0,Oe.Z)(k),"interactionService",Js,(0,Oe.Z)(k)),(0,oe.Z)((0,Oe.Z)(k),"pickingService",xl,(0,Oe.Z)(k)),(0,oe.Z)((0,Oe.Z)(k),"shaderModuleService",xs,(0,Oe.Z)(k)),(0,oe.Z)((0,Oe.Z)(k),"markerService",kl,(0,Oe.Z)(k)),(0,oe.Z)((0,Oe.Z)(k),"popupService",Qs,(0,Oe.Z)(k)),(0,K.Z)((0,Oe.Z)(k),"inited",!1),(0,K.Z)((0,Oe.Z)(k),"initPromise",void 0),(0,K.Z)((0,Oe.Z)(k),"rendering",!1),(0,K.Z)((0,Oe.Z)(k),"$container",void 0),(0,K.Z)((0,Oe.Z)(k),"canvas",void 0),(0,K.Z)((0,Oe.Z)(k),"markerContainer",void 0),(0,K.Z)((0,Oe.Z)(k),"hooks",void 0),(0,K.Z)((0,Oe.Z)(k),"handleWindowResized",function(){k.emit("resize"),k.$container&&(k.initContainer(),Qe.SO.triggerResize(),k.coordinateSystemService.needRefresh=!0,k.render())}),(0,K.Z)((0,Oe.Z)(k),"handleMapCameraChanged",function(le){k.cameraService.update(le),k.render("mapRender")}),k.hooks={init:new Lu.zj},k}return(0,Ne.Z)(D,[{key:"init",value:function(le){var Ce=this;this.configService.setSceneConfig(this.id,le),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Jo.Z)(qi().mark(function ft(){return qi().wrap(function(Tt){for(;;)switch(Tt.prev=Tt.next){case 0:return Tt.next=2,new Promise(function(cr){Ce.map.onCameraChanged(function(Kr){Ce.cameraService.init(),Ce.cameraService.update(Kr),Ce.map.version!=="GAODE2.x"&&cr()}),Ce.map.version!=="GAODE2.x"?Ce.map.init():cr()});case 2:if(!(Ce.map.version==="GAODE2.x"&&Ce.map.initViewPort)){Tt.next=6;break}return Tt.next=5,Ce.map.init();case 5:Ce.map.initViewPort();case 6:Ce.map.onCameraChanged(Ce.handleMapCameraChanged),Ce.map.addMarkerContainer(),Ce.markerService.addMarkers(),Ce.markerService.addMarkerLayers(),Ce.popupService.initPopup(),Ce.interactionService.init(),Ce.interactionService.on(hi.s.Drag,Ce.addSceneEvent.bind(Ce));case 13:case"end":return Tt.stop()}},ft)}))),this.hooks.init.tapPromise("initRenderer",(0,Jo.Z)(qi().mark(function ft(){var Rt;return qi().wrap(function(cr){for(;;)switch(cr.prev=cr.next){case 0:if(Rt=Ji(Ce.configService.getSceneConfig(Ce.id).id||""),Ce.$container=Rt,!Rt){cr.next=11;break}return Ce.canvas=Qe.SO.create("canvas","",Rt),Ce.setCanvas(),cr.next=7,Ce.rendererService.init(Ce.canvas,Ce.configService.getSceneConfig(Ce.id));case 7:_l()(Ce.$container,Ce.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(Ce.handleWindowResized),cr.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:Ce.pickingService.init(Ce.id);case 13:case"end":return cr.stop()}},ft)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(le){this.layerService.add(le),this.render()}},{key:"render",value:function(){var k=(0,Jo.Z)(qi().mark(function Ce(ft){return qi().wrap(function(Tt){for(;;)switch(Tt.prev=Tt.next){case 0:if(!(this.rendering||this.destroyed)){Tt.next=2;break}return Tt.abrupt("return");case 2:if(this.rendering=!0,this.inited){Tt.next=15;break}return Tt.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){Tt.next=10;break}return Tt.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.renderLayers(ft),this.rendering=!1;case 17:case"end":return Tt.stop()}},Ce,this)}));function le(Ce){return k.apply(this,arguments)}return le}()},{key:"addFontFace",value:function(le,Ce){this.fontFamily=le;var ft=document.createElement("style");ft.type="text/css",ft.innerText=`
        @font-face{
            font-family: '`.concat(le,`';
            src: url('`).concat(Ce,`') format('woff2'),
            url('`).concat(Ce,`') format('woff'),
            url('`).concat(Ce,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(ft),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(le){var Ce,ft=(Ce=this.$container)===null||Ce===void 0?void 0:Ce.getElementsByTagName("canvas")[0];this.render();var Rt=le==="jpg"?ft==null?void 0:ft.toDataURL("image/jpeg"):ft==null?void 0:ft.toDataURL("image/png");return Rt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var le=this.$container.parentElement;le!==null&&(this.markerContainer=Qe.SO.create("div","l7-marker-container",le))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var le,Ce;if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),(le=this.$container)===null||le===void 0||(Ce=le.parentNode)===null||Ce===void 0||Ce.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Us.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var le,Ce,ft=Qe.SO.DPR,Rt=((le=this.$container)===null||le===void 0?void 0:le.clientWidth)||400,Tt=((Ce=this.$container)===null||Ce===void 0?void 0:Ce.clientHeight)||300,cr=this.canvas;cr&&(cr.width=Rt*ft,cr.height=Tt*ft,cr.style.width="".concat(Rt,"px"),cr.style.height="".concat(Tt,"px")),this.rendererService.viewport({x:0,y:0,width:ft*Rt,height:ft*Tt})}},{key:"setCanvas",value:function(){var le,Ce,ft=Qe.SO.DPR,Rt=((le=this.$container)===null||le===void 0?void 0:le.clientWidth)||400,Tt=((Ce=this.$container)===null||Ce===void 0?void 0:Ce.clientHeight)||300,cr=this.canvas;cr.width=Rt*ft,cr.height=Tt*ft,cr.style.width="".concat(Rt,"px"),cr.style.height="".concat(Tt,"px")}},{key:"addSceneEvent",value:function(le){this.emit(le.type,le)}}]),D}(E.EventEmitter),go=(0,_e.Z)(_i.prototype,"id",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ao=(0,_e.Z)(_i.prototype,"iconService",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ks=(0,_e.Z)(_i.prototype,"fontService",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uu=(0,_e.Z)(_i.prototype,"controlService",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$s=(0,_e.Z)(_i.prototype,"configService",[Le],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ru=(0,_e.Z)(_i.prototype,"map",[pt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ho=(0,_e.Z)(_i.prototype,"coordinateSystemService",[Zt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_s=(0,_e.Z)(_i.prototype,"rendererService",[jt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uo=(0,_e.Z)(_i.prototype,"layerService",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),La=(0,_e.Z)(_i.prototype,"cameraService",[Wr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Js=(0,_e.Z)(_i.prototype,"interactionService",[hn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xl=(0,_e.Z)(_i.prototype,"pickingService",[Oi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xs=(0,_e.Z)(_i.prototype,"shaderModuleService",[Ei],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kl=(0,_e.Z)(_i.prototype,"markerService",[pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qs=(0,_e.Z)(_i.prototype,"popupService",[Ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_i))||ga),Ra=b(21691),bl=b.n(Ra);function Kc(X){var Q=0;switch(X){case"vec2":case"ivec2":Q=2;break;case"vec3":case"ivec3":Q=3;break;case"vec4":case"ivec4":case"mat2":Q=4;break;case"mat3":Q=9;break;case"mat4":Q=16;break;default:}return Q}var ku=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Sl(X){var Q={};return X=X.replace(ku,function(D,k,le){var Ce=le.split(":"),ft=Ce[0].trim(),Rt="";switch(Ce.length>1&&(Rt=Ce[1].trim()),k){case"bool":Rt=Rt==="true";break;case"float":case"int":Rt=Number(Rt);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":Rt?Rt=Rt.replace("[","").replace("]","").split(",").reduce(function(Tt,cr){return Tt.push(Number(cr.trim())),Tt},[]):Rt=new Array(Kc(k)).fill(0);break;default:}return Q[ft]=Rt,"uniform ".concat(k," ").concat(ft,`;
`)}),{content:X,uniforms:Q}}var $c,el;function Ql(X,Q){var D=Object.keys(X);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(X);Q&&(k=k.filter(function(le){return Object.getOwnPropertyDescriptor(X,le).enumerable})),D.push.apply(D,k)}return D}function Au(X){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?Ql(Object(D),!0).forEach(function(k){(0,K.Z)(X,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(D)):Ql(Object(D)).forEach(function(k){Object.defineProperty(X,k,Object.getOwnPropertyDescriptor(D,k))})}return X}var tl="#define PI 3.14159265359",El=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Cl=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,rl=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,wl=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,nl=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,eu=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,ql=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Fu=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Dc=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,il=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Al=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Fl=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,yc=/precision\s+(high|low|medium)p\s+float/,Bl=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,kc=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,ec=($c=(0,me.b2)(),$c(el=function(){function X(){(0,ae.Z)(this,X),(0,K.Z)(this,"moduleCache",{}),(0,K.Z)(this,"rawContentCache",{})}return(0,Ne.Z)(X,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:tl,fs:tl}),this.registerModule("decode",{vs:El,fs:""}),this.registerModule("projection",{vs:ql,fs:""}),this.registerModule("project",{vs:eu,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Fu}),this.registerModule("lighting",{vs:rl,fs:""}),this.registerModule("light",{vs:Cl,fs:""}),this.registerModule("picking",{vs:nl,fs:wl}),this.registerModule("styleMapping",{vs:Dc,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:il,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Al,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Fl,fs:""})}},{key:"registerModule",value:function(D,k){if(!this.rawContentCache[D]){var le=k.vs,Ce=k.fs,ft=k.uniforms,Rt=Sl(le),Tt=Rt.content,cr=Rt.uniforms,Kr=Sl(Ce),Nn=Kr.content,ni=Kr.uniforms;this.rawContentCache[D]={fs:Nn,uniforms:Au(Au(Au({},cr),ni),ft),vs:Tt}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(D){var k=this;if(this.moduleCache[D])return this.moduleCache[D];var le=this.rawContentCache[D].vs,Ce=this.rawContentCache[D].fs,ft=this.processModule(le,[],"vs"),Rt=ft.content,Tt=ft.includeList,cr=this.processModule(Ce,[],"fs"),Kr=cr.content,Nn=cr.includeList,ni=Kr,li=bl()(Tt.concat(Nn).concat(D)).reduce(function(Li,Mi){return Au(Au({},Li),k.rawContentCache[Mi].uniforms)},{});return yc.test(Kr)||(ni=Bl+Kr),this.moduleCache[D]={fs:ni.trim(),uniforms:li,vs:Rt.trim()},this.moduleCache[D]}},{key:"processModule",value:function(D,k,le){var Ce=this,ft=D.replace(kc,function(Rt,Tt){var cr=Tt.split(" "),Kr=cr[0].replace(/"/g,"");if(k.indexOf(Kr)>-1)return"";var Nn=Ce.rawContentCache[Kr][le];k.push(Kr);var ni=Ce.processModule(Nn,k,le),li=ni.content;return li});return{content:ft,includeList:k}}}]),X}())||el);function vu(X,Q){for(;!Object.prototype.hasOwnProperty.call(X,Q)&&(X=(0,ur.Z)(X),X!==null););return X}function Xa(X,Q,D){return typeof Reflect!="undefined"&&Reflect.get?Xa=Reflect.get:Xa=function(le,Ce,ft){var Rt=vu(le,Ce);if(!!Rt){var Tt=Object.getOwnPropertyDescriptor(Rt,Ce);return Tt.get?Tt.get.call(ft):Tt.value}},Xa(X,Q,D||X)}var lo=b(35951),Bu,Fs,tc,Nl,Nu,Tl=(Bu=(0,me.b2)(),Fs=(0,me.f3)(ue.v.IShaderModuleService),Bu(tc=(Nl=function(){function X(){(0,ae.Z)(this,X),(0,oe.Z)(this,"shaderModuleService",Nu,this),(0,K.Z)(this,"rendererService",void 0),(0,K.Z)(this,"cameraService",void 0),(0,K.Z)(this,"mapService",void 0),(0,K.Z)(this,"interactionService",void 0),(0,K.Z)(this,"layerService",void 0),(0,K.Z)(this,"config",void 0)}return(0,Ne.Z)(X,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return lo.G.Normal}},{key:"init",value:function(D,k){this.config=k,this.rendererService=D.getContainer().get(ue.v.IRendererService),this.cameraService=D.getContainer().get(ue.v.ICameraService),this.mapService=D.getContainer().get(ue.v.IMapService),this.interactionService=D.getContainer().get(ue.v.IInteractionService),this.layerService=D.getContainer().get(ue.v.ILayerService)}},{key:"render",value:function(D){}}]),X}(),Nu=(0,_e.Z)(Nl.prototype,"shaderModuleService",[Fs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nl))||tc),zu,qa;function zl(X){var Q=js();return function(){var k=(0,ur.Z)(X),le;if(Q){var Ce=(0,ur.Z)(this).constructor;le=Reflect.construct(k,arguments,Ce)}else le=k.apply(this,arguments);return(0,ar.Z)(this,le)}}function js(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(X){return!1}}var mu=(zu=(0,me.b2)(),zu(qa=function(X){(0,Ot.Z)(D,X);var Q=zl(D);function D(){return(0,ae.Z)(this,D),Q.apply(this,arguments)}return(0,Ne.Z)(D,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(le,Ce){Xa((0,ur.Z)(D.prototype),"init",this).call(this,le,Ce)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),D}(Tl))||qa),la,Pi,Ps,tu,Zu;function ts(X,Q){var D=typeof Symbol!="undefined"&&X[Symbol.iterator]||X["@@iterator"];if(!D){if(Array.isArray(X)||(D=pf(X))||Q&&X&&typeof X.length=="number"){D&&(X=D);var k=0,le=function(){};return{s:le,n:function(){return k>=X.length?{done:!0}:{done:!1,value:X[k++]}},e:function(cr){throw cr},f:le}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ce=!0,ft=!1,Rt;return{s:function(){D=D.call(X)},n:function(){var cr=D.next();return Ce=cr.done,cr},e:function(cr){ft=!0,Rt=cr},f:function(){try{!Ce&&D.return!=null&&D.return()}finally{if(ft)throw Rt}}}}function pf(X,Q){if(!!X){if(typeof X=="string")return gc(X,Q);var D=Object.prototype.toString.call(X).slice(8,-1);if(D==="Object"&&X.constructor&&(D=X.constructor.name),D==="Map"||D==="Set")return Array.from(X);if(D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D))return gc(X,Q)}}function gc(X,Q){(Q==null||Q>X.length)&&(Q=X.length);for(var D=0,k=new Array(Q);D<Q;D++)k[D]=X[D];return k}var Zl=(la=(0,me.b2)(),Pi=(0,me.f3)(ue.v.IPostProcessor),la(Ps=(tu=function(){function X(){(0,ae.Z)(this,X),(0,K.Z)(this,"passes",[]),(0,oe.Z)(this,"postProcessor",Zu,this),(0,K.Z)(this,"layer",void 0),(0,K.Z)(this,"renderFlag",void 0),(0,K.Z)(this,"width",0),(0,K.Z)(this,"height",0)}return(0,Ne.Z)(X,[{key:"setLayer",value:function(D){this.layer=D}},{key:"setRenderFlag",value:function(D){this.renderFlag=D}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var Q=(0,Jo.Z)(qi().mark(function k(){var le,Ce,ft;return qi().wrap(function(Tt){for(;;)switch(Tt.prev=Tt.next){case 0:le=ts(this.passes),Tt.prev=1,le.s();case 3:if((Ce=le.n()).done){Tt.next=9;break}return ft=Ce.value,Tt.next=7,ft.render(this.layer);case 7:Tt.next=3;break;case 9:Tt.next=14;break;case 11:Tt.prev=11,Tt.t0=Tt.catch(1),le.e(Tt.t0);case 14:return Tt.prev=14,le.f(),Tt.finish(14);case 17:this.layer.renderModels();case 18:case"end":return Tt.stop()}},k,this,[[1,11,14,17]])}));function D(){return Q.apply(this,arguments)}return D}()},{key:"resize",value:function(D,k){(this.width!==D||this.height!==k)&&(this.width=D,this.height=k)}},{key:"add",value:function(D,k){D.getType()===lo.G.PostProcessing?this.postProcessor.add(D,this.layer,k):(D.init(this.layer,k),this.passes.push(D))}},{key:"insert",value:function(D,k,le){D.init(this.layer,k),this.passes.splice(le,0,D)}},{key:"destroy",value:function(){this.passes.length=0}}]),X}(),Zu=(0,_e.Z)(tu.prototype,"postProcessor",[Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tu))||Ps),Ul,yu;function To(X,Q){var D=Object.keys(X);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(X);Q&&(k=k.filter(function(le){return Object.getOwnPropertyDescriptor(X,le).enumerable})),D.push.apply(D,k)}return D}function Tu(X){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?To(Object(D),!0).forEach(function(k){(0,K.Z)(X,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(D)):To(Object(D)).forEach(function(k){Object.defineProperty(X,k,Object.getOwnPropertyDescriptor(D,k))})}return X}function Pl(X){var Q=Po();return function(){var k=(0,ur.Z)(X),le;if(Q){var Ce=(0,ur.Z)(this).constructor;le=Reflect.construct(k,arguments,Ce)}else le=k.apply(this,arguments);return(0,ar.Z)(this,le)}}function Po(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(X){return!1}}var Vn=(Ul=(0,me.b2)(),Ul(yu=function(X){(0,Ot.Z)(D,X);var Q=Pl(D);function D(){var k;(0,ae.Z)(this,D);for(var le=arguments.length,Ce=new Array(le),ft=0;ft<le;ft++)Ce[ft]=arguments[ft];return k=Q.call.apply(Q,[this].concat(Ce)),(0,K.Z)((0,Oe.Z)(k),"pickingFBO",void 0),(0,K.Z)((0,Oe.Z)(k),"layer",void 0),(0,K.Z)((0,Oe.Z)(k),"width",0),(0,K.Z)((0,Oe.Z)(k),"height",0),(0,K.Z)((0,Oe.Z)(k),"alreadyInRendering",!1),(0,K.Z)((0,Oe.Z)(k),"pickFromPickingFBO",function(Rt){var Tt=Rt.x,cr=Rt.y,Kr=Rt.lngLat,Nn=Rt.type;if(!(!k.layer.isVisible()||!k.layer.needPick(Nn))){var ni=k.rendererService,li=ni.getViewportSize,Li=ni.readPixels,Mi=ni.useFramebuffer,aa=li(),xa=aa.width,Ca=aa.height,Va=k.layer.getLayerConfig(),Ga=Va.enableHighlight,to=Va.enableSelect,ca=Tt*Qe.SO.DPR,da=cr*Qe.SO.DPR;if(!(ca>xa||ca<0||da>Ca||da<0)){var va;Mi(k.pickingFBO,function(){var vo;if(va=Li({x:Math.round(ca),y:Math.round(Ca-(cr+1)*Qe.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:k.pickingFBO}),va[0]!==0||va[1]!==0||va[2]!==0){var Fi=(0,Qe.W0)(va),Ia=k.layer.getSource().getFeatureById(Fi),Ka={x:Tt,y:cr,type:Nn,lngLat:Kr,featureId:Fi,feature:Ia};Ia&&(k.layer.setCurrentPickId(Fi),k.triggerHoverOnLayer(Ka))}else{var Oo={x:Tt,y:cr,lngLat:Kr,type:k.layer.getCurrentPickId()===null?"un"+Nn:"mouseout",featureId:null,feature:null};k.triggerHoverOnLayer(Tu(Tu({},Oo),{},{type:"unpick"})),k.triggerHoverOnLayer(Oo),k.layer.setCurrentPickId(null)}Ga&&k.highlightPickedFeature(va),to&&Nn==="click"&&((vo=va)===null||vo===void 0?void 0:vo.toString())!==[0,0,0,0].toString()&&k.selectFeature(va)})}}}),k}return(0,Ne.Z)(D,[{key:"getType",value:function(){return lo.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(le,Ce){Xa((0,ur.Z)(D.prototype),"init",this).call(this,le,Ce),this.layer=le;var ft=this.rendererService,Rt=ft.createTexture2D,Tt=ft.createFramebuffer,cr=ft.getViewportSize,Kr=cr(),Nn=Kr.width,ni=Kr.height;this.pickingFBO=Tt({color:Rt({width:Nn,height:ni,wrapS:Qi.gl.CLAMP_TO_EDGE,wrapT:Qi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(hi.s.Hover,this.pickFromPickingFBO),this.interactionService.on(hi.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(hi.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(le){var Ce=this;if(!this.alreadyInRendering){var ft=this.rendererService,Rt=ft.getViewportSize,Tt=ft.useFramebuffer,cr=ft.clear,Kr=Rt(),Nn=Kr.width,ni=Kr.height;this.alreadyInRendering=!0,(this.width!==Nn||this.height!==ni)&&(this.pickingFBO.resize({width:Nn,height:ni}),this.width=Nn,this.height=ni),Tt(this.pickingFBO,function(){cr({framebuffer:Ce.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var li=Ce.layer.multiPassRenderer.getRenderFlag();Ce.layer.multiPassRenderer.setRenderFlag(!1),le.hooks.beforePickingEncode.call(),le.render(),le.hooks.afterPickingEncode.call(),Ce.layer.multiPassRenderer.setRenderFlag(li),Ce.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(le){this.layer.emit(le.type,le)}},{key:"highlightPickedFeature",value:function(le){var Ce=(0,Ct.Z)(le,3),ft=Ce[0],Rt=Ce[1],Tt=Ce[2];this.layer.hooks.beforeHighlight.call([ft,Rt,Tt]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(le){var Ce=(0,Ct.Z)(le,3),ft=Ce[0],Rt=Ce[1],Tt=Ce[2];this.layer.hooks.beforeSelect.call([ft,Rt,Tt]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(le){var Ce=le.featureId,ft=(0,Qe.Z6)(Ce);this.selectFeature(new Uint8Array(ft))}},{key:"highlightFeatureHandle",value:function(le){var Ce=le.featureId,ft=(0,Qe.Z6)(Ce);this.highlightPickedFeature(new Uint8Array(ft))}}]),D}(Tl))||yu),Na=b(16546),gu,Uu;function eo(X,Q){var D=Object.keys(X);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(X);Q&&(k=k.filter(function(le){return Object.getOwnPropertyDescriptor(X,le).enumerable})),D.push.apply(D,k)}return D}function Ms(X){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?eo(Object(D),!0).forEach(function(k){(0,K.Z)(X,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(D)):eo(Object(D)).forEach(function(k){Object.defineProperty(X,k,Object.getOwnPropertyDescriptor(D,k))})}return X}function _c(X){var Q=En();return function(){var k=(0,ur.Z)(X),le;if(Q){var Ce=(0,ur.Z)(this).constructor;le=Reflect.construct(k,arguments,Ce)}else le=k.apply(this,arguments);return(0,ar.Z)(this,le)}}function En(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(X){return!1}}var Pu=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,xc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lu=(gu=(0,me.b2)(),gu(Uu=function(X){(0,Ot.Z)(D,X);var Q=_c(D);function D(){return(0,ae.Z)(this,D),Q.apply(this,arguments)}return(0,Ne.Z)(D,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:xc,fs:Pu});var le=this.shaderModuleService.getModule("blur-pass"),Ce=le.vs,ft=le.fs,Rt=le.uniforms,Tt=this.rendererService.getViewportSize(),cr=Tt.width,Kr=Tt.height;return{vs:Ce,fs:ft,uniforms:Ms(Ms({},Rt),{},{u_ViewportSize:[cr,Kr]})}}},{key:"convertOptionsToUniforms",value:function(le){var Ce={};return ss()(le.blurRadius)||(Ce.u_BlurDir=[le.blurRadius,0]),Ce}}]),D}(Na.Z))||Uu),ja,bs;function Ml(X,Q){var D=Object.keys(X);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(X);Q&&(k=k.filter(function(le){return Object.getOwnPropertyDescriptor(X,le).enumerable})),D.push.apply(D,k)}return D}function Vs(X){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?Ml(Object(D),!0).forEach(function(k){(0,K.Z)(X,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(D)):Ml(Object(D)).forEach(function(k){Object.defineProperty(X,k,Object.getOwnPropertyDescriptor(D,k))})}return X}function Is(X){var Q=_u();return function(){var k=(0,ur.Z)(X),le;if(Q){var Ce=(0,ur.Z)(this).constructor;le=Reflect.construct(k,arguments,Ce)}else le=k.apply(this,arguments);return(0,ar.Z)(this,le)}}function _u(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(X){return!1}}var Jc=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,rc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bc=(ja=(0,me.b2)(),ja(bs=function(X){(0,Ot.Z)(D,X);var Q=Is(D);function D(){return(0,ae.Z)(this,D),Q.apply(this,arguments)}return(0,Ne.Z)(D,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:rc,fs:Jc});var le=this.shaderModuleService.getModule("blur-pass"),Ce=le.vs,ft=le.fs,Rt=le.uniforms,Tt=this.rendererService.getViewportSize(),cr=Tt.width,Kr=Tt.height;return{vs:Ce,fs:ft,uniforms:Vs(Vs({},Rt),{},{u_ViewportSize:[cr,Kr]})}}},{key:"convertOptionsToUniforms",value:function(le){var Ce={};return ss()(le.blurRadius)||(Ce.u_BlurDir=[0,le.blurRadius]),Ce}}]),D}(Na.Z))||bs),Bo,Gs;function Mo(X,Q){var D=Object.keys(X);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(X);Q&&(k=k.filter(function(le){return Object.getOwnPropertyDescriptor(X,le).enumerable})),D.push.apply(D,k)}return D}function ea(X){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?Mo(Object(D),!0).forEach(function(k){(0,K.Z)(X,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(D)):Mo(Object(D)).forEach(function(k){Object.defineProperty(X,k,Object.getOwnPropertyDescriptor(D,k))})}return X}function ju(X){var Q=cu();return function(){var k=(0,ur.Z)(X),le;if(Q){var Ce=(0,ur.Z)(this).constructor;le=Reflect.construct(k,arguments,Ce)}else le=k.apply(this,arguments);return(0,ar.Z)(this,le)}}function cu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(X){return!1}}var Wo=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,al=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Mu=(Bo=(0,me.b2)(),Bo(Gs=function(X){(0,Ot.Z)(D,X);var Q=ju(D);function D(){return(0,ae.Z)(this,D),Q.apply(this,arguments)}return(0,Ne.Z)(D,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:al,fs:Wo});var le=this.shaderModuleService.getModule("colorhalftone-pass"),Ce=le.vs,ft=le.fs,Rt=le.uniforms,Tt=this.rendererService.getViewportSize(),cr=Tt.width,Kr=Tt.height;return{vs:Ce,fs:ft,uniforms:ea(ea({},Rt),{},{u_ViewportSize:[cr,Kr]})}}}]),D}(Na.Z))||Gs),xi,co;function Il(X){var Q=Gn();return function(){var k=(0,ur.Z)(X),le;if(Q){var Ce=(0,ur.Z)(this).constructor;le=Reflect.construct(k,arguments,Ce)}else le=k.apply(this,arguments);return(0,ar.Z)(this,le)}}function Gn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(X){return!1}}var Wn=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,ol=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ls=(xi=(0,me.b2)(),xi(co=function(X){(0,Ot.Z)(D,X);var Q=Il(D);function D(){return(0,ae.Z)(this,D),Q.apply(this,arguments)}return(0,Ne.Z)(D,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:ol,fs:Wn}),this.shaderModuleService.getModule("copy-pass")}}]),D}(Na.Z))||co),cs,Io;function ru(X,Q){var D=Object.keys(X);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(X);Q&&(k=k.filter(function(le){return Object.getOwnPropertyDescriptor(X,le).enumerable})),D.push.apply(D,k)}return D}function Sc(X){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?ru(Object(D),!0).forEach(function(k){(0,K.Z)(X,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(D)):ru(Object(D)).forEach(function(k){Object.defineProperty(X,k,Object.getOwnPropertyDescriptor(D,k))})}return X}function nc(X){var Q=Xi();return function(){var k=(0,ur.Z)(X),le;if(Q){var Ce=(0,ur.Z)(this).constructor;le=Reflect.construct(k,arguments,Ce)}else le=k.apply(this,arguments);return(0,ar.Z)(this,le)}}function Xi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(X){return!1}}var ji=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Qc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Bs=(cs=(0,me.b2)(),cs(Io=function(X){(0,Ot.Z)(D,X);var Q=nc(D);function D(){return(0,ae.Z)(this,D),Q.apply(this,arguments)}return(0,Ne.Z)(D,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Qc,fs:ji});var le=this.shaderModuleService.getModule("hexagonalpixelate-pass"),Ce=le.vs,ft=le.fs,Rt=le.uniforms,Tt=this.rendererService.getViewportSize(),cr=Tt.width,Kr=Tt.height;return{vs:Ce,fs:ft,uniforms:Sc(Sc({},Rt),{},{u_ViewportSize:[cr,Kr]})}}}]),D}(Na.Z))||Io),Ol,Os;function Ya(X,Q){var D=Object.keys(X);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(X);Q&&(k=k.filter(function(le){return Object.getOwnPropertyDescriptor(X,le).enumerable})),D.push.apply(D,k)}return D}function Hs(X){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?Ya(Object(D),!0).forEach(function(k){(0,K.Z)(X,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(D)):Ya(Object(D)).forEach(function(k){Object.defineProperty(X,k,Object.getOwnPropertyDescriptor(D,k))})}return X}function Ss(X){var Q=Vu();return function(){var k=(0,ur.Z)(X),le;if(Q){var Ce=(0,ur.Z)(this).constructor;le=Reflect.construct(k,arguments,Ce)}else le=k.apply(this,arguments);return(0,ar.Z)(this,le)}}function Vu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(X){return!1}}var sl=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Ll=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ec=(Ol=(0,me.b2)(),Ol(Os=function(X){(0,Ot.Z)(D,X);var Q=Ss(D);function D(){return(0,ae.Z)(this,D),Q.apply(this,arguments)}return(0,Ne.Z)(D,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Ll,fs:sl});var le=this.shaderModuleService.getModule("ink-pass"),Ce=le.vs,ft=le.fs,Rt=le.uniforms,Tt=this.rendererService.getViewportSize(),cr=Tt.width,Kr=Tt.height;return{vs:Ce,fs:ft,uniforms:Hs(Hs({},Rt),{},{u_ViewportSize:[cr,Kr]})}}}]),D}(Na.Z))||Os),ul,Gu;function ll(X){var Q=xu();return function(){var k=(0,ur.Z)(X),le;if(Q){var Ce=(0,ur.Z)(this).constructor;le=Reflect.construct(k,arguments,Ce)}else le=k.apply(this,arguments);return(0,ar.Z)(this,le)}}function xu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(X){return!1}}var Hu=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Cc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Iu=(ul=(0,me.b2)(),ul(Gu=function(X){(0,Ot.Z)(D,X);var Q=ll(D);function D(){return(0,ae.Z)(this,D),Q.apply(this,arguments)}return(0,Ne.Z)(D,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Cc,fs:Hu}),this.shaderModuleService.getModule("noise-pass")}}]),D}(Na.Z))||Gu),Ns,wc;function ic(X){var Q=jl();return function(){var k=(0,ur.Z)(X),le;if(Q){var Ce=(0,ur.Z)(this).constructor;le=Reflect.construct(k,arguments,Ce)}else le=k.apply(this,arguments);return(0,ar.Z)(this,le)}}function jl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(X){return!1}}var cl=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,i=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,u=(Ns=(0,me.b2)(),Ns(wc=function(X){(0,Ot.Z)(D,X);var Q=ic(D);function D(){return(0,ae.Z)(this,D),Q.apply(this,arguments)}return(0,Ne.Z)(D,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:cl,fs:i}),this.shaderModuleService.getModule("sepia-pass")}}]),D}(Na.Z))||wc),o,h,g,S,T,R,G=(o=(0,me.b2)(),h=(0,me.f3)(ue.v.IRendererService),g=(0,me.zY)(),o(S=(T=function(){function X(){(0,ae.Z)(this,X),(0,oe.Z)(this,"rendererService",R,this),(0,K.Z)(this,"passes",[]),(0,K.Z)(this,"readFBO",void 0),(0,K.Z)(this,"writeFBO",void 0)}return(0,Ne.Z)(X,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var Q=(0,Jo.Z)(qi().mark(function k(le){var Ce,ft;return qi().wrap(function(Tt){for(;;)switch(Tt.prev=Tt.next){case 0:Ce=0;case 1:if(!(Ce<this.passes.length)){Tt.next=10;break}return ft=this.passes[Ce],ft.setRenderToScreen(this.isLastEnabledPass(Ce)),Tt.next=6,ft.render(le);case 6:Ce!==this.passes.length-1&&this.swap();case 7:Ce++,Tt.next=1;break;case 10:case"end":return Tt.stop()}},k,this)}));function D(k){return Q.apply(this,arguments)}return D}()},{key:"resize",value:function(D,k){this.readFBO.resize({width:D,height:k}),this.writeFBO.resize({width:D,height:k})}},{key:"add",value:function(D,k,le){D.init(k,le),this.passes.push(D)}},{key:"insert",value:function(D,k,le,Ce){D.init(le,Ce),this.passes.splice(k,0,D)}},{key:"getPostProcessingPassByName",value:function(D){return this.passes.find(function(k){return k.getName()===D})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(D){for(var k=D+1;k<this.passes.length;k++)if(this.passes[k].isEnabled())return!1;return!0}},{key:"swap",value:function(){var D=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=D}}]),X}(),R=(0,_e.Z)(T.prototype,"rendererService",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,_e.Z)(T.prototype,"init",[g],Object.getOwnPropertyDescriptor(T.prototype,"init"),T.prototype),T))||S),se,Ee;function we(X){var Q=Pe();return function(){var k=(0,ur.Z)(X),le;if(Q){var Ce=(0,ur.Z)(this).constructor;le=Reflect.construct(k,arguments,Ce)}else le=k.apply(this,arguments);return(0,ar.Z)(this,le)}}function Pe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(X){return!1}}var Ye=(se=(0,me.b2)(),se(Ee=function(X){(0,Ot.Z)(D,X);var Q=we(D);function D(){return(0,ae.Z)(this,D),Q.apply(this,arguments)}return(0,Ne.Z)(D,[{key:"getType",value:function(){return lo.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(le,Ce){Xa((0,ur.Z)(D.prototype),"init",this).call(this,le,Ce)}},{key:"render",value:function(le){var Ce=this.rendererService,ft=Ce.useFramebuffer,Rt=Ce.clear;ft(null,function(){Rt({color:[0,0,0,0],depth:1,stencil:0}),le.multiPassRenderer.setRenderFlag(!1),le.render(),le.multiPassRenderer.setRenderFlag(!0)})}}]),D}(Tl))||Ee),We,ut,Ue,at,wt;function Xt(X,Q){var D=Object.keys(X);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(X);Q&&(k=k.filter(function(le){return Object.getOwnPropertyDescriptor(X,le).enumerable})),D.push.apply(D,k)}return D}function _r(X){for(var Q=1;Q<arguments.length;Q++){var D=arguments[Q]!=null?arguments[Q]:{};Q%2?Xt(Object(D),!0).forEach(function(k){(0,K.Z)(X,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(D)):Xt(Object(D)).forEach(function(k){Object.defineProperty(X,k,Object.getOwnPropertyDescriptor(D,k))})}return X}function dr(X){var Q=Cr();return function(){var k=(0,ur.Z)(X),le;if(Q){var Ce=(0,ur.Z)(this).constructor;le=Reflect.construct(k,arguments,Ce)}else le=k.apply(this,arguments);return(0,ar.Z)(this,le)}}function Cr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(X){return!1}}var Gr=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,pn=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,an=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Zn(X,Q){for(var D=0,k=1/Q,le=X;le>0;)D=D+k*(le%Q),le=Math.floor(le/Q),k=k/Q;return D}var ui=1,di=(We=(0,me.b2)(),ut=(0,me.f3)(ue.v.IShaderModuleService),We(Ue=(at=function(X){(0,Ot.Z)(D,X);var Q=dr(D);function D(){var k;(0,ae.Z)(this,D);for(var le=arguments.length,Ce=new Array(le),ft=0;ft<le;ft++)Ce[ft]=arguments[ft];return k=Q.call.apply(Q,[this].concat(Ce)),(0,oe.Z)((0,Oe.Z)(k),"shaderModuleService",wt,(0,Oe.Z)(k)),(0,K.Z)((0,Oe.Z)(k),"haltonSequence",[]),(0,K.Z)((0,Oe.Z)(k),"accumulatingId",0),(0,K.Z)((0,Oe.Z)(k),"frame",0),(0,K.Z)((0,Oe.Z)(k),"timer",void 0),(0,K.Z)((0,Oe.Z)(k),"sampleRenderTarget",void 0),(0,K.Z)((0,Oe.Z)(k),"prevRenderTarget",void 0),(0,K.Z)((0,Oe.Z)(k),"outputRenderTarget",void 0),(0,K.Z)((0,Oe.Z)(k),"copyRenderTarget",void 0),(0,K.Z)((0,Oe.Z)(k),"blendModel",void 0),(0,K.Z)((0,Oe.Z)(k),"outputModel",void 0),(0,K.Z)((0,Oe.Z)(k),"copyModel",void 0),k}return(0,Ne.Z)(D,[{key:"getType",value:function(){return lo.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(le,Ce){Xa((0,ur.Z)(D.prototype),"init",this).call(this,le,Ce);var ft=this.rendererService,Rt=ft.createFramebuffer,Tt=ft.createTexture2D;this.sampleRenderTarget=Rt({color:Tt({width:1,height:1,wrapS:Qi.gl.CLAMP_TO_EDGE,wrapT:Qi.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=Rt({color:Tt({width:1,height:1,wrapS:Qi.gl.CLAMP_TO_EDGE,wrapT:Qi.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=Rt({color:Tt({width:1,height:1,wrapS:Qi.gl.CLAMP_TO_EDGE,wrapT:Qi.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=Rt({color:Tt({width:1,height:1,wrapS:Qi.gl.CLAMP_TO_EDGE,wrapT:Qi.gl.CLAMP_TO_EDGE})});for(var cr=0;cr<30;cr++)this.haltonSequence.push([Zn(cr,2),Zn(cr,3)]);this.blendModel=this.createTriangleModel("blend-pass",Gr),this.outputModel=this.createTriangleModel("copy-pass",pn,{blend:{enable:!0,func:{srcRGB:Qi.gl.ONE,dstRGB:Qi.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:Qi.gl.ONE,dstAlpha:Qi.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:Qi.gl.FUNC_ADD,alpha:Qi.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",pn)}},{key:"render",value:function(le){var Ce=this,ft=this.rendererService,Rt=ft.clear,Tt=ft.getViewportSize,cr=ft.useFramebuffer,Kr=Tt(),Nn=Kr.width,ni=Kr.height;this.sampleRenderTarget.resize({width:Nn,height:ni}),this.prevRenderTarget.resize({width:Nn,height:ni}),this.outputRenderTarget.resize({width:Nn,height:ni}),this.copyRenderTarget.resize({width:Nn,height:ni}),this.resetFrame(),this.stopAccumulating();var li=le.multiPassRenderer.getPostProcessor().getReadFBO();cr(li,function(){Rt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:li}),le.multiPassRenderer.setRenderFlag(!1),le.render(),le.multiPassRenderer.setRenderFlag(!0)});var Li=function Mi(aa){!Ce.accumulatingId||aa!==Ce.accumulatingId||Ce.isFinished()||(Ce.doRender(le),requestAnimationFrame(function(){Mi(aa)}))};this.accumulatingId=ui++,this.timer=window.setTimeout(function(){Li(Ce.accumulatingId)},50)}},{key:"doRender",value:function(le){var Ce=this,ft=this.rendererService,Rt=ft.clear,Tt=ft.getViewportSize,cr=ft.useFramebuffer,Kr=Tt(),Nn=Kr.width,ni=Kr.height,li=le.getLayerConfig(),Li=li.jitterScale,Mi=Li===void 0?1:Li,aa=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((aa[0]*2-1)/Nn*Mi,(aa[1]*2-1)/ni*Mi),le.multiPassRenderer.setRenderFlag(!1),le.hooks.beforeRender.call(),cr(this.sampleRenderTarget,function(){Rt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Ce.sampleRenderTarget}),le.render()}),le.hooks.afterRender.call(),le.multiPassRenderer.setRenderFlag(!0);var xa=le.getLayerConfig();cr(this.outputRenderTarget,function(){Ce.blendModel.draw({uniforms:{u_opacity:xa.opacity||1,u_MixRatio:Ce.frame===0?1:.9,u_Diffuse1:Ce.sampleRenderTarget,u_Diffuse2:Ce.frame===0?le.multiPassRenderer.getPostProcessor().getReadFBO():Ce.prevRenderTarget}})}),this.frame===0&&Rt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(cr(this.copyRenderTarget,function(){Ce.outputModel.draw({uniforms:{u_Texture:Ce.outputRenderTarget}})}),cr(le.multiPassRenderer.getPostProcessor().getReadFBO(),function(){Ce.copyModel.draw({uniforms:{u_Texture:Ce.copyRenderTarget}})}),le.multiPassRenderer.getPostProcessor().render(le));var Ca=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Ca,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(le,Ce,ft){this.shaderModuleService.registerModule(le,{vs:an,fs:Ce});var Rt=this.shaderModuleService.getModule(le),Tt=Rt.vs,cr=Rt.fs,Kr=Rt.uniforms,Nn=this.rendererService,ni=Nn.createAttribute,li=Nn.createBuffer,Li=Nn.createModel;return Li(_r({vs:Tt,fs:cr,attributes:{a_Position:ni({buffer:li({data:[-4,-4,4,-4,0,4],type:Qi.gl.FLOAT}),size:2})},uniforms:_r({},Kr),depth:{enable:!1},count:3},ft))}}]),D}(Tl),wt=(0,_e.Z)(at.prototype,"shaderModuleService",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),at))||Ue),dn=new me.W2;dn.bind(ue.v.IGlobalConfigService).to(Ae).inSingletonScope(),dn.bind(ue.v.IShaderModuleService).to(ec).inSingletonScope(),(0,me.GW)((0,me.b2)(),E.EventEmitter),dn.bind(ue.v.IEventEmitter).to(E.EventEmitter);var ia=(0,te.Z)(dn,!1),Hn=function(Q){var D=ia.lazyInject(Q);return function(k,le,Ce){D.call(this,k,le),Ce&&(Ce.initializer=function(){return k[le]})}},bi=function(Q){var D=ia.lazyMultiInject(Q);return function(k,le,Ce){D.call(this,k,le),Ce&&(Ce.initializer=function(){return k[le]})}},Hi=dn,mi=0;function Ci(){var X=new me.W2;return X.parent=dn,X.bind(ue.v.SceneID).toConstantValue("".concat(mi++)),X.bind(ue.v.ILayerService).to(wu).inSingletonScope(),X.bind(ue.v.ISceneService).to(Du).inSingletonScope(),X.bind(ue.v.ICameraService).to(Mr).inSingletonScope(),X.bind(ue.v.ICoordinateSystemService).to(Tn).inSingletonScope(),X.bind(ue.v.IInteractionService).to(so).inSingletonScope(),X.bind(ue.v.IPickingService).to(ke).inSingletonScope(),X.bind(ue.v.IControlService).to(Sr).inSingletonScope(),X.bind(ue.v.IMarkerService).to(Xr).inSingletonScope(),X.bind(ue.v.IIconService).to(ct).inSingletonScope(),X.bind(ue.v.IFontService).to(Ze).inSingletonScope(),X.bind(ue.v.IPopupService).to(Or).inSingletonScope(),X.bind(ue.v.INormalPass).to(mu).whenTargetNamed("clear"),X.bind(ue.v.INormalPass).to(Vn).whenTargetNamed("pixelPicking"),X.bind(ue.v.INormalPass).to(Ye).whenTargetNamed("render"),X.bind(ue.v.INormalPass).to(di).whenTargetNamed("taa"),X.bind(ue.v.IFactoryNormalPass).toFactory(function(Q){return function(D){return Q.container.getNamed(ue.v.INormalPass,D)}}),X.bind(ue.v.IPostProcessingPass).to(ls).whenTargetNamed("copy"),X.bind(ue.v.IPostProcessingPass).to(lu).whenTargetNamed("blurH"),X.bind(ue.v.IPostProcessingPass).to(bc).whenTargetNamed("blurV"),X.bind(ue.v.IPostProcessingPass).to(Iu).whenTargetNamed("noise"),X.bind(ue.v.IPostProcessingPass).to(u).whenTargetNamed("sepia"),X.bind(ue.v.IPostProcessingPass).to(Mu).whenTargetNamed("colorHalftone"),X.bind(ue.v.IPostProcessingPass).to(Bs).whenTargetNamed("hexagonalPixelate"),X.bind(ue.v.IPostProcessingPass).to(Ec).whenTargetNamed("ink"),X.bind(ue.v.IFactoryPostProcessingPass).toFactory(function(Q){return function(D){var k=Q.container.getNamed(ue.v.IPostProcessingPass,D);return k.setName(D),k}}),X}function Vi(X){var Q=new me.W2;return Q.parent=X,Q.bind(ue.v.IStyleAttributeService).to(gl).inSingletonScope(),Q.bind(ue.v.IMultiPassRenderer).to(Zl).inSingletonScope(),Q.bind(ue.v.IPostProcessor).to(G).inSingletonScope(),Q}},83966:function(){},52443:function(){},36868:function(Rr,N,b){"use strict";b.d(N,{l:function(){return re}});var re={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},87571:function(Rr,N,b){"use strict";b.d(N,{d:function(){return re}});var re;(function(E){E.TOPRIGHT="topright",E.TOPLEFT="topleft",E.BOTTOMRIGHT="bottomright",E.BOTTOMLEFT="bottomleft",E.TOPCENTER="topcenter",E.BOTTOMCENTER="bottomcenter",E.LEFTCENTER="leftcenter",E.RIGHTCENTER="rightcenter"})(re||(re={}))},85398:function(){},26273:function(){},58782:function(){},87544:function(Rr,N,b){"use strict";b.d(N,{l:function(){return re},k:function(){return E}});var re;(function(p){p[p.LNGLAT=1]="LNGLAT",p[p.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",p[p.VECTOR_TILE=3]="VECTOR_TILE",p[p.IDENTITY=4]="IDENTITY",p[p.P20=5]="P20",p[p.P20_OFFSET=6]="P20_OFFSET",p[p.METER_OFFSET=7]="METER_OFFSET",p[p.P20_2=8]="P20_2"})(re||(re={}));var E={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},57699:function(Rr,N,b){"use strict";b.d(N,{s:function(){return re}});var re;(function(E){E.Hover="hover",E.Click="click",E.Select="select",E.Active="active",E.Drag="drag"})(re||(re={}))},92175:function(){},65046:function(Rr,N,b){"use strict";b.d(N,{h:function(){return re}});var re;(function(E){E.normal="normal",E.additive="additive",E.subtractive="subtractive",E.min="min",E.max="max",E.none="none"})(re||(re={}))},74578:function(Rr,N,b){"use strict";b.d(N,{vY:function(){return re},ee:function(){return E},GC:function(){return p}});var re;(function(me){me.LINEAR="linear",me.POWER="power",me.LOG="log",me.IDENTITY="identity",me.TIME="time",me.QUANTILE="quantile",me.QUANTIZE="quantize",me.THRESHOLD="threshold",me.CAT="cat"})(re||(re={}));var E;(function(me){me.CONSTANT="constant",me.VARIABLE="variable"})(E||(E={}));var p;(function(me){me[me.Attribute=0]="Attribute",me[me.InstancedAttribute=1]="InstancedAttribute",me[me.Uniform=2]="Uniform"})(p||(p={}))},77301:function(Rr,N,b){"use strict";b.d(N,{I:function(){return re}});var re=["mapload"]},30658:function(){},63500:function(){},86485:function(){},23487:function(){},51591:function(){},35951:function(Rr,N,b){"use strict";b.d(N,{G:function(){return re}});var re;(function(E){E.Normal="normal",E.PostProcessing="post-processing"})(re||(re={}))},25001:function(){},87814:function(){},16853:function(){},25831:function(){},65270:function(Rr,N,b){"use strict";b.d(N,{gl:function(){return re}});var re;(function(E){E[E.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",E[E.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",E[E.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",E[E.POINTS=0]="POINTS",E[E.LINES=1]="LINES",E[E.LINE_LOOP=2]="LINE_LOOP",E[E.LINE_STRIP=3]="LINE_STRIP",E[E.TRIANGLES=4]="TRIANGLES",E[E.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",E[E.TRIANGLE_FAN=6]="TRIANGLE_FAN",E[E.ZERO=0]="ZERO",E[E.ONE=1]="ONE",E[E.SRC_COLOR=768]="SRC_COLOR",E[E.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",E[E.SRC_ALPHA=770]="SRC_ALPHA",E[E.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",E[E.DST_ALPHA=772]="DST_ALPHA",E[E.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",E[E.DST_COLOR=774]="DST_COLOR",E[E.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",E[E.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",E[E.FUNC_ADD=32774]="FUNC_ADD",E[E.BLEND_EQUATION=32777]="BLEND_EQUATION",E[E.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",E[E.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",E[E.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",E[E.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",E[E.MAX_EXT=32776]="MAX_EXT",E[E.MIN_EXT=32775]="MIN_EXT",E[E.BLEND_DST_RGB=32968]="BLEND_DST_RGB",E[E.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",E[E.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",E[E.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",E[E.CONSTANT_COLOR=32769]="CONSTANT_COLOR",E[E.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",E[E.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",E[E.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",E[E.BLEND_COLOR=32773]="BLEND_COLOR",E[E.ARRAY_BUFFER=34962]="ARRAY_BUFFER",E[E.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",E[E.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",E[E.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",E[E.STREAM_DRAW=35040]="STREAM_DRAW",E[E.STATIC_DRAW=35044]="STATIC_DRAW",E[E.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",E[E.BUFFER_SIZE=34660]="BUFFER_SIZE",E[E.BUFFER_USAGE=34661]="BUFFER_USAGE",E[E.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",E[E.FRONT=1028]="FRONT",E[E.BACK=1029]="BACK",E[E.FRONT_AND_BACK=1032]="FRONT_AND_BACK",E[E.CULL_FACE=2884]="CULL_FACE",E[E.BLEND=3042]="BLEND",E[E.DITHER=3024]="DITHER",E[E.STENCIL_TEST=2960]="STENCIL_TEST",E[E.DEPTH_TEST=2929]="DEPTH_TEST",E[E.SCISSOR_TEST=3089]="SCISSOR_TEST",E[E.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",E[E.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",E[E.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",E[E.NO_ERROR=0]="NO_ERROR",E[E.INVALID_ENUM=1280]="INVALID_ENUM",E[E.INVALID_VALUE=1281]="INVALID_VALUE",E[E.INVALID_OPERATION=1282]="INVALID_OPERATION",E[E.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",E[E.CW=2304]="CW",E[E.CCW=2305]="CCW",E[E.LINE_WIDTH=2849]="LINE_WIDTH",E[E.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",E[E.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",E[E.CULL_FACE_MODE=2885]="CULL_FACE_MODE",E[E.FRONT_FACE=2886]="FRONT_FACE",E[E.DEPTH_RANGE=2928]="DEPTH_RANGE",E[E.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",E[E.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",E[E.DEPTH_FUNC=2932]="DEPTH_FUNC",E[E.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",E[E.STENCIL_FUNC=2962]="STENCIL_FUNC",E[E.STENCIL_FAIL=2964]="STENCIL_FAIL",E[E.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",E[E.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",E[E.STENCIL_REF=2967]="STENCIL_REF",E[E.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",E[E.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",E[E.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",E[E.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",E[E.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",E[E.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",E[E.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",E[E.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",E[E.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",E[E.VIEWPORT=2978]="VIEWPORT",E[E.SCISSOR_BOX=3088]="SCISSOR_BOX",E[E.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",E[E.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",E[E.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",E[E.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",E[E.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",E[E.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",E[E.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",E[E.RED_BITS=3410]="RED_BITS",E[E.GREEN_BITS=3411]="GREEN_BITS",E[E.BLUE_BITS=3412]="BLUE_BITS",E[E.ALPHA_BITS=3413]="ALPHA_BITS",E[E.DEPTH_BITS=3414]="DEPTH_BITS",E[E.STENCIL_BITS=3415]="STENCIL_BITS",E[E.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",E[E.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",E[E.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",E[E.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",E[E.SAMPLES=32937]="SAMPLES",E[E.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",E[E.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",E[E.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",E[E.DONT_CARE=4352]="DONT_CARE",E[E.FASTEST=4353]="FASTEST",E[E.NICEST=4354]="NICEST",E[E.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",E[E.BYTE=5120]="BYTE",E[E.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",E[E.SHORT=5122]="SHORT",E[E.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",E[E.INT=5124]="INT",E[E.UNSIGNED_INT=5125]="UNSIGNED_INT",E[E.FLOAT=5126]="FLOAT",E[E.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",E[E.ALPHA=6406]="ALPHA",E[E.RGB=6407]="RGB",E[E.RGBA=6408]="RGBA",E[E.LUMINANCE=6409]="LUMINANCE",E[E.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",E[E.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",E[E.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",E[E.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",E[E.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",E[E.VERTEX_SHADER=35633]="VERTEX_SHADER",E[E.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",E[E.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",E[E.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",E[E.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",E[E.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",E[E.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",E[E.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",E[E.SHADER_TYPE=35663]="SHADER_TYPE",E[E.DELETE_STATUS=35712]="DELETE_STATUS",E[E.LINK_STATUS=35714]="LINK_STATUS",E[E.VALIDATE_STATUS=35715]="VALIDATE_STATUS",E[E.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",E[E.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",E[E.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",E[E.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",E[E.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",E[E.NEVER=512]="NEVER",E[E.LESS=513]="LESS",E[E.EQUAL=514]="EQUAL",E[E.LEQUAL=515]="LEQUAL",E[E.GREATER=516]="GREATER",E[E.NOTEQUAL=517]="NOTEQUAL",E[E.GEQUAL=518]="GEQUAL",E[E.ALWAYS=519]="ALWAYS",E[E.KEEP=7680]="KEEP",E[E.REPLACE=7681]="REPLACE",E[E.INCR=7682]="INCR",E[E.DECR=7683]="DECR",E[E.INVERT=5386]="INVERT",E[E.INCR_WRAP=34055]="INCR_WRAP",E[E.DECR_WRAP=34056]="DECR_WRAP",E[E.VENDOR=7936]="VENDOR",E[E.RENDERER=7937]="RENDERER",E[E.VERSION=7938]="VERSION",E[E.NEAREST=9728]="NEAREST",E[E.LINEAR=9729]="LINEAR",E[E.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",E[E.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",E[E.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",E[E.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",E[E.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",E[E.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",E[E.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",E[E.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",E[E.TEXTURE_2D=3553]="TEXTURE_2D",E[E.TEXTURE=5890]="TEXTURE",E[E.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",E[E.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",E[E.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",E[E.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",E[E.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",E[E.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",E[E.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",E[E.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",E[E.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",E[E.TEXTURE0=33984]="TEXTURE0",E[E.TEXTURE1=33985]="TEXTURE1",E[E.TEXTURE2=33986]="TEXTURE2",E[E.TEXTURE3=33987]="TEXTURE3",E[E.TEXTURE4=33988]="TEXTURE4",E[E.TEXTURE5=33989]="TEXTURE5",E[E.TEXTURE6=33990]="TEXTURE6",E[E.TEXTURE7=33991]="TEXTURE7",E[E.TEXTURE8=33992]="TEXTURE8",E[E.TEXTURE9=33993]="TEXTURE9",E[E.TEXTURE10=33994]="TEXTURE10",E[E.TEXTURE11=33995]="TEXTURE11",E[E.TEXTURE12=33996]="TEXTURE12",E[E.TEXTURE13=33997]="TEXTURE13",E[E.TEXTURE14=33998]="TEXTURE14",E[E.TEXTURE15=33999]="TEXTURE15",E[E.TEXTURE16=34e3]="TEXTURE16",E[E.TEXTURE17=34001]="TEXTURE17",E[E.TEXTURE18=34002]="TEXTURE18",E[E.TEXTURE19=34003]="TEXTURE19",E[E.TEXTURE20=34004]="TEXTURE20",E[E.TEXTURE21=34005]="TEXTURE21",E[E.TEXTURE22=34006]="TEXTURE22",E[E.TEXTURE23=34007]="TEXTURE23",E[E.TEXTURE24=34008]="TEXTURE24",E[E.TEXTURE25=34009]="TEXTURE25",E[E.TEXTURE26=34010]="TEXTURE26",E[E.TEXTURE27=34011]="TEXTURE27",E[E.TEXTURE28=34012]="TEXTURE28",E[E.TEXTURE29=34013]="TEXTURE29",E[E.TEXTURE30=34014]="TEXTURE30",E[E.TEXTURE31=34015]="TEXTURE31",E[E.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",E[E.REPEAT=10497]="REPEAT",E[E.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",E[E.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",E[E.FLOAT_VEC2=35664]="FLOAT_VEC2",E[E.FLOAT_VEC3=35665]="FLOAT_VEC3",E[E.FLOAT_VEC4=35666]="FLOAT_VEC4",E[E.INT_VEC2=35667]="INT_VEC2",E[E.INT_VEC3=35668]="INT_VEC3",E[E.INT_VEC4=35669]="INT_VEC4",E[E.BOOL=35670]="BOOL",E[E.BOOL_VEC2=35671]="BOOL_VEC2",E[E.BOOL_VEC3=35672]="BOOL_VEC3",E[E.BOOL_VEC4=35673]="BOOL_VEC4",E[E.FLOAT_MAT2=35674]="FLOAT_MAT2",E[E.FLOAT_MAT3=35675]="FLOAT_MAT3",E[E.FLOAT_MAT4=35676]="FLOAT_MAT4",E[E.SAMPLER_2D=35678]="SAMPLER_2D",E[E.SAMPLER_CUBE=35680]="SAMPLER_CUBE",E[E.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",E[E.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",E[E.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",E[E.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",E[E.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",E[E.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",E[E.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",E[E.COMPILE_STATUS=35713]="COMPILE_STATUS",E[E.LOW_FLOAT=36336]="LOW_FLOAT",E[E.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",E[E.HIGH_FLOAT=36338]="HIGH_FLOAT",E[E.LOW_INT=36339]="LOW_INT",E[E.MEDIUM_INT=36340]="MEDIUM_INT",E[E.HIGH_INT=36341]="HIGH_INT",E[E.FRAMEBUFFER=36160]="FRAMEBUFFER",E[E.RENDERBUFFER=36161]="RENDERBUFFER",E[E.RGBA4=32854]="RGBA4",E[E.RGB5_A1=32855]="RGB5_A1",E[E.RGB565=36194]="RGB565",E[E.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",E[E.STENCIL_INDEX=6401]="STENCIL_INDEX",E[E.STENCIL_INDEX8=36168]="STENCIL_INDEX8",E[E.DEPTH_STENCIL=34041]="DEPTH_STENCIL",E[E.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",E[E.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",E[E.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",E[E.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",E[E.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",E[E.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",E[E.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",E[E.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",E[E.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",E[E.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",E[E.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",E[E.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",E[E.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",E[E.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",E[E.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",E[E.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",E[E.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",E[E.NONE=0]="NONE",E[E.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",E[E.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",E[E.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",E[E.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",E[E.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",E[E.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",E[E.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",E[E.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",E[E.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",E[E.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",E[E.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",E[E.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",E[E.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",E[E.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(re||(re={}))},16546:function(Rr,N,b){"use strict";b.d(N,{Z:function(){return De}});var re=b(84904),E=b(51548),p=b(46893),me=b(19297),te=b(7273),ue=b(53592),ae=b.n(ue),Ne=b(93544),K=b.n(Ne),Qe=b(34301),xt=b.n(Qe),Ht=b(99311),$t=b(78892),Jt=b.n($t),Ft=b(65270),Gt=b(61931),At=b(35951),Et,bt,er,q,Bt;function et(It,hr){var tr=Object.keys(It);if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(It);hr&&(j=j.filter(function(ie){return Object.getOwnPropertyDescriptor(It,ie).enumerable})),tr.push.apply(tr,j)}return tr}function je(It){for(var hr=1;hr<arguments.length;hr++){var tr=arguments[hr]!=null?arguments[hr]:{};hr%2?et(Object(tr),!0).forEach(function(j){(0,me.Z)(It,j,tr[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(It,Object.getOwnPropertyDescriptors(tr)):et(Object(tr)).forEach(function(j){Object.defineProperty(It,j,Object.getOwnPropertyDescriptor(tr,j))})}return It}var nt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,De=(Et=(0,Ht.b2)(),bt=(0,Ht.f3)(Gt.v.IShaderModuleService),Et(er=(q=function(){function It(){(0,E.Z)(this,It),(0,re.Z)(this,"shaderModuleService",Bt,this),(0,me.Z)(this,"rendererService",void 0),(0,me.Z)(this,"config",void 0),(0,me.Z)(this,"quad",nt),(0,me.Z)(this,"enabled",!0),(0,me.Z)(this,"renderToScreen",!1),(0,me.Z)(this,"model",void 0),(0,me.Z)(this,"name",void 0),(0,me.Z)(this,"optionsToUpdate",{})}return(0,p.Z)(It,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(tr){this.name=tr}},{key:"getType",value:function(){return At.G.PostProcessing}},{key:"init",value:function(tr,j){this.config=j,this.rendererService=tr.getContainer().get(Gt.v.IRendererService);var ie=this.rendererService,Me=ie.createAttribute,ye=ie.createBuffer,it=ie.createModel,lt=this.setupShaders(),Lt=lt.vs,Pt=lt.fs,Lr=lt.uniforms;this.model=it({vs:Lt,fs:Pt,attributes:{a_Position:Me({buffer:ye({data:[-4,-4,4,-4,0,4],type:Ft.gl.FLOAT}),size:2})},uniforms:je(je({u_Texture:null},Lr),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(tr){var j=this,ie=tr.multiPassRenderer.getPostProcessor(),Me=this.rendererService,ye=Me.useFramebuffer,it=Me.getViewportSize,lt=Me.clear,Lt=it(),Pt=Lt.width,Lr=Lt.height;ye(this.renderToScreen?null:ie.getWriteFBO(),function(){lt({framebuffer:ie.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),j.model.draw({uniforms:je({u_Texture:ie.getReadFBO(),u_ViewportSize:[Pt,Lr]},j.convertOptionsToUniforms(j.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(tr){this.enabled=tr}},{key:"setRenderToScreen",value:function(tr){this.renderToScreen=tr}},{key:"updateOptions",value:function(tr){this.optionsToUpdate=je(je({},this.optionsToUpdate),tr)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(tr){var j={};return Object.keys(tr).forEach(function(ie){K()(tr[ie])||(j["u_".concat(ae()(xt()(ie)))]=tr[ie])}),j}}]),It}(),Bt=(0,te.Z)(q.prototype,"shaderModuleService",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q))||er)},24:function(Rr,N,b){"use strict";b.d(N,{P:function(){return re}});var re=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},54559:function(){},96548:function(){},61931:function(Rr,N,b){"use strict";b.d(N,{v:function(){return re}});var re={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},28497:function(Rr,N,b){"use strict";var re=b(61400),E=null;function p(De){return E.indexOf(De)}var me=2,te=4,ue=64,ae=128,Ne=256,K=512,Qe=8192,xt=16384,Ht=32768,$t=null,Jt=131072,Ft=262144,Gt=524288,At=1048576,Et=2097152,bt=4194304,er=8388608,q=16777216,Bt=null;function et(De,It){return De=_clamp(Math.floor(De),0,255),It=_clamp(Math.floor(It),0,255),256*De+It}function je(De){var It=De.color,hr=De.radius,tr=De.tileX,j=De.tileY,ie=De.shape,Me=De.opacity,ye=De.stroke,it=De.strokeWidth,lt=De.strokeOpacity,Lt=[],Pt=[],Lr=[],cn=[et(It[0],It[1]),et(It[2],It[3])],qr=[et(ye[0],ye[1]),et(ye[2],ye[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(fi){var Yt=_slicedToArray(fi,2),he=Yt[0],Te=Yt[1];Lt.push([].concat(cn,[(he+1)*er+(Te+1)*Et+getShapeIndex(ie)*Jt+hr,(tr+512)*Gt+(j+512)*ue])),Pt.push([].concat(qr,[it,lt])),Lr.push([Me,0,0,0])}),{packedBuffer:Lt,packedBuffer2:Pt,packedBuffer3:Lr}}function nt(De,It){if(De===0&&!It)return 0;if(De===1&&It)return 4294967295;var hr=It?1:0,tr=Math.floor(De*127);return tr*Bt+hr*q+tr*Jt+hr*$t+tr*K+hr*Ne+tr*me+hr}},82537:function(Rr,N,b){"use strict";b.d(N,{zP:function(){return Ly},JE:function(){return O0},ns:function(){return Oy}});var re=b(59301),E=(0,re.createContext)({});function p(){return(0,re.useContext)(E)}var me={},te={},ue=function(c){return te[c]},ae=function(c,a){te[c]=a},Ne=function(c){return me[c]},K=function(c,a){me[c]=a},Qe={},xt={},Ht=34,$t=10,Jt=13;function Ft(n){return new Function("d","return {"+n.map(function(c,a){return JSON.stringify(c)+": d["+a+'] || ""'}).join(",")+"}")}function Gt(n,c){var a=Ft(n);return function(s,l){return c(a(s),l,n)}}function At(n){var c=Object.create(null),a=[];return n.forEach(function(s){for(var l in s)l in c||a.push(c[l]=l)}),a}function Et(n,c){var a=n+"",s=a.length;return s<c?new Array(c-s+1).join(0)+a:a}function bt(n){return n<0?"-"+Et(-n,6):n>9999?"+"+Et(n,6):Et(n,4)}function er(n){var c=n.getUTCHours(),a=n.getUTCMinutes(),s=n.getUTCSeconds(),l=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":bt(n.getUTCFullYear(),4)+"-"+Et(n.getUTCMonth()+1,2)+"-"+Et(n.getUTCDate(),2)+(l?"T"+Et(c,2)+":"+Et(a,2)+":"+Et(s,2)+"."+Et(l,3)+"Z":s?"T"+Et(c,2)+":"+Et(a,2)+":"+Et(s,2)+"Z":a||c?"T"+Et(c,2)+":"+Et(a,2)+"Z":"")}function q(n){var c=new RegExp('["'+n+`
\r]`),a=n.charCodeAt(0);function s(H,ge){var Be,vt,kt=l(H,function(yr,wr){if(Be)return Be(yr,wr-1);vt=yr,Be=ge?Gt(yr,ge):Ft(yr)});return kt.columns=vt||[],kt}function l(H,ge){var Be=[],vt=H.length,kt=0,yr=0,wr,jr=vt<=0,gn=!1;H.charCodeAt(vt-1)===$t&&--vt,H.charCodeAt(vt-1)===Jt&&--vt;function Sn(){if(jr)return xt;if(gn)return gn=!1,Qe;var ti,ii=kt,Si;if(H.charCodeAt(ii)===Ht){for(;kt++<vt&&H.charCodeAt(kt)!==Ht||H.charCodeAt(++kt)===Ht;);return(ti=kt)>=vt?jr=!0:(Si=H.charCodeAt(kt++))===$t?gn=!0:Si===Jt&&(gn=!0,H.charCodeAt(kt)===$t&&++kt),H.slice(ii+1,ti-1).replace(/""/g,'"')}for(;kt<vt;){if((Si=H.charCodeAt(ti=kt++))===$t)gn=!0;else if(Si===Jt)gn=!0,H.charCodeAt(kt)===$t&&++kt;else if(Si!==a)continue;return H.slice(ii,ti)}return jr=!0,H.slice(ii,vt)}for(;(wr=Sn())!==xt;){for(var zn=[];wr!==Qe&&wr!==xt;)zn.push(wr),wr=Sn();ge&&(zn=ge(zn,yr++))==null||Be.push(zn)}return Be}function d(H,ge){return H.map(function(Be){return ge.map(function(vt){return $(Be[vt])}).join(n)})}function _(H,ge){return ge==null&&(ge=At(H)),[ge.map($).join(n)].concat(d(H,ge)).join(`
`)}function A(H,ge){return ge==null&&(ge=At(H)),d(H,ge).join(`
`)}function M(H){return H.map(L).join(`
`)}function L(H){return H.map($).join(n)}function $(H){return H==null?"":H instanceof Date?er(H):c.test(H+="")?'"'+H.replace(/"/g,'""')+'"':H}return{parse:s,parseRows:l,format:_,formatBody:A,formatRows:M,formatRow:L,formatValue:$}}var Bt=q(","),et=Bt.parse,je=Bt.parseRows,nt=Bt.format,De=Bt.formatBody,It=Bt.formatRows,hr=Bt.formatRow,tr=Bt.formatValue,j=b(19297),ie=b(10971),Me=b(56928),ye=b.n(Me);function it(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function lt(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?it(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):it(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Lt(n,c){var a=c.x,s=c.y,l=c.x1,d=c.y1,_=c.coordinates,A=[];return n.forEach(function(M,L){var $=[];if(a&&s&&($=[parseFloat(M[a]),parseFloat(M[s])]),a&&s&&l&&d){var H=[parseFloat(M[a]),parseFloat(M[s])],ge=[parseFloat(M[l]),parseFloat(M[d])];$=[H,ge]}if(_){var Be="Polygon";Array.isArray(_[0])||(Be="Point"),Array.isArray(_[0])&&!Array.isArray(_[0][0])&&(Be="LineString");var vt={type:Be,coordinates:(0,ie.Z)(M[_])};ye()(vt,!0),$=vt.coordinates}var kt=lt(lt({},M),{},{_id:L,coordinates:$});A.push(kt)}),{dataArray:A}}var Pt=[{lng1:100,lat1:30,lng2:130,lat2:30}],Lr={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function cn(n,c){var a=et(n);return Lt(a,c)}var qr=b(98576);function fi(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Yt(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function he(n){if(n.length>1&&isNumber(n[0])&&isNumber(n[1]))return!0;if(Array.isArray(n[0])&&n[0].length)return he(n[0]);throw new Error("coordinates must only contain numbers")}function Te(n,c,a){if(!c||!a)throw new Error("type and name required");if(!n||n.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+n.type)}function Ze(n,c,a){if(!n)throw new Error("No feature passed");if(!a)throw new Error(".featureOf() requires a name");if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!n.geometry||n.geometry.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+n.geometry.type)}function Oe(n,c,a){if(!n)throw new Error("No featureCollection passed");if(!a)throw new Error(".collectionOf() requires a name");if(!n||n.type!=="FeatureCollection")throw new Error("Invalid input to "+a+", FeatureCollection required");for(var s=0,l=n.features;s<l.length;s++){var d=l[s];if(!d||d.type!=="Feature"||!d.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!d.geometry||d.geometry.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+d.geometry.type)}}function Ot(n){return n.type==="Feature"?n.geometry:n}function ar(n,c){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function ur(n,c,a){if(n!==null)for(var s,l,d,_,A,M,L,$=0,H=0,ge,Be=n.type,vt=Be==="FeatureCollection",kt=Be==="Feature",yr=vt?n.features.length:1,wr=0;wr<yr;wr++){L=vt?n.features[wr].geometry:kt?n.geometry:n,ge=L?L.type==="GeometryCollection":!1,A=ge?L.geometries.length:1;for(var jr=0;jr<A;jr++){var gn=0,Sn=0;if(_=ge?L.geometries[jr]:L,_!==null){M=_.coordinates;var zn=_.type;switch($=a&&(zn==="Polygon"||zn==="MultiPolygon")?1:0,zn){case null:break;case"Point":if(c(M,H,wr,gn,Sn)===!1)return!1;H++,gn++;break;case"LineString":case"MultiPoint":for(s=0;s<M.length;s++){if(c(M[s],H,wr,gn,Sn)===!1)return!1;H++,zn==="MultiPoint"&&gn++}zn==="LineString"&&gn++;break;case"Polygon":case"MultiLineString":for(s=0;s<M.length;s++){for(l=0;l<M[s].length-$;l++){if(c(M[s][l],H,wr,gn,Sn)===!1)return!1;H++}zn==="MultiLineString"&&gn++,zn==="Polygon"&&Sn++}zn==="Polygon"&&gn++;break;case"MultiPolygon":for(s=0;s<M.length;s++){for(Sn=0,l=0;l<M[s].length;l++){for(d=0;d<M[s][l].length-$;d++){if(c(M[s][l][d],H,wr,gn,Sn)===!1)return!1;H++}Sn++}gn++}break;case"GeometryCollection":for(s=0;s<_.geometries.length;s++)if(ur(_.geometries[s],c,a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Pr(n,c,a,s){var l=a;return ur(n,function(d,_,A,M,L){_===0&&a===void 0?l=d:l=c(l,d,_,A,M,L)},s),l}function or(n,c){var a;switch(n.type){case"FeatureCollection":for(a=0;a<n.features.length&&c(n.features[a].properties,a)!==!1;a++);break;case"Feature":c(n.properties,0);break}}function nn(n,c,a){var s=a;return or(n,function(l,d){d===0&&a===void 0?s=l:s=c(s,l,d)}),s}function C(n,c){if(n.type==="Feature")c(n,0);else if(n.type==="FeatureCollection")for(var a=0;a<n.features.length&&c(n.features[a],a)!==!1;a++);}function V(n,c,a){var s=a;return C(n,function(l,d){d===0&&a===void 0?s=l:s=c(s,l,d)}),s}function Ve(n){var c=[];return ur(n,function(a){c.push(a)}),c}function $e(n,c){var a,s,l,d,_,A,M,L,$,H,ge=0,Be=n.type==="FeatureCollection",vt=n.type==="Feature",kt=Be?n.features.length:1;for(a=0;a<kt;a++){for(A=Be?n.features[a].geometry:vt?n.geometry:n,L=Be?n.features[a].properties:vt?n.properties:{},$=Be?n.features[a].bbox:vt?n.bbox:void 0,H=Be?n.features[a].id:vt?n.id:void 0,M=A?A.type==="GeometryCollection":!1,_=M?A.geometries.length:1,l=0;l<_;l++){if(d=M?A.geometries[l]:A,d===null){if(c(null,ge,L,$,H)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(c(d,ge,L,$,H)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<d.geometries.length;s++)if(c(d.geometries[s],ge,L,$,H)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}ge++}}function ct(n,c,a){var s=a;return $e(n,function(l,d,_,A,M){d===0&&a===void 0?s=l:s=c(s,l,d,_,A,M)}),s}function Ct(n,c){$e(n,function(a,s,l,d,_){var A=a===null?null:a.type;switch(A){case null:case"Point":case"LineString":case"Polygon":return c((0,qr.zL)(a,l,{bbox:d,id:_}),s,0)===!1?!1:void 0}var M;switch(A){case"MultiPoint":M="Point";break;case"MultiLineString":M="LineString";break;case"MultiPolygon":M="Polygon";break}for(var L=0;L<a.coordinates.length;L++){var $=a.coordinates[L],H={type:M,coordinates:$};if(c((0,qr.zL)(H,l),s,L)===!1)return!1}})}function J(n,c,a){var s=a;return Ct(n,function(l,d,_){d===0&&_===0&&a===void 0?s=l:s=c(s,l,d,_)}),s}function Wt(n,c){Ct(n,function(a,s,l){var d=0;if(!!a.geometry){var _=a.geometry.type;if(!(_==="Point"||_==="MultiPoint")){var A,M=0,L=0,$=0;if(ur(a,function(H,ge,Be,vt,kt){if(A===void 0||s>M||vt>L||kt>$){A=H,M=s,L=vt,$=kt,d=0;return}var yr=lineString([A,H],a.properties);if(c(yr,s,l,kt,d)===!1)return!1;d++,A=H})===!1)return!1}}})}function Tr(n,c,a){var s=a,l=!1;return Wt(n,function(d,_,A,M,L){l===!1&&a===void 0?s=d:s=c(s,d,_,A,M,L),l=!0}),s}function Mr(n,c){if(!n)throw new Error("geojson is required");Ct(n,function(a,s,l){if(a.geometry!==null){var d=a.geometry.type,_=a.geometry.coordinates;switch(d){case"LineString":if(c(a,s,l,0,0)===!1)return!1;break;case"Polygon":for(var A=0;A<_.length;A++)if(c(lineString(_[A],a.properties),s,l,A)===!1)return!1;break}}})}function Ke(n,c,a){var s=a;return Mr(n,function(l,d,_,A){d===0&&a===void 0?s=l:s=c(s,l,d,_,A)}),s}function ht(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var a=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,d=c.segmentIndex||0,_=c.properties,A;switch(n.type){case"FeatureCollection":a<0&&(a=n.features.length+a),_=_||n.features[a].properties,A=n.features[a].geometry;break;case"Feature":_=_||n.properties,A=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":A=n;break;default:throw new Error("geojson is invalid")}if(A===null)return null;var M=A.coordinates;switch(A.type){case"Point":case"MultiPoint":return null;case"LineString":return d<0&&(d=M.length+d-1),lineString([M[d],M[d+1]],_,c);case"Polygon":return l<0&&(l=M.length+l),d<0&&(d=M[l].length+d-1),lineString([M[l][d],M[l][d+1]],_,c);case"MultiLineString":return s<0&&(s=M.length+s),d<0&&(d=M[s].length+d-1),lineString([M[s][d],M[s][d+1]],_,c);case"MultiPolygon":return s<0&&(s=M.length+s),l<0&&(l=M[s].length+l),d<0&&(d=M[s][l].length-d-1),lineString([M[s][l][d],M[s][l][d+1]],_,c)}throw new Error("geojson is invalid")}function Mt(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var a=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,d=c.coordIndex||0,_=c.properties,A;switch(n.type){case"FeatureCollection":a<0&&(a=n.features.length+a),_=_||n.features[a].properties,A=n.features[a].geometry;break;case"Feature":_=_||n.properties,A=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":A=n;break;default:throw new Error("geojson is invalid")}if(A===null)return null;var M=A.coordinates;switch(A.type){case"Point":return point(M,_,c);case"MultiPoint":return s<0&&(s=M.length+s),point(M[s],_,c);case"LineString":return d<0&&(d=M.length+d),point(M[d],_,c);case"Polygon":return l<0&&(l=M.length+l),d<0&&(d=M[l].length+d),point(M[l][d],_,c);case"MultiLineString":return s<0&&(s=M.length+s),d<0&&(d=M[s].length+d),point(M[s][d],_,c);case"MultiPolygon":return s<0&&(s=M.length+s),l<0&&(l=M[s].length+l),d<0&&(d=M[s][l].length-d),point(M[s][l][d],_,c)}throw new Error("geojson is invalid")}function Nt(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function br(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Nt(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Nt(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Sr(n,c){var a=[],s={};if(n.features=n.features.filter(function(d){var _=d.geometry;return d!=null&&_&&_.type&&_.coordinates&&_.coordinates.length>0}),ye()(n,!0),n.features.length===0)return{dataArray:[],featureKeys:s};var l=0;return Ct(n,function(d,_){var A=Yt(d),M=_,L=br(br({},d.properties),{},{coordinates:A,_id:M});a.push(L)}),{dataArray:a,featureKeys:s}}var Je=b(28157);function Hr(n,c){var a=c.extent,s=a===void 0?[121.168,30.2828,121.384,30.4219]:a,l=new Promise(function(_){Xr(n,function(A){_(A)})}),d={images:l,_id:1,dataArray:[{_id:0,coordinates:[[s[0],s[1]],[s[2],s[3]]]}]};return d}function Xr(n,c){var a=n,s=[];if(typeof a=="string")(0,Je.gJ)({url:a},function(_,A){s.push(A),c(s)});else{var l=a.length,d=0;a.forEach(function(_){(0,Je.gJ)({url:_},function(A,M){d++,s.push(M),d===l&&c(s)})})}return Hr}function yn(n,c){var a=c.extent,s=c.width,l=c.height,d=c.min,_=c.max,A={_id:1,dataArray:[{_id:1,data:Array.from(n),width:s,height:l,min:d,max:_,coordinates:[[a[0],a[1]],[a[2],a[3]]]}]};return A}var vr=b(51548),Or=b(46893),St=b(67708),Kn=b(37150),Ln=b(87896),zr=b(74415),Y=b(24602),ce=b.n(Y),ve=b(7941),B=b.n(ve),ee=b(9363),pe=b.n(ee),Ae=b(20250),oe=b.n(Ae),_e=b(65859),dt=b(40666),Er=b(83437),Kt=b.n(Er);function ir(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Zr(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?ir(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ir(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Bn(n,c){var a=c.radius,s=a===void 0?40:a,l=c.maxZoom,d=l===void 0?18:l,_=c.minZoom,A=_===void 0?0:_,M=c.zoom,L=M===void 0?2:M;if(n.pointIndex){var $=n.pointIndex.getClusters(n.extent,Math.floor(L));return n.dataArray=Fn($),n}var H=new(Kt())({radius:s,minZoom:A,maxZoom:d}),ge={type:"FeatureCollection",features:[]};return ge.features=n.dataArray.map(function(Be){return{type:"Feature",geometry:{type:"Point",coordinates:Be.coordinates},properties:Zr({},Be)}}),H.load(ge.features),H}function Fn(n){return n.map(function(c,a){return Zr({coordinates:c.geometry.coordinates,_id:a+1},c.properties)})}function nr(n){if(n.length===0)throw new Error("max requires at least one data point");for(var c=n[0],a=1;a<n.length;a++)n[a]>c&&(c=n[a]);return c}function In(n){if(n.length===0)throw new Error("min requires at least one data point");for(var c=n[0],a=1;a<n.length;a++)n[a]<c&&(c=n[a]);return c}function vn(n){if(n.length===0)return 0;for(var c=n[0],a=0,s,l=1;l<n.length;l++)s=c+n[l]*1,Math.abs(c)>=Math.abs(n[l])?a+=c-s+n[l]:a+=n[l]-s+c,c=s;return c+a*1}function xn(n){if(n.length===0)throw new Error("mean requires at least one data point");return vn(n)/n.length}var zi={min:In,max:nr,mean:xn,sum:vn};function Tn(n,c){return n.map(function(a){return a[c]*1})}function Di(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ra(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Di(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Di(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function hi(n){var c=na();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function na(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Yi(n,c){if(Array.isArray(c))return c}var Ii=function(n){(0,Kn.Z)(a,n);var c=hi(a);function a(s,l){var d;return(0,vr.Z)(this,a),d=c.call(this),(0,j.Z)((0,St.Z)(d),"data",void 0),(0,j.Z)((0,St.Z)(d),"extent",void 0),(0,j.Z)((0,St.Z)(d),"hooks",{init:new _e.ni}),(0,j.Z)((0,St.Z)(d),"parser",{type:"geojson"}),(0,j.Z)((0,St.Z)(d),"transforms",[]),(0,j.Z)((0,St.Z)(d),"cluster",!1),(0,j.Z)((0,St.Z)(d),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,j.Z)((0,St.Z)(d),"mapService",void 0),(0,j.Z)((0,St.Z)(d),"invalidExtent",!1),(0,j.Z)((0,St.Z)(d),"originData",void 0),(0,j.Z)((0,St.Z)(d),"rawData",void 0),(0,j.Z)((0,St.Z)(d),"cfg",{}),(0,j.Z)((0,St.Z)(d),"clusterIndex",void 0),d.originData=s,d.initCfg(l),d.hooks.init.tap("parser",function(){d.excuteParser()}),d.hooks.init.tap("cluster",function(){d.initCluster()}),d.hooks.init.tap("transform",function(){d.executeTrans()}),d.init(),d}return(0,Or.Z)(a,[{key:"setData",value:function(l,d){this.rawData=l,this.originData=l,this.initCfg(d),this.init(),this.emit("update")}},{key:"getClusters",value:function(l){return this.clusterIndex.getClusters(this.caculClusterExtent(2),l)}},{key:"getClustersLeaves",value:function(l){return this.clusterIndex.getLeaves(l,Infinity)}},{key:"updateClusterData",value:function(l){var d=this,_=this.clusterOptions,A=_.method,M=A===void 0?"sum":A,L=_.field,$=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(l));this.clusterOptions.zoom=l,$.forEach(function(H){H.id||(H.properties.point_count=1)}),(L||pe()(M))&&($=$.map(function(H){var ge=H.id;if(ge){var Be=d.clusterIndex.getLeaves(ge,Infinity),vt=Be.map(function(wr){return wr.properties}),kt;if(B()(M)&&L){var yr=Tn(vt,L);kt=zi[M](yr)}pe()(M)&&(kt=M(vt)),H.properties.stat=kt}else H.properties.point_count=1;return H})),this.data=ue("geojson")({type:"FeatureCollection",features:$}),this.executeTrans()}},{key:"getFeatureById",value:function(l){var d=this.parser.type,_=d===void 0?"geojson":d;if(_==="geojson"&&!this.cluster){var A=l<this.originData.features.length?this.originData.features[l]:"null",M=oe()(A);if(this.transforms.length!==0){var L=this.data.dataArray.find(function($){return $._id===l});M.properties=L}return M}else return l<this.data.dataArray.length?this.data.dataArray[l]:"null"}},{key:"getFeatureId",value:function(l,d){var _=this.data.dataArray.find(function(A){return A[l]===name});return _==null?void 0:_._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(l){var d=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(d=(0,Je.yA)((0,Je.ds)(this.extent),l)),d[0].concat(d[1])}},{key:"initCfg",value:function(l){this.cfg=ce()(this.cfg,l,Yi);var d=this.cfg;d&&(d.parser&&(this.parser=d.parser),d.transforms&&(this.transforms=d.transforms),this.cluster=d.cluster||!1,d.clusterOptions&&(this.cluster=!0,this.clusterOptions=ra(ra({},this.clusterOptions),d.clusterOptions)))}},{key:"excuteParser",value:function(){var l=this.parser,d=l.type||"geojson",_=ue(d);this.data=_(this.originData,l),this.extent=(0,Je.We)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var l=this,d=this.transforms;d.forEach(function(_){var A=_.type,M=Ne(A)(l.data,_);Object.assign(l.data,M)})}},{key:"initCluster",value:function(){if(!!this.cluster){var l=this.clusterOptions||{};this.clusterIndex=Bn(this.data,l)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),a}(dt.EventEmitter);function ya(n,c){var a=c.callback;return a&&(n.dataArray=n.dataArray.filter(a)),n}function Fa(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Ki(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,A;return{s:function(){a=a.call(n)},n:function(){var L=a.next();return d=L.done,L},e:function(L){_=!0,A=L},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw A}}}}function Ki(n,c){if(!!n){if(typeof n=="string")return Zi(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Zi(n,c)}}function Zi(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var $i=6378e3;function so(n,c){var a=n.dataArray,s=c.size,l=s===void 0?10:s,d=l/(2*Math.PI*$i)*(256<<20)/2,_=Jo(a,l),A=_.gridHash,M=_.gridOffset,L=Cu(A,M,c);return{yOffset:d,xOffset:d,radius:d,type:"grid",dataArray:L}}function Jo(n,c){var a=Infinity,s=-Infinity,l,d=Fa(n),_;try{for(d.s();!(_=d.n()).done;){var A=_.value;l=A.coordinates[1],Number.isFinite(l)&&(a=l<a?l:a,s=l>s?l:s)}}catch(gn){d.e(gn)}finally{d.f()}var M=(a+s)/2,L=za(c,M);if(L.xOffset<=0||L.yOffset<=0)return{gridHash:{},gridOffset:L};var $={},H=Fa(n),ge;try{for(H.s();!(ge=H.n()).done;){var Be=ge.value,vt=Be.coordinates[1],kt=Be.coordinates[0];if(Number.isFinite(vt)&&Number.isFinite(kt)){var yr=Math.floor((vt+90)/L.yOffset),wr=Math.floor((kt+180)/L.xOffset),jr="".concat(yr,"-").concat(wr);$[jr]=$[jr]||{count:0,points:[]},$[jr].count+=1,$[jr].points.push(Be)}}}catch(gn){H.e(gn)}finally{H.f()}return{gridHash:$,gridOffset:L}}function za(n,c){var a=qi(n),s=ou(c,n);return{yOffset:a,xOffset:s}}function qi(n){return n/$i*(180/Math.PI)}function ou(n,c){return c/$i*(180/Math.PI)/Math.cos(n*Math.PI/180)}function Cu(n,c,a){return Object.keys(n).reduce(function(s,l,d){var _=l.split("-"),A=parseInt(_[0],10),M=parseInt(_[1],10),L={};if(a.field&&a.method){var $=Je.a5.getColumn(n[l].points,a.field);L[a.method]=Je.a5.statMap[a.method]($)}return Object.assign(L,{_id:d,coordinates:(0,Je.Z)([-180+c.xOffset*(M+.5),-90+c.yOffset*(A+.5)]),rawData:n[l].points,count:n[l].count}),s.push(L),s},[])}var Ji=b(83405),xo=Math.PI/3,Qi=[0,xo,2*xo,3*xo,4*xo,5*xo];function Ja(n){return n[0]}function Qo(n){return n[1]}function Ea(){var n=0,c=0,a=1,s=1,l=Ja,d=Qo,_,A,M;function L(H){var ge={},Be=[],vt,kt=H.length;for(vt=0;vt<kt;++vt)if(!(isNaN(wr=+l.call(null,yr=H[vt],vt,H))||isNaN(jr=+d.call(null,yr,vt,H)))){var yr,wr,jr,gn=Math.round(jr=jr/M),Sn=Math.round(wr=wr/A-(gn&1)/2),zn=jr-gn;if(Math.abs(zn)*3>1){var ti=wr-Sn,ii=Sn+(wr<Sn?-1:1)/2,Si=gn+(jr<gn?-1:1),ta=wr-ii,_a=jr-Si;ti*ti+zn*zn>ta*ta+_a*_a&&(Sn=ii+(gn&1?1:-1)/2,gn=Si)}var gi=Sn+"-"+gn,Pa=ge[gi];Pa?Pa.push(yr):(Be.push(Pa=ge[gi]=[yr]),Pa.x=(Sn+(gn&1)/2)*A,Pa.y=gn*M)}return Be}function $(H){var ge=0,Be=0;return Qi.map(function(vt){var kt=Math.sin(vt)*H,yr=-Math.cos(vt)*H,wr=kt-ge,jr=yr-Be;return ge=kt,Be=yr,[wr,jr]})}return L.hexagon=function(H){return"m"+$(H==null?_:+H).join("l")+"z"},L.centers=function(){for(var H=[],ge=Math.round(c/M),Be=Math.round(n/A),vt=ge*M;vt<s+_;vt+=M,++ge)for(var kt=Be*A+(ge&1)*A/2;kt<a+A/2;kt+=A)H.push([kt,vt]);return H},L.mesh=function(){var H=$(_).slice(0,4).join("l");return L.centers().map(function(ge){return"M"+ge+"m"+H}).join("")},L.x=function(H){return arguments.length?(l=H,L):l},L.y=function(H){return arguments.length?(d=H,L):d},L.radius=function(H){return arguments.length?(_=+H,A=_*2*Math.sin(xo),M=_*1.5,L):_},L.size=function(H){return arguments.length?(n=c=0,a=+H[0],s=+H[1],L):[a-n,s-c]},L.extent=function(H){return arguments.length?(n=+H[0][0],c=+H[0][1],a=+H[1][0],s=+H[1][1],L):[[n,c],[a,s]]},L.radius(1)}function Do(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ko(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Do(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Do(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var ks=6378e3;function yo(n,c){var a=n.dataArray,s=c.size,l=s===void 0?10:s,d=c.method,_=d===void 0?"sum":d,A=l/(2*Math.PI*ks)*(256<<20)/2,M=a.map(function(ge){var Be=(0,Je.Z)(ge.coordinates),vt=(0,Ji.Z)(Be,2),kt=vt[0],yr=vt[1];return ko(ko({},ge),{},{coordinates:[kt,yr]})}),L=Ea().radius(A).x(function(ge){return ge.coordinates[0]}).y(function(ge){return ge.coordinates[1]}),$=L(M),H={dataArray:$.map(function(ge,Be){var vt;if(c.field&&_){var kt=Je.a5.getColumn(ge,c.field);ge[_]=Je.a5.statMap[_](kt)}return vt={},(0,j.Z)(vt,c.method,ge[_]),(0,j.Z)(vt,"count",ge.length),(0,j.Z)(vt,"rawData",ge),(0,j.Z)(vt,"coordinates",[ge.x,ge.y]),(0,j.Z)(vt,"_id",Be),vt}),radius:A,xOffset:A,yOffset:A,type:"hexagon"};return H}function Go(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ba(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Go(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Go(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function ho(n,c){var a=c.sourceField,s=c.targetField,l=c.data,d={};return l.forEach(function(_){d[_[a]]=_}),n.dataArray=n.dataArray.map(function(_){var A=_[s];return Ba(Ba({},_),d[A])}),n}function as(n,c){var a=c.callback;return a&&(n.dataArray=n.dataArray.map(a)),n}var Fo=b(85491),Se=Ii;ae("geojson",Sr),ae("image",Hr),ae("csv",cn),ae("json",Lt),ae("raster",yn),K("cluster",Bn),K("filter",ya),K("join",ho),K("map",as),K("grid",so),K("hexagon",yo);var ke=Pt,yt=Lr,O=b(75530);function Qr(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function oi(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Qr(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Qr(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Ai(n){var c=po();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function po(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Qa=0,Wa=function(n){(0,Kn.Z)(a,n);var c=Ai(a);function a(s){var l;return(0,vr.Z)(this,a),l=c.call(this),(0,j.Z)((0,St.Z)(l),"controlOption",void 0),(0,j.Z)((0,St.Z)(l),"container",void 0),(0,j.Z)((0,St.Z)(l),"sceneContainer",void 0),(0,j.Z)((0,St.Z)(l),"mapsService",void 0),(0,j.Z)((0,St.Z)(l),"renderService",void 0),(0,j.Z)((0,St.Z)(l),"layerService",void 0),(0,j.Z)((0,St.Z)(l),"controlService",void 0),(0,j.Z)((0,St.Z)(l),"isShow",void 0),l.controlOption=oi(oi({},l.getDefault()),s||{}),l}return(0,Or.Z)(a,[{key:"getDefault",value:function(){return{position:O.PositionType.TOPRIGHT,name:"".concat(Qa++)}}},{key:"setPosition",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:O.PositionType.BOTTOMRIGHT,d=this.controlService;return d&&d.removeControl(this),this.controlOption.position=l,d&&d.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(l){this.mapsService=l.get(O.vK.IMapService),this.renderService=l.get(O.vK.IRendererService),this.layerService=l.get(O.vK.ILayerService),this.controlService=l.get(O.vK.IControlService),this.sceneContainer=l,this.isShow=!0,this.container=this.onAdd();var d=this.container,_=this.controlOption.position,A=this.controlService.controlCorners[_];return Je.SO.addClass(d,"l7-control"),_.indexOf("bottom")!==-1?A.insertBefore(d,A.firstChild):A.appendChild(d),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var l=this.container;Je.SO.addClass(l,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var l=this.container;Je.SO.removeClass(l,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Je.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(l){if(this.mapsService&&l&&l.screenX>0&&l.screenY>0){var d=this.mapsService.getContainer();d!==null&&d.focus()}}}]),a}(dt.EventEmitter);function os(n){var c=su();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function su(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var wu=function(n){(0,Kn.Z)(a,n);var c=os(a);function a(s){var l;return(0,vr.Z)(this,a),l=c.call(this,s),(0,j.Z)((0,St.Z)(l),"layerControlInputs",void 0),(0,j.Z)((0,St.Z)(l),"layers",void 0),(0,j.Z)((0,St.Z)(l),"lastZIndex",void 0),(0,j.Z)((0,St.Z)(l),"handlingClick",void 0),(0,j.Z)((0,St.Z)(l),"layersLink",void 0),(0,j.Z)((0,St.Z)(l),"baseLayersList",void 0),(0,j.Z)((0,St.Z)(l),"separator",void 0),(0,j.Z)((0,St.Z)(l),"overlaysList",void 0),(0,j.Z)((0,St.Z)(l),"form",void 0),l.layerControlInputs=[],l.layers=[],l.lastZIndex=0,l.handlingClick=!1,l.initLayers(),(0,Je.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,St.Z)(l)),l}return(0,Or.Z)(a,[{key:"getDefault",value:function(){return{collapsed:!0,position:O.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var l=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(d){d.layer.on("remove",l.onLayerChange),d.layer.on("add",l.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(l,d){return this.addLayer(l,d,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var l=this.renderService.getViewportSize(),d=l.height;Je.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var _=d-(this.container.offsetTop+50);return _<this.form.clientHeight?(Je.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=_+"px"):Je.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Je.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var l=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(d){d.layer.off("remove",l.onLayerChange),d.layer.off("add",l.onLayerChange)}))}},{key:"initLayout",value:function(){var l="l7-control-layers",d=this.container=Je.SO.create("div",l),_=this.controlOption.collapsed;d.setAttribute("aria-haspopup","true");var A=this.form=Je.SO.create("form",l+"-list");_&&(this.mapsService.on("click",this.collapse),d.addEventListener("mouseenter",this.expand),d.addEventListener("mouseleave",this.collapse)),this.layersLink=Je.SO.create("a",l+"-toggle",d);var M=this.layersLink;M.title="Layers",_||this.expand(),this.baseLayersList=Je.SO.create("div",l+"-base",A),this.separator=Je.SO.create("div",l+"-separator",A),this.overlaysList=Je.SO.create("div",l+"-overlays",A),d.appendChild(A)}},{key:"initLayers",value:function(){var l=this,d=this.controlOption,_=d.baseLayers,A=_===void 0?{}:_,M=d.overlayers,L=M===void 0?{}:M;Object.keys(A).forEach(function($,H){l.addLayer(A[$],$,!1)}),Object.keys(L).forEach(function($,H){l.addLayer(L[$],$,!0)})}},{key:"update",value:function(){if(!this.container)return this;Je.SO.empty(this.baseLayersList),Je.SO.empty(this.overlaysList),this.layerControlInputs=[];var l,d,_,A,M=0;for(_=0;_<this.layers.length;_++)A=this.layers[_],this.addItem(A),d=d||A.overlay,l=l||!A.overlay,M+=A.overlay?0:1;return this.controlOption.hideSingleBase&&(l=l&&M>1,this.baseLayersList.style.display=l?"":"none"),this.separator.style.display=d&&l?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var l=this.layerControlInputs,d,_,A=this.mapsService.getZoom(),M=l.length-1;M>=0;M--)if(d=l[M],_=this.layerService.getLayer(d.layerId),_&&_.inited){var L=_.getMinZoom(),$=_.getMaxZoom();d.disabled=A<L||A>$}}},{key:"addLayer",value:function(l,d,_){this.mapsService&&(l.on("add",this.onLayerChange),l.on("remove",this.onLayerChange)),this.layers.push({layer:l,name:d,overlay:_});var A=this.controlOption,M=A.sortLayers,L=A.sortFunction,$=A.autoZIndex;M&&this.layers.sort(function(H,ge){return L(H.layer,ge.layer,H.name,ge.name)}),$&&l.setZIndex&&(this.lastZIndex++,l.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(l){this.handlingClick||this.update();var d=this.layerService.getLayer(l.target.layerId),_=d!=null&&d.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;_&&this.emit(_,d)}},{key:"createRadioElement",value:function(l,d){var _='<input type="radio" class="l7-control-layers-selector" name="'+l+'"'+(d?' checked="checked"':"")+"/>",A=document.createElement("div");return A.innerHTML=_,A.firstChild}},{key:"addItem",value:function(l){var d=document.createElement("label"),_=this.layerService.getLayer(l.layer.id),A=_&&_.inited&&l.layer.isVisible(),M;l.overlay?(M=document.createElement("input"),M.type="checkbox",M.className="l7-control-layers-selector",M.defaultChecked=A):M=this.createRadioElement("l7-base-layers",A),this.layerControlInputs.push(M),M.layerId=l.layer.id,M.addEventListener("click",this.onInputClick);var L=document.createElement("span");L.innerHTML=" "+l.name;var $=document.createElement("div");d.appendChild($),$.appendChild(M),$.appendChild(L);var H=l.overlay?this.overlaysList:this.baseLayersList;return H.appendChild(d),this.checkDisabledLayers(),d}},{key:"onInputClick",value:function(){var l=this.layerControlInputs,d,_,A=[],M=[];this.handlingClick=!0;for(var L=l.length-1;L>=0;L--)d=l[L],_=this.layerService.getLayer(d.layerId),d.checked?A.push(_):d.checked||M.push(_);M.forEach(function($){$.hide()}),A.forEach(function($){$.show()}),this.handlingClick=!1}}]),a}(Wa);function Qu(n){var c=qo();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function qo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var es=function(n){(0,Kn.Z)(a,n);var c=Qu(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getDefault",value:function(){return{position:O.PositionType.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var l="l7-control-logo",d=Je.SO.create("div",l),_=Je.SO.create("a","l7-ctrl-logo");return _.target="_blank",_.rel="noopener nofollow",_.href="https://antv.alipay.com/l7",_.setAttribute("aria-label","AntV logo"),_.setAttribute("rel","noopener nofollow"),d.appendChild(_),d}},{key:"onRemove",value:function(){return null}}]),a}(Wa);function ss(n){var c=As();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function As(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var us=function(n){(0,Kn.Z)(a,n);var c=ss(a);function a(s){var l;return(0,vr.Z)(this,a),l=c.call(this,s),(0,j.Z)((0,St.Z)(l),"mScale",void 0),(0,j.Z)((0,St.Z)(l),"iScale",void 0),(0,Je.Ev)(["update"],(0,St.Z)(l)),l}return(0,Or.Z)(a,[{key:"getDefault",value:function(){return{position:O.PositionType.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var l="l7-control-scale",d=Je.SO.create("div",l);this.addScales(l+"-line",d);var _=this.controlOption.updateWhenIdle;return this.mapsService.on(_?"moveend":"mapmove",this.update),this.mapsService.on(_?"zoomend":"zoomchange",this.update),this.update(),d}},{key:"onRemove",value:function(){var l=this.controlOption.updateWhenIdle;this.mapsService.off(l?"zoomend":"zoomchange",this.update),this.mapsService.off(l?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var l=this.mapsService,d=this.controlOption.maxWidth,_=l.getSize()[1]/2,A=l.containerToLngLat([0,_]),M=l.containerToLngLat([d,_]),L=(0,Je.yM)([A.lng,A.lat],[M.lng,M.lat]);this.updateScales(L)}},{key:"updateScales",value:function(l){var d=this.controlOption,_=d.metric,A=d.imperial;_&&l&&this.updateMetric(l),A&&l&&this.updateImperial(l)}},{key:"updateMetric",value:function(l){var d=this.getRoundNum(l),_=d<1e3?d+" m":d/1e3+" km";this.updateScale(this.mScale,_,d/l)}},{key:"updateImperial",value:function(l){var d=l*3.2808399,_,A,M;d>5280?(_=d/5280,A=this.getRoundNum(_),this.updateScale(this.iScale,A+" mi",A/_)):(M=this.getRoundNum(d),this.updateScale(this.iScale,M+" ft",M/d))}},{key:"updateScale",value:function(l,d,_){var A=this.controlOption.maxWidth;l.style.width=Math.round(A*_)+"px",l.innerHTML=d}},{key:"getRoundNum",value:function(l){var d=Math.pow(10,(Math.floor(l)+"").length-1),_=l/d;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:1,d*_}},{key:"addScales",value:function(l,d){var _=this.controlOption,A=_.metric,M=_.imperial;A&&(this.mScale=Je.SO.create("div",l,d)),M&&(this.iScale=Je.SO.create("div",l,d))}}]),a}(Wa);function Zs(n){var c=Ys();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Ys(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ts=function(n){(0,Kn.Z)(a,n);var c=Zs(a);function a(s){var l;return(0,vr.Z)(this,a),l=c.call(this,s),(0,j.Z)((0,St.Z)(l),"disabled",void 0),(0,j.Z)((0,St.Z)(l),"zoomInButton",void 0),(0,j.Z)((0,St.Z)(l),"zoomOutButton",void 0),(0,Je.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,St.Z)(l)),l}return(0,Or.Z)(a,[{key:"getDefault",value:function(){return{position:O.PositionType.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var l="l7-control-zoom",d=Je.SO.create("div",l+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,l+"-in",d,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,l+"-out",d,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),d}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(l,d,_,A,M){var L=Je.SO.create("a",_,A);return L.innerHTML=l,L.title=d,L.href="javascript:void(0)",L.addEventListener("click",M),L}},{key:"updateDisabled",value:function(){var l=this.mapsService,d="l7-disabled";Je.SO.removeClass(this.zoomInButton,d),Je.SO.removeClass(this.zoomOutButton,d),(this.disabled||l.getZoom()<=l.getMinZoom())&&Je.SO.addClass(this.zoomOutButton,d),(this.disabled||l.getZoom()>=l.getMaxZoom())&&Je.SO.addClass(this.zoomInButton,d)}}]),a}(Wa);function Aa(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function wo(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Aa(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Aa(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function ml(n){var c=yl();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function yl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var qu=function(n){(0,Kn.Z)(a,n);var c=ml(a);function a(s){var l;return(0,vr.Z)(this,a),l=c.call(this),(0,j.Z)((0,St.Z)(l),"markerOption",void 0),(0,j.Z)((0,St.Z)(l),"defaultMarker",void 0),(0,j.Z)((0,St.Z)(l),"popup",void 0),(0,j.Z)((0,St.Z)(l),"mapsService",void 0),(0,j.Z)((0,St.Z)(l),"sceneSerive",void 0),(0,j.Z)((0,St.Z)(l),"lngLat",void 0),(0,j.Z)((0,St.Z)(l),"scene",void 0),(0,j.Z)((0,St.Z)(l),"added",!1),(0,j.Z)((0,St.Z)(l),"eventHandle",function(d){l.emit(d.type,{target:d,data:l.markerOption.extData,lngLat:l.lngLat})}),l.markerOption=wo(wo({},l.getDefault()),s),(0,Je.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,St.Z)(l)),l.init(),l}return(0,Or.Z)(a,[{key:"getDefault",value:function(){return{element:void 0,anchor:Je.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(l){this.scene=l,this.mapsService=l.get(O.vK.IMapService),this.sceneSerive=l.get(O.vK.ISceneService);var d=this.markerOption,_=d.element,A=d.draggable;return this.mapsService.getMarkerContainer().appendChild(_),this.registerMarkerEvent(_),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var l=this.markerOption.element;return l&&Je.SO.remove(l),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(l){var d=this;if(!this.added)return this.once("added",function(){d.setElement(l)}),this;var _=this.markerOption.element;return _&&Je.SO.remove(_),this.markerOption.element=l,this.init(),this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.update(),this}},{key:"openPopup",value:function(){var l=this;if(!this.added)return this.once("added",function(){l.openPopup()}),this;var d=this.popup;return d?(d.isOpen()||d.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var l=this;this.added||this.once("added",function(){l.closePopup()});var d=this.popup;return d&&d.remove(),this}},{key:"setPopup",value:function(l){return this.popup=l,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var l=this.popup;if(l)l.isOpen()?l.remove():l.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(l){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(l){this.markerOption.extData=l}},{key:"update",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,_=l.anchor;this.updatePosition(),Je.SO.setTransform(d,"".concat(Je.rQ[_]))}}},{key:"onMapClick",value:function(l){var d=this.markerOption.element;this.popup&&d&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,_=l.offsets,A=this.lngLat,M=A.lng,L=A.lat,$=this.mapsService.getBounds(),H=this.mapsService.lngLatToContainer([M,L]);if(d){d.style.display="block";var ge=this.mapsService.getContainer(),Be=0,vt=0;if(ge&&(Be=ge.scrollWidth,vt=ge.scrollHeight),Math.abs($[0][0])>180||Math.abs($[1][0])>180){if(H.x>Be){var kt=this.mapsService.lngLatToContainer([M-360,L]);H.x=kt.x}if(H.x<0){var yr=this.mapsService.lngLatToContainer([M+360,L]);H.x=yr.x}}(H.x>Be||H.x<0||H.y>vt||H.y<0)&&(d.style.display="none"),d.style.left=H.x+_[0]+"px",d.style.top=H.y-_[1]+"px"}}}},{key:"init",value:function(){var l=this,d=this.markerOption.element,_=this.markerOption,A=_.color,M=_.anchor;if(!d){this.defaultMarker=!0,d=Je.SO.create("div"),this.markerOption.element=d;var L=document.createElementNS("http://www.w3.org/2000/svg","svg");L.setAttributeNS(null,"display","block"),L.setAttributeNS(null,"height","48px"),L.setAttributeNS(null,"width","48px"),L.setAttributeNS(null,"viewBox","0 0 1024 1024");var $=document.createElementNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),$.setAttributeNS(null,"fill",A),L.appendChild($),d.appendChild(L)}Je.SO.addClass(d,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(H){var ge,Be,vt=((ge=l.markerOption)===null||ge===void 0?void 0:ge.style)&&((Be=l.markerOption)===null||Be===void 0?void 0:Be.style[H]);d&&(d.style[H]=vt)}),d.addEventListener("click",function(H){l.onMapClick(H)}),d.addEventListener("click",this.eventHandle),(0,Je.zi)(d,M,"marker")}},{key:"registerMarkerEvent",value:function(l){l.addEventListener("mousemove",this.eventHandle),l.addEventListener("click",this.eventHandle),l.addEventListener("mousedown",this.eventHandle),l.addEventListener("mouseup",this.eventHandle),l.addEventListener("dblclick",this.eventHandle),l.addEventListener("contextmenu",this.eventHandle),l.addEventListener("mouseover",this.eventHandle),l.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var l=this.getElement();l.removeEventListener("mousemove",this.eventHandle),l.removeEventListener("click",this.eventHandle),l.removeEventListener("mousedown",this.eventHandle),l.removeEventListener("mouseup",this.eventHandle),l.removeEventListener("dblclick",this.eventHandle),l.removeEventListener("contextmenu",this.eventHandle),l.removeEventListener("mouseover",this.eventHandle),l.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(l){throw new Error("Method not implemented.")}},{key:"onUp",value:function(l){throw new Error("Method not implemented.")}}]),a}(dt.EventEmitter),Jl=b(28440),gl=b.n(Jl);function Lu(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Us(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Lu(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Lu(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function _l(n){var c=m();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function m(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var w=function(n){(0,Kn.Z)(a,n);var c=_l(a);function a(s){var l,d;return(0,vr.Z)(this,a),d=c.call(this),(0,j.Z)((0,St.Z)(d),"markers",[]),(0,j.Z)((0,St.Z)(d),"markerLayerOption",void 0),(0,j.Z)((0,St.Z)(d),"clusterIndex",void 0),(0,j.Z)((0,St.Z)(d),"points",[]),(0,j.Z)((0,St.Z)(d),"clusterMarkers",[]),(0,j.Z)((0,St.Z)(d),"mapsService",void 0),(0,j.Z)((0,St.Z)(d),"scene",void 0),(0,j.Z)((0,St.Z)(d),"zoom",void 0),(0,j.Z)((0,St.Z)(d),"bbox",void 0),d.markerLayerOption=gl()(d.getDefault(),s),(0,Je.Ev)(["update"],(0,St.Z)(d)),d.zoom=((l=d.markerLayerOption.clusterOption)===null||l===void 0?void 0:l.zoom)||-99,d}return(0,Or.Z)(a,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(l){return this.scene=l,this.mapsService=l.get(O.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(l){var d=this.markerLayerOption.cluster;d&&this.addPoint(l,this.markers.length),this.markers.push(l)}},{key:"removeMarker",value:function(l){this.markers.indexOf(l);var d=this.markers.indexOf(l);d>-1&&this.markers.splice(d,1)}},{key:"hide",value:function(){this.markers.map(function(l){l.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(l){l.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var l=this.markerLayerOption.cluster;return l?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var l=this;this.getMarkers().forEach(function(d){d.addTo(l.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(l){l.remove()}),this.clusterMarkers.forEach(function(l){l.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(l,d){var _=l.getLnglat(),A=_.lng,M=_.lat,L={geometry:{type:"Point",coordinates:[A,M]},properties:Us(Us({},l.getExtData()),{},{marker_id:d})};this.points.push(L)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var l=this.markerLayerOption.clusterOption,d=l.radius,_=l.minZoom,A=_===void 0?0:_,M=l.maxZoom;this.clusterIndex=new(Kt())({radius:d,minZoom:A,maxZoom:M}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(l,d){var _=this,A=l[0].concat(l[1]),M=this.clusterIndex.getClusters(A,d);this.clusterMarkers.forEach(function(L){L.remove()}),this.clusterMarkers=[],M.forEach(function(L){var $,H=_.markerLayerOption.clusterOption,ge=H.field,Be=H.method;if(L.properties&&($=L.properties)!==null&&$!==void 0&&$.cluster_id){var vt,kt=_.getLeaves((vt=L.properties)===null||vt===void 0?void 0:vt.cluster_id);if(L.properties.clusterData=kt,ge&&Be){var yr=kt==null?void 0:kt.map(function(zn){var ti=(0,j.Z)({},ge,zn.properties[ge]);return ti}),wr=Je.a5.getColumn(yr,ge),jr=Je.a5.getSatByColumn(Be,wr),gn="point_"+Be;L.properties[gn]=jr.toFixed(2)}}var Sn=_.clusterMarker(L);_.clusterMarkers.push(Sn),Sn.addTo(_.scene)})}},{key:"getLeaves",value:function(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return l?this.clusterIndex.getLeaves(l,d,_):null}},{key:"clusterMarker",value:function(l){var d=this.markerLayerOption.clusterOption,_=d,A=_.element,M=A===void 0?this.generateElement.bind(this):A,L=new qu({element:M(l)}).setLnglat({lng:l.geometry.coordinates[0],lat:l.geometry.coordinates[1]});return L}},{key:"normalMarker",value:function(l){var d=l.properties.marker_id;return this.markers[d]}},{key:"update",value:function(){var l=this.mapsService.getZoom(),d=this.mapsService.getBounds();(!this.bbox||Math.abs(l-this.zoom)>=1||!(0,Je.oO)(this.bbox,d))&&(this.bbox=(0,Je.yA)(d,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(l){var d=Je.SO.create("div","l7-marker-cluster"),_=Je.SO.create("div","",d),A=Je.SO.create("span","",_),M=this.markerLayerOption.clusterOption,L=M.field,$=M.method;l.properties.point_count=l.properties.point_count||1;var H=L&&$?l.properties["point_"+$]||l.properties[L]:l.properties.point_count;return A.textContent=H,d}}]),a}(dt.EventEmitter);function z(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function I(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?z(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):z(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function fe(n){var c=Le();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Le(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var pt=function(n){(0,Kn.Z)(a,n);var c=fe(a);function a(s){var l;return(0,vr.Z)(this,a),l=c.call(this),(0,j.Z)((0,St.Z)(l),"popupOption",void 0),(0,j.Z)((0,St.Z)(l),"mapsService",void 0),(0,j.Z)((0,St.Z)(l),"sceneSerive",void 0),(0,j.Z)((0,St.Z)(l),"lngLat",void 0),(0,j.Z)((0,St.Z)(l),"content",void 0),(0,j.Z)((0,St.Z)(l),"closeButton",void 0),(0,j.Z)((0,St.Z)(l),"timeoutInstance",void 0),(0,j.Z)((0,St.Z)(l),"container",void 0),(0,j.Z)((0,St.Z)(l),"tip",void 0),(0,j.Z)((0,St.Z)(l),"scene",void 0),l.popupOption=I(I({},l.getdefault()),s),(0,Je.Ev)(["update","onClickClose","remove"],(0,St.Z)(l)),l}return(0,Or.Z)(a,[{key:"addTo",value:function(l){var d=this;return this.mapsService=l.get(O.vK.IMapService),this.sceneSerive=l.get(O.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=l,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){d.mapsService.on("click",d.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(l){var d=window.document.createDocumentFragment(),_=window.document.createElement("body"),A;for(_.innerHTML=l;A=_.firstChild,!!A;)d.appendChild(A);return this.setDOMContent(d)}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(l){return this.setDOMContent(window.document.createTextNode(l))}},{key:"setMaxWidth",value:function(l){return this.popupOption.maxWidth=l,this.update(),this}},{key:"setDOMContent",value:function(l){return this.createContent(),this.content.appendChild(l),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&Je.SO.remove(this.content),this.content=Je.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Je.SO.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(l,d,_){var A=window.document.createElement(l);return d!==void 0&&(A.className=d),_&&_.appendChild(A),A}},{key:"removeDom",value:function(l){l.parentNode&&l.parentNode.removeChild(l)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Je.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(l){l.stopPropagation&&l.stopPropagation(),this.remove()}},{key:"update",value:function(){var l=this,d=this.lngLat,_=this.popupOption,A=_.className,M=_.maxWidth,L=_.anchor;if(!(!this.mapsService||!d||!this.content)){var $=this.mapsService.getMarkerContainer();if(!this.container&&$){this.container=this.creatDom("div","l7-popup",$),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),A&&A.split(" ").forEach(function(ge){return l.container.classList.add(ge)});var H=this.popupOption.stopPropagation;H&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(ge){l.container.addEventListener(ge,function(Be){Be.stopPropagation()})})}M&&this.container.style.maxWidth!==M&&(this.container.style.maxWidth=M),this.updatePosition(),Je.SO.setTransform(this.container,"".concat(Je.rQ[L])),(0,Je.zi)(this.container,L,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.lngLat,d=l.lng,_=l.lat,A=this.popupOption.offsets,M=this.mapsService.lngLatToContainer([d,_]);this.container.style.left=M.x+A[0]+"px",this.container.style.top=M.y-A[1]+"px"}}}]),a}(dt.EventEmitter);function Zt(n,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=n:l.appendChild(c.createTextNode(n)),a.appendChild(l),l}}Zt(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var jt=b(30513),Fr=b(90122),Wr=b.n(Fr),hn=b(99311),Oi=b(30954),Ei=b.n(Oi),pa=b(78892),Ma=function(){function n(c,a){(0,vr.Z)(this,n),(0,j.Z)(this,"attribute",void 0),(0,j.Z)(this,"buffer",void 0);var s=a.buffer,l=a.offset,d=a.stride,_=a.normalized,A=a.size,M=a.divisor;this.buffer=s,this.attribute={buffer:s.get(),offset:l||0,stride:d||0,normalized:_||!1,divisor:M||0},A&&(this.attribute.size=A)}return(0,Or.Z)(n,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(a){this.buffer.subData(a)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),n}(),ga,_i,go,Ao,Ks,uu,$s,Ru,Ho,_s,uo,La,Js,xl,xs=(ga={},(0,j.Z)(ga,O.gl.POINTS,"points"),(0,j.Z)(ga,O.gl.LINES,"lines"),(0,j.Z)(ga,O.gl.LINE_LOOP,"line loop"),(0,j.Z)(ga,O.gl.LINE_STRIP,"line strip"),(0,j.Z)(ga,O.gl.TRIANGLES,"triangles"),(0,j.Z)(ga,O.gl.TRIANGLE_FAN,"triangle fan"),(0,j.Z)(ga,O.gl.TRIANGLE_STRIP,"triangle strip"),ga),kl=(_i={},(0,j.Z)(_i,O.gl.STATIC_DRAW,"static"),(0,j.Z)(_i,O.gl.DYNAMIC_DRAW,"dynamic"),(0,j.Z)(_i,O.gl.STREAM_DRAW,"stream"),_i),Qs=(go={},(0,j.Z)(go,O.gl.BYTE,"int8"),(0,j.Z)(go,O.gl.UNSIGNED_INT,"int16"),(0,j.Z)(go,O.gl.INT,"int32"),(0,j.Z)(go,O.gl.UNSIGNED_BYTE,"uint8"),(0,j.Z)(go,O.gl.UNSIGNED_SHORT,"uint16"),(0,j.Z)(go,O.gl.UNSIGNED_INT,"uint32"),(0,j.Z)(go,O.gl.FLOAT,"float"),go),qs=(Ao={},(0,j.Z)(Ao,O.gl.ALPHA,"alpha"),(0,j.Z)(Ao,O.gl.LUMINANCE,"luminance"),(0,j.Z)(Ao,O.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,j.Z)(Ao,O.gl.RGB,"rgb"),(0,j.Z)(Ao,O.gl.RGBA,"rgba"),(0,j.Z)(Ao,O.gl.RGBA4,"rgba4"),(0,j.Z)(Ao,O.gl.RGB5_A1,"rgb5 a1"),(0,j.Z)(Ao,O.gl.RGB565,"rgb565"),(0,j.Z)(Ao,O.gl.DEPTH_COMPONENT,"depth"),(0,j.Z)(Ao,O.gl.DEPTH_STENCIL,"depth stencil"),Ao),mc=(Ks={},(0,j.Z)(Ks,O.gl.DONT_CARE,"dont care"),(0,j.Z)(Ks,O.gl.NICEST,"nice"),(0,j.Z)(Ks,O.gl.FASTEST,"fast"),Ks),Du=(uu={},(0,j.Z)(uu,O.gl.NEAREST,"nearest"),(0,j.Z)(uu,O.gl.LINEAR,"linear"),(0,j.Z)(uu,O.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,j.Z)(uu,O.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,j.Z)(uu,O.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,j.Z)(uu,O.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),uu),Ra=($s={},(0,j.Z)($s,O.gl.REPEAT,"repeat"),(0,j.Z)($s,O.gl.CLAMP_TO_EDGE,"clamp"),(0,j.Z)($s,O.gl.MIRRORED_REPEAT,"mirror"),$s),bl=(Ru={},(0,j.Z)(Ru,O.gl.NONE,"none"),(0,j.Z)(Ru,O.gl.BROWSER_DEFAULT_WEBGL,"browser"),Ru),Kc=(Ho={},(0,j.Z)(Ho,O.gl.NEVER,"never"),(0,j.Z)(Ho,O.gl.ALWAYS,"always"),(0,j.Z)(Ho,O.gl.LESS,"less"),(0,j.Z)(Ho,O.gl.LEQUAL,"lequal"),(0,j.Z)(Ho,O.gl.GREATER,"greater"),(0,j.Z)(Ho,O.gl.GEQUAL,"gequal"),(0,j.Z)(Ho,O.gl.EQUAL,"equal"),(0,j.Z)(Ho,O.gl.NOTEQUAL,"notequal"),Ho),ku=(_s={},(0,j.Z)(_s,O.gl.FUNC_ADD,"add"),(0,j.Z)(_s,O.gl.MIN_EXT,"min"),(0,j.Z)(_s,O.gl.MAX_EXT,"max"),(0,j.Z)(_s,O.gl.FUNC_SUBTRACT,"subtract"),(0,j.Z)(_s,O.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),_s),Sl=(uo={},(0,j.Z)(uo,O.gl.ZERO,"zero"),(0,j.Z)(uo,O.gl.ONE,"one"),(0,j.Z)(uo,O.gl.SRC_COLOR,"src color"),(0,j.Z)(uo,O.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,j.Z)(uo,O.gl.SRC_ALPHA,"src alpha"),(0,j.Z)(uo,O.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,j.Z)(uo,O.gl.DST_COLOR,"dst color"),(0,j.Z)(uo,O.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,j.Z)(uo,O.gl.DST_ALPHA,"dst alpha"),(0,j.Z)(uo,O.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,j.Z)(uo,O.gl.CONSTANT_COLOR,"constant color"),(0,j.Z)(uo,O.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,j.Z)(uo,O.gl.CONSTANT_ALPHA,"constant alpha"),(0,j.Z)(uo,O.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,j.Z)(uo,O.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),uo),$c=(La={},(0,j.Z)(La,O.gl.NEVER,"never"),(0,j.Z)(La,O.gl.ALWAYS,"always"),(0,j.Z)(La,O.gl.LESS,"less"),(0,j.Z)(La,O.gl.LEQUAL,"lequal"),(0,j.Z)(La,O.gl.GREATER,"greater"),(0,j.Z)(La,O.gl.GEQUAL,"gequal"),(0,j.Z)(La,O.gl.EQUAL,"equal"),(0,j.Z)(La,O.gl.NOTEQUAL,"notequal"),La),el=(Js={},(0,j.Z)(Js,O.gl.ZERO,"zero"),(0,j.Z)(Js,O.gl.KEEP,"keep"),(0,j.Z)(Js,O.gl.REPLACE,"replace"),(0,j.Z)(Js,O.gl.INVERT,"invert"),(0,j.Z)(Js,O.gl.INCR,"increment"),(0,j.Z)(Js,O.gl.DECR,"decrement"),(0,j.Z)(Js,O.gl.INCR_WRAP,"increment wrap"),(0,j.Z)(Js,O.gl.DECR_WRAP,"decrement wrap"),Js),Ql=(xl={},(0,j.Z)(xl,O.gl.FRONT,"front"),(0,j.Z)(xl,O.gl.BACK,"back"),xl),Au=function(){function n(c,a){(0,vr.Z)(this,n),(0,j.Z)(this,"buffer",void 0);var s=a.data,l=a.usage,d=a.type;this.buffer=c.buffer({data:s,usage:kl[l||O.gl.STATIC_DRAW],type:Qs[d||O.gl.UNSIGNED_BYTE]})}return(0,Or.Z)(n,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(a){var s=a.data,l=a.offset;this.buffer.subdata(s,l)}}]),n}(),tl=function(){function n(c,a){(0,vr.Z)(this,n),(0,j.Z)(this,"elements",void 0);var s=a.data,l=a.usage,d=a.type,_=a.count;this.elements=c.elements({data:s,usage:kl[l||O.gl.STATIC_DRAW],type:Qs[d||O.gl.UNSIGNED_BYTE],count:_})}return(0,Or.Z)(n,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(a){var s=a.data;this.elements.subdata(s)}},{key:"destroy",value:function(){}}]),n}(),El=function(){function n(c,a){(0,vr.Z)(this,n),(0,j.Z)(this,"framebuffer",void 0);var s=a.width,l=a.height,d=a.color,_=a.colors,A=a.depth,M=a.stencil,L={width:s,height:l};Array.isArray(_)&&(L.colors=_.map(function($){return $.get()})),d&&typeof d!="boolean"&&(L.color=d.get()),this.framebuffer=c.framebuffer(L)}return(0,Or.Z)(n,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.framebuffer.resize(s,l)}}]),n}(),Cl=b(53383),rl=b(18397),wl=b.n(rl),nl=b(19308),eu=b.n(nl);function ql(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Fu(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?ql(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ql(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Dc=function(){function n(c,a){(0,vr.Z)(this,n),(0,j.Z)(this,"reGl",void 0),(0,j.Z)(this,"destroyed",!1),(0,j.Z)(this,"drawCommand",void 0),(0,j.Z)(this,"drawParams",void 0),(0,j.Z)(this,"options",void 0),(0,j.Z)(this,"uniforms",{}),this.reGl=c;var s=a.vs,l=a.fs,d=a.attributes,_=a.uniforms,A=a.primitive,M=a.count,L=a.elements,$=a.depth,H=a.blend,ge=a.stencil,Be=a.cull,vt=a.instances,kt={};this.options=a,_&&(this.uniforms=this.extractUniforms(_),Object.keys(_).forEach(function(jr){kt[jr]=c.prop(jr)}));var yr={};Object.keys(d).forEach(function(jr){yr[jr]=d[jr].get()});var wr={attributes:yr,frag:l,uniforms:kt,vert:s,primitive:xs[A===void 0?O.gl.TRIANGLES:A]};vt&&(wr.instances=vt),M&&(wr.count=M),L&&(wr.elements=L.get()),this.initDepthDrawParams({depth:$},wr),this.initBlendDrawParams({blend:H},wr),this.initStencilDrawParams({stencil:ge},wr),this.initCullDrawParams({cull:Be},wr),this.drawCommand=c(wr),this.drawParams=wr}return(0,Or.Z)(n,[{key:"addUniforms",value:function(a){this.uniforms=Fu(Fu({},this.uniforms),this.extractUniforms(a))}},{key:"draw",value:function(a){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var s=Fu(Fu({},this.uniforms),this.extractUniforms(a.uniforms||{})),l={};Object.keys(s).forEach(function(d){var _=(0,Cl.Z)(s[d]);_==="boolean"||_==="number"||Array.isArray(s[d])||s[d].BYTES_PER_ELEMENT?l[d]=s[d]:l[d]=s[d].get()}),this.drawCommand(l)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(a){a.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(a,s){var l=a.depth;l&&(s.depth={enable:l.enable===void 0?!0:!!l.enable,mask:l.mask===void 0?!0:!!l.mask,func:Kc[l.func||O.gl.LESS],range:l.range||[0,1]})}},{key:"initBlendDrawParams",value:function(a,s){var l=a.blend;if(l){var d=l.enable,_=l.func,A=l.equation,M=l.color,L=M===void 0?[0,0,0,0]:M;s.blend={enable:!!d,func:{srcRGB:Sl[_&&_.srcRGB||O.gl.SRC_ALPHA],srcAlpha:Sl[_&&_.srcAlpha||O.gl.SRC_ALPHA],dstRGB:Sl[_&&_.dstRGB||O.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:Sl[_&&_.dstAlpha||O.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:ku[A&&A.rgb||O.gl.FUNC_ADD],alpha:ku[A&&A.alpha||O.gl.FUNC_ADD]},color:L}}}},{key:"initStencilDrawParams",value:function(a,s){var l=a.stencil;if(l){var d=l.enable,_=l.mask,A=_===void 0?-1:_,M=l.func,L=M===void 0?{cmp:O.gl.ALWAYS,ref:0,mask:-1}:M,$=l.opFront,H=$===void 0?{fail:O.gl.KEEP,zfail:O.gl.KEEP,zpass:O.gl.KEEP}:$,ge=l.opBack,Be=ge===void 0?{fail:O.gl.KEEP,zfail:O.gl.KEEP,zpass:O.gl.KEEP}:ge;s.stencil={enable:!!d,mask:A,func:Fu(Fu({},L),{},{cmp:$c[L.cmp]}),opFront:{fail:el[H.fail],zfail:el[H.zfail],zpass:el[H.zpass]},opBack:{fail:el[Be.fail],zfail:el[Be.zfail],zpass:el[Be.zpass]}}}}},{key:"initCullDrawParams",value:function(a,s){var l=a.cull;if(l){var d=l.enable,_=l.face,A=_===void 0?O.gl.BACK:_;s.cull={enable:!!d,face:Ql[A]}}}},{key:"extractUniforms",value:function(a){var s=this,l={};return Object.keys(a).forEach(function(d){s.extractUniformsRecursively(d,a[d],l,"")}),l}},{key:"extractUniformsRecursively",value:function(a,s,l,d){var _=this;if(s===null||typeof s=="number"||typeof s=="boolean"||Array.isArray(s)&&typeof s[0]=="number"||wl()(s)||s===""||"resize"in s){l["".concat(d&&d+".").concat(a)]=s;return}eu()(s)&&Object.keys(s).forEach(function(A){_.extractUniformsRecursively(A,s[A],l,"".concat(d&&d+".").concat(a))}),Array.isArray(s)&&s.forEach(function(A,M){Object.keys(A).forEach(function(L){_.extractUniformsRecursively(L,A[L],l,"".concat(d&&d+".").concat(a,"[").concat(M,"]"))})})}}]),n}(),il=function(){function n(c,a){(0,vr.Z)(this,n),(0,j.Z)(this,"texture",void 0),(0,j.Z)(this,"width",void 0),(0,j.Z)(this,"height",void 0);var s=a.data,l=a.type,d=l===void 0?O.gl.UNSIGNED_BYTE:l,_=a.width,A=a.height,M=a.flipY,L=M===void 0?!1:M,$=a.format,H=$===void 0?O.gl.RGBA:$,ge=a.mipmap,Be=ge===void 0?!1:ge,vt=a.wrapS,kt=vt===void 0?O.gl.CLAMP_TO_EDGE:vt,yr=a.wrapT,wr=yr===void 0?O.gl.CLAMP_TO_EDGE:yr,jr=a.aniso,gn=jr===void 0?0:jr,Sn=a.alignment,zn=Sn===void 0?1:Sn,ti=a.premultiplyAlpha,ii=ti===void 0?!1:ti,Si=a.mag,ta=Si===void 0?O.gl.NEAREST:Si,_a=a.min,gi=_a===void 0?O.gl.NEAREST:_a,Pa=a.colorSpace,Ua=Pa===void 0?O.gl.BROWSER_DEFAULT_WEBGL:Pa;this.width=_,this.height=A;var au={width:_,height:A,type:Qs[d],format:qs[H],wrapS:Ra[kt],wrapT:Ra[wr],mag:Du[ta],min:Du[gi],alignment:zn,flipY:L,colorSpace:bl[Ua],premultiplyAlpha:ii,aniso:gn};s&&(au.data=s),typeof Be=="number"?au.mipmap=mc[Be]:typeof Be=="boolean"&&(au.mipmap=Be),this.texture=c.texture(au)}return(0,Or.Z)(n,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(a)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.texture.resize(s,l),this.width=s,this.height=l}},{key:"destroy",value:function(){this.texture.destroy()}}]),n}(),Al,Fl,yc=(Al=(0,hn.b2)(),Al(Fl=function(){function n(){var c=this;(0,vr.Z)(this,n),(0,j.Z)(this,"extensionObject",void 0),(0,j.Z)(this,"gl",void 0),(0,j.Z)(this,"$container",void 0),(0,j.Z)(this,"canvas",void 0),(0,j.Z)(this,"width",void 0),(0,j.Z)(this,"height",void 0),(0,j.Z)(this,"isDirty",void 0),(0,j.Z)(this,"createModel",function(a){return new Dc(c.gl,a)}),(0,j.Z)(this,"createAttribute",function(a){return new Ma(c.gl,a)}),(0,j.Z)(this,"createBuffer",function(a){return new Au(c.gl,a)}),(0,j.Z)(this,"createElements",function(a){return new tl(c.gl,a)}),(0,j.Z)(this,"createTexture2D",function(a){return new il(c.gl,a)}),(0,j.Z)(this,"createFramebuffer",function(a){return new El(c.gl,a)}),(0,j.Z)(this,"useFramebuffer",function(a,s){c.gl({framebuffer:a?a.get():null})(s)}),(0,j.Z)(this,"clear",function(a){var s=a.color,l=a.depth,d=a.stencil,_=a.framebuffer,A=_===void 0?null:_,M={color:s,depth:l,stencil:d};M.framebuffer=A===null?A:A.get(),c.gl.clear(M)}),(0,j.Z)(this,"viewport",function(a){var s=a.x,l=a.y,d=a.width,_=a.height;c.gl._gl.viewport(s,l,d,_),c.width=d,c.height=_,c.gl._refresh()}),(0,j.Z)(this,"readPixels",function(a){var s=a.framebuffer,l=a.x,d=a.y,_=a.width,A=a.height,M={x:l,y:d,width:_,height:A};return s&&(M.framebuffer=s.get()),c.gl.read(M)}),(0,j.Z)(this,"getViewportSize",function(){return{width:c.gl._gl.drawingBufferWidth,height:c.gl._gl.drawingBufferHeight}}),(0,j.Z)(this,"getContainer",function(){var a;return(a=c.canvas)===null||a===void 0?void 0:a.parentElement}),(0,j.Z)(this,"getCanvas",function(){return c.canvas}),(0,j.Z)(this,"getGLContext",function(){return c.gl._gl}),(0,j.Z)(this,"destroy",function(){c.gl.destroy()})}return(0,Or.Z)(n,[{key:"init",value:function(){var c=(0,jt.Z)(Wr().mark(function s(l,d){var _=this;return Wr().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return this.canvas=l,M.next=3,new Promise(function(L,$){Ei()({canvas:_.canvas,attributes:{alpha:!0,antialias:d.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:d.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(ge,Be){(ge||!Be)&&$(ge),L(Be)}})});case 3:this.gl=M.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return M.stop()}},s,this)}));function a(s,l){return c.apply(this,arguments)}return a}()},{key:"testExtension",value:function(a){return!!this.getGLContext().getExtension(a)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var a=this.getGLContext();a.disable(a.CULL_FACE)}},{key:"setDirty",value:function(a){this.isDirty=a}},{key:"getDirty",value:function(){return this.isDirty}}]),n}())||Fl);function Bl(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function kc(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Bl(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Bl(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var ec=function(){function n(c){(0,vr.Z)(this,n),(0,j.Z)(this,"sceneService",void 0),(0,j.Z)(this,"mapService",void 0),(0,j.Z)(this,"controlService",void 0),(0,j.Z)(this,"layerService",void 0),(0,j.Z)(this,"iconService",void 0),(0,j.Z)(this,"markerService",void 0),(0,j.Z)(this,"popupService",void 0),(0,j.Z)(this,"fontService",void 0),(0,j.Z)(this,"interactionService",void 0),(0,j.Z)(this,"container",void 0);var a=c.id,s=c.map,l=(0,O.Hp)();this.container=l,s.setContainer(l,a),l.bind(O.vK.IRendererService).to(yc).inSingletonScope(),this.sceneService=l.get(O.vK.ISceneService),this.mapService=l.get(O.vK.IMapService),this.iconService=l.get(O.vK.IIconService),this.fontService=l.get(O.vK.IFontService),this.controlService=l.get(O.vK.IControlService),this.layerService=l.get(O.vK.ILayerService),this.markerService=l.get(O.vK.IMarkerService),this.interactionService=l.get(O.vK.IInteractionService),this.popupService=l.get(O.vK.IPopupService),this.initComponent(a),this.sceneService.init(c),this.initControl()}return(0,Or.Z)(n,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(a){return this.sceneService.exportPng(a)}},{key:"exportMap",value:function(a){return this.sceneService.exportPng(a)}},{key:"registerRenderService",value:function(a){var s=this;if(this.sceneService.loaded){var l=new a(this);l.init()}else this.on("loaded",function(){var d=new a(s);d.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"setBgColor",value:function(a){this.mapService.setBgColor(a)}},{key:"addLayer",value:function(a){var s=(0,O.e7)(this.container);a.setContainer(s),this.sceneService.addLayer(a)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(a){return this.layerService.getLayer(a)}},{key:"getLayerByName",value:function(a){return this.layerService.getLayerByName(a)}},{key:"removeLayer",value:function(a){this.layerService.remove(a)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(a,s){this.fontService.addIconFont(a,s)}},{key:"addIconFonts",value:function(a){var s=this;a.forEach(function(l){var d=(0,Ji.Z)(l,2),_=d[0],A=d[1];s.fontService.addIconFont(_,A)})}},{key:"addFontFace",value:function(a,s){this.sceneService.addFontFace(a,s)}},{key:"addImage",value:function(a,s){this.iconService.addImage(a,s)}},{key:"hasImage",value:function(a){return this.iconService.hasImage(a)}},{key:"removeImage",value:function(a){this.iconService.removeImage(a)}},{key:"addIconFontGlyphs",value:function(a,s){this.fontService.addIconGlyphs(s)}},{key:"addControl",value:function(a){this.controlService.addControl(a,this.container)}},{key:"removeControl",value:function(a){this.controlService.removeControl(a)}},{key:"getControlByName",value:function(a){return this.controlService.getControlByName(a)}},{key:"addMarker",value:function(a){this.markerService.addMarker(a)}},{key:"addMarkerLayer",value:function(a){this.markerService.addMarkerLayer(a)}},{key:"removeMarkerLayer",value:function(a){this.markerService.removeMarkerLayer(a)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(a){this.popupService.addPopup(a)}},{key:"on",value:function(a,s){O.SceneEventList.indexOf(a)===-1?this.mapService.on(a,s):this.sceneService.on(a,s)}},{key:"once",value:function(a,s){O.SceneEventList.indexOf(a)===-1?this.mapService.once(a,s):this.sceneService.once(a,s)}},{key:"off",value:function(a,s){O.SceneEventList.indexOf(a)===-1?this.mapService.off(a,s):this.sceneService.off(a,s)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(a){return this.mapService.getCenter(a)}},{key:"setCenter",value:function(a,s){return this.mapService.setCenter(a,s)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(a){return this.mapService.setPitch(a)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(a){this.mapService.setRotation(a)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(a){this.mapService.panTo(a)}},{key:"panBy",value:function(a,s){this.mapService.panBy(a,s)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(a){this.mapService.setZoom(a)}},{key:"fitBounds",value:function(a,s){var l=this.sceneService.getSceneConfig(),d=l.fitBoundsOptions,_=l.animate;this.mapService.fitBounds(a,s||kc(kc({},d),{},{animate:_}))}},{key:"setZoomAndCenter",value:function(a,s){this.mapService.setZoomAndCenter(a,s)}},{key:"setMapStyle",value:function(a){this.mapService.setMapStyle(a)}},{key:"setMapStatus",value:function(a){this.mapService.setMapStatus(a)}},{key:"pixelToLngLat",value:function(a){return this.mapService.pixelToLngLat(a)}},{key:"lngLatToPixel",value:function(a){return this.mapService.lngLatToPixel(a)}},{key:"containerToLngLat",value:function(a){return this.mapService.containerToLngLat(a)}},{key:"lngLatToContainer",value:function(a){return this.mapService.lngLatToContainer(a)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(a,s){this.container.bind(O.vK.IPostProcessingPass).to(a).whenTargetNamed(s)}},{key:"initComponent",value:function(a){this.controlService.init({container:Je.SO.getContainer(a)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var a=this.sceneService.getSceneConfig(),s=a.logoVisible,l=a.logoPosition;s&&this.addControl(new es({position:l}))}}]),n}(),vu=b(96320),Xa=b(84904),lo=b(7273),Bu=b(20816),Fs=b.n(Bu),tc,Nl,Nu,Tl,zu;function qa(n){return n.map(function(c){return typeof c=="string"&&(c=[c,{}]),c})}var zl=(tc=(0,hn.b2)(),Nl=(0,hn.f3)(O.vK.IGlobalConfigService),tc(Nu=(Tl=function(){function n(){(0,vr.Z)(this,n),(0,Xa.Z)(this,"configService",zu,this),(0,j.Z)(this,"enabled",void 0)}return(0,Or.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.rendererService,_=s.postProcessingPassFactory,A=s.normalPassFactory;a.hooks.init.tap("MultiPassRendererPlugin",function(){var M=a.getLayerConfig(),L=M.enableMultiPassRenderer,$=M.passes,H=$===void 0?[]:$;l.enabled=!!L&&a.getLayerConfig().enableMultiPassRenderer!==!1,l.enabled&&(a.multiPassRenderer=l.createMultiPassRenderer(a,H,_,A),a.multiPassRenderer.setRenderFlag(!0))}),a.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(a,s,l,d){var _=a.multiPassRenderer,A=a.getLayerConfig(),M=A.enablePicking,L=A.enableTAA;return M&&_.add(d("pixelPicking")),_}}]),n}(),zu=(0,lo.Z)(Tl.prototype,"configService",[Nl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tl))||Nu),js,mu=(js={},(0,j.Z)(js,O.BlendType.additive,{enable:!0,func:{srcRGB:O.gl.ONE,dstRGB:O.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,j.Z)(js,O.BlendType.none,{enable:!1}),(0,j.Z)(js,O.BlendType.normal,{enable:!0,func:{srcRGB:O.gl.SRC_ALPHA,dstRGB:O.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,j.Z)(js,O.BlendType.subtractive,{enable:!0,func:{srcRGB:O.gl.ONE,dstRGB:O.gl.ONE,srcAlpha:O.gl.ZERO,dstAlpha:O.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:O.gl.FUNC_SUBTRACT,alpha:O.gl.FUNC_SUBTRACT}}),(0,j.Z)(js,O.BlendType.max,{enable:!0,func:{srcRGB:O.gl.ONE,dstRGB:O.gl.ONE},equation:{rgb:O.gl.MAX_EXT}}),(0,j.Z)(js,O.BlendType.min,{enable:!0,func:{srcRGB:O.gl.ONE,dstRGB:O.gl.ONE},equation:{rgb:O.gl.MIN_EXT}}),js),la=b(68868),Pi=b.n(la),Ps=b(80744),tu=b.n(Ps),Zu=1024;function ts(n,c,a,s,l){c.updateStyleAttribute(n,a,s,l)}function pf(n,c){n.opacity&&gc("opacity",c,n.opacity),n.strokeWidth&&gc("strokeWidth",c,n.strokeWidth),n.strokeOpacity&&gc("strokeOpacity",c,n.strokeOpacity),n.stroke&&Ul("stroke",c,n.stroke),n.offsets&&Zl("offsets",c,n.offsets),n.textOffset&&Zl("textOffset",c,n.textOffset)}function gc(n,c,a){B()(a)?ts(n,c,a,function(s){return s}):Pi()(a)?ts(n,c,[a],void 0):tu()(a)&&a.length===2?B()(a[0])&&pe()(a[1])||B()(a[0])&&tu()(a[1])&&Pi()(a[1][0])&&Pi()(a[1][1])?ts(n,c,a[0],a[1]):ts(n,c,[1],void 0):ts(n,c,[1],void 0)}function Zl(n,c,a){B()(a)?ts(n,c,a,function(s){return s}):tu()(a)&&a.length===2&&B()(a[0])&&pe()(a[1])?ts(n,c,a[0],a[1]):tu()(a)&&a.length===2&&Pi()(a[0])&&Pi()(a[1])?ts(n,c,a,void 0):ts(n,c,[0,0],void 0)}function Ul(n,c,a){B()(a)?ts(n,c,a,void 0):tu()(a)&&a.length===2&&(B()(a[0])&&pe()(a[1])||B()(a[0])&&tu()(a[1])&&a[1].length>0)?ts(n,c,a[0],a[1]):ts(n,c,"#fff",void 0)}var yu,To,Tu,Pl,Po;function Vn(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Na(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,A;return{s:function(){a=a.call(n)},n:function(){var L=a.next();return d=L.done,L},e:function(L){_=!0,A=L},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw A}}}}function Na(n,c){if(!!n){if(typeof n=="string")return gu(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return gu(n,c)}}function gu(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Uu(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function eo(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Uu(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Uu(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Ms(n){var c=_c();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function _c(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var En=0,Pu=(yu=(0,O.yT)(O.vK.IGlobalConfigService),To=(0,O.yT)(O.vK.IShaderModuleService),Tu=function(n){(0,Kn.Z)(a,n);var c=Ms(a);function a(){var s,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,vr.Z)(this,a),s=c.call(this),(0,j.Z)((0,St.Z)(s),"id","".concat(En++)),(0,j.Z)((0,St.Z)(s),"name","".concat(En)),(0,j.Z)((0,St.Z)(s),"type",void 0),(0,j.Z)((0,St.Z)(s),"visible",!0),(0,j.Z)((0,St.Z)(s),"zIndex",0),(0,j.Z)((0,St.Z)(s),"minZoom",void 0),(0,j.Z)((0,St.Z)(s),"maxZoom",void 0),(0,j.Z)((0,St.Z)(s),"inited",!1),(0,j.Z)((0,St.Z)(s),"layerModelNeedUpdate",!1),(0,j.Z)((0,St.Z)(s),"pickedFeatureID",null),(0,j.Z)((0,St.Z)(s),"selectedFeatureID",null),(0,j.Z)((0,St.Z)(s),"styleNeedUpdate",!1),(0,j.Z)((0,St.Z)(s),"rendering",void 0),(0,j.Z)((0,St.Z)(s),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,j.Z)((0,St.Z)(s),"hooks",{init:new _e.oI,afterInit:new _e.oI,beforeRender:new _e.oI,beforeRenderData:new _e.gg,afterRender:new _e.ni,beforePickingEncode:new _e.ni,afterPickingEncode:new _e.ni,beforeHighlight:new _e.ni(["pickedColor"]),afterHighlight:new _e.ni,beforeSelect:new _e.ni(["pickedColor"]),afterSelect:new _e.ni,beforeDestroy:new _e.ni,afterDestroy:new _e.ni}),(0,j.Z)((0,St.Z)(s),"models",[]),(0,j.Z)((0,St.Z)(s),"multiPassRenderer",void 0),(0,j.Z)((0,St.Z)(s),"plugins",void 0),(0,j.Z)((0,St.Z)(s),"sourceOption",void 0),(0,j.Z)((0,St.Z)(s),"layerModel",void 0),(0,Xa.Z)((0,St.Z)(s),"configService",Pl,(0,St.Z)(s)),(0,Xa.Z)((0,St.Z)(s),"shaderModuleService",Po,(0,St.Z)(s)),(0,j.Z)((0,St.Z)(s),"cameraService",void 0),(0,j.Z)((0,St.Z)(s),"coordinateService",void 0),(0,j.Z)((0,St.Z)(s),"iconService",void 0),(0,j.Z)((0,St.Z)(s),"fontService",void 0),(0,j.Z)((0,St.Z)(s),"pickingService",void 0),(0,j.Z)((0,St.Z)(s),"rendererService",void 0),(0,j.Z)((0,St.Z)(s),"layerService",void 0),(0,j.Z)((0,St.Z)(s),"interactionService",void 0),(0,j.Z)((0,St.Z)(s),"mapService",void 0),(0,j.Z)((0,St.Z)(s),"styleAttributeService",void 0),(0,j.Z)((0,St.Z)(s),"layerSource",void 0),(0,j.Z)((0,St.Z)(s),"postProcessingPassFactory",void 0),(0,j.Z)((0,St.Z)(s),"normalPassFactory",void 0),(0,j.Z)((0,St.Z)(s),"animateOptions",{enable:!1}),(0,j.Z)((0,St.Z)(s),"container",void 0),(0,j.Z)((0,St.Z)(s),"encodedData",void 0),(0,j.Z)((0,St.Z)(s),"configSchema",void 0),(0,j.Z)((0,St.Z)(s),"currentPickId",null),(0,j.Z)((0,St.Z)(s),"rawConfig",void 0),(0,j.Z)((0,St.Z)(s),"needUpdateConfig",void 0),(0,j.Z)((0,St.Z)(s),"pendingStyleAttributes",[]),(0,j.Z)((0,St.Z)(s),"scaleOptions",{}),(0,j.Z)((0,St.Z)(s),"animateStartTime",void 0),(0,j.Z)((0,St.Z)(s),"aniamateStatus",!1),(0,j.Z)((0,St.Z)(s),"sourceEvent",function(){s.dataState.dataSourceNeedUpdate=!0;var d=s.getLayerConfig(),_=d.autoFit,A=d.fitBoundsOptions;_&&s.fitBounds(A),s.emit("dataUpdate"),s.reRender()}),s.name=l.name||s.id,s.zIndex=l.zIndex||0,s.rawConfig=l,s}return(0,Or.Z)(a,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(l){if(!this.inited)this.needUpdateConfig=eo(eo({},this.needUpdateConfig),l);else{var d=this.container.get(O.vK.SceneID);pf(l,this),this.configService.setLayerConfig(d,this.id,eo(eo(eo({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),l)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(l){this.container=l}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(l){return this.plugins.push(l),this}},{key:"init",value:function(){var l=this,d=this.container.get(O.vK.SceneID),_=this.rawConfig.enableMultiPassRenderer,A=_===void 0?!1:_;this.configService.setLayerConfig(d,this.id,{enableMultiPassRenderer:A}),this.iconService=this.container.get(O.vK.IIconService),this.fontService=this.container.get(O.vK.IFontService),this.rendererService=this.container.get(O.vK.IRendererService),this.layerService=this.container.get(O.vK.ILayerService),this.interactionService=this.container.get(O.vK.IInteractionService),this.pickingService=this.container.get(O.vK.IPickingService),this.mapService=this.container.get(O.vK.IMapService),this.cameraService=this.container.get(O.vK.ICameraService),this.coordinateService=this.container.get(O.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(O.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(O.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(O.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(O.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(H){var ge=H.attributeName,Be=H.attributeField,vt=H.attributeValues,kt=H.updateOptions;l.styleAttributeService.updateStyleAttribute(ge,{scale:eo({field:Be},l.splitValuesAndCallbackInAttribute(vt,l.getLayerConfig()[ge]))},kt)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(O.vK.ILayerPlugin);var M=Vn(this.plugins),L;try{for(M.s();!(L=M.n()).done;){var $=L.value;$.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(H){M.e(H)}finally{M.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(eo(eo({},this.getDefaultConfig()),this.rawConfig));var l=this.getLayerConfig(),d=l.animateOption;d!=null&&d.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(l,d,_){return this.updateStyleAttribute("color",l,d,_),this}},{key:"texture",value:function(l,d,_){return this.updateStyleAttribute("texture",l,d,_),this}},{key:"rotate",value:function(l,d,_){return this.updateStyleAttribute("rotate",l,d,_),this}},{key:"size",value:function(l,d,_){return this.updateStyleAttribute("size",l,d,_),this}},{key:"filter",value:function(l,d,_){return this.updateStyleAttribute("filter",l,d,_),this}},{key:"shape",value:function(l,d,_){return this.updateStyleAttribute("shape",l,d,_),this}},{key:"label",value:function(l,d,_){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:l,attributeValues:d,updateOptions:_}),this}},{key:"animate",value:function(l){var d={};return Fs()(l)?(d.enable=!0,d=eo(eo({},d),l)):d.enable=l,this.updateLayerConfig({animateOption:d}),this}},{key:"source",value:function(l,d){return l!=null&&l.data?(this.setSource(l),this):(this.sourceOption={data:l,options:d},this)}},{key:"setData",value:function(l,d){var _=this;return this.inited?this.layerSource.setData(l,d):this.on("inited",function(){_.layerSource.setData(l,d)}),this}},{key:"style",value:function(l){var d=this,_=l.passes,A=(0,vu.Z)(l,["passes"]);return _&&qa(_).forEach(function(M){var L=d.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(M[0]);L&&L.updateOptions(M[1])}),this.rawConfig=eo(eo({},this.rawConfig),A),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(l,d){return Fs()(l)?this.scaleOptions=eo(eo({},this.scaleOptions),l):this.scaleOptions[l]=d,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(l){var d={};return d.enableHighlight=Fs()(l)?!0:l,Fs()(l)?(d.enableHighlight=!0,l.color&&(d.highlightColor=l.color)):d.enableHighlight=!!l,this.updateLayerConfig(d),this}},{key:"setActive",value:function(l,d){var _=this;if(Fs()(l)){var A=l.x,M=A===void 0?0:A,L=l.y,$=L===void 0?0:L;this.updateLayerConfig({highlightColor:Fs()(d)?d.color:this.getLayerConfig().highlightColor}),this.pick({x:M,y:$})}else this.updateLayerConfig({pickedFeatureID:l,highlightColor:Fs()(d)?d.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,Je.Z6)(l)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"select",value:function(l){var d={};return d.enableSelect=Fs()(l)?!0:l,Fs()(l)?(d.enableSelect=!0,l.color&&(d.selectColor=l.color)):d.enableSelect=!!l,this.updateLayerConfig(d),this}},{key:"setSelect",value:function(l,d){var _=this;if(Fs()(l)){var A=l.x,M=A===void 0?0:A,L=l.y,$=L===void 0?0:L;this.updateLayerConfig({selectColor:Fs()(d)?d.color:this.getLayerConfig().selectColor}),this.pick({x:M,y:$})}else this.updateLayerConfig({pickedFeatureID:l,selectColor:Fs()(d)?d.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,Je.Z6)(l)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"setBlend",value:function(l){this.updateLayerConfig({blend:l}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(l){return this.zIndex=l,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(l){this.currentPickId=l}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(l){this.selectedFeatureID=l}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var l=this.mapService.getZoom(),d=this.getLayerConfig(),_=d.visible,A=d.minZoom,M=A===void 0?-Infinity:A,L=d.maxZoom,$=L===void 0?Infinity:L;return!!_&&l>=M&&l<=$}},{key:"setMinZoom",value:function(l){return this.updateLayerConfig({minZoom:l}),this}},{key:"getMinZoom",value:function(){var l=this.getLayerConfig(),d=l.minZoom;return d}},{key:"getMaxZoom",value:function(){var l=this.getLayerConfig(),d=l.maxZoom;return d}},{key:"get",value:function(l){var d=this.getLayerConfig();return d[l]}},{key:"setMaxZoom",value:function(l){return this.updateLayerConfig({maxZoom:l}),this}},{key:"fitBounds",value:function(l){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var d=this.getSource(),_=d.extent,A=_.some(function(M){return Math.abs(M)===Infinity});return A?this:(this.mapService.fitBounds([[_[0],_[1]],[_[2],_[3]]],l),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(l){return l.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(l){return l.needRescale||l.needRemapping||l.needRegenerateVertices}).length}},{key:"setSource",value:function(l){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=l,this.inited&&this.layerSource.cluster){var d=this.mapService.getZoom();this.layerSource.updateClusterData(d)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(l){this.encodedData=l}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(l){var d=this.styleAttributeService.getLayerAttributeScale(l);if(d){if(d.ticks){var _=d.ticks().map(function(M){return(0,j.Z)({value:M},l,d(M))});return _}else if(d.invertExtent){var A=d.range().map(function(M){return(0,j.Z)({value:d.invertExtent(M)},l,M)});return A}}else return[]}},{key:"pick",value:function(l){var d=l.x,_=l.y;this.interactionService.triggerHover({x:d,y:_})}},{key:"boxSelect",value:function(l,d){this.pickingService.boxPickLayer(this,l,d)}},{key:"buildLayerModel",value:function(l){var d=l.moduleName,_=l.vertexShader,A=l.fragmentShader,M=l.triangulation,L=l.segmentNumber,$=(0,vu.Z)(l,["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"]);this.shaderModuleService.registerModule(d,{vs:_,fs:A});var H=this.shaderModuleService.getModule(d),ge=H.vs,Be=H.fs,vt=H.uniforms,kt=this.rendererService.createModel,yr=this.styleAttributeService.createAttributesAndIndices(this.encodedData,M,L),wr=yr.attributes,jr=yr.elements;return kt(eo({attributes:wr,uniforms:vt,fs:Be,vs:ge,elements:jr,blend:mu[O.BlendType.normal]},$))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(l){var d=this.getLayerConfig(),_=d.enableHighlight,A=_===void 0?!0:_,M=d.enableSelect,L=M===void 0?!0:M,$=this.eventNames().indexOf(l)!==-1||this.eventNames().indexOf("un"+l)!==-1;return(l==="click"||l==="dblclick")&&L&&($=!0),l==="mousemove"&&(A||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&($=!0),this.isVisible()&&$}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var l=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:l.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(l,d,_,A){this.inited?this.styleAttributeService.updateStyleAttribute(l,{scale:eo({field:d},this.splitValuesAndCallbackInAttribute(_,this.getLayerConfig()[d]))},A):this.pendingStyleAttributes.push({attributeName:l,attributeField:d,attributeValues:_,updateOptions:A})}},{key:"setEarthTime",value:function(l){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(l,d){return{values:pe()(l)?void 0:l||d,callback:pe()(l)?l:void 0}}}]),a}(dt.EventEmitter),Pl=(0,lo.Z)(Tu.prototype,"configService",[yu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Po=(0,lo.Z)(Tu.prototype,"shaderModuleService",[To],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tu),xc=b(98621),lu=b.n(xc),ja=b(34663),bs,Ml,Vs,Is,_u;function Jc(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=rc(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,A;return{s:function(){a=a.call(n)},n:function(){var L=a.next();return d=L.done,L},e:function(L){_=!0,A=L},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw A}}}}function rc(n,c){if(!!n){if(typeof n=="string")return bc(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return bc(n,c)}}function bc(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var Bo=(bs=(0,O.yT)(O.vK.IGlobalConfigService),Ml=(0,O.yT)(O.vK.IShaderModuleService),Vs=function(){function n(c){(0,vr.Z)(this,n),(0,j.Z)(this,"triangulation",void 0),(0,j.Z)(this,"createTexture2D",void 0),(0,j.Z)(this,"layer",void 0),(0,j.Z)(this,"dataTexture",void 0),(0,j.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,j.Z)(this,"rowCount",void 0),(0,j.Z)(this,"cacheStyleProperties",void 0),(0,j.Z)(this,"cellLength",void 0),(0,j.Z)(this,"cellProperties",void 0),(0,j.Z)(this,"cellTypeLayout",void 0),(0,j.Z)(this,"stylePropertyesExist",void 0),(0,j.Z)(this,"dataTextureTest",void 0),(0,Xa.Z)(this,"configService",Is,this),(0,Xa.Z)(this,"shaderModuleService",_u,this),(0,j.Z)(this,"rendererService",void 0),(0,j.Z)(this,"iconService",void 0),(0,j.Z)(this,"fontService",void 0),(0,j.Z)(this,"styleAttributeService",void 0),(0,j.Z)(this,"mapService",void 0),(0,j.Z)(this,"cameraService",void 0),(0,j.Z)(this,"layerService",void 0),this.layer=c,this.rendererService=c.getContainer().get(O.vK.IRendererService),this.styleAttributeService=c.getContainer().get(O.vK.IStyleAttributeService),this.mapService=c.getContainer().get(O.vK.IMapService),this.iconService=c.getContainer().get(O.vK.IIconService),this.fontService=c.getContainer().get(O.vK.IFontService),this.cameraService=c.getContainer().get(O.vK.ICameraService),this.layerService=c.getContainer().get(O.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var a=this.rendererService.createTexture2D;this.createTexture2D=a,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:O.gl.NEAREST,min:O.gl.NEAREST,width:1,height:1}))}return(0,Or.Z)(n,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(a){var s=!1;return lu()(a.opacity,this.cacheStyleProperties.opacity)||(s=!0,this.cacheStyleProperties.opacity=a.opacity),lu()(a.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(s=!0,this.cacheStyleProperties.strokeOpacity=a.strokeOpacity),lu()(a.strokeWidth,this.cacheStyleProperties.strokeWidth)||(s=!0,this.cacheStyleProperties.strokeWidth=a.strokeWidth),lu()(a.stroke,this.cacheStyleProperties.stroke)||(s=!0,this.cacheStyleProperties.stroke=a.stroke),lu()(a.offsets,this.cacheStyleProperties.offsets)||(s=!0,this.cacheStyleProperties.offsets=a.offsets),this.dataTexture===void 0&&(s=!0),s}},{key:"judgeStyleAttributes",value:function(a){this.clearLastCalRes(),a.opacity!==void 0&&!Pi()(a.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),a.strokeOpacity!==void 0&&!Pi()(a.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),a.strokeWidth!==void 0&&!Pi()(a.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),a.stroke!==void 0&&!this.isStaticColor(a.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),a.offsets!==void 0&&!this.isOffsetStatic(a.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(a){return B()(a)?!!(0,ja.ZP)(a):!1}},{key:"getStrokeColor",value:function(a){if(this.isStaticColor(a)){var s=(0,Je.CI)(a);return s[0]=s[0]?s[0]:0,s[1]=s[1]?s[1]:0,s[2]=s[2]?s[2]:0,s[3]=s[3]?s[3]:0,s}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(a){return!!(tu()(a)&&a.length===2&&Pi()(a[0])&&Pi()(a[1]))}},{key:"patchMod",value:function(a,s){for(var l=0;l<s;l++)a.push(-1)}},{key:"patchData",value:function(a,s,l){var d=Jc(l),_;try{for(d.s();!(_=d.n()).done;){var A=_.value,M=A.attr,L=A.count,$=s[M];$?M==="stroke"?a.push.apply(a,(0,ie.Z)((0,Je.CI)($))):M==="offsets"?this.isOffsetStatic($)?a.push(-$[0],$[1]):a.push(0,0):a.push(Pi()($)?$:1):this.patchMod(a,L)}}catch(H){d.e(H)}finally{d.f()}}},{key:"calDataFrame",value:function(a,s,l){for(var d=s.length,_=Math.ceil(d*a/this.DATA_TEXTURE_WIDTH),A=_*this.DATA_TEXTURE_WIDTH,M=[],L=0;L<d;L++){var $=s[L];this.patchData(M,$,l)}for(var H=M.length;H<A;H++)M.push(-1);return{data:M,width:this.DATA_TEXTURE_WIDTH,height:_}}},{key:"getBlend",value:function(){var a=this.layer.getLayerConfig(),s=a.blend,l=s===void 0?"normal":s;return mu[O.BlendType[l]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.duration||4,a.interval||.2,a.trailLength||.1]}},{key:"startModelAnimate",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;s.enable&&this.layer.setAnimateStartTime()}}]),n}(),Is=(0,lo.Z)(Vs.prototype,"configService",[bs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_u=(0,lo.Z)(Vs.prototype,"shaderModuleService",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vs),Gs=b(83628),Mo=b.n(Gs),ea=100,ju=36,cu=40;function Wo(n){return n/180*Math.acos(-1)}function al(n){var c=Wo(n[0])+Math.PI/2,a=Wo(n[1]),s=ea+Math.random()*.4,l=s*Math.cos(a)*Math.cos(c),d=s*Math.cos(a)*Math.sin(c),_=s*Math.sin(a);return[d,_,l]}function Mu(n,c){var a=mat4.create(),s=mat4.create(),l=vec3.fromValues(0,1,0),d=vec3.fromValues(0,0,0);c=c||{},n=typeof n!="undefined"?n:1;for(var _=typeof c.segments!="undefined"?c.segments:32,A=2+_,M=2*A,L=[],$=[],H=[],ge=[],Be=[],vt=[],kt=0;kt<=A;kt++){for(var yr=kt/A,wr=yr*Math.PI,jr=0;jr<=M;jr++){var gn=jr/M,Sn=gn*Math.PI*2;mat4.identity(s),mat4.rotateZ(s,s,-wr),mat4.identity(a),mat4.rotateY(a,a,Sn),vec3.transformMat4(d,l,s),vec3.transformMat4(d,d,a),vec3.scale(d,d,-n),H.push(d.slice()),ge.push.apply(ge,_toConsumableArray(d.slice())),vec3.normalize(d,d),Be.push.apply(Be,_toConsumableArray(d.slice())),vt.push([gn,1-yr]),ge.push(gn,1-yr)}if(kt>0)for(var zn=H.length,ti=zn-2*(M+1);ti+M+2<zn;ti++)L.push([ti,ti+1,ti+M+1]),$.push(ti,ti+1,ti+M+1),L.push([ti+M+1,ti+1,ti+M+2]),$.push(ti+M+1,ti+1,ti+M+2)}return{cells:L,positions:H,uvs:vt,positionsArr:ge,indicesArr:$,normalArr:Be}}var xi=b(7124),co=xi.create(),Il=xi.create(),Gn=xi.create(),Wn=xi.create(),ol=xi.create();function ls(n,c,a,s,l){xi.add(n,a,s),xi.normalize(n,n),c=xi.fromValues(-n[1],n[0]);var d=xi.fromValues(-a[1],a[0]);return[l/xi.dot(c,d),c]}function cs(n,c){return xi.set(n,-c[1],c[0])}function Io(n,c,a){return xi.sub(n,c,a),xi.normalize(n,n),n}function ru(n,c){return n[0]===c[0]&&n[1]===c[1]}function Sc(n){for(var c=new Map,a=0;a<n.length;a++){var s=n[0].toString()+"-"+n[1].toString();c.get(s)?(n.splice(a,1),a++):c.set(s,s)}return n}var nc=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,vr.Z)(this,n),(0,j.Z)(this,"complex",void 0),(0,j.Z)(this,"join",void 0),(0,j.Z)(this,"cap",void 0),(0,j.Z)(this,"miterLimit",void 0),(0,j.Z)(this,"thickness",void 0),(0,j.Z)(this,"normal",void 0),(0,j.Z)(this,"lastFlip",-1),(0,j.Z)(this,"miter",xi.fromValues(0,0)),(0,j.Z)(this,"started",!1),(0,j.Z)(this,"dash",!1),(0,j.Z)(this,"totalDistance",0),this.join=c.join||"miter",this.cap=c.cap||"butt",this.miterLimit=c.miterLimit||10,this.thickness=c.thickness||1,this.dash=c.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,Or.Z)(n,[{key:"extrude_gaode2",value:function(a,s){var l=this.complex;if(a.length<=1)return l;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var d=a.length,_=l.startIndex,A=1;A<d;A++){var M=a[A-1],L=s[A-1],$=a[A],H=s[A],ge=A<a.length-1?a[A+1]:null,Be=A<s.length-1?s[A+1]:null,vt=this.segment_gaode2(l,_,M,$,ge,L,H,Be);_+=vt}if(this.dash)for(var kt=0;kt<l.positions.length/6;kt++)l.positions[kt*6+5]=this.totalDistance;return l.startIndex=l.positions.length/6,l}},{key:"extrude",value:function(a){var s=this.complex;if(a.length<=1)return s;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var l=a.length,d=s.startIndex,_=1;_<l;_++){var A=a[_-1],M=a[_],L=_<a.length-1?a[_+1]:null,$=this.segment(s,d,A,M,L);d+=$}if(this.dash)for(var H=0;H<s.positions.length/6;H++)s.positions[H*6+5]=this.totalDistance;return s.startIndex=s.positions.length/6,s}},{key:"segment_gaode2",value:function(a,s,l,d,_,A,M,L){var $=0,H=a.indices,ge=a.positions,Be=a.normals,vt=this.cap==="square",kt=this.join==="bevel",yr=(0,Je.Z)([M[0],M[1]]),wr=(0,Je.Z)([A[0],A[1]]);Io(Gn,d,l);var jr=0;if(this.dash&&(jr=this.lineSegmentDistance(yr,wr),this.totalDistance+=jr),this.normal||(this.normal=xi.create(),cs(this.normal,Gn)),!this.started)if(this.started=!0,vt){var gn=xi.create(),Sn=xi.create();xi.add(gn,this.normal,Gn),xi.add(Sn,this.normal,Gn),Be.push(Sn[0],Sn[1],0),Be.push(gn[0],gn[1],0),ge.push(l[0],l[1],0,this.totalDistance-jr,-this.thickness,0),ge.push(l[0],l[1],0,this.totalDistance-jr,this.thickness,0)}else this.extrusions(ge,Be,l,this.normal,this.thickness,this.totalDistance-jr);if(H.push(s+0,s+1,s+2),_){ru(d,_)&&xi.add(_,d,xi.normalize(_,xi.subtract(_,d,l))),Io(Wn,_,d);var ii=ls(ol,xi.create(),Gn,Wn,this.thickness),Si=(0,Ji.Z)(ii,2),ta=Si[0],_a=Si[1],gi=xi.dot(ol,this.normal)<0?-1:1,Pa=kt;if(!Pa&&this.join==="miter"){var Ua=ta;Ua>this.miterLimit&&(Pa=!0)}Pa?(Be.push(this.normal[0],this.normal[1],0),Be.push(_a[0],_a[1],0),ge.push(d[0],d[1],0,this.totalDistance,-this.thickness*gi,0),ge.push(d[0],d[1],0,this.totalDistance,this.thickness*gi,0),H.push.apply(H,(0,ie.Z)(this.lastFlip!==-gi?[s,s+2,s+3]:[s+2,s+1,s+3])),H.push(s+2,s+3,s+4),cs(co,Wn),xi.copy(this.normal,co),Be.push(this.normal[0],this.normal[1],0),ge.push(d[0],d[1],0,this.totalDistance,-this.thickness*gi,0),$+=3):(this.extrusions(ge,Be,d,_a,ta,this.totalDistance),H.push.apply(H,(0,ie.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),gi=-1,xi.copy(this.normal,_a),$+=2),this.lastFlip=gi}else{if(cs(this.normal,Gn),vt){var zn=xi.create(),ti=xi.create();xi.sub(ti,Gn,this.normal),xi.add(zn,Gn,this.normal),Be.push(ti[0],ti[1],0),Be.push(zn[0],zn[1],0),ge.push(d[0],d[1],0,this.totalDistance,this.thickness,0),ge.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(ge,Be,d,this.normal,this.thickness,this.totalDistance);H.push.apply(H,(0,ie.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),$+=2}return $}},{key:"segment",value:function(a,s,l,d,_){var A=0,M=a.indices,L=a.positions,$=a.normals,H=this.cap==="square",ge=this.join==="bevel",Be=(0,Je.Z)([d[0],d[1]]),vt=(0,Je.Z)([l[0],l[1]]);Io(Gn,Be,vt);var kt=0;if(this.dash&&(kt=this.lineSegmentDistance(Be,vt),this.totalDistance+=kt),this.normal||(this.normal=xi.create(),cs(this.normal,Gn)),!this.started)if(this.started=!0,H){var yr=xi.create(),wr=xi.create();xi.add(yr,this.normal,Gn),xi.add(wr,this.normal,Gn),$.push(wr[0],wr[1],0),$.push(yr[0],yr[1],0),L.push(l[0],l[1],0,this.totalDistance-kt,-this.thickness,0),L.push(l[0],l[1],0,this.totalDistance-kt,this.thickness,0)}else this.extrusions(L,$,l,this.normal,this.thickness,this.totalDistance-kt);if(M.push(s+0,s+1,s+2),_){var Sn=(0,Je.Z)([_[0],_[1]]);ru(Be,Sn)&&xi.add(Sn,Be,xi.normalize(Sn,xi.subtract(Sn,Be,vt))),Io(Wn,Sn,Be);var zn=ls(ol,xi.create(),Gn,Wn,this.thickness),ti=(0,Ji.Z)(zn,2),ii=ti[0],Si=ti[1],ta=xi.dot(ol,this.normal)<0?-1:1,_a=ge;if(!_a&&this.join==="miter"){var gi=ii;gi>this.miterLimit&&(_a=!0)}_a?($.push(this.normal[0],this.normal[1],0),$.push(Si[0],Si[1],0),L.push(d[0],d[1],0,this.totalDistance,-this.thickness*ta,0),L.push(d[0],d[1],0,this.totalDistance,this.thickness*ta,0),M.push.apply(M,(0,ie.Z)(this.lastFlip!==-ta?[s,s+2,s+3]:[s+2,s+1,s+3])),M.push(s+2,s+3,s+4),cs(co,Wn),xi.copy(this.normal,co),$.push(this.normal[0],this.normal[1],0),L.push(d[0],d[1],0,this.totalDistance,-this.thickness*ta,0),A+=3):(this.extrusions(L,$,d,Si,ii,this.totalDistance),M.push.apply(M,(0,ie.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),ta=-1,xi.copy(this.normal,Si),A+=2),this.lastFlip=ta}else{if(cs(this.normal,Gn),H){var jr=xi.create(),gn=xi.create();xi.sub(gn,Gn,this.normal),xi.add(jr,Gn,this.normal),$.push(gn[0],gn[1],0),$.push(jr[0],jr[1],0),L.push(d[0],d[1],0,this.totalDistance,this.thickness,0),L.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(L,$,d,this.normal,this.thickness,this.totalDistance);M.push.apply(M,(0,ie.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),A+=2}return A}},{key:"extrusions",value:function(a,s,l,d,_,A){s.push(d[0],d[1],0),s.push(d[0],d[1],0),a.push(l[0],l[1],0,A,-_,0),a.push(l[0],l[1],0,A,_,0)}},{key:"lineSegmentDistance",value:function(a,s){var l=s[0]-a[0],d=s[1]-a[1];return Math.sqrt(l*l+d*d)}}]),n}();function Xi(n){if(Pi()(n[0]))return n;if(Pi()(n[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Pi()(n[0][0][0])){var c=n,a=0,s=0,l=0;return c.forEach(function(d){d.forEach(function(_){a+=_[0],s+=_[1],l++})}),[a/l,s/l,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var ji=b(92541);function Qc(n){var c=n[0][0],a=n[0][n[0].length-1];c[0]===a[0]&&c[1]===a[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var s=n[0].length,l=Mo().flatten(n),d=l.vertices,_=l.dimensions,A=[],M=[],L=0;L<d.length/_;L++)_===2?A.push(d[L*2],d[L*2+1],1):A.push(d[L*3],d[L*3+1],1);var $=Mo()(l.vertices,l.holes,l.dimensions);M.push.apply(M,(0,ie.Z)($));for(var H=function(vt){var kt=l.vertices.slice(vt*_,(vt+1)*_),yr=l.vertices.slice((vt+1)*_,(vt+2)*_);yr.length===0&&(yr=l.vertices.slice(0,_));var wr=A.length/3;A.push(kt[0],kt[1],1,yr[0],yr[1],1,kt[0],kt[1],0,yr[0],yr[1],0),M.push.apply(M,(0,ie.Z)([0,2,1,2,3,1].map(function(jr){return jr+wr})))},ge=0;ge<s;ge++)H(ge);return{positions:A,index:M}}function Bs(n){var c=Mo().flatten(n),a=Mo()(c.vertices,c.holes,c.dimensions);return{positions:c.vertices,index:a}}function Ol(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=n[0][0],s=n[0][n[0].length-1];a[0]===s[0]&&a[1]===s[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var l=n[0].length,d=Mo().flatten(n),_=d.vertices,A=d.dimensions,M=[],L=[],$=[],H=0;H<_.length/A;H++)A===2?M.push(_[H*2],_[H*2+1],1,-1,-1):M.push(_[H*3],_[H*3+1],1,-1,-1),$.push(0,0,1);var ge=Mo()(d.vertices,d.holes,d.dimensions);L.push.apply(L,(0,ie.Z)(ge));for(var Be=function(yr){var wr=d.vertices.slice(yr*A,(yr+1)*A),jr=d.vertices.slice((yr+1)*A,(yr+2)*A);jr.length===0&&(jr=d.vertices.slice(0,A));var gn=M.length/5;M.push(wr[0],wr[1],1,0,0,jr[0],jr[1],1,.1,0,wr[0],wr[1],0,0,.8,jr[0],jr[1],0,.1,.8);var Sn=Os([jr[0],jr[1],1],[wr[0],wr[1],0],[wr[0],wr[1],1],c);$.push.apply($,(0,ie.Z)(Sn).concat((0,ie.Z)(Sn),(0,ie.Z)(Sn),(0,ie.Z)(Sn))),L.push.apply(L,(0,ie.Z)([1,2,0,3,2,1].map(function(zn){return zn+gn})))},vt=0;vt<l;vt++)Be(vt);return{positions:M,index:L,normals:$}}function Os(n,c,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=ji.create(),d=ji.create(),_=ji.create();s&&(n=(0,Je.vP)(n),c=(0,Je.vP)(c),a=(0,Je.vP)(a));var A=ji.fromValues.apply(ji,(0,ie.Z)(n)),M=ji.fromValues.apply(ji,(0,ie.Z)(c)),L=ji.fromValues.apply(ji,(0,ie.Z)(a));ji.sub(l,L,M),ji.sub(d,A,M),ji.cross(_,l,d);var $=ji.create();return ji.normalize($,_),$}var Ya,Hs;(function(n){n.CYLINDER="cylinder",n.SQUARECOLUMN="squareColumn",n.TRIANGLECOLUMN="triangleColumn",n.HEXAGONCOLUMN="hexagonColumn",n.PENTAGONCOLUMN="pentagonColumn"})(Hs||(Hs={}));var Ss;(function(n){n.CIRCLE="circle",n.SQUARE="square",n.TRIANGLE="triangle",n.HEXAGON="hexagon",n.PENTAGON="pentagon"})(Ss||(Ss={}));function Vu(n){for(var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=Math.PI*2/n,s=[],l=0;l<n;l++)s.push(a*l+c*Math.PI/12);var d=s.map(function(_){var A=Math.sin(_+Math.PI/4),M=Math.cos(_+Math.PI/4);return[A,M,0]});return d}function sl(){return Vu(30)}function Ll(){return Vu(4)}function Ec(){return Vu(3)}function ul(){return Vu(6,1)}function Gu(){return Vu(5)}var ll=(Ya={},(0,j.Z)(Ya,Ss.CIRCLE,sl),(0,j.Z)(Ya,Ss.HEXAGON,ul),(0,j.Z)(Ya,Ss.TRIANGLE,Ec),(0,j.Z)(Ya,Ss.SQUARE,Ll),(0,j.Z)(Ya,Ss.PENTAGON,Gu),(0,j.Z)(Ya,Hs.CYLINDER,sl),(0,j.Z)(Ya,Hs.HEXAGONCOLUMN,ul),(0,j.Z)(Ya,Hs.TRIANGLECOLUMN,Ec),(0,j.Z)(Ya,Hs.SQUARECOLUMN,Ll),(0,j.Z)(Ya,Hs.PENTAGONCOLUMN,Gu),Ya),xu={};function Hu(n){var c=Xi(n.coordinates);return{vertices:[].concat((0,ie.Z)(c),(0,ie.Z)(c),(0,ie.Z)(c),(0,ie.Z)(c)),indices:[0,1,2,2,3,0],size:c.length}}function Cc(n){var c=Xi(n.coordinates),a=al(c);return{vertices:[].concat((0,ie.Z)(a),(0,ie.Z)(a),(0,ie.Z)(a),(0,ie.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function Iu(n){var c=n.shape,a=h(c,!1),s=a.positions,l=a.index,d=a.normals;return{vertices:s,indices:l,normals:d,size:5}}function Ns(n){var c=Xi(n.coordinates);return{vertices:(0,ie.Z)(c),indices:[0],size:c.length}}function wc(n){var c=n.coordinates,a=n.originCoordinates,s=n.version,l=new nc({dash:!0,join:"bevel"});if(s==="GAODE2.x"){var d=c;Array.isArray(d[0][0])||(d=[c]);var _=a;Array.isArray(_[0][0])||(_=[a]);for(var A=0;A<d.length;A++){var M=d[A],L=_[A];l.extrude_gaode2(M,L)}}else{var $=c;Array.isArray($[0][0])||($=[c]),$.forEach(function(ge){l.extrude(ge)})}var H=l.complex;return{vertices:H.positions,indices:H.indices,normals:H.normals,size:6}}function ic(n){var c=n.coordinates,a=Mo().flatten(c),s=a.vertices,l=a.dimensions,d=a.holes;return{indices:Mo()(s,d,l),vertices:s,size:l}}function jl(n){var c=n.coordinates,a=Ol(c,!0),s=a.positions,l=a.index,d=a.normals;return{vertices:s,indices:l,normals:d,size:5}}function cl(n){var c=n.shape,a=R(c),s=a.positions,l=a.index;return{vertices:s,indices:l,size:3}}function i(n){var c=n.coordinates,a=[].concat((0,ie.Z)(c[0]),[0,0,1,c[1][0],c[0][1],0,1,1],(0,ie.Z)(c[1]),[0,1,0],(0,ie.Z)(c[0]),[0,0,1],(0,ie.Z)(c[1]),[0,1,0,c[0][0],c[1][1],0,0,0]),s=[0,1,2,3,4,5];return{vertices:a,indices:s,size:5}}function u(n,c){for(var a=c||30,s=n.coordinates,l=[],d=[],_=function(L){l.push(L,1,L,s[0][0],s[0][1],s[1][0],s[1][1],L,-1,L,s[0][0],s[0][1],s[1][0],s[1][1]),L!==a-1&&d.push.apply(d,(0,ie.Z)([0,1,2,1,3,2].map(function($){return L*2+$})))},A=0;A<a;A++)_(A);return{vertices:l,indices:d,size:7}}function o(n){var c=n.coordinates;c.length===2&&c.push(0);var a=n.size,s=G(-1,1),l=G(1,1),d=G(-1,-1),_=G(1,-1),A=[].concat((0,ie.Z)(c),(0,ie.Z)(s),(0,ie.Z)(c),(0,ie.Z)(d),(0,ie.Z)(c),(0,ie.Z)(_),(0,ie.Z)(c),(0,ie.Z)(l)),M=[0,1,2,3,0,2];return{vertices:A,indices:M,size:5}}function h(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(xu&&xu[n])return xu[n];var a=ll[n]?ll[n]():ll.cylinder(),s=Ol([a],c);return xu[n]=s,s}function g(n,c){for(var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=new Float32Array(n.length/a*3),d,_,A,M=vec3.create(),L=vec3.create(),$=vec3.create(),H=0,ge=c.length;H<ge;H+=3){d=c[H+0]*3,_=c[H+1]*3,A=c[H+2]*3;var Be=[n[d],n[d+1]],vt=[n[_],n[_+1]],kt=[n[A],n[A+1]];s&&(Be=lngLatToMeters(Be),vt=lngLatToMeters(vt),kt=lngLatToMeters(kt));var yr=Be,wr=_slicedToArray(yr,2),jr=wr[0],gn=wr[1],Sn=vec3.fromValues(jr,gn,n[d+2]),zn=vt,ti=_slicedToArray(zn,2),ii=ti[0],Si=ti[1],ta=vec3.fromValues(ii,Si,n[_+2]),_a=kt,gi=_slicedToArray(_a,2),Pa=gi[0],Ua=gi[1],au=vec3.fromValues(Pa,Ua,n[A+2]);vec3.sub(M,au,ta),vec3.sub(L,Sn,ta),vec3.cross($,M,L),l[d]+=M[0],l[d+1]+=M[1],l[d+2]+=M[2],l[_]+=M[0],l[_+1]+=M[1],l[_+2]+=M[2],l[A]+=M[0],l[A+1]+=M[1],l[A+2]+=M[2]}return S(l),l}function S(n){for(var c=0,a=n.length;c<a;c+=3){var s=vec3.fromValues(n[c],n[c+1],n[c+2]),l=vec3.create();vec3.normalize(l,s),n.set(l,c)}}function T(n){var c=n[0][0],a=n[0][n[0].length-1];return c[0]===a[0]&&c[1]===a[1]}function R(n){var c=["cylinder","triangleColumn","hexagonColumn","squareColumn"],a=ll[n]?ll[n]():ll.circle(),s=c.indexOf(n)===-1?Bs([a]):Qc([a]);return s}function G(n,c){var a=(n+1)/2,s=(c+1)/2;return[a,s]}function se(){var n=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),c=n.positionsArr,a=n.indicesArr,s=n.normalArr;return{vertices:c,indices:a,size:5,normals:s}}function Ee(){var n=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),c=n.positionsArr,a=n.indicesArr,s=n.normalArr;return{vertices:c,indices:a,size:5,normals:s}}function we(n){var c=Pe();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Pe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ye=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,We=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,ut=function(n){(0,Kn.Z)(a,n);var c=we(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,A=l.baseColor,M=A===void 0?"rgb(16,16,16)":A,L=l.brightColor,$=L===void 0?"rgb(255,176,38)":L,H=l.windowColor,ge=H===void 0?"rgb(30,60,89)":H,Be=l.time,vt=Be===void 0?0:Be;return{u_opacity:_,u_baseColor:(0,Je.CI)(M),u_brightColor:(0,Je.CI)($),u_windowColor:(0,Je.CI)(ge),u_time:this.layer.getLayerAnimateTime()||vt}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:We,fragmentShader:Ye,triangulation:jl})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:O.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:3,update:function(d,_,A,M,L){return L}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(d,_,A,M){var L=d.size,$=L===void 0?10:L;return Array.isArray($)?[$[0]]:[$]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:O.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:2,update:function(d,_,A,M){var L=d.size;return[A[3],A[4]]}}})}}]),a}(Bo);function Ue(n){var c=at();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function at(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var wt=function(n){(0,Kn.Z)(a,n);var c=Ue(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"type","PolygonLayer"),s}return(0,Or.Z)(a,[{key:"buildModels",value:function(){this.layerModel=new ut(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(l){this.updateLayerConfig({time:l})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),a}(Pu);function Xt(n){var c=_r();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function _r(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var dr=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,Cr=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Gr=function(n){(0,Kn.Z)(a,n);var c=Xt(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.coverage,A=l.angle;return{u_opacity:d||1,u_coverage:_||.9,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:dr,fragmentShader:Cr,triangulation:cl,depth:{enable:!1},primitive:O.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:O.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:3,update:function(d,_){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),a}(Bo);function pn(n){var c=an();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function an(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Zn=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,ui=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,di=function(n){(0,Kn.Z)(a,n);var c=pn(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.coverage,A=l.angle;return{u_opacity:d||1,u_coverage:_||1,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:Zn,fragmentShader:ui,triangulation:Iu,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(d,_,A,M){var L=d.size;return Array.isArray(L)?[L[0]]:[L]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:O.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:3,update:function(d,_,A,M,L){return L}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:O.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:3,update:function(d,_){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),a}(Bo),dn=b(74768);function ia(n,c){for(var a=[],s=[],l=[],d=n+1,_=c+1,A=n/2,M=c/2,L=0;L<_;L++)for(var $=L-M,H=0;H<d;H++){var ge=H-A;s.push(ge/A,-$/M,0),l.push(H/n),l.push(1-L/c)}for(var Be=0;Be<c;Be++)for(var vt=0;vt<n;vt++){var kt=vt+d*Be,yr=vt+d*(Be+1),wr=vt+1+d*(Be+1),jr=vt+1+d*Be;a.push(kt,yr,jr),a.push(yr,wr,jr)}return{vertices:s,indices:a,uvs:l}}var Hn,bi;function Hi(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function mi(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Hi(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Hi(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Ci(n){var c=Vi();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Vi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var X=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,Q=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,D=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,k=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,le=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,Ce=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,ft=(Hn=(0,hn.b2)(),Hn(bi=function(n){(0,Kn.Z)(a,n);var c=Ci(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"texture",void 0),(0,j.Z)((0,St.Z)(s),"colorTexture",void 0),(0,j.Z)((0,St.Z)(s),"heatmapFramerBuffer",void 0),(0,j.Z)((0,St.Z)(s),"intensityModel",void 0),(0,j.Z)((0,St.Z)(s),"colorModel",void 0),(0,j.Z)((0,St.Z)(s),"shapeType",void 0),s}return(0,Or.Z)(a,[{key:"render",value:function(){var l=this,d=this.rendererService,_=d.clear,A=d.useFramebuffer;A(this.heatmapFramerBuffer,function(){_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l.heatmapFramerBuffer}),l.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var l,d=this.rendererService,_=d.createFramebuffer,A=d.clear,M=d.getViewportSize,L=d.createTexture2D,$=d.useFramebuffer,H=this.styleAttributeService.getLayerStyleAttribute("shape"),ge=(H==null||(l=H.scale)===null||l===void 0?void 0:l.field)||"heatmap";this.shapeType=ge,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=ge==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var Be=this.layer.getLayerConfig(),vt=Be.rampColors,kt=(0,Je.Cl)(vt),yr=M(),wr=yr.width,jr=yr.height;return this.heatmapFramerBuffer=_({color:L({width:Math.floor(wr/4),height:Math.floor(jr/4),wrapS:O.gl.CLAMP_TO_EDGE,wrapT:O.gl.CLAMP_TO_EDGE,min:O.gl.LINEAR,mag:O.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:O.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:2,update:function(d,_,A,M){return[A[3],A[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(d,_,A,M){var L=d.size,$=L===void 0?1:L;return[$]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:le,fragmentShader:k,triangulation:o,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:O.gl.ONE,srcAlpha:1,dstRGB:O.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:Ce,fs:D});var l=this.shaderModuleService.getModule("heatmapColor"),d=l.vs,_=l.fs,A=l.uniforms,M=this.rendererService,L=M.createAttribute,$=M.createElements,H=M.createBuffer,ge=M.createModel;return ge({vs:d,fs:_,attributes:{a_Position:L({buffer:H({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:O.gl.FLOAT}),size:3}),a_Uv:L({buffer:H({data:[0,1,1,1,0,0,1,0],type:O.gl.FLOAT}),size:2})},uniforms:mi({},A),depth:{enable:!1},blend:this.getBlend(),count:6,elements:$({data:[0,2,1,2,3,1],type:O.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.intensity,A=_===void 0?10:_,M=l.radius,L=M===void 0?5:M;this.intensityModel.draw({uniforms:{u_opacity:d||1,u_radius:L,u_intensity:A}})}},{key:"drawColorMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=dn.create();dn.invert(_,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,ie.Z)(_)}})}},{key:"build3dHeatMap",value:function(){var l=this.rendererService.getViewportSize,d=l(),_=d.width,A=d.height,M=ia(_/4,A/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:Q,fs:X});var L=this.shaderModuleService.getModule("heatmap3dColor"),$=L.vs,H=L.fs,ge=L.uniforms,Be=this.rendererService,vt=Be.createAttribute,kt=Be.createElements,yr=Be.createBuffer,wr=Be.createModel;return wr({vs:$,fs:H,attributes:{a_Position:vt({buffer:yr({data:M.vertices,type:O.gl.FLOAT}),size:3}),a_Uv:vt({buffer:yr({data:M.uvs,type:O.gl.FLOAT}),size:2})},primitive:O.gl.TRIANGLES,uniforms:mi({},ge),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:O.gl.SRC_ALPHA,srcAlpha:1,dstRGB:O.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:kt({data:M.indices,type:O.gl.UNSIGNED_INT,count:M.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var l=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var d=this.layer.getLayerConfig(),_=d.rampColors,A=(0,Je.Cl)(_);this.colorTexture=l({data:new Uint8Array(A.data),width:A.width,height:A.height,wrapS:O.gl.CLAMP_TO_EDGE,wrapT:O.gl.CLAMP_TO_EDGE,min:O.gl.NEAREST,mag:O.gl.NEAREST,flipY:!1})}}]),a}(Bo))||bi);function Rt(n){var c=Tt();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Tt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var cr=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Kr=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Nn=function(n){(0,Kn.Z)(a,n);var c=Rt(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.coverage,A=l.angle;return{u_opacity:d||1,u_coverage:_||.9,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:Kr,fragmentShader:cr,triangulation:cl,depth:{enable:!1},primitive:O.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:O.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:3,update:function(d,_){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),a}(Bo),ni={heatmap:ft,heatmap3d:ft,grid:Gr,grid3d:di,hexagon:Nn},li=ni;function Li(n){var c=Mi();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Mi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var aa=function(n){(0,Kn.Z)(a,n);var c=Li(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"type","HeatMapLayer"),s}return(0,Or.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new li[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var l=this,d=this.getModelType();return d==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(_){return _.draw({uniforms:l.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),_=this.getLayerConfig(),A=_.shape3d,M=this.getSource(),L=M.data.type,$=(d==null||(l=d.scale)===null||l===void 0?void 0:l.field)||"heatmap";return $==="heatmap"||$==="heatmap3d"?"heatmap":L==="hexagon"?(A==null?void 0:A.indexOf($))===-1?"hexagon":"grid3d":L==="grid"?(A==null?void 0:A.indexOf($))===-1?"grid":"grid3d":"heatmap"}}]),a}(Pu);function xa(n){var c=Ca();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Ca(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Va=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,Ga=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,to=function(n){(0,Kn.Z)(a,n);var c=xa(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"texture",void 0),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture}}},{key:"initModels",value:function(){var l=this,d=this.layer.getSource(),_=this.rendererService.createTexture2D;return this.texture=_({height:0,width:0}),d.data.images.then(function(A){l.texture=_({data:A[0],width:A[0].width,height:A[0].height}),l.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:Ga,fragmentShader:Va,triangulation:i,primitive:O.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:O.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:2,update:function(d,_,A,M){return[A[3],A[4]]}}})}}]),a}(Bo),ca={image:to},da=ca;function va(n){var c=vo();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function vo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Fi=function(n){(0,Kn.Z)(a,n);var c=va(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"type","ImageLayer"),s}return(0,Or.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new da[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={image:{}};return d[l]}},{key:"getModelType",value:function(){return"image"}}]),a}(Pu);function Ia(n){var c=Ka();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Ka(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Oo=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - \u7528\u4E8E\u5408\u5E76\u5355\u4E2A\u7684 varying \u53D8\u91CF

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = v_dataset.r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = v_dataset.b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float d_texCount = v_dataset.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = 1.0 - fract(arcRadio * d_texCount + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = v_dataset.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,ac=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - \u7528\u4E8E\u5408\u5E76\u5355\u4E2A\u7684 varying \u53D8\u91CF

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_dataset.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  v_dataset.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_dataset.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_dataset.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,bu={solid:0,dash:1},Es=function(n){(0,Kn.Z)(a,n);var c=Ia(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"texture",void 0),(0,j.Z)((0,St.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:O.gl.NEAREST,min:O.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,A=l.targetColor,M=l.textureBlend,L=M===void 0?"normal":M,$=l.lineType,H=$===void 0?"solid":$,ge=l.dashArray,Be=ge===void 0?[10,5]:ge,vt=l.forward,kt=vt===void 0?!0:vt,yr=l.lineTexture,wr=yr===void 0?!1:yr,jr=l.iconStep,gn=jr===void 0?100:jr,Sn=l.segmentNumber,zn=Sn===void 0?30:Sn,ti=l.thetaOffset,ii=ti===void 0?.314:ti;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var Si=this.layer.getEncodedData(),ta=this.calDataFrame(this.cellLength,Si,this.cellProperties),_a=ta.data,gi=ta.width,Pa=ta.height;this.rowCount=Pa,this.dataTexture=this.cellLength>0&&_a.length>0?this.createTexture2D({flipY:!0,data:_a,format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:gi,height:Pa}):this.createTexture2D({flipY:!0,data:[1],format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:1,height:1})}Be.length===2&&Be.push(0,0);var Ua=0,au=[0,0,0,0],Lf=[0,0,0,0];return _&&A&&(au=(0,Je.CI)(_),Lf=(0,Je.CI)(A),Ua=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:ii,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(d)?d:1,u_textureBlend:L==="normal"?0:1,segmentNumber:zn,u_line_type:bu[H||"solid"],u_dash_array:Be,u_blur:.9,u_lineDir:kt?1:-1,u_texture:this.texture,u_line_texture:wr?1:0,u_icon_step:gn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ua,u_sourceColor:au,u_targetColor:Lf}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var l=this.layer.getLayerConfig(),d=l.segmentNumber,_=d===void 0?30:d;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:ac,fragmentShader:Oo,triangulation:u,depth:{enable:!1},blend:this.getBlend(),segmentNumber:_})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(_,A,M,L){var $=_.size,H=$===void 0?1:$;return Array.isArray(H)?[H[0]]:[H]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:O.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:4,update:function(_,A,M,L){return[M[3],M[4],M[5],M[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:O.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:2,update:function(_,A,M,L){var $=l.iconService.getIconMap(),H=_.texture,ge=$[H]||{x:0,y:0},Be=ge.x,vt=ge.y;return[Be,vt]}}})}}]),a}(Bo);function Ou(n){var c=Wu();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Wu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var fl=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec4 v_dataset; // \u6570\u636E\u96C6

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_dataset.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Vl=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

varying vec4 v_dataset; // \u6570\u636E\u96C6

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_dataset.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel(u_icon_step);
    v_dataset.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_dataset.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,oc={solid:0,dash:1},Xu=function(n){(0,Kn.Z)(a,n);var c=Ou(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"texture",void 0),(0,j.Z)((0,St.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:O.gl.NEAREST,min:O.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,A=l.targetColor,M=l.textureBlend,L=M===void 0?"normal":M,$=l.lineType,H=$===void 0?"solid":$,ge=l.dashArray,Be=ge===void 0?[10,5]:ge,vt=l.lineTexture,kt=vt===void 0?!1:vt,yr=l.iconStep,wr=yr===void 0?100:yr,jr=l.segmentNumber,gn=jr===void 0?30:jr,Sn=l.globalArcHeight,zn=Sn===void 0?10:Sn;Be.length===2&&Be.push(0,0);var ti=0,ii=[0,0,0,0],Si=[0,0,0,0];if(_&&A&&(ii=(0,Je.CI)(_),Si=(0,Je.CI)(A),ti=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var ta=this.layer.getEncodedData(),_a=this.calDataFrame(this.cellLength,ta,this.cellProperties),gi=_a.data,Pa=_a.width,Ua=_a.height;this.rowCount=Ua,this.dataTexture=this.cellLength>0&&gi.length>0?this.createTexture2D({flipY:!0,data:gi,format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:Pa,height:Ua}):this.createTexture2D({flipY:!0,data:[1],format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:ea,u_global_height:zn,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(d)?d:1,u_textureBlend:L==="normal"?0:1,segmentNumber:gn,u_line_type:oc[H]||0,u_dash_array:Be,u_texture:this.texture,u_line_texture:kt?1:0,u_icon_step:wr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ti,u_sourceColor:ii,u_targetColor:Si}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var l=this.layer.getLayerConfig(),d=l.segmentNumber,_=d===void 0?30:d;return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:Vl,fragmentShader:fl,triangulation:u,blend:this.getBlend(),segmentNumber:_})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(_,A,M,L){var $=_.size,H=$===void 0?1:$;return Array.isArray(H)?[H[0]]:[H]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:O.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:4,update:function(_,A,M,L){return[M[3],M[4],M[5],M[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:O.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:2,update:function(_,A,M,L){var $=l.iconService.getIconMap(),H=_.texture,ge=$[H]||{x:0,y:0},Be=ge.x,vt=ge.y;return[Be,vt]}}})}}]),a}(Bo);function fs(n){var c=Rf();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Rf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var df=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec4 v_dataset; // \u6570\u636E\u96C6

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = v_dataset.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_dataset.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_dataset.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,vf=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

varying vec4 v_dataset; // \u6570\u636E\u96C6

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_dataset.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    v_dataset.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_dataset.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,uh={solid:0,dash:1},lh=function(n){(0,Kn.Z)(a,n);var c=fs(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"texture",void 0),(0,j.Z)((0,St.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:O.gl.NEAREST,min:O.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,A=l.targetColor,M=l.textureBlend,L=M===void 0?"normal":M,$=l.lineType,H=$===void 0?"solid":$,ge=l.dashArray,Be=ge===void 0?[10,5]:ge,vt=l.lineTexture,kt=vt===void 0?!1:vt,yr=l.iconStep,wr=yr===void 0?100:yr,jr=l.segmentNumber,gn=jr===void 0?30:jr;Be.length===2&&Be.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Sn=0,zn=[0,0,0,0],ti=[0,0,0,0];if(_&&A&&(zn=(0,Je.CI)(_),ti=(0,Je.CI)(A),Sn=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var ii=this.layer.getEncodedData(),Si=this.calDataFrame(this.cellLength,ii,this.cellProperties),ta=Si.data,_a=Si.width,gi=Si.height;this.rowCount=gi,this.dataTexture=this.cellLength>0&&ta.length>0?this.createTexture2D({flipY:!0,data:ta,format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:_a,height:gi}):this.createTexture2D({flipY:!0,data:[1],format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(d)?d:1,u_textureBlend:L==="normal"?0:1,segmentNumber:gn,u_line_type:uh[H]||0,u_dash_array:Be,u_texture:this.texture,u_line_texture:kt?1:0,u_icon_step:wr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Sn,u_sourceColor:zn,u_targetColor:ti}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:vf,fragmentShader:df,triangulation:u,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(_,A,M,L){var $=_.size,H=$===void 0?1:$;return Array.isArray(H)?[H[0]]:[H]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:O.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:4,update:function(_,A,M,L){return[M[3],M[4],M[5],M[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:O.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:2,update:function(_,A,M,L){var $=l.iconService.getIconMap(),H=_.texture,ge=$[H]||{x:0,y:0},Be=ge.x,vt=ge.y;return[Be,vt]}}})}}]),a}(Bo);function qc(n){var c=Ac();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Ac(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var up=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - distance_ratio/distance/pixelLen/texV

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Df=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - distance_ratio/distance/pixelLen/texV
// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset.r = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset.g = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset.b = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset.a = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,ch={solid:0,dash:1},Gl=function(n){(0,Kn.Z)(a,n);var c=qc(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"texture",void 0),(0,j.Z)((0,St.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:O.gl.NEAREST,min:O.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,A=l.targetColor,M=l.textureBlend,L=M===void 0?"normal":M,$=l.lineType,H=$===void 0?"solid":$,ge=l.dashArray,Be=ge===void 0?[10,5,0,0]:ge,vt=l.lineTexture,kt=vt===void 0?!1:vt,yr=l.iconStep,wr=yr===void 0?100:yr;Be.length===2&&Be.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var jr=0,gn=[0,0,0,0],Sn=[0,0,0,0];if(_&&A&&(gn=(0,Je.CI)(_),Sn=(0,Je.CI)(A),jr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var zn=this.layer.getEncodedData(),ti=this.calDataFrame(this.cellLength,zn,this.cellProperties),ii=ti.data,Si=ti.width,ta=ti.height;this.rowCount=ta,this.dataTexture=this.cellLength>0&&ii.length>0?this.createTexture2D({flipY:!0,data:ii,format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:Si,height:ta}):this.createTexture2D({flipY:!0,data:[1],format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(d)?d:1,u_textureBlend:L==="normal"?0:1,u_line_type:ch[H],u_dash_array:Be,u_texture:this.texture,u_line_texture:kt?1:0,u_icon_step:wr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:jr,u_sourceColor:gn,u_targetColor:Sn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:Df,fragmentShader:up,triangulation:wc,primitive:O.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var l=this,d=this.layer.getLayerConfig(),_=d.lineType,A=_===void 0?"solid":_;this.styleAttributeService.registerStyleAttribute({name:"distance",type:O.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(L,$,H,ge){return[H[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:O.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(L,$,H,ge){return[H[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:2,update:function(L,$,H,ge){var Be=L.size,vt=Be===void 0?1:Be;return Array.isArray(vt)?[vt[0],vt[1]]:[vt,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:O.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:3,update:function(L,$,H,ge,Be){return Be}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:O.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(L,$,H,ge){return[H[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:O.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:2,update:function(L,$,H,ge){var Be=l.iconService.getIconMap(),vt=L.texture,kt=Be[vt]||{x:0,y:0},yr=kt.x,wr=kt.y;return[yr,wr]}}})}},{key:"loadImage",value:function(l){return new Promise(function(d,_){if(l instanceof HTMLImageElement){d(l);return}var A=new Image;A.crossOrigin="anonymous",A.onload=function(){d(A)},A.onerror=function(){_(new Error("Could not load image at "+l))},A.src=l instanceof File?URL.createObjectURL(l):l})}}]),a}(Bo),ef={arc:Es,arc3d:Xu,greatcircle:lh,line:Gl},lp=ef;function tf(n){var c=fh();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function fh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var cp=function(n){(0,Kn.Z)(a,n);var c=tf(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"type","LineLayer"),s}return(0,Or.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new lp[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return d[l]}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),_=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return _||"line"}}]),a}(Pu);function fp(n){var c=Rh();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Rh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var hp=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,hh=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,Dh=function(n){(0,Kn.Z)(a,n);var c=fp(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var A=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,A,this.cellProperties),L=M.data,$=M.width,H=M.height;this.rowCount=H,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:$,height:H}):this.createTexture2D({flipY:!0,data:[1],format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:hh,fragmentShader:hp,triangulation:Iu,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:3,update:function(_,A,M,L){var $=_.size;if($){var H=[];return Array.isArray($)&&(H=$.length===2?[$[0],$[0],$[1]]:$),Array.isArray($)||(H=[$,$,$]),H}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:O.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:3,update:function(_,A,M,L,$){return $}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:O.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:3,update:function(_,A){var M=Xi(_.coordinates);return l?al([M[0],M[1]]):[M[0],M[1],0]}}})}}]),a}(Bo);function rf(n){var c=pp();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function pp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var rs=`#define Animate 0.0

uniform float u_globel;
uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiased_blur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  
 
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

  

}
`,kf=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,ph=function(n){(0,Kn.Z)(a,n);var c=rf(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,A=l.strokeOpacity,M=A===void 0?1:A,L=l.strokeWidth,$=L===void 0?0:L,H=l.stroke,ge=H===void 0?"rgba(0,0,0,0)":H,Be=l.offsets,vt=Be===void 0?[0,0]:Be;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,strokeOpacity:M,strokeWidth:$,stroke:ge,offsets:vt})){this.judgeStyleAttributes({opacity:_,strokeOpacity:M,strokeWidth:$,stroke:ge,offsets:vt});var kt=this.layer.getEncodedData(),yr=this.calDataFrame(this.cellLength,kt,this.cellProperties),wr=yr.data,jr=yr.width,gn=yr.height;this.rowCount=gn,this.dataTexture=this.cellLength>0&&wr.length>0?this.createTexture2D({flipY:!0,data:wr,format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:jr,height:gn}):this.createTexture2D({flipY:!0,data:[1],format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(_)?_:1,u_stroke_opacity:Pi()(M)?M:1,u_stroke_width:Pi()($)?$:0,u_stroke_color:this.getStrokeColor(ge),u_offsets:this.isOffsetStatic(vt)?vt:[0,0]}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Hu)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var l=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:kf,fragmentShader:rs,triangulation:l?Cc:Hu,depth:{enable:l},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"animateOption2Array",value:function(l){return[l.enable?0:1,l.speed||1,l.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var l=this,d=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:O.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:3,update:function(A,M,L,$){var H;if(d){var ge=(0,Ji.Z)(L,3),Be=ge[0],vt=ge[1],kt=ge[2],yr=ji.fromValues(0,0,1),wr=ji.fromValues(Be,0,kt),jr=Be>=0?ji.angle(yr,wr):Math.PI*2-ji.angle(yr,wr),gn=Math.PI*2-Math.asin(vt/100),Sn=dn.create();dn.rotateY(Sn,Sn,jr),dn.rotateX(Sn,Sn,gn);var zn=ji.fromValues(1,1,0);ji.transformMat4(zn,zn,Sn),ji.normalize(zn,zn);var ti=ji.fromValues(-1,1,0);ji.transformMat4(ti,ti,Sn),ji.normalize(ti,ti);var ii=ji.fromValues(-1,-1,0);ji.transformMat4(ii,ii,Sn),ji.normalize(ii,ii);var Si=ji.fromValues(1,-1,0);ji.transformMat4(Si,Si,Sn),ji.normalize(Si,Si),H=[].concat((0,ie.Z)(zn),(0,ie.Z)(ti),(0,ie.Z)(ii),(0,ie.Z)(Si))}else H=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var ta=$%4*3;return[H[ta],H[ta+1],H[ta+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(A,M,L,$){var H=A.size,ge=H===void 0?5:H;return Array.isArray(ge)?[ge[0]]:[ge]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:O.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(A,M,L,$){var H=A.shape,ge=H===void 0?2:H,Be=l.layer.getLayerConfig().shape2d,vt=Be.indexOf(ge);return[vt]}}})}}]),a}(Bo);function Ff(n){var c=Bf();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Bf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Fc=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,mf=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,yf=function(n){(0,Kn.Z)(a,n);var c=Ff(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"texture",void 0),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var l=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){l.updateTexture(),l.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:mf,fragmentShader:Fc,triangulation:Ns,primitive:O.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(_,A,M,L){var $=_.size;return Array.isArray($)?[$[0]]:[$]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:O.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:2,update:function(_,A,M,L){var $=l.fontService.mapping,H=_.shape,ge=l.fontService.getGlyph(H),Be=$[ge],vt=Be.x,kt=Be.y;return[vt,kt]}}})}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.texture=l({data:d,mag:O.gl.LINEAR,min:O.gl.LINEAR,width:d.width,height:d.height})}},{key:"initIconFontGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),_=d.fontWeight,A=_===void 0?"normal":_,M=d.fontFamily,L=M===void 0?"sans-serif":M,$=this.layer.getEncodedData(),H=[];$.forEach(function(ge){var Be=ge.shape,vt=Be===void 0?"":Be;vt=vt.toString();var kt=l.fontService.getGlyph(vt);H.indexOf(kt)===-1&&H.push(kt)}),this.fontService.setFontOptions({characterSet:H,fontWeight:A,fontFamily:L,fontSize:48})}}]),a}(Bo);function Tc(n){var c=gf();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function gf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var nf=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Nf=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,sc=function(n){(0,Kn.Z)(a,n);var c=Tc(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"texture",void 0),(0,j.Z)((0,St.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.renderLayers();return}s.texture=A({data:s.iconService.getCanvas(),mag:O.gl.LINEAR,min:O.gl.LINEAR,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.offsets,A=_===void 0?[0,0]:_;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:A})){this.judgeStyleAttributes({opacity:d,offsets:A});var M=this.layer.getEncodedData(),L=this.calDataFrame(this.cellLength,M,this.cellProperties),$=L.data,H=L.width,ge=L.height;this.rowCount=ge,this.dataTexture=this.cellLength>0&&$.length>0?this.createTexture2D({flipY:!0,data:$,format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:H,height:ge}):this.createTexture2D({flipY:!0,data:[1],format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Pi()(d)?d:1,u_offsets:this.isOffsetStatic(A)?A:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:Nf,fragmentShader:nf,triangulation:Ns,primitive:O.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(_,A,M,L){var $=_.size,H=$===void 0?5:$;return Array.isArray(H)?[H[0]]:[H]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:O.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:2,update:function(_,A,M,L){var $=l.iconService.getIconMap(),H=_.shape,ge=$[H]||{x:0,y:0},Be=ge.x,vt=ge.y;return[Be,vt]}}})}}]),a}(Bo);function dh(n){var c=af();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function af(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var zf=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,of=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Bc(n){var c=n.coordinates;return{vertices:(0,ie.Z)(c),indices:[0],size:c.length}}var fu=function(n){(0,Kn.Z)(a,n);var c=dh(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,A=l.offsets,M=A===void 0?[0,0]:A;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,offsets:M})){this.judgeStyleAttributes({opacity:_,offsets:M});var L=this.layer.getEncodedData(),$=this.calDataFrame(this.cellLength,L,this.cellProperties),H=$.data,ge=$.width,Be=$.height;this.rowCount=Be,this.dataTexture=this.cellLength>0&&H.length>0?this.createTexture2D({flipY:!0,data:H,format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:ge,height:Be}):this.createTexture2D({flipY:!0,data:[1],format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(_)?_:1,u_offsets:this.isOffsetStatic(M)?M:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:of,fragmentShader:zf,triangulation:Bc,depth:{enable:!1},primitive:O.gl.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(d,_,A,M){var L=d.size,$=L===void 0?1:L;return Array.isArray($)?[$[0]]:[$]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:O.BlendType.additive}}}]),a}(Bo),uc=b(93311);function _f(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=xf(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,A;return{s:function(){a=a.call(n)},n:function(){var L=a.next();return d=L.done,L},e:function(L){_=!0,A=L},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw A}}}}function xf(n,c){if(!!n){if(typeof n=="string")return Zf(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Zf(n,c)}}function Zf(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var sf=function(){function n(c,a,s){(0,vr.Z)(this,n),(0,j.Z)(this,"boxCells",[]),(0,j.Z)(this,"xCellCount",void 0),(0,j.Z)(this,"yCellCount",void 0),(0,j.Z)(this,"boxKeys",void 0),(0,j.Z)(this,"bboxes",void 0),(0,j.Z)(this,"width",void 0),(0,j.Z)(this,"height",void 0),(0,j.Z)(this,"xScale",void 0),(0,j.Z)(this,"yScale",void 0),(0,j.Z)(this,"boxUid",void 0);var l=this.boxCells;this.xCellCount=Math.ceil(c/s),this.yCellCount=Math.ceil(a/s);for(var d=0;d<this.xCellCount*this.yCellCount;d++)l.push([]);this.boxKeys=[],this.bboxes=[],this.width=c,this.height=a,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/a,this.boxUid=0}return(0,Or.Z)(n,[{key:"insert",value:function(a,s,l,d,_){this.forEachCell(s,l,d,_,this.insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(_)}},{key:"query",value:function(a,s,l,d,_){return this.queryHitTest(a,s,l,d,!1,_)}},{key:"hitTest",value:function(a,s,l,d,_){return this.queryHitTest(a,s,l,d,!0,_)}},{key:"insertBoxCell",value:function(a,s,l,d,_,A){this.boxCells[_].push(A)}},{key:"queryHitTest",value:function(a,s,l,d,_,A){if(l<0||a>this.width||d<0||s>this.height)return _?!1:[];var M=[];if(a<=0&&s<=0&&this.width<=l&&this.height<=d){if(_)return!0;for(var L=0;L<this.boxKeys.length;L++)M.push({key:this.boxKeys[L],x1:this.bboxes[L*4],y1:this.bboxes[L*4+1],x2:this.bboxes[L*4+2],y2:this.bboxes[L*4+3]});return A?M.filter(A):M}var $={hitTest:_,seenUids:{box:{},circle:{}}};return this.forEachCell(a,s,l,d,this.queryCell,M,$,A),_?M.length>0:M}},{key:"queryCell",value:function(a,s,l,d,_,A,M,L){var $=M.seenUids,H=this.boxCells[_];if(H!==null){var ge=this.bboxes,Be=_f(H),vt;try{for(Be.s();!(vt=Be.n()).done;){var kt=vt.value;if(!$.box[kt]){$.box[kt]=!0;var yr=kt*4;if(a<=ge[yr+2]&&s<=ge[yr+3]&&l>=ge[yr+0]&&d>=ge[yr+1]&&(!L||L(this.boxKeys[kt]))){if(M.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[kt],x1:ge[yr],y1:ge[yr+1],x2:ge[yr+2],y2:ge[yr+3]})}}}}catch(wr){Be.e(wr)}finally{Be.f()}}return!1}},{key:"forEachCell",value:function(a,s,l,d,_,A,M,L){for(var $=this.convertToXCellCoord(a),H=this.convertToYCellCoord(s),ge=this.convertToXCellCoord(l),Be=this.convertToYCellCoord(d),vt=$;vt<=ge;vt++)for(var kt=H;kt<=Be;kt++){var yr=this.xCellCount*kt+vt;if(_.call(this,a,s,l,d,yr,A,M,L))return}}},{key:"convertToXCellCoord",value:function(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}},{key:"convertToYCellCoord",value:function(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}}]),n}(),hl=sf,kh=function(){function n(c,a){(0,vr.Z)(this,n),(0,j.Z)(this,"width",void 0),(0,j.Z)(this,"height",void 0),(0,j.Z)(this,"grid",void 0),(0,j.Z)(this,"viewportPadding",100),(0,j.Z)(this,"screenRightBoundary",void 0),(0,j.Z)(this,"screenBottomBoundary",void 0),(0,j.Z)(this,"gridRightBoundary",void 0),(0,j.Z)(this,"gridBottomBoundary",void 0),this.width=c,this.height=a,this.viewportPadding=Math.max(c,a),this.grid=new hl(c+this.viewportPadding,a+this.viewportPadding,25),this.screenRightBoundary=c+this.viewportPadding,this.screenBottomBoundary=a+this.viewportPadding,this.gridRightBoundary=c+2*this.viewportPadding,this.gridBottomBoundary=a+2*this.viewportPadding}return(0,Or.Z)(n,[{key:"placeCollisionBox",value:function(a){var s=a.x1+a.anchorPointX+this.viewportPadding,l=a.y1+a.anchorPointY+this.viewportPadding,d=a.x2+a.anchorPointX+this.viewportPadding,_=a.y2+a.anchorPointY+this.viewportPadding;return!this.isInsideGrid(s,l,d,_)||this.grid.hitTest(s,l,d,_)?{box:[]}:{box:[s,l,d,_]}}},{key:"insertCollisionBox",value:function(a,s){var l={featureIndex:s};this.grid.insert(l,a[0],a[1],a[2],a[3])}},{key:"project",value:function(a,s,l){var d=uc.al(s,l,0,1),_=uc.Ue(),A=dn.fromValues.apply(dn,(0,ie.Z)(a));return uc.fF(_,d,A),{x:(_[0]/_[3]+1)/2*this.width+this.viewportPadding,y:(-_[1]/_[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(a,s,l,d){return l>=0&&a<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}}]),n}();function Uf(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Fh(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,A;return{s:function(){a=a.call(n)},n:function(){var L=a.next();return d=L.done,L},e:function(L){_=!0,A=L},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw A}}}}function Fh(n,c){if(!!n){if(typeof n=="string")return vh(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return vh(n,c)}}function vh(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Bh(n){var c=.5,a=.5;switch(n){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0;break;default:c=.5}switch(n){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0;break;default:a=.5}return{horizontalAlign:c,verticalAlign:a}}function lc(n,c,a,s,l){if(!!l){var d=n[s],_=d.glyph;if(_)for(var A=c[_].advance*d.scale,M=(n[s].x+A)*l,L=a;L<=s;L++)n[L].x-=M}}function Pc(n,c,a,s,l,d,_){var A=(c-a)*l,M=(-s*_+.5)*d,L=Uf(n),$;try{for(L.s();!($=L.n()).done;){var H=$.value;H.x+=A,H.y+=M}}catch(ge){L.e(ge)}finally{L.f()}}function Nh(n,c,a,s,l,d,_){var A=-8,M=0,L=A,$=0,H=n.positionedGlyphs,ge=d==="right"?1:d==="left"?0:.5,Be=H.length;a.forEach(function(jr){if(jr.split("").forEach(function(Sn){var zn=c[Sn],ti=0;zn&&(H.push({glyph:Sn,x:M,y:L+ti,vertical:!1,scale:1,metrics:zn}),M+=zn.advance+_)}),H.length!==Be){var gn=M-_;$=Math.max(gn,$),lc(H,c,Be,H.length-1,ge)}M=0,L+=s});var vt=Bh(l),kt=vt.horizontalAlign,yr=vt.verticalAlign;Pc(H,ge,kt,yr,$,s,a.length);var wr=L-A;n.top+=-yr*wr,n.bottom=n.top+wr,n.left+=-kt*$,n.right=n.left+$}function jf(n,c,a,s,l,d,_){var A=-8,M=0,L=A,$=0,H=n.positionedGlyphs,ge=d==="right"?1:d==="left"?0:.5,Be=H.length;a.forEach(function(jr){var gn=c[jr],Sn=0;if(gn&&(H.push({glyph:jr,x:M,y:L+Sn,vertical:!1,scale:1,metrics:gn}),M+=gn.advance+_),H.length!==Be){var zn=M-_;$=Math.max(zn,$),lc(H,c,Be,H.length-1,ge)}M=0,L+=s});var vt=Bh(l),kt=vt.horizontalAlign,yr=vt.verticalAlign;Pc(H,ge,kt,yr,$,s,a.length);var wr=L-A;n.top+=-yr*wr,n.bottom=n.top+wr,n.left+=-kt*$,n.right=n.left+$}function bf(n,c,a,s,l,d){var _=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],A=arguments.length>7?arguments[7]:void 0,M=n.split(`
`),L=[],$={positionedGlyphs:L,top:_[1],bottom:_[1],left:_[0],right:_[0],lineCount:M.length,text:n};return A?jf($,c,M,a,s,l,d):Nh($,c,M,a,s,l,d),L.length?$:!1}function pl(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],a=arguments.length>2?arguments[2]:void 0,s=n.positionedGlyphs,l=s===void 0?[]:s,d=[],_=Uf(l),A;try{for(_.s();!(A=_.n()).done;){var M=A.value,L=M.metrics,$=4,H=L.advance*M.scale/2,ge=a?[M.x+H,M.y]:[0,0],Be=a?[0,0]:[M.x+H+c[0],M.y+c[1]],vt=(0-$)*M.scale-H+Be[0],kt=(0-$)*M.scale+Be[1],yr=vt+L.width*M.scale,wr=kt+L.height*M.scale,jr={x:vt,y:kt},gn={x:yr,y:kt},Sn={x:vt,y:wr},zn={x:yr,y:wr};d.push({tl:jr,tr:gn,bl:Sn,br:zn,tex:L,glyphOffset:ge})}}catch(ti){_.e(ti)}finally{_.f()}return d}function dp(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Hl(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,A;return{s:function(){a=a.call(n)},n:function(){var L=a.next();return d=L.done,L},e:function(L){_=!0,A=L},f:function(){try{!d&&a.return!=null&&a.return()}finally{if(_)throw A}}}}function Hl(n,c){if(!!n){if(typeof n=="string")return mh(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return mh(n,c)}}function mh(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Wl(n){var c=cc();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function cc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var yh=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Vf=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Sf(n){var c=this,a=n.id,s=[],l=[];if(!c.glyphInfoMap||!c.glyphInfoMap[a])return{vertices:[],indices:[],size:7};var d=c.glyphInfoMap[a].centroid,_=d.length===2?[d[0],d[1],0]:d;return c.glyphInfoMap[a].glyphQuads.forEach(function(A,M){s.push.apply(s,(0,ie.Z)(_).concat([A.tex.x,A.tex.y+A.tex.height,A.tl.x,A.tl.y],(0,ie.Z)(_),[A.tex.x+A.tex.width,A.tex.y+A.tex.height,A.tr.x,A.tr.y],(0,ie.Z)(_),[A.tex.x+A.tex.width,A.tex.y,A.br.x,A.br.y],(0,ie.Z)(_),[A.tex.x,A.tex.y,A.bl.x,A.bl.y])),l.push(0+M*4,1+M*4,2+M*4,2+M*4,3+M*4,0+M*4)}),{vertices:s,indices:l,size:7}}var gh=function(n){(0,Kn.Z)(a,n);var c=Wl(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"glyphInfo",void 0),(0,j.Z)((0,St.Z)(s),"glyphInfoMap",{}),(0,j.Z)((0,St.Z)(s),"texture",void 0),(0,j.Z)((0,St.Z)(s),"currentZoom",-1),(0,j.Z)((0,St.Z)(s),"extent",void 0),(0,j.Z)((0,St.Z)(s),"textureHeight",0),(0,j.Z)((0,St.Z)(s),"textCount",0),(0,j.Z)((0,St.Z)(s),"preTextStyle",{}),(0,j.Z)((0,St.Z)(s),"buildModels",function(){return s.initGlyph(),s.updateTexture(),s.filterGlyphs(),s.reBuildModel(),[s.layer.buildLayerModel({moduleName:"pointText",vertexShader:Vf,fragmentShader:yh,triangulation:Sf.bind((0,St.Z)(s)),depth:{enable:!1},blend:s.getBlend()})]}),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,A=l.stroke,M=A===void 0?"#fff":A,L=l.strokeWidth,$=L===void 0?0:L,H=l.textAnchor,ge=H===void 0?"center":H,Be=l.textAllowOverlap,vt=Be===void 0?!1:Be,kt=l.halo,yr=kt===void 0?.5:kt,wr=l.gamma,jr=wr===void 0?2:wr,gn=this.fontService,Sn=gn.canvas,zn=gn.mapping;if(Object.keys(zn).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(zn).length),this.preTextStyle={textAnchor:ge,textAllowOverlap:vt},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,strokeWidth:$,stroke:M})){this.judgeStyleAttributes({opacity:_,strokeWidth:$,stroke:M});var ti=this.layer.getEncodedData(),ii=this.calDataFrame(this.cellLength,ti,this.cellProperties),Si=ii.data,ta=ii.width,_a=ii.height;this.rowCount=_a,this.dataTexture=this.cellLength>0&&Si.length>0?this.createTexture2D({flipY:!0,data:Si,format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:ta,height:_a}):this.createTexture2D({flipY:!0,data:[1],format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(_)?_:1,u_stroke_width:Pi()($)?$:0,u_stroke_color:this.getStrokeColor(M),u_sdf_map:this.texture,u_halo_blur:yr,u_gamma_scale:jr,u_sdf_map_size:[Sn.width,Sn.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var l=this.layer.getLayerConfig(),d=l.textAnchor,_=d===void 0?"center":d,A=l.textAllowOverlap,M=A===void 0?!0:A;return this.preTextStyle={textAnchor:_,textAllowOverlap:M},this.buildModels()}},{key:"needUpdate",value:function(){var l=this.layer.getLayerConfig(),d=l.textAllowOverlap,_=d===void 0?!1:d,A=this.mapService.getZoom(),M=this.mapService.getBounds(),L=(0,Je.oO)(this.extent,M);return!_&&(Math.abs(this.currentZoom-A)>1||!L)||_!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:O.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(d,_,A,M){var L=d.rotate,$=L===void 0?0:L;return Array.isArray($)?[$[0]]:[$]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:O.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:2,update:function(d,_,A,M){return[A[5],A[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(d,_,A,M){var L=d.size,$=L===void 0?12:L;return Array.isArray($)?[$[0]]:[$]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:O.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:2,update:function(d,_,A,M){return[A[3],A[4]]}}})}},{key:"textExtent",value:function(){var l=this.mapService.getBounds();return(0,Je.yA)(l,.5)}},{key:"initTextFont",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,_=d===void 0?"400":d,A=l.fontFamily,M=A===void 0?"sans-serif":A,L=this.layer.getEncodedData(),$=[];L.forEach(function(H){var ge=H.shape,Be=ge===void 0?"":ge;Be=Be.toString();var vt=dp(Be),kt;try{for(vt.s();!(kt=vt.n()).done;){var yr=kt.value;$.indexOf(yr)===-1&&$.push(yr)}}catch(wr){vt.e(wr)}finally{vt.f()}}),this.fontService.setFontOptions({characterSet:$,fontWeight:_,fontFamily:M,iconfont:!1})}},{key:"initIconFontTex",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,_=d===void 0?"400":d,A=l.fontFamily,M=A===void 0?"sans-serif":A,L=this.layer.getEncodedData(),$=[];L.forEach(function(H){var ge=H.shape,Be=ge===void 0?"":ge;Be=Be.toString(),$.indexOf(Be)===-1&&$.push(Be)}),this.fontService.setFontOptions({characterSet:$,fontWeight:_,fontFamily:M,iconfont:!0})}},{key:"generateGlyphLayout",value:function(l){var d=this,_=this.fontService.mapping,A=this.layer.getLayerConfig(),M=A.spacing,L=M===void 0?2:M,$=A.textAnchor,H=$===void 0?"center":$,ge=this.layer.getEncodedData();this.glyphInfo=ge.map(function(Be){var vt=Be.shape,kt=vt===void 0?"":vt,yr=Be.id,wr=Be.size,jr=wr===void 0?1:wr,gn=Be.textOffset,Sn=gn===void 0?[0,0]:gn,zn=bf(kt.toString(),_,jr,H,"center",L,Sn,l),ti=pl(zn,Sn,!1);return Be.shaping=zn,Be.glyphQuads=ti,Be.centroid=Xi(Be.coordinates),Be.originCentroid=Be.version==="GAODE2.x"?Xi(Be.originCoordinates):Be.originCentroid=Be.centroid,d.glyphInfoMap[yr]={shaping:zn,glyphQuads:ti,centroid:Xi(Be.coordinates)},Be})}},{key:"filterGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),_=d.padding,A=_===void 0?[4,4]:_,M=d.textAllowOverlap,L=M===void 0?!1:M;if(!L){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var $=this.rendererService.getViewportSize(),H=$.width,ge=$.height,Be=new kh(H,ge),vt=this.glyphInfo.filter(function(kt){var yr=kt.shaping,wr=kt.id,jr=wr===void 0?0:wr,gn=kt.version==="GAODE2.x"?kt.originCentroid:kt.centroid,Sn=kt.size,zn=Sn/24,ti=l.mapService.lngLatToContainer(gn),ii=Be.placeCollisionBox({x1:yr.left*zn-A[0],x2:yr.right*zn+A[0],y1:yr.top*zn-A[1],y2:yr.bottom*zn+A[1],anchorPointX:ti.x,anchorPointY:ti.y}),Si=ii.box;return Si&&Si.length?(Be.insertCollisionBox(Si,jr),!0):!1});vt.forEach(function(kt){l.glyphInfoMap[kt.id]=kt})}}},{key:"initGlyph",value:function(){var l=this.layer.getLayerConfig(),d=l.iconfont,_=d===void 0?!1:d;_?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(_)}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.textureHeight=d.height,this.texture&&this.texture.destroy(),this.texture=l({data:d,mag:O.gl.LINEAR,min:O.gl.LINEAR,width:d.width,height:d.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Vf,fragmentShader:yh,triangulation:Sf.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),a}(Bo),Cs={fill:ph,image:sc,normal:fu,extrude:Dh,text:gh,icon:yf},Xo=Cs;function hs(n){var c=Su();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Su(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var _h=function(n){(0,Kn.Z)(a,n);var c=hs(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"type","PointLayer"),s}return(0,Or.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Xo[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return d[l]}},{key:"getModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),_=d.shape2d,A=d.shape3d,M=this.iconService.getIconMap(),L=l.find(function(H){return H.hasOwnProperty("shape")});if(L){var $=L.shape;return $==="dot"?"normal":(_==null?void 0:_.indexOf($))!==-1?"fill":(A==null?void 0:A.indexOf($))!==-1?"extrude":M.hasOwnProperty($)?"image":this.fontService.getGlyph($)!==""?"icon":"text"}else return"normal"}}]),a}(Pu);function vp(n){var c=zh();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function zh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var mp=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,yp=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Zh=function(n){(0,Kn.Z)(a,n);var c=vp(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var A=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,A,this.cellProperties),L=M.data,$=M.width,H=M.height;this.rowCount=H,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:$,height:H}):this.createTexture2D({flipY:!0,data:[1],format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:yp,fragmentShader:mp,triangulation:jl})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:O.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:3,update:function(d,_,A,M,L){return L}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(d,_,A,M){var L=d.size,$=L===void 0?10:L;return Array.isArray($)?[$[0]]:[$]}}})}}]),a}(Bo);function Uh(n){var c=gp();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function gp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var _p=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ef=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,jh=function(n){(0,Kn.Z)(a,n);var c=Uh(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var A=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,A,this.cellProperties),L=M.data,$=M.width,H=M.height;this.rowCount=H,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:$,height:H}):this.createTexture2D({flipY:!0,data:[1],format:O.gl.LUMINANCE,type:O.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pi()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:Ef,fragmentShader:_p,triangulation:ic,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),a}(Bo),xh={fill:jh,line:Gl,extrude:Zh,text:gh,point_fill:ph,point_image:sc,point_normal:fu,point_extrude:Dh},Cf=xh;function ro(n){var c=Vh();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Vh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Xl=function(n){(0,Kn.Z)(a,n);var c=ro(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"type","PolygonLayer"),s}return(0,Or.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Cf[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),_=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return _==="fill"?"fill":_==="extrude"?"extrude":_==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),_=d.shape2d,A=d.shape3d,M=this.iconService.getIconMap(),L=l.find(function(H){return H.hasOwnProperty("shape")});if(L){var $=L.shape;return $==="dot"?"point_normal":(_==null?void 0:_.indexOf($))!==-1?"point_fill":(A==null?void 0:A.indexOf($))!==-1?"point_extrude":M.hasOwnProperty($)?"point_image":"text"}else return"fill"}}]),a}(Pu);function Nc(n){var c=Gh();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Gh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Z=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Ie=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,qe=function(n){(0,Kn.Z)(a,n);var c=Nc(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"texture",void 0),(0,j.Z)((0,St.Z)(s),"colorTexture",void 0),s}return(0,Or.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,A=l.clampLow,M=A===void 0?!0:A,L=l.clampHigh,$=L===void 0?!0:L,H=l.noDataValue,ge=H===void 0?-9999999:H,Be=l.domain,vt=Be===void 0?[0,1]:Be;return this.updateColorTexure(),{u_opacity:_||1,u_texture:this.texture,u_domain:vt,u_clampLow:M,u_clampHigh:typeof $!="undefined"?$:M,u_noDataValue:ge,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var l=this.layer.getSource(),d=this.rendererService.createTexture2D,_=l.data.dataArray[0];this.texture=d({data:_.data,width:_.width,height:_.height,format:O.gl.LUMINANCE,type:O.gl.FLOAT});var A=this.layer.getLayerConfig(),M=A.rampColors,L=(0,Je.Cl)(M);return this.colorTexture=d({data:L.data,width:L.width,height:L.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:Ie,fragmentShader:Z,triangulation:i,primitive:O.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:O.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:2,update:function(d,_,A,M){return[A[3],A[4]]}}})}},{key:"updateColorTexure",value:function(){var l=this.rendererService.createTexture2D,d=this.layer.getLayerConfig(),_=d.rampColors,A=(0,Je.Cl)(_);this.colorTexture=l({data:A.data,width:A.width,height:A.height,flipY:!1})}}]),a}(Bo),pr={raster:qe,raster3d:qe},Br=pr;function lr(n){var c=Ir();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function Ir(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Vr=function(n){(0,Kn.Z)(a,n);var c=lr(a);function a(){var s;(0,vr.Z)(this,a);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,j.Z)((0,St.Z)(s),"type","RasterLayer"),s}return(0,Or.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Br[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={raster:{},raster3d:{}};return d[l]}},{key:"getModelType",value:function(){return"raster"}}]),a}(Pu),$r,en,tn,sn,bn,Yr,un,zt,gr;function Jr(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Dn(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Jr(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Jr(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Dr=($r=(0,hn.b2)(),en=(0,hn.f3)(O.vK.IGlobalConfigService),tn=(0,hn.f3)(O.vK.IMapService),sn=(0,hn.f3)(O.vK.IFontService),$r(bn=(Yr=function(){function n(){(0,vr.Z)(this,n),(0,Xa.Z)(this,"configService",un,this),(0,Xa.Z)(this,"mapService",zt,this),(0,Xa.Z)(this,"fontService",gr,this)}return(0,Or.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("DataMappingPlugin",function(){l.generateMaping(a,{styleAttributeService:d})}),a.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return a.dataState.dataMappingNeedUpdate=!1,l.generateMaping(a,{styleAttributeService:d}),!0}),a.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!a.layerModelNeedUpdate){var _=d.getLayerStyleAttributes()||[],A=d.getLayerStyleAttribute("filter"),M=a.getSource().data.dataArray,L=_.filter(function(H){return H.needRemapping}),$=M;A!=null&&A.needRemapping&&A!==null&&A!==void 0&&A.scale&&($=M.filter(function(H){return l.applyAttributeMapping(A,H)[0]})),L.length&&(A!=null&&A.needRemapping?(a.setEncodedData(l.mapping(_,$)),A.needRemapping=!1):a.setEncodedData(l.mapping(L,$,a.getEncodedData())),a.emit("remapping",null))}})}},{key:"generateMaping",value:function(a,s){var l=this,d=s.styleAttributeService,_=d.getLayerStyleAttributes()||[],A=d.getLayerStyleAttribute("filter"),M=a.getSource().data.dataArray,L=M;A!=null&&A.scale&&(L=M.filter(function($){return l.applyAttributeMapping(A,$)[0]})),a.setEncodedData(this.mapping(_,L))}},{key:"mapping",value:function(a,s,l){var d=this,_=s.map(function(A,M){var L=l?l[M]:{},$=Dn({id:A._id,coordinates:A.coordinates},L);return a.filter(function(H){return H.scale!==void 0}).forEach(function(H){var ge=d.applyAttributeMapping(H,A);H.needRemapping=!1,H.name==="color"&&(ge=ge.map(function(Be){return(0,Je.CI)(Be)})),$[H.name]=Array.isArray(ge)&&ge.length===1?ge[0]:ge,H.name==="shape"&&($.shape=d.fontService.getIconFontKey($[H.name]))}),$});return _.length>0&&this.mapService.version==="GAODE2.x"&&(typeof _[0].coordinates[0]=="number"?_.filter(function(A){return!A.originCoordinates}).map(function(A){A.version="GAODE2.x",A.originCoordinates=oe()(A.coordinates),A.coordinates=d.mapService.lngLatToCoord(A.coordinates)}):_.filter(function(A){return!A.originCoordinates}).map(function(A){A.version="GAODE2.x",A.originCoordinates=oe()(A.coordinates),A.coordinates=d.mapService.lngLatToCoords(A.coordinates)})),_}},{key:"applyAttributeMapping",value:function(a,s){var l;if(!a.scale)return[];var d=(a==null||(l=a.scale)===null||l===void 0?void 0:l.scalers)||[],_=[];return d.forEach(function(A){var M,L=A.field;(s.hasOwnProperty(L)||((M=a.scale)===null||M===void 0?void 0:M.type)==="variable")&&_.push(s[L])}),a.mapping?a.mapping(_):[]}}]),n}(),un=(0,lo.Z)(Yr.prototype,"configService",[en],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zt=(0,lo.Z)(Yr.prototype,"mapService",[tn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gr=(0,lo.Z)(Yr.prototype,"fontService",[sn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yr))||bn),Pn,fn,pi=(Pn=(0,hn.b2)(),Pn(fn=function(){function n(){(0,vr.Z)(this,n),(0,j.Z)(this,"mapService",void 0)}return(0,Or.Z)(n,[{key:"apply",value:function(a){var s=this;this.mapService=a.getContainer().get(O.vK.IMapService),a.hooks.init.tap("DataSourcePlugin",function(){var l=a.getSource();if(!l){var d=a.sourceOption||{data:ke,options:yt},_=d.data,A=d.options;a.setSource(new Se(_,A))}s.updateClusterData(a)}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var l=s.updateClusterData(a),d=a.dataState.dataSourceNeedUpdate;return a.dataState.dataSourceNeedUpdate=!1,l||d})}},{key:"updateClusterData",value:function(a){var s=a.getSource(),l=s.cluster,d=s.clusterOptions,_=d.zoom,A=_===void 0?0:_,M=d.maxZoom,L=M===void 0?16:M,$=this.mapService.getZoom()-1,H=a.dataState.dataSourceNeedUpdate;return l&&(H||Math.abs(A-$)>1)&&L>A?(s.updateClusterData(Math.floor($)),!0):!1}}]),n}())||fn),kr=b(21691),Ar=b.n(kr),ri=b(93544),Cn=b.n(ri);function rn(n,c){return n<c?-1:n>c?1:n>=c?0:NaN}function Mn(n){return n.length===1&&(n=On(n)),{left:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;n(c[d],a)<0?s=d+1:l=d}return s},right:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;n(c[d],a)>0?l=d:s=d+1}return s}}}function On(n){return function(c,a){return rn(n(c),a)}}var Gi=Mn(rn),Bi=Gi.right,kn=Gi.left,An=Bi;function Ti(n,c){var a=n.length,s=-1,l,d,_;if(c==null){for(;++s<a;)if((l=n[s])!=null&&l>=l)for(d=_=l;++s<a;)(l=n[s])!=null&&(d>l&&(d=l),_<l&&(_=l))}else for(;++s<a;)if((l=c(n[s],s,n))!=null&&l>=l)for(d=_=l;++s<a;)(l=c(n[s],s,n))!=null&&(d>l&&(d=l),_<l&&(_=l));return[d,_]}var Ui=Array.prototype,ma=Ui.slice,Zo=Ui.map,bo=Math.sqrt(50),sa=Math.sqrt(10),ps=Math.sqrt(2);function fo(n,c,a){var s,l=-1,d,_,A;if(c=+c,n=+n,a=+a,n===c&&a>0)return[n];if((s=c<n)&&(d=n,n=c,c=d),(A=Yo(n,c,a))===0||!isFinite(A))return[];if(A>0)for(n=Math.ceil(n/A),c=Math.floor(c/A),_=new Array(d=Math.ceil(c-n+1));++l<d;)_[l]=(n+l)*A;else for(n=Math.floor(n*A),c=Math.ceil(c*A),_=new Array(d=Math.ceil(n-c+1));++l<d;)_[l]=(n-l)/A;return s&&_.reverse(),_}function Yo(n,c,a){var s=(c-n)/Math.max(0,a),l=Math.floor(Math.log(s)/Math.LN10),d=s/Math.pow(10,l);return l>=0?(d>=bo?10:d>=sa?5:d>=ps?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(d>=bo?10:d>=sa?5:d>=ps?2:1)}function Uo(n,c,a){var s=Math.abs(c-n)/Math.max(0,a),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),d=s/l;return d>=bo?l*=10:d>=sa?l*=5:d>=ps&&(l*=2),c<n?-l:l}function Ls(){var n=identity,c=extent,a=sturges;function s(l){var d,_=l.length,A,M=new Array(_);for(d=0;d<_;++d)M[d]=n(l[d],d,l);var L=c(M),$=L[0],H=L[1],ge=a(M,$,H);Array.isArray(ge)||(ge=tickStep($,H,ge),ge=range(Math.ceil($/ge)*ge,H,ge));for(var Be=ge.length;ge[0]<=$;)ge.shift(),--Be;for(;ge[Be-1]>H;)ge.pop(),--Be;var vt=new Array(Be+1),kt;for(d=0;d<=Be;++d)kt=vt[d]=[],kt.x0=d>0?ge[d-1]:$,kt.x1=d<Be?ge[d]:H;for(d=0;d<_;++d)A=M[d],$<=A&&A<=H&&vt[bisect(ge,A,0,Be)].push(l[d]);return vt}return s.value=function(l){return arguments.length?(n=typeof l=="function"?l:constant(l),s):n},s.domain=function(l){return arguments.length?(c=typeof l=="function"?l:constant([l[0],l[1]]),s):c},s.thresholds=function(l){return arguments.length?(a=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):a},s}function zs(n,c,a){return n=map.call(n,number).sort(ascending),Math.ceil((a-c)/(2*(quantile(n,.75)-quantile(n,.25))*Math.pow(n.length,-1/3)))}function ws(n){return n===null?NaN:+n}function Ko(n,c,a){if(a==null&&(a=ws),!!(s=n.length)){if((c=+c)<=0||s<2)return+a(n[0],0,n);if(c>=1)return+a(n[s-1],s-1,n);var s,l=(s-1)*c,d=Math.floor(l),_=+a(n[d],d,n),A=+a(n[d+1],d+1,n);return _+(A-_)*(l-d)}}var wi="$";function jo(){}jo.prototype=Oa.prototype={constructor:jo,has:function(n){return wi+n in this},get:function(n){return this[wi+n]},set:function(n,c){return this[wi+n]=c,this},remove:function(n){var c=wi+n;return c in this&&delete this[c]},clear:function(){for(var n in this)n[0]===wi&&delete this[n]},keys:function(){var n=[];for(var c in this)c[0]===wi&&n.push(c.slice(1));return n},values:function(){var n=[];for(var c in this)c[0]===wi&&n.push(this[c]);return n},entries:function(){var n=[];for(var c in this)c[0]===wi&&n.push({key:c.slice(1),value:this[c]});return n},size:function(){var n=0;for(var c in this)c[0]===wi&&++n;return n},empty:function(){for(var n in this)if(n[0]===wi)return!1;return!0},each:function(n){for(var c in this)c[0]===wi&&n(this[c],c.slice(1),this)}};function Oa(n,c){var a=new jo;if(n instanceof jo)n.each(function(A,M){a.set(M,A)});else if(Array.isArray(n)){var s=-1,l=n.length,d;if(c==null)for(;++s<l;)a.set(s,n[s]);else for(;++s<l;)a.set(c(d=n[s],s,n),d)}else if(n)for(var _ in n)a.set(_,n[_]);return a}var Lo=Oa;function ki(){var n=[],c=[],a,s,l;function d(A,M,L,$){if(M>=n.length)return a!=null&&A.sort(a),s!=null?s(A):A;for(var H=-1,ge=A.length,Be=n[M++],vt,kt,yr=map(),wr,jr=L();++H<ge;)(wr=yr.get(vt=Be(kt=A[H])+""))?wr.push(kt):yr.set(vt,[kt]);return yr.each(function(gn,Sn){$(jr,Sn,d(gn,M,L,$))}),jr}function _(A,M){if(++M>n.length)return A;var L,$=c[M-1];return s!=null&&M>=n.length?L=A.entries():(L=[],A.each(function(H,ge){L.push({key:ge,values:_(H,M)})})),$!=null?L.sort(function(H,ge){return $(H.key,ge.key)}):L}return l={object:function(A){return d(A,0,fa,no)},map:function(A){return d(A,0,So,dl)},entries:function(A){return _(d(A,0,So,dl),0)},key:function(A){return n.push(A),l},sortKeys:function(A){return c[n.length-1]=A,l},sortValues:function(A){return a=A,l},rollup:function(A){return s=A,l}}}function fa(){return{}}function no(n,c,a){n[c]=a}function So(){return map()}function dl(n,c,a){n.set(c,a)}function Ge(){}var sr=Lo.prototype;Ge.prototype=rr.prototype={constructor:Ge,has:sr.has,add:function(n){return n+="",this[wi+n]=n,this},remove:sr.remove,clear:sr.clear,values:sr.keys,size:sr.size,empty:sr.empty,each:sr.each};function rr(n,c){var a=new Ge;if(n instanceof Ge)n.each(function(d){a.add(d)});else if(n){var s=-1,l=n.length;if(c==null)for(;++s<l;)a.add(n[s]);else for(;++s<l;)a.add(c(n[s],s,n))}return a}var Xn=null,ha=Array.prototype,Fe=ha.map,xe=ha.slice;function tt(n,c){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(c).domain(n);break}return this}function Ut(n,c){switch(arguments.length){case 0:break;case 1:this.interpolator(n);break;default:this.interpolator(c).domain(n);break}return this}var fr={name:"implicit"};function gt(){var n=Lo(),c=[],a=[],s=fr;function l(d){var _=d+"",A=n.get(_);if(!A){if(s!==fr)return s;n.set(_,A=c.push(d))}return a[(A-1)%a.length]}return l.domain=function(d){if(!arguments.length)return c.slice();c=[],n=Lo();for(var _=-1,A=d.length,M,L;++_<A;)n.has(L=(M=d[_])+"")||n.set(L,c.push(M));return l},l.range=function(d){return arguments.length?(a=xe.call(d),l):a.slice()},l.unknown=function(d){return arguments.length?(s=d,l):s},l.copy=function(){return gt(c,a).unknown(s)},tt.apply(l,arguments),l}function mt(){var n=ordinal().unknown(void 0),c=n.domain,a=n.range,s=[0,1],l,d,_=!1,A=0,M=0,L=.5;delete n.unknown;function $(){var H=c().length,ge=s[1]<s[0],Be=s[ge-0],vt=s[1-ge];l=(vt-Be)/Math.max(1,H-A+M*2),_&&(l=Math.floor(l)),Be+=(vt-Be-l*(H-A))*L,d=l*(1-A),_&&(Be=Math.round(Be),d=Math.round(d));var kt=sequence(H).map(function(yr){return Be+l*yr});return a(ge?kt.reverse():kt)}return n.domain=function(H){return arguments.length?(c(H),$()):c()},n.range=function(H){return arguments.length?(s=[+H[0],+H[1]],$()):s.slice()},n.rangeRound=function(H){return s=[+H[0],+H[1]],_=!0,$()},n.bandwidth=function(){return d},n.step=function(){return l},n.round=function(H){return arguments.length?(_=!!H,$()):_},n.padding=function(H){return arguments.length?(A=Math.min(1,M=+H),$()):A},n.paddingInner=function(H){return arguments.length?(A=Math.min(1,H),$()):A},n.paddingOuter=function(H){return arguments.length?(M=+H,$()):M},n.align=function(H){return arguments.length?(L=Math.max(0,Math.min(1,H)),$()):L},n.copy=function(){return mt(c(),s).round(_).paddingInner(A).paddingOuter(M).align(L)},initRange.apply($(),arguments)}function ot(n){var c=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return ot(c())},n}function Re(){return ot(mt.apply(null,arguments).paddingInner(1))}var st=b(45257),ze=b(53254);function Vt(n,c){return n=+n,c=+c,function(a){return Math.round(n*(1-a)+c*a)}}function Qt(n){return function(){return n}}function Ur(n){return+n}var _n=[0,1];function on(n){return n}function Rn(n,c){return(c-=n=+n)?function(a){return(a-n)/c}:Qt(isNaN(c)?NaN:.5)}function mn(n){var c=n[0],a=n[n.length-1],s;return c>a&&(s=c,c=a,a=s),function(l){return Math.max(c,Math.min(a,l))}}function ai(n,c,a){var s=n[0],l=n[1],d=c[0],_=c[1];return l<s?(s=Rn(l,s),d=a(_,d)):(s=Rn(s,l),d=a(d,_)),function(A){return d(s(A))}}function Un(n,c,a){var s=Math.min(n.length,c.length)-1,l=new Array(s),d=new Array(s),_=-1;for(n[s]<n[0]&&(n=n.slice().reverse(),c=c.slice().reverse());++_<s;)l[_]=Rn(n[_],n[_+1]),d[_]=a(c[_],c[_+1]);return function(A){var M=An(n,A,1,s)-1;return d[M](l[M](A))}}function Yn(n,c){return c.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function Qn(){var n=_n,c=_n,a=st.Z,s,l,d,_=on,A,M,L;function $(){return A=Math.min(n.length,c.length)>2?Un:ai,M=L=null,H}function H(ge){return isNaN(ge=+ge)?d:(M||(M=A(n.map(s),c,a)))(s(_(ge)))}return H.invert=function(ge){return _(l((L||(L=A(c,n.map(s),ze.Z)))(ge)))},H.domain=function(ge){return arguments.length?(n=Fe.call(ge,Ur),_===on||(_=mn(n)),$()):n.slice()},H.range=function(ge){return arguments.length?(c=xe.call(ge),$()):c.slice()},H.rangeRound=function(ge){return c=xe.call(ge),a=Vt,$()},H.clamp=function(ge){return arguments.length?(_=ge?mn(n):on,H):_!==on},H.interpolate=function(ge){return arguments.length?(a=ge,$()):a},H.unknown=function(ge){return arguments.length?(d=ge,H):d},function(ge,Be){return s=ge,l=Be,$()}}function qn(n,c){return Qn()(n,c)}var yi=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Za(n){if(!(c=yi.exec(n)))throw new Error("invalid format: "+n);var c;return new No({fill:c[1],align:c[2],sign:c[3],symbol:c[4],zero:c[5],width:c[6],comma:c[7],precision:c[8]&&c[8].slice(1),trim:c[9],type:c[10]})}Za.prototype=No.prototype;function No(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}No.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Yl(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function Ha(n,c){if((a=(n=c?n.toExponential(c-1):n.toExponential()).indexOf("e"))<0)return null;var a,s=n.slice(0,a);return[s.length>1?s[0]+s.slice(2):s,+n.slice(a+1)]}function ba(n){return n=Ha(Math.abs(n)),n?n[1]:NaN}function nu(n,c){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ba(c)/3)))*3-ba(Math.abs(n)))}function Rl(n,c){return function(a,s){for(var l=a.length,d=[],_=0,A=n[0],M=0;l>0&&A>0&&(M+A+1>s&&(A=Math.max(1,s-M)),d.push(a.substring(l-=A,l+A)),!((M+=A+1)>s));)A=n[_=(_+1)%n.length];return d.reverse().join(c)}}function Yu(n){return function(c){return c.replace(/[0-9]/g,function(a){return n[+a]})}}function bh(n){e:for(var c=n.length,a=1,s=-1,l;a<c;++a)switch(n[a]){case".":s=l=a;break;case"0":s===0&&(s=a),l=a;break;default:if(!+n[a])break e;s>0&&(s=0);break}return s>0?n.slice(0,s)+n.slice(l+1):n}var Ku;function Gf(n,c){var a=Ha(n,c);if(!a)return n+"";var s=a[0],l=a[1],d=l-(Ku=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,_=s.length;return d===_?s:d>_?s+new Array(d-_+1).join("0"):d>0?s.slice(0,d)+"."+s.slice(d):"0."+new Array(1-d).join("0")+Ha(n,Math.max(0,c+d-1))[0]}function uf(n,c){var a=Ha(n,c);if(!a)return n+"";var s=a[0],l=a[1];return l<0?"0."+new Array(-l).join("0")+s:s.length>l+1?s.slice(0,l+1)+"."+s.slice(l+1):s+new Array(l-s.length+2).join("0")}var lf={"%":function(n,c){return(n*100).toFixed(c)},b:function(n){return Math.round(n).toString(2)},c:function(n){return n+""},d:Yl,e:function(n,c){return n.toExponential(c)},f:function(n,c){return n.toFixed(c)},g:function(n,c){return n.toPrecision(c)},o:function(n){return Math.round(n).toString(8)},p:function(n,c){return uf(n*100,c)},r:uf,s:Gf,X:function(n){return Math.round(n).toString(16).toUpperCase()},x:function(n){return Math.round(n).toString(16)}};function xp(n){return n}var ds=Array.prototype.map,Hf=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function zc(n){var c=n.grouping===void 0||n.thousands===void 0?xp:Rl(ds.call(n.grouping,Number),n.thousands+""),a=n.currency===void 0?"":n.currency[0]+"",s=n.currency===void 0?"":n.currency[1]+"",l=n.decimal===void 0?".":n.decimal+"",d=n.numerals===void 0?xp:Yu(ds.call(n.numerals,String)),_=n.percent===void 0?"%":n.percent+"",A=n.minus===void 0?"-":n.minus+"",M=n.nan===void 0?"NaN":n.nan+"";function L(H){H=Za(H);var ge=H.fill,Be=H.align,vt=H.sign,kt=H.symbol,yr=H.zero,wr=H.width,jr=H.comma,gn=H.precision,Sn=H.trim,zn=H.type;zn==="n"?(jr=!0,zn="g"):lf[zn]||(gn===void 0&&(gn=12),Sn=!0,zn="g"),(yr||ge==="0"&&Be==="=")&&(yr=!0,ge="0",Be="=");var ti=kt==="$"?a:kt==="#"&&/[boxX]/.test(zn)?"0"+zn.toLowerCase():"",ii=kt==="$"?s:/[%p]/.test(zn)?_:"",Si=lf[zn],ta=/[defgprs%]/.test(zn);gn=gn===void 0?6:/[gprs]/.test(zn)?Math.max(1,Math.min(21,gn)):Math.max(0,Math.min(20,gn));function _a(gi){var Pa=ti,Ua=ii,au,Lf,ap;if(zn==="c")Ua=Si(gi)+Ua,gi="";else{gi=+gi;var op=gi<0||1/gi<0;if(gi=isNaN(gi)?M:Si(Math.abs(gi),gn),Sn&&(gi=bh(gi)),op&&+gi==0&&vt!=="+"&&(op=!1),Pa=(op?vt==="("?vt:A:vt==="-"||vt==="("?"":vt)+Pa,Ua=(zn==="s"?Hf[8+Ku/3]:"")+Ua+(op&&vt==="("?")":""),ta){for(au=-1,Lf=gi.length;++au<Lf;)if(ap=gi.charCodeAt(au),48>ap||ap>57){Ua=(ap===46?l+gi.slice(au+1):gi.slice(au))+Ua,gi=gi.slice(0,au);break}}}jr&&!yr&&(gi=c(gi,Infinity));var sp=Pa.length+gi.length+Ua.length,Yc=sp<wr?new Array(wr-sp+1).join(ge):"";switch(jr&&yr&&(gi=c(Yc+gi,Yc.length?wr-Ua.length:Infinity),Yc=""),Be){case"<":gi=Pa+gi+Ua+Yc;break;case"=":gi=Pa+Yc+gi+Ua;break;case"^":gi=Yc.slice(0,sp=Yc.length>>1)+Pa+gi+Ua+Yc.slice(sp);break;default:gi=Yc+Pa+gi+Ua;break}return d(gi)}return _a.toString=function(){return H+""},_a}function $(H,ge){var Be=L((H=Za(H),H.type="f",H)),vt=Math.max(-8,Math.min(8,Math.floor(ba(ge)/3)))*3,kt=Math.pow(10,-vt),yr=Hf[8+vt/3];return function(wr){return Be(kt*wr)+yr}}return{format:L,formatPrefix:$}}var wf,Wf,Hh;Xf({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Xf(n){return wf=zc(n),Wf=wf.format,Hh=wf.formatPrefix,wf}function Zc(n,c){return n=Math.abs(n),c=Math.abs(c)-n,Math.max(0,ba(c)-ba(n))+1}function Gp(n){return Math.max(0,-ba(Math.abs(n)))}function Hp(n,c,a,s){var l=Uo(n,c,a),d;switch(s=Za(s==null?",f":s),s.type){case"s":{var _=Math.max(Math.abs(n),Math.abs(c));return s.precision==null&&!isNaN(d=nu(l,_))&&(s.precision=d),Hh(s,_)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(d=Zc(l,Math.max(Math.abs(n),Math.abs(c))))&&(s.precision=d-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(d=Gp(l))&&(s.precision=d-(s.type==="%")*2);break}}return Wf(s)}function Wh(n){var c=n.domain;return n.ticks=function(a){var s=c();return fo(s[0],s[s.length-1],a==null?10:a)},n.tickFormat=function(a,s){var l=c();return Hp(l[0],l[l.length-1],a==null?10:a,s)},n.nice=function(a){a==null&&(a=10);var s=c(),l=0,d=s.length-1,_=s[l],A=s[d],M;return A<_&&(M=_,_=A,A=M,M=l,l=d,d=M),M=Yo(_,A,a),M>0?(_=Math.floor(_/M)*M,A=Math.ceil(A/M)*M,M=Yo(_,A,a)):M<0&&(_=Math.ceil(_*M)/M,A=Math.floor(A*M)/M,M=Yo(_,A,a)),M>0?(s[l]=Math.floor(_/M)*M,s[d]=Math.ceil(A/M)*M,c(s)):M<0&&(s[l]=Math.ceil(_*M)/M,s[d]=Math.floor(A*M)/M,c(s)),n},n}function Rs(){var n=qn(on,on);return n.copy=function(){return Yn(n,Rs())},tt.apply(n,arguments),Wh(n)}function Uc(n){var c;function a(s){return isNaN(s=+s)?c:s}return a.invert=a,a.domain=a.range=function(s){return arguments.length?(n=Fe.call(s,Ur),a):n.slice()},a.unknown=function(s){return arguments.length?(c=s,a):c},a.copy=function(){return Uc(n).unknown(c)},n=arguments.length?Fe.call(n,Ur):[0,1],Wh(a)}function bp(n,c){n=n.slice();var a=0,s=n.length-1,l=n[a],d=n[s],_;return d<l&&(_=a,a=s,s=_,_=l,l=d,d=_),n[a]=c.floor(l),n[s]=c.ceil(d),n}function e(n){return Math.log(n)}function t(n){return Math.exp(n)}function r(n){return-Math.log(-n)}function f(n){return-Math.exp(-n)}function v(n){return isFinite(n)?+("1e"+n):n<0?0:n}function y(n){return n===10?v:n===Math.E?Math.exp:function(c){return Math.pow(n,c)}}function x(n){return n===Math.E?Math.log:n===10&&Math.log10||n===2&&Math.log2||(n=Math.log(n),function(c){return Math.log(c)/n})}function P(n){return function(c){return-n(-c)}}function F(n){var c=n(e,t),a=c.domain,s=10,l,d;function _(){return l=x(s),d=y(s),a()[0]<0?(l=P(l),d=P(d),n(r,f)):n(e,t),c}return c.base=function(A){return arguments.length?(s=+A,_()):s},c.domain=function(A){return arguments.length?(a(A),_()):a()},c.ticks=function(A){var M=a(),L=M[0],$=M[M.length-1],H;(H=$<L)&&(ge=L,L=$,$=ge);var ge=l(L),Be=l($),vt,kt,yr,wr=A==null?10:+A,jr=[];if(!(s%1)&&Be-ge<wr){if(ge=Math.round(ge)-1,Be=Math.round(Be)+1,L>0){for(;ge<Be;++ge)for(kt=1,vt=d(ge);kt<s;++kt)if(yr=vt*kt,!(yr<L)){if(yr>$)break;jr.push(yr)}}else for(;ge<Be;++ge)for(kt=s-1,vt=d(ge);kt>=1;--kt)if(yr=vt*kt,!(yr<L)){if(yr>$)break;jr.push(yr)}}else jr=fo(ge,Be,Math.min(Be-ge,wr)).map(d);return H?jr.reverse():jr},c.tickFormat=function(A,M){if(M==null&&(M=s===10?".0e":","),typeof M!="function"&&(M=Wf(M)),A===Infinity)return M;A==null&&(A=10);var L=Math.max(1,s*A/c.ticks().length);return function($){var H=$/d(Math.round(l($)));return H*s<s-.5&&(H*=s),H<=L?M($):""}},c.nice=function(){return a(bp(a(),{floor:function(A){return d(Math.floor(l(A)))},ceil:function(A){return d(Math.ceil(l(A)))}}))},c}function U(){var n=F(Qn()).domain([1,10]);return n.copy=function(){return Yn(n,U()).base(n.base())},tt.apply(n,arguments),n}function W(n){return function(c){return Math.sign(c)*Math.log1p(Math.abs(c/n))}}function ne(n){return function(c){return Math.sign(c)*Math.expm1(Math.abs(c))*n}}function de(n){var c=1,a=n(W(c),ne(c));return a.constant=function(s){return arguments.length?n(W(c=+s),ne(c)):c},linearish(a)}function be(){var n=de(transformer());return n.copy=function(){return copy(n,be()).constant(n.constant())},initRange.apply(n,arguments)}function He(n){return function(c){return c<0?-Math.pow(-c,n):Math.pow(c,n)}}function Xe(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function _t(n){return n<0?-n*n:n*n}function rt(n){var c=n(on,on),a=1;function s(){return a===1?n(on,on):a===.5?n(Xe,_t):n(He(a),He(1/a))}return c.exponent=function(l){return arguments.length?(a=+l,s()):a},Wh(c)}function Dt(){var n=rt(Qn());return n.copy=function(){return Yn(n,Dt()).exponent(n.exponent())},tt.apply(n,arguments),n}function qt(){return Dt.apply(null,arguments).exponent(.5)}function mr(){var n=[],c=[],a=[],s;function l(){var _=0,A=Math.max(1,c.length);for(a=new Array(A-1);++_<A;)a[_-1]=Ko(n,_/A);return d}function d(_){return isNaN(_=+_)?s:c[An(a,_)]}return d.invertExtent=function(_){var A=c.indexOf(_);return A<0?[NaN,NaN]:[A>0?a[A-1]:n[0],A<a.length?a[A]:n[n.length-1]]},d.domain=function(_){if(!arguments.length)return n.slice();n=[];for(var A=0,M=_.length,L;A<M;++A)L=_[A],L!=null&&!isNaN(L=+L)&&n.push(L);return n.sort(rn),l()},d.range=function(_){return arguments.length?(c=xe.call(_),l()):c.slice()},d.unknown=function(_){return arguments.length?(s=_,d):s},d.quantiles=function(){return a.slice()},d.copy=function(){return mr().domain(n).range(c).unknown(s)},tt.apply(d,arguments)}function xr(){var n=0,c=1,a=1,s=[.5],l=[0,1],d;function _(M){return M<=M?l[An(s,M,0,a)]:d}function A(){var M=-1;for(s=new Array(a);++M<a;)s[M]=((M+1)*c-(M-a)*n)/(a+1);return _}return _.domain=function(M){return arguments.length?(n=+M[0],c=+M[1],A()):[n,c]},_.range=function(M){return arguments.length?(a=(l=xe.call(M)).length-1,A()):l.slice()},_.invertExtent=function(M){var L=l.indexOf(M);return L<0?[NaN,NaN]:L<1?[n,s[0]]:L>=a?[s[a-1],c]:[s[L-1],s[L]]},_.unknown=function(M){return arguments.length&&(d=M),_},_.thresholds=function(){return s.slice()},_.copy=function(){return xr().domain([n,c]).range(l).unknown(d)},tt.apply(Wh(_),arguments)}function Nr(){var n=[.5],c=[0,1],a,s=1;function l(d){return d<=d?c[An(n,d,0,s)]:a}return l.domain=function(d){return arguments.length?(n=xe.call(d),s=Math.min(n.length,c.length-1),l):n.slice()},l.range=function(d){return arguments.length?(c=xe.call(d),s=Math.min(n.length,c.length-1),l):c.slice()},l.invertExtent=function(d){var _=c.indexOf(d);return[n[_-1],n[_]]},l.unknown=function(d){return arguments.length?(a=d,l):a},l.copy=function(){return Nr().domain(n).range(c).unknown(a)},tt.apply(l,arguments)}var ln=new Date,wn=new Date;function ei(n,c,a,s){function l(d){return n(d=arguments.length===0?new Date:new Date(+d)),d}return l.floor=function(d){return n(d=new Date(+d)),d},l.ceil=function(d){return n(d=new Date(d-1)),c(d,1),n(d),d},l.round=function(d){var _=l(d),A=l.ceil(d);return d-_<A-d?_:A},l.offset=function(d,_){return c(d=new Date(+d),_==null?1:Math.floor(_)),d},l.range=function(d,_,A){var M=[],L;if(d=l.ceil(d),A=A==null?1:Math.floor(A),!(d<_)||!(A>0))return M;do M.push(L=new Date(+d)),c(d,A),n(d);while(L<d&&d<_);return M},l.filter=function(d){return ei(function(_){if(_>=_)for(;n(_),!d(_);)_.setTime(_-1)},function(_,A){if(_>=_)if(A<0)for(;++A<=0;)for(;c(_,-1),!d(_););else for(;--A>=0;)for(;c(_,1),!d(_););})},a&&(l.count=function(d,_){return ln.setTime(+d),wn.setTime(+_),n(ln),n(wn),Math.floor(a(ln,wn))},l.every=function(d){return d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?l.filter(s?function(_){return s(_)%d==0}:function(_){return l.count(0,_)%d==0}):l}),l}var jn=ei(function(n){n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,c){n.setFullYear(n.getFullYear()+c)},function(n,c){return c.getFullYear()-n.getFullYear()},function(n){return n.getFullYear()});jn.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:ei(function(c){c.setFullYear(Math.floor(c.getFullYear()/n)*n),c.setMonth(0,1),c.setHours(0,0,0,0)},function(c,a){c.setFullYear(c.getFullYear()+a*n)})};var ci=jn,$n=jn.range,oa=ei(function(n){n.setDate(1),n.setHours(0,0,0,0)},function(n,c){n.setMonth(n.getMonth()+c)},function(n,c){return c.getMonth()-n.getMonth()+(c.getFullYear()-n.getFullYear())*12},function(n){return n.getMonth()}),Ri=oa,si=oa.range,ua=1e3,Wi=6e4,wa=36e5,vi=864e5,Da=6048e5;function $a(n){return ei(function(c){c.setDate(c.getDate()-(c.getDay()+7-n)%7),c.setHours(0,0,0,0)},function(c,a){c.setDate(c.getDate()+a*7)},function(c,a){return(a-c-(a.getTimezoneOffset()-c.getTimezoneOffset())*Wi)/Da})}var zo=$a(0),Eo=$a(1),Ro=$a(2),$o=$a(3),Vo=$a(4),Ds=$a(5),hu=$a(6),Ws=zo.range,Eu=Eo.range,vs=Ro.range,Xs=$o.range,Sa=Vo.range,mo=Ds.range,io=hu.range,Ta=ei(function(n){n.setHours(0,0,0,0)},function(n,c){n.setDate(n.getDate()+c)},function(n,c){return(c-n-(c.getTimezoneOffset()-n.getTimezoneOffset())*Wi)/vi},function(n){return n.getDate()-1}),iu=Ta,pu=Ta.range,_o=ei(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*ua-n.getMinutes()*Wi)},function(n,c){n.setTime(+n+c*wa)},function(n,c){return(c-n)/wa},function(n){return n.getHours()}),ms=_o,du=_o.range,ka=ei(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*ua)},function(n,c){n.setTime(+n+c*Wi)},function(n,c){return(c-n)/Wi},function(n){return n.getMinutes()}),Mc=ka,Dl=ka.range,fc=ei(function(n){n.setTime(n-n.getMilliseconds())},function(n,c){n.setTime(+n+c*ua)},function(n,c){return(c-n)/ua},function(n){return n.getUTCSeconds()}),ns=fc,jc=fc.range,$u=ei(function(){},function(n,c){n.setTime(+n+c)},function(n,c){return c-n});$u.every=function(n){return n=Math.floor(n),!isFinite(n)||!(n>0)?null:n>1?ei(function(c){c.setTime(Math.floor(c/n)*n)},function(c,a){c.setTime(+c+a*n)},function(c,a){return(a-c)/n}):$u};var Yf=$u,Kf=$u.range;function Kl(n){return ei(function(c){c.setUTCDate(c.getUTCDate()-(c.getUTCDay()+7-n)%7),c.setUTCHours(0,0,0,0)},function(c,a){c.setUTCDate(c.getUTCDate()+a*7)},function(c,a){return(a-c)/Da})}var Ic=Kl(0),Vc=Kl(1),Xh=Kl(2),$f=Kl(3),Oc=Kl(4),Yh=Kl(5),Kh=Kl(6),cf=Ic.range,$h=Vc.range,Sh=Xh.range,Af=$f.range,Eh=Oc.range,Sp=Yh.range,Ep=Kh.range,Jf=ei(function(n){n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCDate(n.getUTCDate()+c)},function(n,c){return(c-n)/vi},function(n){return n.getUTCDate()-1}),Qf=Jf,Cp=Jf.range,Tf=ei(function(n){n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCFullYear(n.getUTCFullYear()+c)},function(n,c){return c.getUTCFullYear()-n.getUTCFullYear()},function(n){return n.getUTCFullYear()});Tf.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:ei(function(c){c.setUTCFullYear(Math.floor(c.getUTCFullYear()/n)*n),c.setUTCMonth(0,1),c.setUTCHours(0,0,0,0)},function(c,a){c.setUTCFullYear(c.getUTCFullYear()+a*n)})};var Gc=Tf,Jh=Tf.range;function qf(n){if(0<=n.y&&n.y<100){var c=new Date(-1,n.m,n.d,n.H,n.M,n.S,n.L);return c.setFullYear(n.y),c}return new Date(n.y,n.m,n.d,n.H,n.M,n.S,n.L)}function ff(n){if(0<=n.y&&n.y<100){var c=new Date(Date.UTC(-1,n.m,n.d,n.H,n.M,n.S,n.L));return c.setUTCFullYear(n.y),c}return new Date(Date.UTC(n.y,n.m,n.d,n.H,n.M,n.S,n.L))}function hf(n,c,a){return{y:n,m:c,d:a,H:0,M:0,S:0,L:0}}function eh(n){var c=n.dateTime,a=n.date,s=n.time,l=n.periods,d=n.days,_=n.shortDays,A=n.months,M=n.shortMonths,L=Pf(l),$=nh(l),H=Pf(d),ge=nh(d),Be=Pf(_),vt=nh(_),kt=Pf(A),yr=nh(A),wr=Pf(M),jr=nh(M),gn={a:op,A:sp,b:Yc,B:Yy,c:null,d:Pp,e:Pp,f:ed,g:id,G:Mp,H:Qp,I:qp,j:vl,L:Th,m:Lc,M:Md,p:Ky,q:$y,Q:hd,s:pd,S:td,u:Mf,U:ah,V:oh,w:sh,W:rd,x:null,X:null,y:nd,Y:ad,Z:Ip,"%":fd},Sn={a:Jy,A:Qy,b:qy,B:eg,c:null,d:Rc,e:Rc,f:Dp,g:Ld,G:Dd,H:od,I:Op,j:Lp,L:Rp,m:sd,M:ud,p:tg,q:rg,Q:hd,s:pd,S:kp,u:ld,U:Ph,V:rp,w:Id,W:cd,x:null,X:null,y:Od,Y:Rd,Z:kd,"%":fd},zn={a:_a,A:gi,b:Pa,B:Ua,c:au,d:pc,e:pc,f:Kp,g:Hc,G:Xp,H:ih,I:ih,j:qh,L:Tp,m:Qh,M:ep,p:ta,q:Yp,Q:$p,s:Jp,S:tp,u:Pd,U:wh,V:is,w:wp,W:hc,x:Lf,X:ap,y:Hc,Y:Xp,Z:Ap,"%":Ah};gn.x=ti(a,gn),gn.X=ti(s,gn),gn.c=ti(c,gn),Sn.x=ti(a,Sn),Sn.X=ti(s,Sn),Sn.c=ti(c,Sn);function ti(Ni,oo){return function(Co){var Jn=[],$l=-1,gs=0,dc=Ni.length,vc,Lh,Sm;for(Co instanceof Date||(Co=new Date(+Co));++$l<dc;)Ni.charCodeAt($l)===37&&(Jn.push(Ni.slice(gs,$l)),(Lh=th[vc=Ni.charAt(++$l)])!=null?vc=Ni.charAt(++$l):Lh=vc==="e"?" ":"0",(Sm=oo[vc])&&(vc=Sm(Co,Lh)),Jn.push(vc),gs=$l+1);return Jn.push(Ni.slice(gs,$l)),Jn.join("")}}function ii(Ni,oo){return function(Co){var Jn=hf(1900,void 0,1),$l=Si(Jn,Ni,Co+="",0),gs,dc;if($l!=Co.length)return null;if("Q"in Jn)return new Date(Jn.Q);if("s"in Jn)return new Date(Jn.s*1e3+("L"in Jn?Jn.L:0));if(oo&&!("Z"in Jn)&&(Jn.Z=0),"p"in Jn&&(Jn.H=Jn.H%12+Jn.p*12),Jn.m===void 0&&(Jn.m="q"in Jn?Jn.q:0),"V"in Jn){if(Jn.V<1||Jn.V>53)return null;"w"in Jn||(Jn.w=1),"Z"in Jn?(gs=ff(hf(Jn.y,0,1)),dc=gs.getUTCDay(),gs=dc>4||dc===0?Vc.ceil(gs):Vc(gs),gs=Qf.offset(gs,(Jn.V-1)*7),Jn.y=gs.getUTCFullYear(),Jn.m=gs.getUTCMonth(),Jn.d=gs.getUTCDate()+(Jn.w+6)%7):(gs=qf(hf(Jn.y,0,1)),dc=gs.getDay(),gs=dc>4||dc===0?Eo.ceil(gs):Eo(gs),gs=iu.offset(gs,(Jn.V-1)*7),Jn.y=gs.getFullYear(),Jn.m=gs.getMonth(),Jn.d=gs.getDate()+(Jn.w+6)%7)}else("W"in Jn||"U"in Jn)&&("w"in Jn||(Jn.w="u"in Jn?Jn.u%7:"W"in Jn?1:0),dc="Z"in Jn?ff(hf(Jn.y,0,1)).getUTCDay():qf(hf(Jn.y,0,1)).getDay(),Jn.m=0,Jn.d="W"in Jn?(Jn.w+6)%7+Jn.W*7-(dc+5)%7:Jn.w+Jn.U*7-(dc+6)%7);return"Z"in Jn?(Jn.H+=Jn.Z/100|0,Jn.M+=Jn.Z%100,ff(Jn)):qf(Jn)}}function Si(Ni,oo,Co,Jn){for(var $l=0,gs=oo.length,dc=Co.length,vc,Lh;$l<gs;){if(Jn>=dc)return-1;if(vc=oo.charCodeAt($l++),vc===37){if(vc=oo.charAt($l++),Lh=zn[vc in th?oo.charAt($l++):vc],!Lh||(Jn=Lh(Ni,Co,Jn))<0)return-1}else if(vc!=Co.charCodeAt(Jn++))return-1}return Jn}function ta(Ni,oo,Co){var Jn=L.exec(oo.slice(Co));return Jn?(Ni.p=$[Jn[0].toLowerCase()],Co+Jn[0].length):-1}function _a(Ni,oo,Co){var Jn=Be.exec(oo.slice(Co));return Jn?(Ni.w=vt[Jn[0].toLowerCase()],Co+Jn[0].length):-1}function gi(Ni,oo,Co){var Jn=H.exec(oo.slice(Co));return Jn?(Ni.w=ge[Jn[0].toLowerCase()],Co+Jn[0].length):-1}function Pa(Ni,oo,Co){var Jn=wr.exec(oo.slice(Co));return Jn?(Ni.m=jr[Jn[0].toLowerCase()],Co+Jn[0].length):-1}function Ua(Ni,oo,Co){var Jn=kt.exec(oo.slice(Co));return Jn?(Ni.m=yr[Jn[0].toLowerCase()],Co+Jn[0].length):-1}function au(Ni,oo,Co){return Si(Ni,c,oo,Co)}function Lf(Ni,oo,Co){return Si(Ni,a,oo,Co)}function ap(Ni,oo,Co){return Si(Ni,s,oo,Co)}function op(Ni){return _[Ni.getDay()]}function sp(Ni){return d[Ni.getDay()]}function Yc(Ni){return M[Ni.getMonth()]}function Yy(Ni){return A[Ni.getMonth()]}function Ky(Ni){return l[+(Ni.getHours()>=12)]}function $y(Ni){return 1+~~(Ni.getMonth()/3)}function Jy(Ni){return _[Ni.getUTCDay()]}function Qy(Ni){return d[Ni.getUTCDay()]}function qy(Ni){return M[Ni.getUTCMonth()]}function eg(Ni){return A[Ni.getUTCMonth()]}function tg(Ni){return l[+(Ni.getUTCHours()>=12)]}function rg(Ni){return 1+~~(Ni.getUTCMonth()/3)}return{format:function(Ni){var oo=ti(Ni+="",gn);return oo.toString=function(){return Ni},oo},parse:function(Ni){var oo=ii(Ni+="",!1);return oo.toString=function(){return Ni},oo},utcFormat:function(Ni){var oo=ti(Ni+="",Sn);return oo.toString=function(){return Ni},oo},utcParse:function(Ni){var oo=ii(Ni+="",!0);return oo.toString=function(){return Ni},oo}}}var th={"-":"",_:" ","0":"0"},ys=/^\s*\d+/,Ch=/^%/,rh=/[\\^$*+?|[\]().{}]/g;function ao(n,c,a){var s=n<0?"-":"",l=(s?-n:n)+"",d=l.length;return s+(d<a?new Array(a-d+1).join(c)+l:l)}function Wp(n){return n.replace(rh,"\\$&")}function Pf(n){return new RegExp("^(?:"+n.map(Wp).join("|")+")","i")}function nh(n){for(var c={},a=-1,s=n.length;++a<s;)c[n[a].toLowerCase()]=a;return c}function wp(n,c,a){var s=ys.exec(c.slice(a,a+1));return s?(n.w=+s[0],a+s[0].length):-1}function Pd(n,c,a){var s=ys.exec(c.slice(a,a+1));return s?(n.u=+s[0],a+s[0].length):-1}function wh(n,c,a){var s=ys.exec(c.slice(a,a+2));return s?(n.U=+s[0],a+s[0].length):-1}function is(n,c,a){var s=ys.exec(c.slice(a,a+2));return s?(n.V=+s[0],a+s[0].length):-1}function hc(n,c,a){var s=ys.exec(c.slice(a,a+2));return s?(n.W=+s[0],a+s[0].length):-1}function Xp(n,c,a){var s=ys.exec(c.slice(a,a+4));return s?(n.y=+s[0],a+s[0].length):-1}function Hc(n,c,a){var s=ys.exec(c.slice(a,a+2));return s?(n.y=+s[0]+(+s[0]>68?1900:2e3),a+s[0].length):-1}function Ap(n,c,a){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(c.slice(a,a+6));return s?(n.Z=s[1]?0:-(s[2]+(s[3]||"00")),a+s[0].length):-1}function Yp(n,c,a){var s=ys.exec(c.slice(a,a+1));return s?(n.q=s[0]*3-3,a+s[0].length):-1}function Qh(n,c,a){var s=ys.exec(c.slice(a,a+2));return s?(n.m=s[0]-1,a+s[0].length):-1}function pc(n,c,a){var s=ys.exec(c.slice(a,a+2));return s?(n.d=+s[0],a+s[0].length):-1}function qh(n,c,a){var s=ys.exec(c.slice(a,a+3));return s?(n.m=0,n.d=+s[0],a+s[0].length):-1}function ih(n,c,a){var s=ys.exec(c.slice(a,a+2));return s?(n.H=+s[0],a+s[0].length):-1}function ep(n,c,a){var s=ys.exec(c.slice(a,a+2));return s?(n.M=+s[0],a+s[0].length):-1}function tp(n,c,a){var s=ys.exec(c.slice(a,a+2));return s?(n.S=+s[0],a+s[0].length):-1}function Tp(n,c,a){var s=ys.exec(c.slice(a,a+3));return s?(n.L=+s[0],a+s[0].length):-1}function Kp(n,c,a){var s=ys.exec(c.slice(a,a+6));return s?(n.L=Math.floor(s[0]/1e3),a+s[0].length):-1}function Ah(n,c,a){var s=Ch.exec(c.slice(a,a+1));return s?a+s[0].length:-1}function $p(n,c,a){var s=ys.exec(c.slice(a));return s?(n.Q=+s[0],a+s[0].length):-1}function Jp(n,c,a){var s=ys.exec(c.slice(a));return s?(n.s=+s[0],a+s[0].length):-1}function Pp(n,c){return ao(n.getDate(),c,2)}function Qp(n,c){return ao(n.getHours(),c,2)}function qp(n,c){return ao(n.getHours()%12||12,c,2)}function vl(n,c){return ao(1+iu.count(ci(n),n),c,3)}function Th(n,c){return ao(n.getMilliseconds(),c,3)}function ed(n,c){return Th(n,c)+"000"}function Lc(n,c){return ao(n.getMonth()+1,c,2)}function Md(n,c){return ao(n.getMinutes(),c,2)}function td(n,c){return ao(n.getSeconds(),c,2)}function Mf(n){var c=n.getDay();return c===0?7:c}function ah(n,c){return ao(zo.count(ci(n)-1,n),c,2)}function If(n){var c=n.getDay();return c>=4||c===0?Vo(n):Vo.ceil(n)}function oh(n,c){return n=If(n),ao(Vo.count(ci(n),n)+(ci(n).getDay()===4),c,2)}function sh(n){return n.getDay()}function rd(n,c){return ao(Eo.count(ci(n)-1,n),c,2)}function nd(n,c){return ao(n.getFullYear()%100,c,2)}function id(n,c){return n=If(n),ao(n.getFullYear()%100,c,2)}function ad(n,c){return ao(n.getFullYear()%1e4,c,4)}function Mp(n,c){var a=n.getDay();return n=a>=4||a===0?Vo(n):Vo.ceil(n),ao(n.getFullYear()%1e4,c,4)}function Ip(n){var c=n.getTimezoneOffset();return(c>0?"-":(c*=-1,"+"))+ao(c/60|0,"0",2)+ao(c%60,"0",2)}function Rc(n,c){return ao(n.getUTCDate(),c,2)}function od(n,c){return ao(n.getUTCHours(),c,2)}function Op(n,c){return ao(n.getUTCHours()%12||12,c,2)}function Lp(n,c){return ao(1+Qf.count(Gc(n),n),c,3)}function Rp(n,c){return ao(n.getUTCMilliseconds(),c,3)}function Dp(n,c){return Rp(n,c)+"000"}function sd(n,c){return ao(n.getUTCMonth()+1,c,2)}function ud(n,c){return ao(n.getUTCMinutes(),c,2)}function kp(n,c){return ao(n.getUTCSeconds(),c,2)}function ld(n){var c=n.getUTCDay();return c===0?7:c}function Ph(n,c){return ao(Ic.count(Gc(n)-1,n),c,2)}function Fp(n){var c=n.getUTCDay();return c>=4||c===0?Oc(n):Oc.ceil(n)}function rp(n,c){return n=Fp(n),ao(Oc.count(Gc(n),n)+(Gc(n).getUTCDay()===4),c,2)}function Id(n){return n.getUTCDay()}function cd(n,c){return ao(Vc.count(Gc(n)-1,n),c,2)}function Od(n,c){return ao(n.getUTCFullYear()%100,c,2)}function Ld(n,c){return n=Fp(n),ao(n.getUTCFullYear()%100,c,2)}function Rd(n,c){return ao(n.getUTCFullYear()%1e4,c,4)}function Dd(n,c){var a=n.getUTCDay();return n=a>=4||a===0?Oc(n):Oc.ceil(n),ao(n.getUTCFullYear()%1e4,c,4)}function kd(){return"+0000"}function fd(){return"%"}function hd(n){return+n}function pd(n){return Math.floor(+n/1e3)}var Ju,Mh,dd,Ih,vd;Em({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Em(n){return Ju=eh(n),Mh=Ju.format,dd=Ju.parse,Ih=Ju.utcFormat,vd=Ju.utcParse,Ju}var Bp=1e3,Np=Bp*60,zp=Np*60,Zp=zp*24,Cm=Zp*7,Hd=Zp*30,Fd=Zp*365;function wm(n){return new Date(n)}function Am(n){return n instanceof Date?+n:+new Date(+n)}function Wd(n,c,a,s,l,d,_,A,M){var L=qn(on,on),$=L.invert,H=L.domain,ge=M(".%L"),Be=M(":%S"),vt=M("%I:%M"),kt=M("%I %p"),yr=M("%a %d"),wr=M("%b %d"),jr=M("%B"),gn=M("%Y"),Sn=[[_,1,Bp],[_,5,5*Bp],[_,15,15*Bp],[_,30,30*Bp],[d,1,Np],[d,5,5*Np],[d,15,15*Np],[d,30,30*Np],[l,1,zp],[l,3,3*zp],[l,6,6*zp],[l,12,12*zp],[s,1,Zp],[s,2,2*Zp],[a,1,Cm],[c,1,Hd],[c,3,3*Hd],[n,1,Fd]];function zn(ii){return(_(ii)<ii?ge:d(ii)<ii?Be:l(ii)<ii?vt:s(ii)<ii?kt:c(ii)<ii?a(ii)<ii?yr:wr:n(ii)<ii?jr:gn)(ii)}function ti(ii,Si,ta,_a){if(ii==null&&(ii=10),typeof ii=="number"){var gi=Math.abs(ta-Si)/ii,Pa=Mn(function(Ua){return Ua[2]}).right(Sn,gi);Pa===Sn.length?(_a=Uo(Si/Fd,ta/Fd,ii),ii=n):Pa?(Pa=Sn[gi/Sn[Pa-1][2]<Sn[Pa][2]/gi?Pa-1:Pa],_a=Pa[1],ii=Pa[0]):(_a=Math.max(Uo(Si,ta,ii),1),ii=A)}return _a==null?ii:ii.every(_a)}return L.invert=function(ii){return new Date($(ii))},L.domain=function(ii){return arguments.length?H(Fe.call(ii,Am)):H().map(wm)},L.ticks=function(ii,Si){var ta=H(),_a=ta[0],gi=ta[ta.length-1],Pa=gi<_a,Ua;return Pa&&(Ua=_a,_a=gi,gi=Ua),Ua=ti(ii,_a,gi,Si),Ua=Ua?Ua.range(_a,gi+1):[],Pa?Ua.reverse():Ua},L.tickFormat=function(ii,Si){return Si==null?zn:M(Si)},L.nice=function(ii,Si){var ta=H();return(ii=ti(ii,ta[0],ta[ta.length-1],Si))?H(bp(ta,ii)):L},L.copy=function(){return Yn(L,Wd(n,c,a,s,l,d,_,A,M))},L}function Tm(){return tt.apply(Wd(ci,Ri,zo,iu,ms,Mc,ns,Yf,Mh).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function ng(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function md(){var n=0,c=1,a,s,l,d,_=identity,A=!1,M;function L($){return isNaN($=+$)?M:_(l===0?.5:($=(d($)-a)*l,A?Math.max(0,Math.min(1,$)):$))}return L.domain=function($){return arguments.length?(a=d(n=+$[0]),s=d(c=+$[1]),l=a===s?0:1/(s-a),L):[n,c]},L.clamp=function($){return arguments.length?(A=!!$,L):A},L.interpolator=function($){return arguments.length?(_=$,L):_},L.unknown=function($){return arguments.length?(M=$,L):M},function($){return d=$,a=$(n),s=$(c),l=a===s?0:1/(s-a),L}}function yd(n,c){return c.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function Pm(){var n=linearish(md()(identity));return n.copy=function(){return yd(n,Pm())},initInterpolator.apply(n,arguments)}function Mm(){var n=loggish(md()).domain([1,10]);return n.copy=function(){return yd(n,Mm()).base(n.base())},initInterpolator.apply(n,arguments)}function Im(){var n=symlogish(md());return n.copy=function(){return yd(n,Im()).constant(n.constant())},initInterpolator.apply(n,arguments)}function Xd(){var n=powish(md());return n.copy=function(){return yd(n,Xd()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function ig(){return Xd.apply(null,arguments).exponent(.5)}function Om(){var n=[],c=identity;function a(s){if(!isNaN(s=+s))return c((bisect(n,s)-1)/(n.length-1))}return a.domain=function(s){if(!arguments.length)return n.slice();n=[];for(var l=0,d=s.length,_;l<d;++l)_=s[l],_!=null&&!isNaN(_=+_)&&n.push(_);return n.sort(ascending),a},a.interpolator=function(s){return arguments.length?(c=s,a):c},a.copy=function(){return Om(c).domain(n)},initInterpolator.apply(a,arguments)}function gd(){var n=0,c=.5,a=1,s,l,d,_,A,M=identity,L,$=!1,H;function ge(Be){return isNaN(Be=+Be)?H:(Be=.5+((Be=+L(Be))-l)*(Be<l?_:A),M($?Math.max(0,Math.min(1,Be)):Be))}return ge.domain=function(Be){return arguments.length?(s=L(n=+Be[0]),l=L(c=+Be[1]),d=L(a=+Be[2]),_=s===l?0:.5/(l-s),A=l===d?0:.5/(d-l),ge):[n,c,a]},ge.clamp=function(Be){return arguments.length?($=!!Be,ge):$},ge.interpolator=function(Be){return arguments.length?(M=Be,ge):M},ge.unknown=function(Be){return arguments.length?(H=Be,ge):H},function(Be){return L=Be,s=Be(n),l=Be(c),d=Be(a),_=s===l?0:.5/(l-s),A=l===d?0:.5/(d-l),ge}}function Lm(){var n=linearish(gd()(identity));return n.copy=function(){return copy(n,Lm())},initInterpolator.apply(n,arguments)}function Rm(){var n=loggish(gd()).domain([.1,1,10]);return n.copy=function(){return copy(n,Rm()).base(n.base())},initInterpolator.apply(n,arguments)}function Dm(){var n=symlogish(gd());return n.copy=function(){return copy(n,Dm()).constant(n.constant())},initInterpolator.apply(n,arguments)}function Yd(){var n=powish(gd());return n.copy=function(){return copy(n,Yd()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function ag(){return Yd.apply(null,arguments).exponent(.5)}var Wc,Kd,$d,Jd,Bd,Qd,km=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Fm=(Wc={},(0,j.Z)(Wc,O.ScaleTypes.LINEAR,Rs),(0,j.Z)(Wc,O.ScaleTypes.POWER,Dt),(0,j.Z)(Wc,O.ScaleTypes.LOG,U),(0,j.Z)(Wc,O.ScaleTypes.IDENTITY,Uc),(0,j.Z)(Wc,O.ScaleTypes.TIME,Tm),(0,j.Z)(Wc,O.ScaleTypes.QUANTILE,mr),(0,j.Z)(Wc,O.ScaleTypes.QUANTIZE,xr),(0,j.Z)(Wc,O.ScaleTypes.THRESHOLD,Nr),(0,j.Z)(Wc,O.ScaleTypes.CAT,gt),Wc),Bm=(Kd=(0,hn.b2)(),$d=(0,hn.f3)(O.vK.IGlobalConfigService),Kd(Jd=(Bd=function(){function n(){(0,vr.Z)(this,n),(0,Xa.Z)(this,"configService",Qd,this),(0,j.Z)(this,"scaleCache",{}),(0,j.Z)(this,"scaleOptions",{})}return(0,Or.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var _=d.getLayerStyleAttributes(),A=a.getSource().data.dataArray;A.length!==0&&l.caculateScalesForAttributes(_||[],A)}),a.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var _=d.getLayerStyleAttributes(),A=a.getSource().data.dataArray;return l.caculateScalesForAttributes(_||[],A),a.layerModelNeedUpdate=!0,!0}),a.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!a.layerModelNeedUpdate){l.scaleOptions=a.getScaleOptions();var _=d.getLayerStyleAttributes();if(_){var A=a.getSource().data.dataArray;if(A.length===0)return;var M=_.filter(function(L){return L.needRescale});M.length&&l.caculateScalesForAttributes(M,A)}}})}},{key:"isNumber",value:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}},{key:"caculateScalesForAttributes",value:function(a,s){var l=this;this.scaleCache={},a.forEach(function(d){if(d.scale){var _=d.scale,A=d.name;_.names=l.parseFields(d.scale.field||[]);var M=[];_.names.forEach(function(L){M.push(l.getOrCreateScale(L,d,s))}),M.some(function(L){return L.type===O.StyleScaleType.VARIABLE})?(_.type=O.StyleScaleType.VARIABLE,M.forEach(function(L){if(!_.callback){var $;if(_.values&&_.values!=="text"){var H;if(((H=L.option)===null||H===void 0?void 0:H.type)==="linear"&&_.values.length>2){var ge=L.scale.ticks(_.values.length);A==="color"&&L.scale.domain(ge)}L.scale.range(_.values)}else(($=L.option)===null||$===void 0?void 0:$.type)==="cat"&&L.scale.range(L.option.domain)}})):(_.type=O.StyleScaleType.CONSTANT,_.defaultValues=M.map(function(L,$){return L.scale(_.names[$])})),_.scalers=M.map(function(L){return{field:L.field,func:L.scale,option:L.option}}),d.needRescale=!1}})}},{key:"getOrCreateScale",value:function(a,s,l){var d,_=[a,s.name].join("_"),A=(d=s.scale)===null||d===void 0?void 0:d.values,M=this.createScale(a,s.name,A,l);return M}},{key:"parseFields",value:function(a){return Array.isArray(a)?a:B()(a)?a.split("*"):[a]}},{key:"createScale",value:function(a,s,l,d){var _,A,M=this.scaleOptions[s]&&((_=this.scaleOptions[s])===null||_===void 0?void 0:_.field)===a?this.scaleOptions[s]:this.scaleOptions[a],L={field:a,scale:void 0,type:O.StyleScaleType.VARIABLE,option:M};if(!d||!d.length)return M&&M.type?L.scale=this.createDefaultScale(M):(L.scale=gt([a]),L.type=O.StyleScaleType.CONSTANT),L;var $=(A=d.find(function(Be){return!Cn()(Be[a])}))===null||A===void 0?void 0:A[a];if(this.isNumber(a)||Cn()($)&&!M)L.scale=gt([a]),L.type=O.StyleScaleType.CONSTANT;else{var H=M&&M.type||this.getDefaultType($);l==="text"&&(H=O.ScaleTypes.CAT);var ge=this.createDefaultScaleConfig(H,a,d);Object.assign(ge,M),L.scale=this.createDefaultScale(ge),L.option=ge}return L}},{key:"getDefaultType",value:function(a){var s=O.ScaleTypes.LINEAR;return typeof a=="string"&&(s=km.test(a)?O.ScaleTypes.TIME:O.ScaleTypes.CAT),s}},{key:"createDefaultScaleConfig",value:function(a,s,l){var d={type:a},_=(l==null?void 0:l.map(function(A){return A[s]}))||[];return a!==O.ScaleTypes.CAT&&a!==O.ScaleTypes.QUANTILE?d.domain=Ti(_):a===O.ScaleTypes.CAT?d.domain=Ar()(_):a===O.ScaleTypes.QUANTILE&&(d.domain=_),d}},{key:"createDefaultScale",value:function(a){var s=a.type,l=a.domain,d=Fm[s]();return l&&d.domain(l),d}}]),n}(),Qd=(0,lo.Z)(Bd.prototype,"configService",[$d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bd))||Jd),qd,ev,tv,rv,_d,nv,iv;function av(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Nm(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?av(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):av(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var zm=(qd=(0,hn.b2)(),ev=(0,hn.f3)(O.vK.ICameraService),tv=(0,hn.f3)(O.vK.IRendererService),qd(rv=(_d=function(){function n(){(0,vr.Z)(this,n),(0,Xa.Z)(this,"cameraService",nv,this),(0,Xa.Z)(this,"rendererService",iv,this)}return(0,Or.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){a.models.forEach(function(s){s.addUniforms(Nm({},a.layerModel.getAnimateUniforms()))})})}}]),n}(),nv=(0,lo.Z)(_d.prototype,"cameraService",[ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iv=(0,lo.Z)(_d.prototype,"rendererService",[tv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d))||rv),ov,sv,Zm=(ov=(0,hn.b2)(),ov(sv=function(){function n(){(0,vr.Z)(this,n)}return(0,Or.Z)(n,[{key:"apply",value:function(a){a.hooks.init.tap("LayerModelPlugin",function(){a.prepareBuildModel(),a.buildModels(),a.styleNeedUpdate=!1}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return a.prepareBuildModel(),a.clearModels(),a.buildModels(),a.layerModelNeedUpdate=!1,!1})}}]),n}())||sv),uv,lv,Um=(uv=(0,hn.b2)(),uv(lv=function(){function n(){(0,vr.Z)(this,n)}return(0,Or.Z)(n,[{key:"apply",value:function(a){a.hooks.afterInit.tap("LayerStylePlugin",function(){a.updateLayerConfig({});var s=a.getLayerConfig(),l=s.autoFit,d=s.fitBoundsOptions;l&&setTimeout(function(){a.fitBounds(d)},100)})}}]),n}())||lv),cv,fv;function hv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Up(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?hv(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):hv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var pv={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},jm={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Vm={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Gm={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},og=null;function Hm(n){var c={u_DirectionalLights:new Array(3).fill(Up({},Vm)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Up({},Gm)),u_NumOfSpotLights:0};return(!n||!n.length)&&(n=[jm]),n.forEach(function(a,s){var l=a.type,d=l===void 0?"directional":l,_=(0,vu.Z)(a,["type"]),A=pv[d].lights,M=pv[d].num,L=c[M];c[A][L]=Up(Up({},c[A][L]),_),c[M]++}),c}var Wm=(cv=(0,hn.b2)(),cv(fv=function(){function n(){(0,vr.Z)(this,n)}return(0,Or.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LightingPlugin",function(){var s=a.getLayerConfig(),l=s.enableLighting;l&&a.models.forEach(function(d){return d.addUniforms(Up({},Hm()))})})}}]),n}())||fv),dv,vv,xd={NONE:0,ENCODE:1,HIGHLIGHT:2},Xm=(dv=(0,hn.b2)(),dv(vv=function(){function n(){(0,vr.Z)(this,n)}return(0,Or.Z)(n,[{key:"apply",value:function(a,s){var l=s.rendererService,d=s.styleAttributeService;a.hooks.init.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),A=_.enablePicking;d.registerStyleAttribute({name:"pickingColor",type:O.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:O.gl.FLOAT},size:3,update:function(L,$){var H=L.id;return A?(0,Je.Z6)(H):[0,0,0]}}})}),a.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),A=_.enablePicking;A&&a.isVisible()&&a.models.forEach(function(M){return M.addUniforms({u_PickingStage:xd.ENCODE})})}),a.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),A=_.enablePicking;A&&a.isVisible()&&a.models.forEach(function(M){return M.addUniforms({u_PickingStage:xd.HIGHLIGHT})})}),a.hooks.beforeHighlight.tap("PixelPickingPlugin",function(_){var A=a.getLayerConfig(),M=A.highlightColor,L=typeof M=="string"?(0,Je.CI)(M):M||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,Je.W0)(new Uint8Array(_))}),a.models.forEach(function($){return $.addUniforms({u_PickingStage:xd.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:L.map(function(H){return H*255})})})}),a.hooks.beforeSelect.tap("PixelPickingPlugin",function(_){var A=a.getLayerConfig(),M=A.selectColor,L=typeof M=="string"?(0,Je.CI)(M):M||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,Je.W0)(new Uint8Array(_))}),a.models.forEach(function($){return $.addUniforms({u_PickingStage:xd.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:L.map(function(H){return H*255})})})})}}]),n}())||vv),mv,yv,Ym=(mv=(0,hn.b2)(),mv(yv=function(){function n(){(0,vr.Z)(this,n)}return(0,Or.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("RegisterStyleAttributePlugin",function(){l.registerBuiltinAttributes(d)})}},{key:"registerBuiltinAttributes",value:function(a){a.registerStyleAttribute({name:"position",type:O.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:O.gl.FLOAT},size:3,update:function(l,d,_){return _.length===2?[_[0],_[1],0]:[_[0],_[1],_[2]]}}}),a.registerStyleAttribute({name:"filter",type:O.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(l,d){var _=l.filter;return _?[1]:[0]}}}),a.registerStyleAttribute({name:"color",type:O.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:4,update:function(l,d){var _=l.color;return!_||!_.length?[1,1,1,1]:_}}}),a.registerStyleAttribute({name:"vertexId",type:O.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(l,d,_,A){return[d]}}})}}]),n}())||yv),gv,_v,xv,bv,Sv,Ev,np,Cv,wv,Av,Tv,Km=(gv=(0,hn.b2)(),_v=(0,hn.f3)(O.vK.ICameraService),xv=(0,hn.f3)(O.vK.ICoordinateSystemService),bv=(0,hn.f3)(O.vK.IRendererService),Sv=(0,hn.f3)(O.vK.IMapService),gv(Ev=(np=function(){function n(){(0,vr.Z)(this,n),(0,Xa.Z)(this,"cameraService",Cv,this),(0,Xa.Z)(this,"coordinateSystemService",wv,this),(0,Xa.Z)(this,"rendererService",Av,this),(0,Xa.Z)(this,"mapService",Tv,this)}return(0,Or.Z)(n,[{key:"apply",value:function(a){var s=this,l=this.mapService.version,d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_=[0,0];a.hooks.beforeRender.tap("ShaderUniformPlugin",function(){s.coordinateSystemService.refresh(),l==="GAODE2.x"&&(d=s.mapService.map.customCoords.getMVPMatrix(),_=s.mapService.getCustomCoordCenter());var A=s.rendererService.getViewportSize(),M=A.width,L=A.height;a.models.forEach(function($){var H;$.addUniforms((H={},(0,j.Z)(H,O.CameraUniform.ProjectionMatrix,s.cameraService.getProjectionMatrix()),(0,j.Z)(H,O.CameraUniform.ViewMatrix,s.cameraService.getViewMatrix()),(0,j.Z)(H,O.CameraUniform.ViewProjectionMatrix,s.cameraService.getViewProjectionMatrix()),(0,j.Z)(H,O.CameraUniform.Zoom,s.cameraService.getZoom()),(0,j.Z)(H,O.CameraUniform.ZoomScale,s.cameraService.getZoomScale()),(0,j.Z)(H,O.CameraUniform.FocalDistance,s.cameraService.getFocalDistance()),(0,j.Z)(H,O.CameraUniform.CameraPosition,s.cameraService.getCameraPosition()),(0,j.Z)(H,O.CoordinateUniform.CoordinateSystem,s.coordinateSystemService.getCoordinateSystem()),(0,j.Z)(H,O.CoordinateUniform.ViewportCenter,s.coordinateSystemService.getViewportCenter()),(0,j.Z)(H,O.CoordinateUniform.ViewportCenterProjection,s.coordinateSystemService.getViewportCenterProjection()),(0,j.Z)(H,O.CoordinateUniform.PixelsPerDegree,s.coordinateSystemService.getPixelsPerDegree()),(0,j.Z)(H,O.CoordinateUniform.PixelsPerDegree2,s.coordinateSystemService.getPixelsPerDegree2()),(0,j.Z)(H,O.CoordinateUniform.PixelsPerMeter,s.coordinateSystemService.getPixelsPerMeter()),(0,j.Z)(H,O.CoordinateUniform.Mvp,d),(0,j.Z)(H,"u_SceneCenterMKT",_),(0,j.Z)(H,"u_ViewportSize",[M,L]),(0,j.Z)(H,"u_DevicePixelRatio",window.devicePixelRatio),(0,j.Z)(H,"u_ModelMatrix",s.cameraService.getModelMatrix()),(0,j.Z)(H,"u_PickingBuffer",a.getLayerConfig().pickingBuffer||0),H))})})}}]),n}(),Cv=(0,lo.Z)(np.prototype,"cameraService",[_v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wv=(0,lo.Z)(np.prototype,"coordinateSystemService",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Av=(0,lo.Z)(np.prototype,"rendererService",[bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tv=(0,lo.Z)(np.prototype,"mapService",[Sv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),np))||Ev),Pv,Mv,$m=(Pv=(0,hn.b2)(),Pv(Mv=function(){function n(){(0,vr.Z)(this,n)}return(0,Or.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("UpdateModelPlugin",function(){a.layerModel&&a.layerModel.needUpdate()})}}]),n}())||Mv),Iv,Ov,Jm=(Iv=(0,hn.b2)(),Iv(Ov=function(){function n(){(0,vr.Z)(this,n)}return(0,Or.Z)(n,[{key:"apply",value:function(a,s){var l=this,d=s.styleAttributeService;a.hooks.init.tap("UpdateStyleAttributePlugin",function(){l.initStyleAttribute(a,{styleAttributeService:d})}),a.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){a.layerModelNeedUpdate||l.updateStyleAtrribute(a,{styleAttributeService:d})})}},{key:"updateStyleAtrribute",value:function(a,s){var l=s.styleAttributeService,d=l.getLayerStyleAttributes()||[],_=l.getLayerStyleAttribute("filter"),A=l.getLayerStyleAttribute("shape");if(_&&_.needRegenerateVertices||A&&A.needRegenerateVertices){a.layerModelNeedUpdate=!0,d.forEach(function(M){return M.needRegenerateVertices=!1});return}d.filter(function(M){return M.needRegenerateVertices}).forEach(function(M){l.updateAttributeByFeatureRange(M.name,a.getEncodedData(),M.featureRange.startIndex,M.featureRange.endIndex),M.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(a,s){var l=s.styleAttributeService,d=l.getLayerStyleAttributes()||[];d.filter(function(_){return _.needRegenerateVertices}).forEach(function(_){l.updateAttributeByFeatureRange(_.name,a.getEncodedData(),_.featureRange.startIndex,_.featureRange.endIndex),_.needRegenerateVertices=!1})}}]),n}())||Ov);O.nC.bind(O.vK.ILayerPlugin).to(pi).inRequestScope(),O.nC.bind(O.vK.ILayerPlugin).to(Ym).inRequestScope(),O.nC.bind(O.vK.ILayerPlugin).to(Bm).inRequestScope(),O.nC.bind(O.vK.ILayerPlugin).to(Dr).inRequestScope(),O.nC.bind(O.vK.ILayerPlugin).to(Um).inRequestScope(),O.nC.bind(O.vK.ILayerPlugin).to(Jm).inRequestScope(),O.nC.bind(O.vK.ILayerPlugin).to($m).inRequestScope(),O.nC.bind(O.vK.ILayerPlugin).to(zl).inRequestScope(),O.nC.bind(O.vK.ILayerPlugin).to(Km).inRequestScope(),O.nC.bind(O.vK.ILayerPlugin).to(zm).inRequestScope(),O.nC.bind(O.vK.ILayerPlugin).to(Wm).inRequestScope(),O.nC.bind(O.vK.ILayerPlugin).to(Xm).inRequestScope(),O.nC.bind(O.vK.ILayerPlugin).to(Zm).inRequestScope();var sg="2.5.35";function Lv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ug(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Lv(Object(a),!0).forEach(function(s){Qm(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Lv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Qm(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function lg(n,c){return r0(n)||t0(n,c)||e0(n,c)||qm()}function qm(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e0(n,c){if(!!n){if(typeof n=="string")return Rv(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Rv(n,c)}}function Rv(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function t0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,A;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function r0(n){if(Array.isArray(n))return n}var cg=null,fg=null,Dv,Nd,kv;function Fv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Bv(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Fv(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Fv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var n0=(Dv=(0,O.yT)(O.vK.IGlobalConfigService),Nd=function(){function n(c){(0,vr.Z)(this,n),(0,Xa.Z)(this,"configService",kv,this),(0,j.Z)(this,"config",void 0),this.config=c}return(0,Or.Z)(n,[{key:"setContainer",value:function(a,s){a.bind(O.vK.MapConfig).toConstantValue(Bv(Bv({},this.config),{},{id:s})),a.bind(O.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),n}(),kv=(0,lo.Z)(Nd.prototype,"configService",[Dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nd),i0=b(84105),a0=b.n(i0),zd;(function(n){n["GAODE1.x"]="GAODE1.x",n["GAODE2.x"]="GAODE2.x",n.MAPBOX="MAPBOX",n.L7MAP="L7MAP",n.GLOBEL="GLOBEL"})(zd||(zd={}));function jp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function bd(n,c){var a=uc.fF([],c,n);return uc.bA(a,a,1/a[3]),a}function hg(n,c){var a=n%c;return a<0?c+a:a}function pg(n,c,a){return a*c+(1-a)*n}function Oh(n,c){if(!n)throw new Error(c||"viewport-mercator-project: assertion failed.")}var Xc=Math.PI,Nv=Xc/4,Of=Xc/180,zv=180/Xc,Zd=512,Ud=4003e4,o0=1.5;function Zv(n){return Math.pow(2,n)}function s0(n){return Math.log2(n)}function Sd(n,c){var a=(0,Ji.Z)(n,2),s=a[0],l=a[1];Oh(Number.isFinite(s)&&Number.isFinite(c)),Oh(Number.isFinite(l)&&l>=-90&&l<=90,"invalid latitude"),c*=Zd;var d=s*Of,_=l*Of,A=c*(d+Xc)/(2*Xc),M=c*(Xc-Math.log(Math.tan(Nv+_*.5)))/(2*Xc);return[A,M]}function jd(n,c){var a=(0,Ji.Z)(n,2),s=a[0],l=a[1];c*=Zd;var d=s/c*(2*Xc)-Xc,_=2*(Math.atan(Math.exp(Xc-l/c*(2*Xc)))-Nv);return[d*zv,_*zv]}function dg(n){var c=n.latitude;assert(Number.isFinite(c));var a=Math.cos(c*Of);return s0(Ud*a)-9}function Uv(n){var c=n.latitude,a=n.longitude,s=n.zoom,l=n.scale,d=n.highPrecision,_=d===void 0?!1:d;l=l!==void 0?l:Zv(s),Oh(Number.isFinite(c)&&Number.isFinite(a)&&Number.isFinite(l));var A={},M=Zd*l,L=Math.cos(c*Of),$=M/360,H=$/L,ge=M/Ud/L;if(A.pixelsPerMeter=[ge,-ge,ge],A.metersPerPixel=[1/ge,-1/ge,1/ge],A.pixelsPerDegree=[$,-H,ge],A.degreesPerPixel=[1/$,-1/H,1/ge],_){var Be=Of*Math.tan(c*Of)/L,vt=$*Be/2,kt=M/Ud*Be,yr=kt/H*ge;A.pixelsPerDegree2=[0,-vt,kt],A.pixelsPerMeter2=[yr,0,yr]}return A}function vg(n,c){var a=_slicedToArray(n,3),s=a[0],l=a[1],d=a[2],_=_slicedToArray(c,3),A=_[0],M=_[1],L=_[2],$=1,H=Uv({longitude:s,latitude:l,scale:$,highPrecision:!0}),ge=H.pixelsPerMeter,Be=H.pixelsPerMeter2,vt=Sd(n,$);vt[0]+=A*(ge[0]+Be[0]*M),vt[1]+=M*(ge[1]+Be[1]*M);var kt=jd(vt,$),yr=(d||0)+(L||0);return Number.isFinite(d)||Number.isFinite(L)?[kt[0],kt[1],yr]:kt}function u0(n){var c=n.height,a=n.pitch,s=n.bearing,l=n.altitude,d=n.center,_=d===void 0?null:d,A=n.flipY,M=A===void 0?!1:A,L=jp();return dn.translate(L,L,[0,0,-l]),dn.scale(L,L,[1,1,1/c]),dn.rotateX(L,L,-a*Of),dn.rotateZ(L,L,s*Of),M&&dn.scale(L,L,[1,-1,1]),_&&dn.translate(L,L,ji.negate([],_)),L}function l0(n){var c=n.width,a=n.height,s=n.altitude,l=s===void 0?o0:s,d=n.pitch,_=d===void 0?0:d,A=n.nearZMultiplier,M=A===void 0?1:A,L=n.farZMultiplier,$=L===void 0?1:L,H=_*Of,ge=Math.atan(.5/l),Be=Math.sin(ge)*l/Math.sin(Math.PI/2-H-ge),vt=Math.cos(Math.PI/2-H)*Be+l;return{fov:2*Math.atan(a/2/l),aspect:c/a,focalDistance:l,near:M,far:vt*$}}function c0(n){var c=n.width,a=n.height,s=n.pitch,l=n.altitude,d=n.nearZMultiplier,_=n.farZMultiplier,A=l0({width:c,height:a,altitude:l,pitch:s,nearZMultiplier:d,farZMultiplier:_}),M=A.fov,L=A.aspect,$=A.near,H=A.far,ge=dn.perspective([],M,L,$,H);return ge}function f0(n,c){var a=(0,Ji.Z)(n,3),s=a[0],l=a[1],d=a[2],_=d===void 0?0:d;return Oh(Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(_)),bd(c,[s,l,_,1])}function jv(n,c){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=(0,Ji.Z)(n,3),l=s[0],d=s[1],_=s[2];if(Oh(Number.isFinite(l)&&Number.isFinite(d),"invalid pixel coordinate"),Number.isFinite(_)){var A=bd(c,[l,d,_,1]);return A}var M=bd(c,[l,d,0,1]),L=bd(c,[l,d,1,1]),$=M[2],H=L[2],ge=$===H?0:((a||0)-$)/(H-$);return xi.lerp([],M,L,ge)}var Vv=jp(),h0=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=c.width,s=c.height,l=c.viewMatrix,d=l===void 0?Vv:l,_=c.projectionMatrix,A=_===void 0?Vv:_;(0,vr.Z)(this,n),this.width=a||1,this.height=s||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=d,this.projectionMatrix=A;var M=jp();dn.multiply(M,M,this.projectionMatrix),dn.multiply(M,M,this.viewMatrix),this.viewProjectionMatrix=M;var L=jp();dn.scale(L,L,[this.width/2,-this.height/2,1]),dn.translate(L,L,[1,-1,0]),dn.multiply(L,L,this.viewProjectionMatrix);var $=dn.invert(jp(),L);if(!$)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=L,this.pixelUnprojectionMatrix=$,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Or.Z)(n,[{key:"equals",value:function(a){return a instanceof n?a.width===this.width&&a.height===this.height&&dn.equals(a.projectionMatrix,this.projectionMatrix)&&dn.equals(a.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,_=this.projectPosition(a),A=f0(_,this.pixelProjectionMatrix),M=(0,Ji.Z)(A,2),L=M[0],$=M[1],H=d?$:this.height-$;return a.length===2?[L,H]:[L,H,A[2]]}},{key:"unproject",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,_=s.targetZ,A=(0,Ji.Z)(a,3),M=A[0],L=A[1],$=A[2],H=d?L:this.height-L,ge=_&&_*this.pixelsPerMeter,Be=jv([M,H,$],this.pixelUnprojectionMatrix,ge),vt=this.unprojectPosition(Be),kt=(0,Ji.Z)(vt,3),yr=kt[0],wr=kt[1],jr=kt[2];return Number.isFinite($)?[yr,wr,jr]:Number.isFinite(_)?[yr,wr,_]:[yr,wr]}},{key:"projectPosition",value:function(a){var s=this.projectFlat(a),l=(0,Ji.Z)(s,2),d=l[0],_=l[1],A=(a[2]||0)*this.pixelsPerMeter;return[d,_,A]}},{key:"unprojectPosition",value:function(a){var s=this.unprojectFlat(a),l=(0,Ji.Z)(s,2),d=l[0],_=l[1],A=(a[2]||0)/this.pixelsPerMeter;return[d,_,A]}},{key:"projectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}},{key:"unprojectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}}]),n}();function p0(n){var c=n.width,a=n.height,s=n.bounds,l=n.minExtent,d=l===void 0?0:l,_=n.maxZoom,A=_===void 0?24:_,M=n.padding,L=M===void 0?0:M,$=n.offset,H=$===void 0?[0,0]:$,ge=(0,Ji.Z)(s,2),Be=(0,Ji.Z)(ge[0],2),vt=Be[0],kt=Be[1],yr=(0,Ji.Z)(ge[1],2),wr=yr[0],jr=yr[1];if(Number.isFinite(L)){var gn=L;L={top:gn,bottom:gn,left:gn,right:gn}}else Oh(Number.isFinite(L.top)&&Number.isFinite(L.bottom)&&Number.isFinite(L.left)&&Number.isFinite(L.right));var Sn=new Gv({width:c,height:a,longitude:0,latitude:0,zoom:0}),zn=Sn.project([vt,jr]),ti=Sn.project([wr,kt]),ii=[Math.max(Math.abs(ti[0]-zn[0]),d),Math.max(Math.abs(ti[1]-zn[1]),d)],Si=[c-L.left-L.right-Math.abs(H[0])*2,a-L.top-L.bottom-Math.abs(H[1])*2];Oh(Si[0]>0&&Si[1]>0);var ta=Si[0]/ii[0],_a=Si[1]/ii[1],gi=(L.right-L.left)/2/ta,Pa=(L.bottom-L.top)/2/_a,Ua=[(ti[0]+zn[0])/2+gi,(ti[1]+zn[1])/2+Pa],au=Sn.unproject(Ua),Lf=Sn.zoom+Math.log2(Math.abs(Math.min(ta,_a)));return{longitude:au[0],latitude:au[1],zoom:Math.min(Lf,A)}}var Gv=function(n){(0,Kn.Z)(c,n);function c(){var a,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.width,d=s.height,_=s.latitude,A=_===void 0?0:_,M=s.longitude,L=M===void 0?0:M,$=s.zoom,H=$===void 0?0:$,ge=s.pitch,Be=ge===void 0?0:ge,vt=s.bearing,kt=vt===void 0?0:vt,yr=s.altitude,wr=yr===void 0?1.5:yr,jr=s.nearZMultiplier,gn=s.farZMultiplier;(0,vr.Z)(this,c),l=l||1,d=d||1;var Sn=Zv(H);wr=Math.max(.75,wr);var zn=Sd([L,A],Sn);zn[2]=0;var ti=c0({width:l,height:d,pitch:Be,bearing:kt,altitude:wr,nearZMultiplier:jr||1/d,farZMultiplier:gn||1.01}),ii=u0({height:d,center:zn,pitch:Be,bearing:kt,altitude:wr,flipY:!0});return a=(0,Ln.Z)(this,(0,zr.Z)(c).call(this,{width:l,height:d,viewMatrix:ii,projectionMatrix:ti})),a.latitude=A,a.longitude=L,a.zoom=H,a.pitch=Be,a.bearing=kt,a.altitude=wr,a.scale=Sn,a.center=zn,a.pixelsPerMeter=Uv((0,St.Z)((0,St.Z)(a))).pixelsPerMeter[2],Object.freeze((0,St.Z)((0,St.Z)(a))),a}return(0,Or.Z)(c,[{key:"projectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Sd(s,l)}},{key:"unprojectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return jd(s,l)}},{key:"getMapCenterByLngLatPosition",value:function(s){var l=s.lngLat,d=s.pos,_=jv(d,this.pixelUnprojectionMatrix),A=Sd(l,this.scale),M=xi.add([],A,xi.negate([],_)),L=xi.add([],this.center,M);return jd(L,this.scale)}},{key:"getLocationAtPoint",value:function(s){var l=s.lngLat,d=s.pos;return this.getMapCenterByLngLatPosition({lngLat:l,pos:d})}},{key:"fitBounds",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=this.width,_=this.height,A=p0(Object.assign({width:d,height:_,bounds:s},l)),M=A.longitude,L=A.latitude,$=A.zoom;return new c({width:d,height:_,longitude:M,latitude:L,zoom:$})}}]),c}(h0),d0=function(){function n(){(0,vr.Z)(this,n),(0,j.Z)(this,"viewport",void 0)}return(0,Or.Z)(n,[{key:"syncWithMapCamera",value:function(a){var s=a.center,l=a.zoom,d=a.pitch,_=a.bearing,A=a.viewportHeight,M=a.viewportWidth;this.viewport=new Gv({width:M,height:A,longitude:s&&s[0],latitude:s&&s[1],zoom:l,pitch:d,bearing:_})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(a,s){return this.viewport.projectFlat(a,s)}}]),n}(),Hv={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},Wv,Xv,Yv,Kv,$v,Jv,ip,Qv,qv,em,tm;function rm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function v0(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?rm(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):rm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function m0(n,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=n:l.appendChild(c.createTextNode(n)),a.appendChild(l),l}}m0(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=a0();var nm={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},y0=0,g0=12,im="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",_0=(Wv=(0,hn.b2)(),Xv=(0,hn.f3)(O.vK.MapConfig),Yv=(0,hn.f3)(O.vK.IGlobalConfigService),Kv=(0,hn.f3)(O.vK.ICoordinateSystemService),$v=(0,hn.f3)(O.vK.IEventEmitter),Wv(Jv=(ip=function(){function n(){var c=this;(0,vr.Z)(this,n),(0,j.Z)(this,"version",zd.MAPBOX),(0,j.Z)(this,"map",void 0),(0,j.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),(0,Xa.Z)(this,"config",Qv,this),(0,Xa.Z)(this,"configService",qv,this),(0,Xa.Z)(this,"coordinateSystemService",em,this),(0,Xa.Z)(this,"eventEmitter",tm,this),(0,j.Z)(this,"viewport",void 0),(0,j.Z)(this,"markerContainer",void 0),(0,j.Z)(this,"cameraChangedCallback",void 0),(0,j.Z)(this,"$mapContainer",void 0),(0,j.Z)(this,"handleCameraChanged",function(){var a=c.map.getCenter().wrap(),s=a.lat,l=a.lng;c.viewport.syncWithMapCamera({bearing:c.map.getBearing(),center:[l,s],viewportHeight:c.map.transform.height,pitch:c.map.getPitch(),viewportWidth:c.map.transform.width,zoom:c.map.getZoom(),cameraHeight:0});var d=c.config.offsetZoom,_=d===void 0?g0:d;c.viewport.getZoom()>_?c.coordinateSystemService.setCoordinateSystem(O.CoordinateSystem.LNGLAT_OFFSET):c.coordinateSystemService.setCoordinateSystem(O.CoordinateSystem.LNGLAT),c.cameraChangedCallback(c.viewport)})}return(0,Or.Z)(n,[{key:"setBgColor",value:function(a){this.bgColor=a}},{key:"addMarkerContainer",value:function(){var a=this.map.getCanvasContainer();this.markerContainer=Je.SO.create("div","l7-marker-container",a),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(a,s){O.MapServiceEvent.indexOf(a)!==-1?this.eventEmitter.on(a,s):this.map.on(nm[a]||a,s)}},{key:"off",value:function(a,s){this.map.off(nm[a]||a,s)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var a=this.map.transform;return[a.width,a.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(a){return this.map.setZoom(a)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(a){this.map.setCenter(a)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(a){this.map.setBearing(a)}},{key:"zoomIn",value:function(a,s){this.map.zoomIn(a,s)}},{key:"zoomOut",value:function(a,s){this.map.zoomOut(a,s)}},{key:"setPitch",value:function(a){return this.map.setPitch(a)}},{key:"panTo",value:function(a){this.map.panTo(a)}},{key:"panBy",value:function(a,s){this.panTo([a,s])}},{key:"fitBounds",value:function(a,s){this.map.fitBounds(a,s)}},{key:"setMaxZoom",value:function(a){this.map.setMaxZoom(a)}},{key:"setMinZoom",value:function(a){this.map.setMinZoom(a)}},{key:"setMapStatus",value:function(a){a.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),a.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),a.dragEnable===!1&&this.map.dragPan.disable(),a.dragEnable===!0&&this.map.dragPan.enable(),a.rotateEnable===!1&&this.map.dragRotate.disable(),a.rotateEnable===!0&&this.map.dragRotate.enable(),a.keyboardEnable===!1&&this.map.keyboard.disable(),a.keyboardEnable===!0&&this.map.keyboard.enable(),a.zoomEnable===!1&&this.map.scrollZoom.disable(),a.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(a,s){this.map.flyTo({zoom:a,center:s})}},{key:"setMapStyle",value:function(a){this.map.setStyle(this.getMapStyle(a))}},{key:"pixelToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToPixel",value:function(a){return this.map.project(a)}},{key:"containerToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToContainer",value:function(a){return this.map.project(a)}},{key:"lngLatToCoord",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},l=this.lngLatToMercator(a,0),d=l.x,_=l.y;return[d-s.x,_-s.y]}},{key:"lngLatToMercator",value:function(a,s){var l=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),d=l.x,_=d===void 0?0:d,A=l.y,M=A===void 0?0:A,L=l.z,$=L===void 0?0:L;return{x:_,y:M,z:$}}},{key:"getModelMatrix",value:function(a,s,l){var d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],_=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},A=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),M=A.meterInMercatorCoordinateUnits(),L=dn.create();return dn.translate(L,L,ji.fromValues(A.x-_.x,A.y-_.y,A.z||0-_.z)),dn.scale(L,L,ji.fromValues(M*d[0],-M*d[1],M*d[2])),dn.rotateX(L,L,l[0]),dn.rotateY(L,L,l[1]),dn.rotateZ(L,L,l[2]),L}},{key:"init",value:function(){var c=(0,jt.Z)(Wr().mark(function s(){var l,d,_,A,M,L,$,H,ge,Be,vt,kt,yr;return Wr().wrap(function(jr){for(;;)switch(jr.prev=jr.next){case 0:l=this.config,d=l.id,_=d===void 0?"map":d,A=l.attributionControl,M=A===void 0?!1:A,L=l.style,$=L===void 0?"light":L,H=l.token,ge=H===void 0?im:H,Be=l.rotation,vt=Be===void 0?0:Be,kt=l.mapInstance,yr=(0,vu.Z)(l,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new d0,!kt&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),ge===im&&$!=="blank"&&!window.mapboxgl.accessToken&&!kt&&console.warn(this.configService.getSceneWarninfo("MapToken")),!kt&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=ge),kt?(this.map=kt,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(_),this.map=new window.mapboxgl.Map(v0({container:this.$mapContainer,style:this.getMapStyle($),attributionControl:M,bearing:vt},yr))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return jr.stop()}},s,this)}));function a(){return c.apply(this,arguments)}return a}()},{key:"destroy",value:function(){var a,s;(a=this.$mapContainer)===null||a===void 0||(s=a.parentNode)===null||s===void 0||s.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(a){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),_=1;_<l;_++)d[_-1]=arguments[_];(s=this.eventEmitter).emit.apply(s,[a].concat(d))}},{key:"once",value:function(a){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),_=1;_<l;_++)d[_-1]=arguments[_];(s=this.eventEmitter).once.apply(s,[a].concat(d))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(a){var s=this.map.getCanvas(),l=a==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png");return l}},{key:"onCameraChanged",value:function(a){this.cameraChangedCallback=a}},{key:"creatAmapContainer",value:function(a){var s=a;typeof a=="string"&&(s=document.getElementById(a));var l=document.createElement("div");return l.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,l.id="l7_mapbox_div"+y0++,s.appendChild(l),l}},{key:"getMapStyle",value:function(a){return typeof a!="string"?a:Hv[a]?Hv[a]:a}}]),n}(),Qv=(0,lo.Z)(ip.prototype,"config",[Xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qv=(0,lo.Z)(ip.prototype,"configService",[Yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),em=(0,lo.Z)(ip.prototype,"coordinateSystemService",[Kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tm=(0,lo.Z)(ip.prototype,"eventEmitter",[$v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ip))||Jv);function x0(n){var c=b0();return function(){var s=(0,zr.Z)(n),l;if(c){var d=(0,zr.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ln.Z)(this,l)}}function b0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function S0(n,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=n:l.appendChild(c.createTextNode(n)),a.appendChild(l),l}}S0(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var E0=function(n){(0,Kn.Z)(a,n);var c=x0(a);function a(){return(0,vr.Z)(this,a),c.apply(this,arguments)}return(0,Or.Z)(a,[{key:"getServiceConstructor",value:function(){return _0}}]),a}(n0);function am(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function om(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?am(Object(a),!0).forEach(function(s){C0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):am(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function C0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function w0(n,c){return M0(n)||P0(n,c)||T0(n,c)||A0()}function A0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function T0(n,c){if(!!n){if(typeof n=="string")return sm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return sm(n,c)}}function sm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function P0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,A;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function M0(n){if(Array.isArray(n))return n}var I0=re.memo(function(n){var c=n.style,a=n.className,s=n.map,l=n.option,d=n.onSceneLoaded,_=(0,re.createRef)(),A=(0,re.useState)(),M=w0(A,2),L=M[0],$=M[1];return(0,re.useEffect)(function(){var H=new ec(om(om({id:_.current},l),{},{map:new E0(s)}));return H.on("loaded",function(){$(H),d&&d(H)}),function(){H.destroy()}},[]),(0,re.useEffect)(function(){L&&s.style&&L.setMapStyle(s.style)},[JSON.stringify(s.style)]),(0,re.useEffect)(function(){L&&s.zoom&&L.setZoom(s.zoom)},[s.zoom]),(0,re.useEffect)(function(){L&&s.center&&L.setCenter(s.center)},[JSON.stringify(s.center)]),(0,re.useEffect)(function(){L&&s.pitch!==void 0&&L.setPitch(s.pitch||0)},[s.pitch]),(0,re.useEffect)(function(){L&&s.rotation&&L.setRotation(s.rotation)},[s.rotation]),re.createElement(E.Provider,{value:L},(0,re.createElement)("div",{ref:_,style:c,className:a},L&&n.children))}),O0=I0;function um(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function mg(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?um(Object(a),!0).forEach(function(s){L0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):um(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function L0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function yg(n,c){return F0(n)||k0(n,c)||D0(n,c)||R0()}function R0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function D0(n,c){if(!!n){if(typeof n=="string")return lm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return lm(n,c)}}function lm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function k0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,A;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function F0(n){if(Array.isArray(n))return n}var gg=null,_g=null;function cm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function xg(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?cm(Object(a),!0).forEach(function(s){B0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):cm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function B0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function bg(n,c){return U0(n)||Z0(n,c)||z0(n,c)||N0()}function N0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function z0(n,c){if(!!n){if(typeof n=="string")return fm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fm(n,c)}}function fm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Z0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,A;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function U0(n){if(Array.isArray(n))return n}var Sg=null,Eg=null;function Cg(n,c){return H0(n)||G0(n,c)||V0(n,c)||j0()}function j0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function V0(n,c){if(!!n){if(typeof n=="string")return hm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return hm(n,c)}}function hm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function G0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,A;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function H0(n){if(Array.isArray(n))return n}var wg=null,Ag=null;function pm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Tg(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?pm(Object(a),!0).forEach(function(s){W0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):pm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function W0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function Pg(n,c){if(n==null)return{};var a=X0(n,c),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(n);for(l=0;l<d.length;l++)s=d[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(a[s]=n[s]))}return a}function X0(n,c){if(n==null)return{};var a={},s=Object.keys(n),l,d;for(d=0;d<s.length;d++)l=s[d],!(c.indexOf(l)>=0)&&(a[l]=n[l]);return a}var Mg=null,dm=b(5672);function Y0(n,c){return Q0(n)||J0(n,c)||$0(n,c)||K0()}function K0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $0(n,c){if(!!n){if(typeof n=="string")return vm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return vm(n,c)}}function vm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function J0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,A;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function Q0(n){if(Array.isArray(n))return n}var q0=re.useEffect,ey=re.useState;function Ig(n){var c=n.className,a=n.style,s=n.children,l=n.position,d=useSceneValue(),_=ey(function(){return document.createElement("div")}),A=Y0(_,1),M=A[0];return q0(function(){var L=new Control({position:l});return L.onAdd=function(){if(c&&(M.className=c),a){var $=Object.keys(a).map(function(H){return"".concat(H,":").concat(a[H])}).join(";");M.style.cssText=$}return M},d.addControl(L),function(){d.removeControl(L)}},[]),createPortal(s,M)}var mm=(0,re.createContext)({});function Og(){return useContext(mm)}var ty=re.useEffect,ry=re.memo(function(c){var a=c.layer,s=c.active;return ty(function(){a.active(s.option)},[JSON.stringify(s)]),null}),ny=re.useEffect,iy=re.memo(function(c){var a=c.layer,s=c.animate;return ny(function(){a.animate(s)},[JSON.stringify(s)]),null}),ay=re.useEffect,oy=re.memo(function(c){var a=c.layer,s=c.color;return ay(function(){s.field?a.color(s.field,s.values):a.color(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),sy=re.useEffect,uy=re.memo(function(c){var a=c.layer,s=c.filter;return sy(function(){s.field&&a.filter(s.field,s.values)},[s.field,s.values,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),ly=re.useEffect,cy=re.memo(function(c){var a=c.layer,s=c.scale;return ly(function(){a.scale(s.values)},[s.values]),null}),fy=re.useEffect,hy=re.memo(function(c){var a=c.layer,s=c.select;return fy(function(){a.select(s.option)},[JSON.stringify(s)]),null}),py=re.useEffect,dy=re.memo(function(c){var a=c.layer,s=c.shape;return py(function(){s.field?a.shape(s.field,s.values):a.shape(s.values)},[s.field,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),vy=re.useEffect,yy=re.memo(function(c){var a=c.layer,s=c.size;return vy(function(){s.field?a.size(s.field,s.values):a.size(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),gy=["data"];function _y(n,c){if(n==null)return{};var a=xy(n,c),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(n);for(l=0;l<d.length;l++)s=d[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(a[s]=n[s]))}return a}function xy(n,c){if(n==null)return{};var a={},s=Object.keys(n),l,d;for(d=0;d<s.length;d++)l=s[d],!(c.indexOf(l)>=0)&&(a[l]=n[l]);return a}var by=re.useEffect,Sy=re.memo(function(c){var a=c.layer,s=c.source,l=s.data,d=_y(s,gy);return by(function(){a.inited?a.setData(l,d):a.source(l,d),d.autoFit&&a.fitBounds(d&&d.fitBoundsOptions)},[l,JSON.stringify(d)]),null}),Ey=re.useEffect,Cy=re.memo(function(c){var a=c.layer,s=c.style;return Ey(function(){a.style(s)},Object.keys(s).map(function(l){return s[l]})),null});function wy(n,c){return My(n)||Py(n,c)||Ty(n,c)||Ay()}function Ay(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ty(n,c){if(!!n){if(typeof n=="string")return ym(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ym(n,c)}}function ym(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Py(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,d=!1,_,A;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(d)throw A}}return s}}function My(n){if(Array.isArray(n))return n}var Vp=re.useEffect,Iy=re.useState;function gm(n,c){var a=c.source,s=c.color,l=c.shape,d=c.style,_=c.size,A=c.scale,M=c.active,L=c.select,$=c.filter,H=c.animate,ge=c.options,Be=c.onLayerLoaded,vt=p(),kt=Iy(function(){var jr;switch(n){case"polygonLayer":jr=new Xl(ge);break;case"lineLayer":jr=new cp(ge);break;case"pointLayer":jr=new _h(ge);break;case"heatmapLayer":jr=new aa(ge);break;case"rasterLayer":jr=new Vr(ge);break;case"imageLayer":jr=new Fi(ge);break;case"citybuildingLayer":jr=new wt(ge);break;default:jr=new Xl(ge)}return jr.on("inited",function(){Be&&Be(jr,vt)}),jr}),yr=wy(kt,1),wr=yr[0];return Vp(function(){return vt.addLayer(wr),function(){vt.removeLayer(wr)}},[]),Vp(function(){wr.inited&&ge&&wr.updateLayerConfig(ge)},[ge==null?void 0:ge.minZoom,ge==null?void 0:ge.maxZoom,ge==null?void 0:ge.visible]),Vp(function(){wr.inited&&(ge==null?void 0:ge.zIndex)&&wr.setIndex(ge.zIndex)},[ge==null?void 0:ge.zIndex]),Vp(function(){wr.inited&&(ge==null?void 0:ge.blend)&&wr.setBlend(ge.blend)},[ge==null?void 0:ge.blend]),Vp(function(){vt.render()}),re.createElement(mm.Provider,{value:wr},re.createElement(Sy,{layer:wr,source:a}),A&&re.createElement(cy,{layer:wr,scale:A}),s&&re.createElement(oy,{layer:wr,color:s}),_&&re.createElement(yy,{layer:wr,size:_}),l&&re.createElement(dy,{layer:wr,shape:l}),d&&re.createElement(Cy,{layer:wr,style:d}),M&&re.createElement(ry,{layer:wr,active:M}),L&&re.createElement(hy,{layer:wr,select:L}),$&&re.createElement(uy,{layer:wr,filter:$}),H&&re.createElement(iy,{layer:wr,animate:H}),c.children)}var Lg=null,Rg=null,Oy=re.memo(function(c){return gm("pointLayer",c)}),Ly=re.memo(function(c){return gm("heatmapLayer",c)}),Dg=null,kg=null,Fg=null,Bg=re.useEffect,Ng=null,zg=null;function Ed(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ed=function(a){return typeof a}:Ed=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Ed(n)}function _m(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Cd(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?_m(Object(a),!0).forEach(function(s){Ry(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):_m(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Ry(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function Dy(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function xm(n,c){for(var a=0;a<c.length;a++){var s=c[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function ky(n,c,a){return c&&xm(n.prototype,c),a&&xm(n,a),n}function Fy(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&Vd(n,c)}function Vd(n,c){return Vd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Vd(n,c)}function By(n){var c=Zy();return function(){var s=wd(n),l;if(c){var d=wd(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return Ny(this,l)}}function Ny(n,c){if(c&&(Ed(c)==="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zy(n)}function zy(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Zy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function wd(n){return wd=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},wd(n)}var Zg=function(n){Fy(a,n);var c=By(a);function a(s){var l;return Dy(this,a),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.popup=void 0,l.el=document.createElement("div"),l}return ky(a,[{key:"componentDidMount",value:function(){var l,d=this.props,_=d.lnglat,A=d.children,M=d.option,L=d.lngLat,$=new pt(Cd(Cd({},M),{},{stopPropagation:(l=this.props.option)===null||l===void 0?void 0:l.stopPropagation}));_&&$.setLnglat(_),L&&$.setLnglat(L),A&&$.setDOMContent(this.el),this.popup=$,this.scene.addPopup($)}},{key:"componentDidUpdate",value:function(l){var d,_,A,M,L,$,H=Array.isArray(l.lnglat)?l.lnglat:[l==null||(d=l.lnglat)===null||d===void 0?void 0:d.lng,l==null||(_=l.lnglat)===null||_===void 0?void 0:_.lat],ge=Array.isArray(this.props.lnglat)?this.props.lnglat:[(A=this.props)===null||A===void 0||(M=A.lnglat)===null||M===void 0?void 0:M.lng,(L=this.props)===null||L===void 0||($=L.lnglat)===null||$===void 0?void 0:$.lat],Be=H.toString()!==ge.toString();if(Be){var vt;this.popup.remove(),this.popup=new pt(Cd(Cd({},this.props.option),{},{stopPropagation:(vt=this.props.option)===null||vt===void 0?void 0:vt.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var l=this;return re.createElement(E.Consumer,{},function(d){return d&&(l.scene=d),(0,dm.createPortal)(l.props.children,l.el)})}}]),a}(re.PureComponent);function Ad(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ad=function(a){return typeof a}:Ad=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Ad(n)}function Uy(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function bm(n,c){for(var a=0;a<c.length;a++){var s=c[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function jy(n,c,a){return c&&bm(n.prototype,c),a&&bm(n,a),n}function Vy(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&Gd(n,c)}function Gd(n,c){return Gd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Gd(n,c)}function Gy(n){var c=Xy();return function(){var s=Td(n),l;if(c){var d=Td(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return Hy(this,l)}}function Hy(n,c){if(c&&(Ad(c)==="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Wy(n)}function Wy(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Xy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Td(n){return Td=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},Td(n)}var Ug=function(n){Vy(a,n);var c=Gy(a);function a(s){var l;return Uy(this,a),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.marker=void 0,l.el=document.createElement("div"),l}return jy(a,[{key:"componentDidMount",value:function(){var l=this.props,d=l.lnglat,_=l.children,A=l.option,M=l.onMarkerLoaded,L=new qu(A);d&&L.setLnglat(d),_&&L.setElement(this.el),this.marker=L,M&&M(L),this.scene.addMarker(L)}},{key:"componentDidUpdate",value:function(l){var d,_=(l==null?void 0:l.lnglat.toString())!==((d=this.props)===null||d===void 0?void 0:d.lnglat.toString());_&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var l=this;return re.createElement(E.Consumer,{},function(d){return d&&(l.scene=d),(0,dm.createPortal)(l.props.children,l.el)})}}]),a}(re.PureComponent),jg=re.useEffect,Vg=null,Gg=null,Hg=re.useEffect,Wg=null},85491:function(){},28157:function(Rr,N,b){"use strict";b.d(N,{SO:function(){return re},z6:function(){return ht},a5:function(){return E},Z:function(){return ct},rQ:function(){return yn},bV:function(){return Xr},zi:function(){return vr},ds:function(){return Ke},Ev:function(){return Mt},oO:function(){return Mr},W0:function(){return Sr},Z6:function(){return Je},We:function(){return ar},Cl:function(){return Hr},gJ:function(){return Ze},vP:function(){return nn},yM:function(){return J},yA:function(){return Tr},CI:function(){return br}});var re={};b.r(re),b.d(re,{DPR:function(){return je},addClass:function(){return $t},create:function(){return xt},empty:function(){return Et},getClass:function(){return At},getContainer:function(){return ae},getViewPortScale:function(){return et},hasClass:function(){return Ft},printCanvas:function(){return Bt},remove:function(){return Ht},removeClass:function(){return Jt},setClass:function(){return Gt},setTransform:function(){return er},splitWords:function(){return K},triggerResize:function(){return q},trim:function(){return Ne}});var E={};b.r(E),b.d(E,{getColumn:function(){return ce},getSatByColumn:function(){return ve},max:function(){return Or},mean:function(){return Ln},min:function(){return St},mode:function(){return zr},statMap:function(){return Y},sum:function(){return Kn}});function p(B){var ee=131,pe=137,Ae=0;B+="x";for(var oe=Math.floor(9007199254740991/pe),_e=0;_e<B.length;_e++)Ae>oe&&(Ae=Math.floor(Ae/pe)),Ae=Ae*ee+B.charCodeAt(_e);return Ae}function me(B){B=B.toString();for(var ee=5381,pe=B.length;pe;)ee=ee*33^B.charCodeAt(--pe);return ee>>>0}var te=b(83405),ue=window.document.documentElement.style;function ae(B){var ee=B;return typeof B=="string"&&(ee=document.getElementById(B)),ee}function Ne(B){return B.trim?B.trim():B.replace(/^\s+|\s+$/g,"")}function K(B){return Ne(B).split(/\s+/)}function Qe(B){if(!ue)return B[0];for(var ee in B)if(B[ee]&&B[ee]in ue)return B[ee];return B[0]}function xt(B,ee,pe){var Ae=document.createElement(B);return Ae.className=ee||"",pe&&pe.appendChild(Ae),Ae}function Ht(B){var ee=B.parentNode;ee&&ee.removeChild(B)}function $t(B,ee){if(B.classList!==void 0)for(var pe=K(ee),Ae=0,oe=pe.length;Ae<oe;Ae++)B.classList.add(pe[Ae]);else if(!Ft(B,ee)){var _e=At(B);Gt(B,(_e?_e+" ":"")+ee)}}function Jt(B,ee){B.classList!==void 0?B.classList.remove(ee):Gt(B,Ne((" "+At(B)+" ").replace(" "+ee+" "," ")))}function Ft(B,ee){if(B.classList!==void 0)return B.classList.contains(ee);var pe=At(B);return pe.length>0&&new RegExp("(^|\\s)"+ee+"(\\s|$)").test(pe)}function Gt(B,ee){B instanceof HTMLElement?B.className=ee:B.className.baseVal=ee}function At(B){return B instanceof SVGElement&&(B=B.correspondingElement),B.className.baseVal===void 0?B.className:B.className.baseVal}function Et(B){for(;B&&B.firstChild;)B.removeChild(B.firstChild)}var bt=Qe(["transform","WebkitTransform"]);function er(B,ee){B.style[bt]=ee}function q(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var B=window.document.createEvent("UIEvents");B.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(B)}}function Bt(B){var ee=["padding: "+(B.height/2-8)+"px "+B.width/2+"px;","line-height: "+B.height+"px;","background-image: url("+B.toDataURL()+");"];console.log(`%c
`,ee.join(""))}function et(){var B,ee=document.querySelector('meta[name="viewport"]');if(!ee)return 1;var pe=(B=ee.content)===null||B===void 0?void 0:B.split(","),Ae=pe.find(function(oe){var _e=oe.split("="),dt=(0,te.Z)(_e,2),Er=dt[0],Kt=dt[1];return Er==="initial-scale"});return Ae?Ae.split("=")[1]*1:1}var je=et()<1?1:window.devicePixelRatio,nt=b(51548),De=b(46893),It=b(67708),hr=b(37150),tr=b(87896),j=b(74415),ie=b(80792);function Me(B){return Function.toString.call(B).indexOf("[native code]")!==-1}var ye=b(86315);function it(B,ee,pe){return(0,ye.Z)()?it=Reflect.construct:it=function(oe,_e,dt){var Er=[null];Er.push.apply(Er,_e);var Kt=Function.bind.apply(oe,Er),ir=new Kt;return dt&&(0,ie.Z)(ir,dt.prototype),ir},it.apply(null,arguments)}function lt(B){var ee=typeof Map=="function"?new Map:void 0;return lt=function(Ae){if(Ae===null||!Me(Ae))return Ae;if(typeof Ae!="function")throw new TypeError("Super expression must either be null or a function");if(typeof ee!="undefined"){if(ee.has(Ae))return ee.get(Ae);ee.set(Ae,oe)}function oe(){return it(Ae,arguments,(0,j.Z)(this).constructor)}return oe.prototype=Object.create(Ae.prototype,{constructor:{value:oe,enumerable:!1,writable:!0,configurable:!0}}),(0,ie.Z)(oe,Ae)},lt(B)}var Lt=b(19297);function Pt(B){var ee=Lr();return function(){var Ae=(0,j.Z)(B),oe;if(ee){var _e=(0,j.Z)(this).constructor;oe=Reflect.construct(Ae,arguments,_e)}else oe=Ae.apply(this,arguments);return(0,tr.Z)(this,oe)}}function Lr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var cn=function(B){(0,hr.Z)(pe,B);var ee=Pt(pe);function pe(Ae,oe,_e){var dt;return(0,nt.Z)(this,pe),dt=ee.call(this,Ae),(0,Lt.Z)((0,It.Z)(dt),"status",void 0),(0,Lt.Z)((0,It.Z)(dt),"url",void 0),dt.status=oe,dt.url=_e,dt.name=dt.constructor.name,dt.message=Ae,dt}return(0,De.Z)(pe,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),pe}(lt(Error));function qr(B){var ee=new XMLHttpRequest;ee.open("GET",B.url,!0);for(var pe in B.headers)B.headers.hasOwnProperty(pe)&&ee.setRequestHeader(pe,B.headers[pe]);return ee.withCredentials=B.credentials==="include",ee}var fi=function(ee,pe){var Ae=qr(ee);return Ae.setRequestHeader("Accept","application/json"),Ae.onerror=function(){pe(new Error(Ae.statusText))},Ae.onload=function(){if(Ae.status>=200&&Ae.status<300&&Ae.response){var oe;try{oe=JSON.parse(Ae.response)}catch(_e){return pe(_e)}pe(null,oe)}else Ae.status===401?pe(new cn("".concat(Ae.statusText),Ae.status,ee.url)):pe(new cn(Ae.statusText,Ae.status,ee.url))},Ae.send(),Ae},Yt=function(ee,pe){var Ae=qr(ee);return Ae.responseType="arraybuffer",Ae.onerror=function(){pe(new Error(Ae.statusText))},Ae.onload=function(){var oe=Ae.response;if(oe.byteLength===0&&Ae.status===200)return pe(new Error("http status 200 returned without content."));Ae.status>=200&&Ae.status<300&&Ae.response?pe(null,{data:oe,cacheControl:Ae.getResponseHeader("Cache-Control"),expires:Ae.getResponseHeader("Expires")}):pe(new cn(Ae.statusText,Ae.status,ee.url))},Ae.send(),Ae};function he(B){var ee=window.document.createElement("a");return ee.href=B,ee.protocol===window.document.location.protocol&&ee.host===window.document.location.host}var Te="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ze=function(ee,pe){return Yt(ee,function(Ae,oe){if(Ae)pe(Ae);else if(oe){var _e=new window.Image;_e.crossOrigin="anonymous";var dt=window.URL||window.webkitURL;_e.onload=function(){pe(null,_e),dt.revokeObjectURL(_e.src)};var Er=new window.Blob([new Uint8Array(oe.data)],{type:"image/png"});_e.src=oe.data.byteLength?dt.createObjectURL(Er):Te}})},Oe=b(98576),Ot=2*Math.PI*6378137/2;function ar(B){var ee=[Infinity,Infinity,-Infinity,-Infinity];return B.forEach(function(pe){var Ae=pe.coordinates;ur(ee,Ae)}),ee}function ur(B,ee){return Array.isArray(ee[0])?ee.forEach(function(pe){ur(B,pe)}):(B[0]>ee[0]&&(B[0]=ee[0]),B[1]>ee[1]&&(B[1]=ee[1]),B[2]<ee[0]&&(B[2]=ee[0]),B[3]<ee[1]&&(B[3]=ee[1])),B}function Pr(B,ee){return or(B,ee)}function or(B,ee){return Array.isArray(B[0])?B.map(function(pe){return or(pe,ee)}):ee(B)}function nn(B){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,pe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};B=$e(B,ee);var Ae=B[0],oe=B[1],_e=Ae*Ot/180,dt=Math.log(Math.tan((90+oe)*Math.PI/360))/(Math.PI/180);return dt=dt*Ot/180,pe.enable&&(_e=Number(_e.toFixed(pe.decimal)),dt=Number(dt.toFixed(pe.decimal))),B.length===3?[_e,dt,B[2]]:[_e,dt]}function C(B){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,pe=B[0],Ae=B[1],oe=pe/Ot*180,_e=Ae/Ot*180;return _e=180/Math.PI*(2*Math.atan(Math.exp(_e*Math.PI/180))-Math.PI/2),ee!=null&&(oe=Number(oe.toFixed(ee)),_e=Number(_e.toFixed(ee))),B.length===3?[oe,_e,B[2]]:[oe,_e]}function V(B){if(B==null)throw new Error("lng is required");return(B>180||B<-180)&&(B=B%360,B>180&&(B=-360+B),B<-180&&(B=360+B),B===0&&(B=0)),B}function Ve(B){if(B==null)throw new Error("lat is required");return(B>90||B<-90)&&(B=B%180,B>90&&(B=-180+B),B<-90&&(B=180+B),B===0&&(B=0)),B}function $e(B,ee){if(ee===!1)return B;var pe=V(B[0]),Ae=Ve(B[1]);return Ae>85&&(Ae=85),Ae<-85&&(Ae=-85),B.length===3?[pe,Ae,B[2]]:[pe,Ae]}function ct(B){var ee=85.0511287798,pe=Math.max(Math.min(ee,B[1]),-ee),Ae=256<<20,oe=Math.PI/180,_e=B[0]*oe,dt=pe*oe;dt=Math.log(Math.tan(Math.PI/4+dt/2));var Er=.5/Math.PI,Kt=.5,ir=-.5/Math.PI;return oe=.5,_e=Ae*(Er*_e+Kt),dt=Ae*(ir*dt+oe),[Math.floor(_e),Math.floor(dt)]}function Ct(B){var ee=.5/Math.PI,pe=.5,Ae=-.5/Math.PI,oe=.5,_e=256<<20,dt=_slicedToArray(B,2),Er=dt[0],Kt=dt[1];Er=(Er/_e-pe)/ee,Kt=(Kt/_e-oe)/Ae,Kt=(Math.atan(Math.pow(Math.E,Kt))-Math.PI/4)*2,oe=Math.PI/180;var ir=Kt/oe,Zr=Er/oe;return[Zr,ir]}function J(B,ee,pe){var Ae=(0,Oe.Ht)(ee[1]-B[1]),oe=(0,Oe.Ht)(ee[0]-B[0]),_e=(0,Oe.Ht)(B[1]),dt=(0,Oe.Ht)(ee[1]),Er=Math.pow(Math.sin(Ae/2),2)+Math.pow(Math.sin(oe/2),2)*Math.cos(_e)*Math.cos(dt);return(0,Oe.DL)(2*Math.atan2(Math.sqrt(Er),Math.sqrt(1-Er)),pe="meters")}function Wt(B){var ee=Math.PI/180,pe=85.0511287798,Ae=6378137,oe=Math.max(Math.min(pe,B[1]),-pe),_e=Math.sin(oe*ee),dt=Ae*B[0]*ee,Er=Ae*Math.log((1+_e)/(1-_e))/2;return[dt,Er]}function Tr(B,ee){var pe=Math.abs(B[1][1]-B[0][1])*ee,Ae=Math.abs(B[1][0]-B[0][0])*ee;return[[B[0][0]-Ae,B[0][1]-pe],[B[1][0]+Ae,B[1][1]+pe]]}function Mr(B,ee){return B[0][0]<=ee[0][0]&&B[0][1]<=ee[0][1]&&B[1][0]>=ee[1][0]&&B[1][1]>=ee[1][1]}function Ke(B){return[[B[0],B[1]],[B[2],B[3]]]}var ht=function(){function B(){var ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,pe=arguments.length>1?arguments[1]:void 0;(0,nt.Z)(this,B),(0,Lt.Z)(this,"limit",void 0),(0,Lt.Z)(this,"cache",void 0),(0,Lt.Z)(this,"destroy",void 0),(0,Lt.Z)(this,"order",void 0),this.limit=ee,this.destroy=pe||this.defaultDestroy,this.order=[],this.clear()}return(0,De.Z)(B,[{key:"clear",value:function(){var pe=this;this.order.forEach(function(Ae){pe.delete(Ae)}),this.cache={},this.order=[]}},{key:"get",value:function(pe){var Ae=this.cache[pe];return Ae&&(this.deleteOrder(pe),this.appendOrder(pe)),Ae}},{key:"set",value:function(pe,Ae){this.cache[pe]?(this.delete(pe),this.cache[pe]=Ae,this.appendOrder(pe)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[pe]=Ae,this.appendOrder(pe))}},{key:"delete",value:function(pe){var Ae=this.cache[pe];Ae&&(this.deleteCache(pe),this.deleteOrder(pe),this.destroy(Ae,pe))}},{key:"deleteCache",value:function(pe){delete this.cache[pe]}},{key:"deleteOrder",value:function(pe){var Ae=this.order.findIndex(function(oe){return oe===pe});Ae>=0&&this.order.splice(Ae,1)}},{key:"appendOrder",value:function(pe){this.order.push(pe)}},{key:"defaultDestroy",value:function(pe,Ae){return null}}]),B}();function Mt(B,ee){B.forEach(function(pe){!ee[pe]||(ee[pe]=ee[pe].bind(ee))})}var Nt=b(34663);function br(B){var ee=Nt.ZP(B),pe=[0,0,0,0];return ee!=null&&(pe[0]=ee.r/255,pe[1]=ee.g/255,pe[2]=ee.b/255,pe[3]=ee.opacity),pe}function Sr(B){var ee=B&&B[0],pe=B&&B[1],Ae=B&&B[2],oe=ee+pe*256+Ae*65536-1;return oe}function Je(B){return[B+1&255,B+1>>8&255,B+1>>8>>8&255]}function Hr(B){var ee=document.createElement("canvas"),pe=ee.getContext("2d");ee.width=256,ee.height=1;for(var Ae=pe.createLinearGradient(0,0,256,1),oe=null,_e=B.positions[0],dt=B.positions[B.positions.length-1],Er=0;Er<B.colors.length;++Er){var Kt=(B.positions[Er]-_e)/(dt-_e);Ae.addColorStop(Kt,B.colors[Er])}return pe.fillStyle=Ae,pe.fillRect(0,0,256,1),oe=new Uint8ClampedArray(pe.getImageData(0,0,256,1).data),new ImageData(oe,256,1)}var Xr;(function(B){B.CENTER="center",B.TOP="top",B["TOP-LEFT"]="top-left",B["TOP-RIGHT"]="top-right",B.BOTTOM="bottom",B["BOTTOM-LEFT"]="bottom-left",B.LEFT="left",B.RIGHT="right"})(Xr||(Xr={}));var yn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function vr(B,ee,pe){var Ae=B.classList;for(var oe in yn)yn.hasOwnProperty(oe)&&Ae.remove("l7-".concat(pe,"-anchor-").concat(oe));Ae.add("l7-".concat(pe,"-anchor-").concat(ee))}function Or(B){if(B.length===0)throw new Error("max requires at least one data point");for(var ee=B[0],pe=1;pe<B.length;pe++)B[pe]>ee&&(ee=B[pe]);return ee*1}function St(B){if(B.length===0)throw new Error("min requires at least one data point");for(var ee=B[0],pe=1;pe<B.length;pe++)B[pe]<ee&&(ee=B[pe]);return ee*1}function Kn(B){if(B.length===0)return 0;for(var ee=B[0]*1,pe=1;pe<B.length;pe++)ee+=B[pe]*1;return ee}function Ln(B){if(B.length===0)throw new Error("mean requires at least one data point");return Kn(B)/B.length}function zr(B){if(B.length===0)throw new Error("mean requires at least one data point");if(B.length<3)return B[0];B.sort();for(var ee=B[0],pe=NaN,Ae=0,oe=1,_e=1;_e<B.length+1;_e++)B[_e]!==ee?(oe>Ae&&(Ae=oe,pe=ee),oe=1,ee=B[_e]):oe++;return pe*1}var Y={min:St,max:Or,mean:Ln,sum:Kn,mode:zr};function ce(B,ee){return B.map(function(pe){return pe[ee]})}function ve(B,ee){return Y[B](ee)}},7273:function(Rr,N,b){"use strict";b.d(N,{Z:function(){return re}});function re(E,p,me,te,ue){var ae={};return Object.keys(te).forEach(function(Ne){ae[Ne]=te[Ne]}),ae.enumerable=!!ae.enumerable,ae.configurable=!!ae.configurable,("value"in ae||ae.initializer)&&(ae.writable=!0),ae=me.slice().reverse().reduce(function(Ne,K){return K(E,p,Ne)||Ne},ae),ue&&ae.initializer!==void 0&&(ae.value=ae.initializer?ae.initializer.call(ue):void 0,ae.initializer=void 0),ae.initializer===void 0&&(Object.defineProperty(E,p,ae),ae=null),ae}},84904:function(Rr,N,b){"use strict";b.d(N,{Z:function(){return re}});function re(E,p,me,te){!me||Object.defineProperty(E,p,{enumerable:me.enumerable,configurable:me.configurable,writable:me.writable,value:me.initializer?me.initializer.call(te):void 0})}},42512:function(Rr,N,b){var re=b(48027);Rr.exports.geometry=E,Rr.exports.ring=me;function E(ue){var ae=0,Ne;switch(ue.type){case"Polygon":return p(ue.coordinates);case"MultiPolygon":for(Ne=0;Ne<ue.coordinates.length;Ne++)ae+=p(ue.coordinates[Ne]);return ae;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Ne=0;Ne<ue.geometries.length;Ne++)ae+=E(ue.geometries[Ne]);return ae}}function p(ue){var ae=0;if(ue&&ue.length>0){ae+=Math.abs(me(ue[0]));for(var Ne=1;Ne<ue.length;Ne++)ae-=Math.abs(me(ue[Ne]))}return ae}function me(ue){var ae,Ne,K,Qe,xt,Ht,$t,Jt=0,Ft=ue.length;if(Ft>2){for($t=0;$t<Ft;$t++)$t===Ft-2?(Qe=Ft-2,xt=Ft-1,Ht=0):$t===Ft-1?(Qe=Ft-1,xt=0,Ht=1):(Qe=$t,xt=$t+1,Ht=$t+2),ae=ue[Qe],Ne=ue[xt],K=ue[Ht],Jt+=(te(K[0])-te(ae[0]))*Math.sin(te(Ne[1]));Jt=Jt*re.RADIUS*re.RADIUS/2}return Jt}function te(ue){return ue*Math.PI/180}},56928:function(Rr,N,b){var re=b(42512);Rr.exports=E;function E(Ne,K){switch(Ne&&Ne.type||null){case"FeatureCollection":return Ne.features=Ne.features.map(p(E,K)),Ne;case"GeometryCollection":return Ne.geometries=Ne.geometries.map(p(E,K)),Ne;case"Feature":return Ne.geometry=E(Ne.geometry,K),Ne;case"Polygon":case"MultiPolygon":return me(Ne,K);default:return Ne}}function p(Ne,K){return function(Qe){return Ne(Qe,K)}}function me(Ne,K){return Ne.type==="Polygon"?Ne.coordinates=te(Ne.coordinates,K):Ne.type==="MultiPolygon"&&(Ne.coordinates=Ne.coordinates.map(p(te,K))),Ne}function te(Ne,K){K=!!K,Ne[0]=ue(Ne[0],K);for(var Qe=1;Qe<Ne.length;Qe++)Ne[Qe]=ue(Ne[Qe],!K);return Ne}function ue(Ne,K){return ae(Ne)===K?Ne:Ne.reverse()}function ae(Ne){return re.ring(Ne)>=0}},52155:function(Rr){"use strict";Rr.exports=b,Rr.exports.default=b;var N=1e20;function b(te,ue,ae,Ne,K,Qe){this.fontSize=te||24,this.buffer=ue===void 0?3:ue,this.cutoff=Ne||.25,this.fontFamily=K||"sans-serif",this.fontWeight=Qe||"normal",this.radius=ae||8;var xt=this.size=this.fontSize+this.buffer*2,Ht=xt+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=xt,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Ht*Ht),this.gridInner=new Float64Array(Ht*Ht),this.f=new Float64Array(Ht),this.z=new Float64Array(Ht+1),this.v=new Uint16Array(Ht),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(xt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function re(te,ue,ae,Ne,K,Qe,xt){Qe.fill(N,0,ue*ae),xt.fill(0,0,ue*ae);for(var Ht=(ue-Ne)/2,$t=0;$t<K;$t++)for(var Jt=0;Jt<Ne;Jt++){var Ft=($t+Ht)*ue+Jt+Ht,Gt=te.data[4*($t*Ne+Jt)+3]/255;if(Gt===1)Qe[Ft]=0,xt[Ft]=N;else if(Gt===0)Qe[Ft]=N,xt[Ft]=0;else{var At=Math.max(0,.5-Gt),Et=Math.max(0,Gt-.5);Qe[Ft]=At*At,xt[Ft]=Et*Et}}}function E(te,ue,ae,Ne,K,Qe,xt){for(var Ht=0;Ht<ue*ae;Ht++){var $t=Math.sqrt(Ne[Ht])-Math.sqrt(K[Ht]);te[Ht]=Math.round(255-255*($t/Qe+xt))}}b.prototype._draw=function(te,ue){var ae=this.ctx.measureText(te),Ne=ae.width,K=2*this.buffer,Qe,xt,Ht,$t,Jt,Ft,Gt,At;ue&&this.useMetrics?(Jt=Math.floor(ae.actualBoundingBoxAscent),At=this.buffer+Math.ceil(ae.actualBoundingBoxAscent),Ft=this.buffer,Gt=this.buffer,xt=Math.min(this.size,Math.ceil(ae.actualBoundingBoxRight-ae.actualBoundingBoxLeft)),$t=Math.min(this.size-Ft,Math.ceil(ae.actualBoundingBoxAscent+ae.actualBoundingBoxDescent)),Qe=xt+K,Ht=$t+K,this.ctx.textBaseline="alphabetic"):(Qe=xt=this.size,Ht=$t=this.size,Jt=19*this.fontSize/24,Ft=Gt=0,At=this.middle,this.ctx.textBaseline="middle");var Et;xt&&$t&&(this.ctx.clearRect(Gt,Ft,xt,$t),this.ctx.fillText(te,this.buffer,At),Et=this.ctx.getImageData(Gt,Ft,xt,$t));var bt=new Uint8ClampedArray(Qe*Ht);return re(Et,Qe,Ht,xt,$t,this.gridOuter,this.gridInner),p(this.gridOuter,Qe,Ht,this.f,this.v,this.z),p(this.gridInner,Qe,Ht,this.f,this.v,this.z),E(bt,Qe,Ht,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:bt,metrics:{width:xt,height:$t,sdfWidth:Qe,sdfHeight:Ht,top:Jt,left:0,advance:Ne}}},b.prototype.draw=function(te){return this._draw(te,!1).data},b.prototype.drawWithMetrics=function(te){return this._draw(te,!0)};function p(te,ue,ae,Ne,K,Qe){for(var xt=0;xt<ue;xt++)me(te,xt,ue,ae,Ne,K,Qe);for(var Ht=0;Ht<ae;Ht++)me(te,Ht*ue,1,ue,Ne,K,Qe)}function me(te,ue,ae,Ne,K,Qe,xt){var Ht,$t,Jt,Ft;for(Qe[0]=0,xt[0]=-N,xt[1]=N,Ht=0;Ht<Ne;Ht++)K[Ht]=te[ue+Ht*ae];for(Ht=1,$t=0,Jt=0;Ht<Ne;Ht++){do Ft=Qe[$t],Jt=(K[Ht]-K[Ft]+Ht*Ht-Ft*Ft)/(Ht-Ft)/2;while(Jt<=xt[$t]&&--$t>-1);$t++,Qe[$t]=Ht,xt[$t]=Jt,xt[$t+1]=N}for(Ht=0,$t=0;Ht<Ne;Ht++){for(;xt[$t+1]<Ht;)$t++;Ft=Qe[$t],te[ue+Ht*ae]=K[Ft]+(Ht-Ft)*(Ht-Ft)}}},98576:function(Rr,N,b){"use strict";b.d(N,{zL:function(){return te},DL:function(){return bt},Ht:function(){return je}});var re=63710088e-1,E={centimeters:re*100,centimetres:re*100,degrees:re/111325,feet:re*3.28084,inches:re*39.37,kilometers:re/1e3,kilometres:re/1e3,meters:re,metres:re,miles:re/1609.344,millimeters:re*1e3,millimetres:re*1e3,nauticalmiles:re/1852,radians:1,yards:re*1.0936},p={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/re,yards:1.0936133},me={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function te(ie,Me,ye){ye===void 0&&(ye={});var it={type:"Feature"};return(ye.id===0||ye.id)&&(it.id=ye.id),ye.bbox&&(it.bbox=ye.bbox),it.properties=Me||{},it.geometry=ie,it}function ue(ie,Me,ye){switch(ye===void 0&&(ye={}),ie){case"Point":return ae(Me).geometry;case"LineString":return xt(Me).geometry;case"Polygon":return K(Me).geometry;case"MultiPoint":return Ft(Me).geometry;case"MultiLineString":return Jt(Me).geometry;case"MultiPolygon":return Gt(Me).geometry;default:throw new Error(ie+" is invalid")}}function ae(ie,Me,ye){if(ye===void 0&&(ye={}),!ie)throw new Error("coordinates is required");if(!Array.isArray(ie))throw new Error("coordinates must be an Array");if(ie.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!It(ie[0])||!It(ie[1]))throw new Error("coordinates must contain numbers");var it={type:"Point",coordinates:ie};return te(it,Me,ye)}function Ne(ie,Me,ye){return ye===void 0&&(ye={}),$t(ie.map(function(it){return ae(it,Me)}),ye)}function K(ie,Me,ye){ye===void 0&&(ye={});for(var it=0,lt=ie;it<lt.length;it++){var Lt=lt[it];if(Lt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Pt=0;Pt<Lt[Lt.length-1].length;Pt++)if(Lt[Lt.length-1][Pt]!==Lt[0][Pt])throw new Error("First and last Position are not equivalent.")}var Lr={type:"Polygon",coordinates:ie};return te(Lr,Me,ye)}function Qe(ie,Me,ye){return ye===void 0&&(ye={}),$t(ie.map(function(it){return K(it,Me)}),ye)}function xt(ie,Me,ye){if(ye===void 0&&(ye={}),ie.length<2)throw new Error("coordinates must be an array of two or more positions");var it={type:"LineString",coordinates:ie};return te(it,Me,ye)}function Ht(ie,Me,ye){return ye===void 0&&(ye={}),$t(ie.map(function(it){return xt(it,Me)}),ye)}function $t(ie,Me){Me===void 0&&(Me={});var ye={type:"FeatureCollection"};return Me.id&&(ye.id=Me.id),Me.bbox&&(ye.bbox=Me.bbox),ye.features=ie,ye}function Jt(ie,Me,ye){ye===void 0&&(ye={});var it={type:"MultiLineString",coordinates:ie};return te(it,Me,ye)}function Ft(ie,Me,ye){ye===void 0&&(ye={});var it={type:"MultiPoint",coordinates:ie};return te(it,Me,ye)}function Gt(ie,Me,ye){ye===void 0&&(ye={});var it={type:"MultiPolygon",coordinates:ie};return te(it,Me,ye)}function At(ie,Me,ye){ye===void 0&&(ye={});var it={type:"GeometryCollection",geometries:ie};return te(it,Me,ye)}function Et(ie,Me){if(Me===void 0&&(Me=0),Me&&!(Me>=0))throw new Error("precision must be a positive number");var ye=Math.pow(10,Me||0);return Math.round(ie*ye)/ye}function bt(ie,Me){Me===void 0&&(Me="kilometers");var ye=E[Me];if(!ye)throw new Error(Me+" units is invalid");return ie*ye}function er(ie,Me){Me===void 0&&(Me="kilometers");var ye=E[Me];if(!ye)throw new Error(Me+" units is invalid");return ie/ye}function q(ie,Me){return et(er(ie,Me))}function Bt(ie){var Me=ie%360;return Me<0&&(Me+=360),Me}function et(ie){var Me=ie%(2*Math.PI);return Me*180/Math.PI}function je(ie){var Me=ie%360;return Me*Math.PI/180}function nt(ie,Me,ye){if(Me===void 0&&(Me="kilometers"),ye===void 0&&(ye="kilometers"),!(ie>=0))throw new Error("length must be a positive number");return bt(er(ie,Me),ye)}function De(ie,Me,ye){if(Me===void 0&&(Me="meters"),ye===void 0&&(ye="kilometers"),!(ie>=0))throw new Error("area must be a positive number");var it=me[Me];if(!it)throw new Error("invalid original units");var lt=me[ye];if(!lt)throw new Error("invalid final units");return ie/it*lt}function It(ie){return!isNaN(ie)&&ie!==null&&!Array.isArray(ie)}function hr(ie){return!!ie&&ie.constructor===Object}function tr(ie){if(!ie)throw new Error("bbox is required");if(!Array.isArray(ie))throw new Error("bbox must be an Array");if(ie.length!==4&&ie.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");ie.forEach(function(Me){if(!It(Me))throw new Error("bbox must only contain numbers")})}function j(ie){if(!ie)throw new Error("id is required");if(["string","number"].indexOf(typeof ie)===-1)throw new Error("id must be a number or a string")}},91956:function(){},14920:function(){},52212:function(Rr,N,b){"use strict";b.d(N,{Z:function(){return q}});var re=b(19297),E=b(87062),p=b(59301),me=b(92691),te=b.n(me),ue=b(42349),ae=b(3181),Ne=function(Bt,et){var je={};for(var nt in Bt)Object.prototype.hasOwnProperty.call(Bt,nt)&&et.indexOf(nt)<0&&(je[nt]=Bt[nt]);if(Bt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var De=0,nt=Object.getOwnPropertySymbols(Bt);De<nt.length;De++)et.indexOf(nt[De])<0&&Object.prototype.propertyIsEnumerable.call(Bt,nt[De])&&(je[nt[De]]=Bt[nt[De]]);return je},K=function(et){var je=et.prefixCls,nt=et.className,De=et.hoverable,It=De===void 0?!0:De,hr=Ne(et,["prefixCls","className","hoverable"]);return p.createElement(ae.C,null,function(tr){var j=tr.getPrefixCls,ie=j("card",je),Me=te()("".concat(ie,"-grid"),nt,(0,re.Z)({},"".concat(ie,"-grid-hoverable"),It));return p.createElement("div",(0,E.Z)({},hr,{className:Me}))})},Qe=K,xt=function(Bt,et){var je={};for(var nt in Bt)Object.prototype.hasOwnProperty.call(Bt,nt)&&et.indexOf(nt)<0&&(je[nt]=Bt[nt]);if(Bt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var De=0,nt=Object.getOwnPropertySymbols(Bt);De<nt.length;De++)et.indexOf(nt[De])<0&&Object.prototype.propertyIsEnumerable.call(Bt,nt[De])&&(je[nt[De]]=Bt[nt[De]]);return je},Ht=function(et){return p.createElement(ae.C,null,function(je){var nt=je.getPrefixCls,De=et.prefixCls,It=et.className,hr=et.avatar,tr=et.title,j=et.description,ie=xt(et,["prefixCls","className","avatar","title","description"]),Me=nt("card",De),ye=te()("".concat(Me,"-meta"),It),it=hr?p.createElement("div",{className:"".concat(Me,"-meta-avatar")},hr):null,lt=tr?p.createElement("div",{className:"".concat(Me,"-meta-title")},tr):null,Lt=j?p.createElement("div",{className:"".concat(Me,"-meta-description")},j):null,Pt=lt||Lt?p.createElement("div",{className:"".concat(Me,"-meta-detail")},lt,Lt):null;return p.createElement("div",(0,E.Z)({},ie,{className:ye}),it,Pt)})},$t=Ht,Jt=b(98041),Ft=b(4701),Gt=b(34636),At=b(24147),Et=function(Bt,et){var je={};for(var nt in Bt)Object.prototype.hasOwnProperty.call(Bt,nt)&&et.indexOf(nt)<0&&(je[nt]=Bt[nt]);if(Bt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var De=0,nt=Object.getOwnPropertySymbols(Bt);De<nt.length;De++)et.indexOf(nt[De])<0&&Object.prototype.propertyIsEnumerable.call(Bt,nt[De])&&(je[nt[De]]=Bt[nt[De]]);return je};function bt(Bt){var et=Bt.map(function(je,nt){return p.createElement("li",{style:{width:"".concat(100/Bt.length,"%")},key:"action-".concat(nt)},p.createElement("span",null,je))});return et}var er=function(et){var je,nt,De=p.useContext(ae.E_),It=De.getPrefixCls,hr=De.direction,tr=p.useContext(At.Z),j=function(Xr){var yn;(yn=et.onTabChange)===null||yn===void 0||yn.call(et,Xr)},ie=function(){var Xr;return p.Children.forEach(et.children,function(yn){yn&&yn.type&&yn.type===Qe&&(Xr=!0)}),Xr},Me=et.prefixCls,ye=et.className,it=et.extra,lt=et.headStyle,Lt=lt===void 0?{}:lt,Pt=et.bodyStyle,Lr=Pt===void 0?{}:Pt,cn=et.title,qr=et.loading,fi=et.bordered,Yt=fi===void 0?!0:fi,he=et.size,Te=et.type,Ze=et.cover,Oe=et.actions,Ot=et.tabList,ar=et.children,ur=et.activeTabKey,Pr=et.defaultActiveTabKey,or=et.tabBarExtraContent,nn=et.hoverable,C=et.tabProps,V=C===void 0?{}:C,Ve=Et(et,["prefixCls","className","extra","headStyle","bodyStyle","title","loading","bordered","size","type","cover","actions","tabList","children","activeTabKey","defaultActiveTabKey","tabBarExtraContent","hoverable","tabProps"]),$e=It("card",Me),ct=Lr.padding===0||Lr.padding==="0px"?{padding:24}:void 0,Ct=p.createElement("div",{className:"".concat($e,"-loading-block")}),J=p.createElement("div",{className:"".concat($e,"-loading-content"),style:ct},p.createElement(Ft.Z,{gutter:8},p.createElement(Gt.Z,{span:22},Ct)),p.createElement(Ft.Z,{gutter:8},p.createElement(Gt.Z,{span:8},Ct),p.createElement(Gt.Z,{span:15},Ct)),p.createElement(Ft.Z,{gutter:8},p.createElement(Gt.Z,{span:6},Ct),p.createElement(Gt.Z,{span:18},Ct)),p.createElement(Ft.Z,{gutter:8},p.createElement(Gt.Z,{span:13},Ct),p.createElement(Gt.Z,{span:9},Ct)),p.createElement(Ft.Z,{gutter:8},p.createElement(Gt.Z,{span:4},Ct),p.createElement(Gt.Z,{span:3},Ct),p.createElement(Gt.Z,{span:16},Ct))),Wt=ur!==void 0,Tr=(0,E.Z)((0,E.Z)({},V),(je={},(0,re.Z)(je,Wt?"activeKey":"defaultActiveKey",Wt?ur:Pr),(0,re.Z)(je,"tabBarExtraContent",or),je)),Mr,Ke=Ot&&Ot.length?p.createElement(Jt.Z,(0,E.Z)({size:"large"},Tr,{className:"".concat($e,"-head-tabs"),onChange:j}),Ot.map(function(Hr){return p.createElement(Jt.Z.TabPane,{tab:Hr.tab,disabled:Hr.disabled,key:Hr.key})})):null;(cn||it||Ke)&&(Mr=p.createElement("div",{className:"".concat($e,"-head"),style:Lt},p.createElement("div",{className:"".concat($e,"-head-wrapper")},cn&&p.createElement("div",{className:"".concat($e,"-head-title")},cn),it&&p.createElement("div",{className:"".concat($e,"-extra")},it)),Ke));var ht=Ze?p.createElement("div",{className:"".concat($e,"-cover")},Ze):null,Mt=p.createElement("div",{className:"".concat($e,"-body"),style:Lr},qr?J:ar),Nt=Oe&&Oe.length?p.createElement("ul",{className:"".concat($e,"-actions")},bt(Oe)):null,br=(0,ue.Z)(Ve,["onTabChange"]),Sr=he||tr,Je=te()($e,(nt={},(0,re.Z)(nt,"".concat($e,"-loading"),qr),(0,re.Z)(nt,"".concat($e,"-bordered"),Yt),(0,re.Z)(nt,"".concat($e,"-hoverable"),nn),(0,re.Z)(nt,"".concat($e,"-contain-grid"),ie()),(0,re.Z)(nt,"".concat($e,"-contain-tabs"),Ot&&Ot.length),(0,re.Z)(nt,"".concat($e,"-").concat(Sr),Sr),(0,re.Z)(nt,"".concat($e,"-type-").concat(Te),!!Te),(0,re.Z)(nt,"".concat($e,"-rtl"),hr==="rtl"),nt),ye);return p.createElement("div",(0,E.Z)({},br,{className:Je}),Mr,ht,Mt,Nt)};er.Grid=Qe,er.Meta=$t;var q=er},76664:function(Rr,N,b){"use strict";var re=b(78446),E=b.n(re),p=b(91956),me=b.n(p),te=b(12337),ue=b(17051),ae=b(52916)},34636:function(Rr,N,b){"use strict";var re=b(34047);N.Z=re.Z},52916:function(Rr,N,b){"use strict";var re=b(78446),E=b.n(re),p=b(50028)},62110:function(Rr,N,b){"use strict";var re=b(59301),E=(0,re.createContext)({});N.Z=E},34047:function(Rr,N,b){"use strict";var re=b(19297),E=b(87062),p=b(53383),me=b(59301),te=b(92691),ue=b.n(te),ae=b(62110),Ne=b(3181),K=function($t,Jt){var Ft={};for(var Gt in $t)Object.prototype.hasOwnProperty.call($t,Gt)&&Jt.indexOf(Gt)<0&&(Ft[Gt]=$t[Gt]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var At=0,Gt=Object.getOwnPropertySymbols($t);At<Gt.length;At++)Jt.indexOf(Gt[At])<0&&Object.prototype.propertyIsEnumerable.call($t,Gt[At])&&(Ft[Gt[At]]=$t[Gt[At]]);return Ft};function Qe($t){return typeof $t=="number"?"".concat($t," ").concat($t," auto"):/^\d+(\.\d+)?(px|em|rem|%)$/.test($t)?"0 0 ".concat($t):$t}var xt=["xs","sm","md","lg","xl","xxl"],Ht=me.forwardRef(function($t,Jt){var Ft,Gt=me.useContext(Ne.E_),At=Gt.getPrefixCls,Et=Gt.direction,bt=me.useContext(ae.Z),er=bt.gutter,q=bt.wrap,Bt=bt.supportFlexGap,et=$t.prefixCls,je=$t.span,nt=$t.order,De=$t.offset,It=$t.push,hr=$t.pull,tr=$t.className,j=$t.children,ie=$t.flex,Me=$t.style,ye=K($t,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),it=At("col",et),lt={};xt.forEach(function(qr){var fi,Yt={},he=$t[qr];typeof he=="number"?Yt.span=he:(0,p.Z)(he)==="object"&&(Yt=he||{}),delete ye[qr],lt=(0,E.Z)((0,E.Z)({},lt),(fi={},(0,re.Z)(fi,"".concat(it,"-").concat(qr,"-").concat(Yt.span),Yt.span!==void 0),(0,re.Z)(fi,"".concat(it,"-").concat(qr,"-order-").concat(Yt.order),Yt.order||Yt.order===0),(0,re.Z)(fi,"".concat(it,"-").concat(qr,"-offset-").concat(Yt.offset),Yt.offset||Yt.offset===0),(0,re.Z)(fi,"".concat(it,"-").concat(qr,"-push-").concat(Yt.push),Yt.push||Yt.push===0),(0,re.Z)(fi,"".concat(it,"-").concat(qr,"-pull-").concat(Yt.pull),Yt.pull||Yt.pull===0),(0,re.Z)(fi,"".concat(it,"-rtl"),Et==="rtl"),fi))});var Lt=ue()(it,(Ft={},(0,re.Z)(Ft,"".concat(it,"-").concat(je),je!==void 0),(0,re.Z)(Ft,"".concat(it,"-order-").concat(nt),nt),(0,re.Z)(Ft,"".concat(it,"-offset-").concat(De),De),(0,re.Z)(Ft,"".concat(it,"-push-").concat(It),It),(0,re.Z)(Ft,"".concat(it,"-pull-").concat(hr),hr),Ft),tr,lt),Pt={};if(er&&er[0]>0){var Lr=er[0]/2;Pt.paddingLeft=Lr,Pt.paddingRight=Lr}if(er&&er[1]>0&&!Bt){var cn=er[1]/2;Pt.paddingTop=cn,Pt.paddingBottom=cn}return ie&&(Pt.flex=Qe(ie),ie==="auto"&&q===!1&&!Pt.minWidth&&(Pt.minWidth=0)),me.createElement("div",(0,E.Z)({},ye,{style:(0,E.Z)((0,E.Z)({},Pt),Me),className:Lt,ref:Jt}),j)});Ht.displayName="Col",N.Z=Ht},46728:function(Rr,N,b){"use strict";var re=b(87062),E=b(19297),p=b(53383),me=b(83405),te=b(59301),ue=b(92691),ae=b.n(ue),Ne=b(3181),K=b(62110),Qe=b(42442),xt=b(60291),Ht=b(15754),$t=function(At,Et){var bt={};for(var er in At)Object.prototype.hasOwnProperty.call(At,er)&&Et.indexOf(er)<0&&(bt[er]=At[er]);if(At!=null&&typeof Object.getOwnPropertySymbols=="function")for(var q=0,er=Object.getOwnPropertySymbols(At);q<er.length;q++)Et.indexOf(er[q])<0&&Object.prototype.propertyIsEnumerable.call(At,er[q])&&(bt[er[q]]=At[er[q]]);return bt},Jt=(0,Qe.b)("top","middle","bottom","stretch"),Ft=(0,Qe.b)("start","end","center","space-around","space-between"),Gt=te.forwardRef(function(At,Et){var bt,er=At.prefixCls,q=At.justify,Bt=At.align,et=At.className,je=At.style,nt=At.children,De=At.gutter,It=De===void 0?0:De,hr=At.wrap,tr=$t(At,["prefixCls","justify","align","className","style","children","gutter","wrap"]),j=te.useContext(Ne.E_),ie=j.getPrefixCls,Me=j.direction,ye=te.useState({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),it=(0,me.Z)(ye,2),lt=it[0],Lt=it[1],Pt=(0,Ht.Z)(),Lr=te.useRef(It);te.useEffect(function(){var ar=xt.ZP.subscribe(function(ur){var Pr=Lr.current||0;(!Array.isArray(Pr)&&(0,p.Z)(Pr)==="object"||Array.isArray(Pr)&&((0,p.Z)(Pr[0])==="object"||(0,p.Z)(Pr[1])==="object"))&&Lt(ur)});return function(){return xt.ZP.unsubscribe(ar)}},[]);var cn=function(){var ur=[0,0],Pr=Array.isArray(It)?It:[It,0];return Pr.forEach(function(or,nn){if((0,p.Z)(or)==="object")for(var C=0;C<xt.c4.length;C++){var V=xt.c4[C];if(lt[V]&&or[V]!==void 0){ur[nn]=or[V];break}}else ur[nn]=or||0}),ur},qr=ie("row",er),fi=cn(),Yt=ae()(qr,(bt={},(0,E.Z)(bt,"".concat(qr,"-no-wrap"),hr===!1),(0,E.Z)(bt,"".concat(qr,"-").concat(q),q),(0,E.Z)(bt,"".concat(qr,"-").concat(Bt),Bt),(0,E.Z)(bt,"".concat(qr,"-rtl"),Me==="rtl"),bt),et),he={},Te=fi[0]>0?fi[0]/-2:void 0,Ze=fi[1]>0?fi[1]/-2:void 0;if(Te&&(he.marginLeft=Te,he.marginRight=Te),Pt){var Oe=(0,me.Z)(fi,2);he.rowGap=Oe[1]}else Ze&&(he.marginTop=Ze,he.marginBottom=Ze);var Ot=te.useMemo(function(){return{gutter:fi,wrap:hr,supportFlexGap:Pt}},[fi,hr,Pt]);return te.createElement(K.Z.Provider,{value:Ot},te.createElement("div",(0,re.Z)({},tr,{className:Yt,style:(0,re.Z)((0,re.Z)({},he),je),ref:Et}),nt))});Gt.displayName="Row",N.Z=Gt},50028:function(Rr,N,b){"use strict";var re=b(78446),E=b.n(re),p=b(14920),me=b.n(p)},4701:function(Rr,N,b){"use strict";var re=b(46728);N.Z=re.Z},17051:function(Rr,N,b){"use strict";var re=b(78446),E=b.n(re),p=b(50028)},83628:function(Rr){"use strict";Rr.exports=N,Rr.exports.default=N;function N(ie,Me,ye){ye=ye||2;var it=Me&&Me.length,lt=it?Me[0]*ye:ie.length,Lt=b(ie,0,lt,ye,!0),Pt=[];if(!Lt||Lt.next===Lt.prev)return Pt;var Lr,cn,qr,fi,Yt,he,Te;if(it&&(Lt=ae(ie,Me,Lt,ye)),ie.length>80*ye){Lr=qr=ie[0],cn=fi=ie[1];for(var Ze=ye;Ze<lt;Ze+=ye)Yt=ie[Ze],he=ie[Ze+1],Yt<Lr&&(Lr=Yt),he<cn&&(cn=he),Yt>qr&&(qr=Yt),he>fi&&(fi=he);Te=Math.max(qr-Lr,fi-cn),Te=Te!==0?1/Te:0}return E(Lt,Pt,ye,Lr,cn,Te),Pt}function b(ie,Me,ye,it,lt){var Lt,Pt;if(lt===j(ie,Me,ye,it)>0)for(Lt=Me;Lt<ye;Lt+=it)Pt=It(Lt,ie[Lt],ie[Lt+1],Pt);else for(Lt=ye-it;Lt>=Me;Lt-=it)Pt=It(Lt,ie[Lt],ie[Lt+1],Pt);return Pt&&bt(Pt,Pt.next)&&(hr(Pt),Pt=Pt.next),Pt}function re(ie,Me){if(!ie)return ie;Me||(Me=ie);var ye=ie,it;do if(it=!1,!ye.steiner&&(bt(ye,ye.next)||Et(ye.prev,ye,ye.next)===0)){if(hr(ye),ye=Me=ye.prev,ye===ye.next)break;it=!0}else ye=ye.next;while(it||ye!==Me);return Me}function E(ie,Me,ye,it,lt,Lt,Pt){if(!!ie){!Pt&&Lt&&Ht(ie,it,lt,Lt);for(var Lr=ie,cn,qr;ie.prev!==ie.next;){if(cn=ie.prev,qr=ie.next,Lt?me(ie,it,lt,Lt):p(ie)){Me.push(cn.i/ye),Me.push(ie.i/ye),Me.push(qr.i/ye),hr(ie),ie=qr.next,Lr=qr.next;continue}if(ie=qr,ie===Lr){Pt?Pt===1?(ie=te(re(ie),Me,ye),E(ie,Me,ye,it,lt,Lt,2)):Pt===2&&ue(ie,Me,ye,it,lt,Lt):E(re(ie),Me,ye,it,lt,Lt,1);break}}}}function p(ie){var Me=ie.prev,ye=ie,it=ie.next;if(Et(Me,ye,it)>=0)return!1;for(var lt=ie.next.next;lt!==ie.prev;){if(Gt(Me.x,Me.y,ye.x,ye.y,it.x,it.y,lt.x,lt.y)&&Et(lt.prev,lt,lt.next)>=0)return!1;lt=lt.next}return!0}function me(ie,Me,ye,it){var lt=ie.prev,Lt=ie,Pt=ie.next;if(Et(lt,Lt,Pt)>=0)return!1;for(var Lr=lt.x<Lt.x?lt.x<Pt.x?lt.x:Pt.x:Lt.x<Pt.x?Lt.x:Pt.x,cn=lt.y<Lt.y?lt.y<Pt.y?lt.y:Pt.y:Lt.y<Pt.y?Lt.y:Pt.y,qr=lt.x>Lt.x?lt.x>Pt.x?lt.x:Pt.x:Lt.x>Pt.x?Lt.x:Pt.x,fi=lt.y>Lt.y?lt.y>Pt.y?lt.y:Pt.y:Lt.y>Pt.y?Lt.y:Pt.y,Yt=Jt(Lr,cn,Me,ye,it),he=Jt(qr,fi,Me,ye,it),Te=ie.prevZ,Ze=ie.nextZ;Te&&Te.z>=Yt&&Ze&&Ze.z<=he;){if(Te!==ie.prev&&Te!==ie.next&&Gt(lt.x,lt.y,Lt.x,Lt.y,Pt.x,Pt.y,Te.x,Te.y)&&Et(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,Ze!==ie.prev&&Ze!==ie.next&&Gt(lt.x,lt.y,Lt.x,Lt.y,Pt.x,Pt.y,Ze.x,Ze.y)&&Et(Ze.prev,Ze,Ze.next)>=0))return!1;Ze=Ze.nextZ}for(;Te&&Te.z>=Yt;){if(Te!==ie.prev&&Te!==ie.next&&Gt(lt.x,lt.y,Lt.x,Lt.y,Pt.x,Pt.y,Te.x,Te.y)&&Et(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;Ze&&Ze.z<=he;){if(Ze!==ie.prev&&Ze!==ie.next&&Gt(lt.x,lt.y,Lt.x,Lt.y,Pt.x,Pt.y,Ze.x,Ze.y)&&Et(Ze.prev,Ze,Ze.next)>=0)return!1;Ze=Ze.nextZ}return!0}function te(ie,Me,ye){var it=ie;do{var lt=it.prev,Lt=it.next.next;!bt(lt,Lt)&&er(lt,it,it.next,Lt)&&je(lt,Lt)&&je(Lt,lt)&&(Me.push(lt.i/ye),Me.push(it.i/ye),Me.push(Lt.i/ye),hr(it),hr(it.next),it=ie=Lt),it=it.next}while(it!==ie);return re(it)}function ue(ie,Me,ye,it,lt,Lt){var Pt=ie;do{for(var Lr=Pt.next.next;Lr!==Pt.prev;){if(Pt.i!==Lr.i&&At(Pt,Lr)){var cn=De(Pt,Lr);Pt=re(Pt,Pt.next),cn=re(cn,cn.next),E(Pt,Me,ye,it,lt,Lt),E(cn,Me,ye,it,lt,Lt);return}Lr=Lr.next}Pt=Pt.next}while(Pt!==ie)}function ae(ie,Me,ye,it){var lt=[],Lt,Pt,Lr,cn,qr;for(Lt=0,Pt=Me.length;Lt<Pt;Lt++)Lr=Me[Lt]*it,cn=Lt<Pt-1?Me[Lt+1]*it:ie.length,qr=b(ie,Lr,cn,it,!1),qr===qr.next&&(qr.steiner=!0),lt.push(Ft(qr));for(lt.sort(Ne),Lt=0;Lt<lt.length;Lt++)ye=K(lt[Lt],ye),ye=re(ye,ye.next);return ye}function Ne(ie,Me){return ie.x-Me.x}function K(ie,Me){var ye=Qe(ie,Me);if(!ye)return Me;var it=De(ye,ie),lt=re(ye,ye.next);return re(it,it.next),Me===ye?lt:Me}function Qe(ie,Me){var ye=Me,it=ie.x,lt=ie.y,Lt=-Infinity,Pt;do{if(lt<=ye.y&&lt>=ye.next.y&&ye.next.y!==ye.y){var Lr=ye.x+(lt-ye.y)*(ye.next.x-ye.x)/(ye.next.y-ye.y);if(Lr<=it&&Lr>Lt){if(Lt=Lr,Lr===it){if(lt===ye.y)return ye;if(lt===ye.next.y)return ye.next}Pt=ye.x<ye.next.x?ye:ye.next}}ye=ye.next}while(ye!==Me);if(!Pt)return null;if(it===Lt)return Pt;var cn=Pt,qr=Pt.x,fi=Pt.y,Yt=Infinity,he;ye=Pt;do it>=ye.x&&ye.x>=qr&&it!==ye.x&&Gt(lt<fi?it:Lt,lt,qr,fi,lt<fi?Lt:it,lt,ye.x,ye.y)&&(he=Math.abs(lt-ye.y)/(it-ye.x),je(ye,ie)&&(he<Yt||he===Yt&&(ye.x>Pt.x||ye.x===Pt.x&&xt(Pt,ye)))&&(Pt=ye,Yt=he)),ye=ye.next;while(ye!==cn);return Pt}function xt(ie,Me){return Et(ie.prev,ie,Me.prev)<0&&Et(Me.next,ie,ie.next)<0}function Ht(ie,Me,ye,it){var lt=ie;do lt.z===null&&(lt.z=Jt(lt.x,lt.y,Me,ye,it)),lt.prevZ=lt.prev,lt.nextZ=lt.next,lt=lt.next;while(lt!==ie);lt.prevZ.nextZ=null,lt.prevZ=null,$t(lt)}function $t(ie){var Me,ye,it,lt,Lt,Pt,Lr,cn,qr=1;do{for(ye=ie,ie=null,Lt=null,Pt=0;ye;){for(Pt++,it=ye,Lr=0,Me=0;Me<qr&&(Lr++,it=it.nextZ,!!it);Me++);for(cn=qr;Lr>0||cn>0&&it;)Lr!==0&&(cn===0||!it||ye.z<=it.z)?(lt=ye,ye=ye.nextZ,Lr--):(lt=it,it=it.nextZ,cn--),Lt?Lt.nextZ=lt:ie=lt,lt.prevZ=Lt,Lt=lt;ye=it}Lt.nextZ=null,qr*=2}while(Pt>1);return ie}function Jt(ie,Me,ye,it,lt){return ie=32767*(ie-ye)*lt,Me=32767*(Me-it)*lt,ie=(ie|ie<<8)&16711935,ie=(ie|ie<<4)&252645135,ie=(ie|ie<<2)&858993459,ie=(ie|ie<<1)&1431655765,Me=(Me|Me<<8)&16711935,Me=(Me|Me<<4)&252645135,Me=(Me|Me<<2)&858993459,Me=(Me|Me<<1)&1431655765,ie|Me<<1}function Ft(ie){var Me=ie,ye=ie;do(Me.x<ye.x||Me.x===ye.x&&Me.y<ye.y)&&(ye=Me),Me=Me.next;while(Me!==ie);return ye}function Gt(ie,Me,ye,it,lt,Lt,Pt,Lr){return(lt-Pt)*(Me-Lr)-(ie-Pt)*(Lt-Lr)>=0&&(ie-Pt)*(it-Lr)-(ye-Pt)*(Me-Lr)>=0&&(ye-Pt)*(Lt-Lr)-(lt-Pt)*(it-Lr)>=0}function At(ie,Me){return ie.next.i!==Me.i&&ie.prev.i!==Me.i&&!et(ie,Me)&&(je(ie,Me)&&je(Me,ie)&&nt(ie,Me)&&(Et(ie.prev,ie,Me.prev)||Et(ie,Me.prev,Me))||bt(ie,Me)&&Et(ie.prev,ie,ie.next)>0&&Et(Me.prev,Me,Me.next)>0)}function Et(ie,Me,ye){return(Me.y-ie.y)*(ye.x-Me.x)-(Me.x-ie.x)*(ye.y-Me.y)}function bt(ie,Me){return ie.x===Me.x&&ie.y===Me.y}function er(ie,Me,ye,it){var lt=Bt(Et(ie,Me,ye)),Lt=Bt(Et(ie,Me,it)),Pt=Bt(Et(ye,it,ie)),Lr=Bt(Et(ye,it,Me));return!!(lt!==Lt&&Pt!==Lr||lt===0&&q(ie,ye,Me)||Lt===0&&q(ie,it,Me)||Pt===0&&q(ye,ie,it)||Lr===0&&q(ye,Me,it))}function q(ie,Me,ye){return Me.x<=Math.max(ie.x,ye.x)&&Me.x>=Math.min(ie.x,ye.x)&&Me.y<=Math.max(ie.y,ye.y)&&Me.y>=Math.min(ie.y,ye.y)}function Bt(ie){return ie>0?1:ie<0?-1:0}function et(ie,Me){var ye=ie;do{if(ye.i!==ie.i&&ye.next.i!==ie.i&&ye.i!==Me.i&&ye.next.i!==Me.i&&er(ye,ye.next,ie,Me))return!0;ye=ye.next}while(ye!==ie);return!1}function je(ie,Me){return Et(ie.prev,ie,ie.next)<0?Et(ie,Me,ie.next)>=0&&Et(ie,ie.prev,Me)>=0:Et(ie,Me,ie.prev)<0||Et(ie,ie.next,Me)<0}function nt(ie,Me){var ye=ie,it=!1,lt=(ie.x+Me.x)/2,Lt=(ie.y+Me.y)/2;do ye.y>Lt!=ye.next.y>Lt&&ye.next.y!==ye.y&&lt<(ye.next.x-ye.x)*(Lt-ye.y)/(ye.next.y-ye.y)+ye.x&&(it=!it),ye=ye.next;while(ye!==ie);return it}function De(ie,Me){var ye=new tr(ie.i,ie.x,ie.y),it=new tr(Me.i,Me.x,Me.y),lt=ie.next,Lt=Me.prev;return ie.next=Me,Me.prev=ie,ye.next=lt,lt.prev=ye,it.next=ye,ye.prev=it,Lt.next=it,it.prev=Lt,it}function It(ie,Me,ye,it){var lt=new tr(ie,Me,ye);return it?(lt.next=it.next,lt.prev=it,it.next.prev=lt,it.next=lt):(lt.prev=lt,lt.next=lt),lt}function hr(ie){ie.next.prev=ie.prev,ie.prev.next=ie.next,ie.prevZ&&(ie.prevZ.nextZ=ie.nextZ),ie.nextZ&&(ie.nextZ.prevZ=ie.prevZ)}function tr(ie,Me,ye){this.i=ie,this.x=Me,this.y=ye,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}N.deviation=function(ie,Me,ye,it){var lt=Me&&Me.length,Lt=lt?Me[0]*ye:ie.length,Pt=Math.abs(j(ie,0,Lt,ye));if(lt)for(var Lr=0,cn=Me.length;Lr<cn;Lr++){var qr=Me[Lr]*ye,fi=Lr<cn-1?Me[Lr+1]*ye:ie.length;Pt-=Math.abs(j(ie,qr,fi,ye))}var Yt=0;for(Lr=0;Lr<it.length;Lr+=3){var he=it[Lr]*ye,Te=it[Lr+1]*ye,Ze=it[Lr+2]*ye;Yt+=Math.abs((ie[he]-ie[Ze])*(ie[Te+1]-ie[he+1])-(ie[he]-ie[Te])*(ie[Ze+1]-ie[he+1]))}return Pt===0&&Yt===0?0:Math.abs((Yt-Pt)/Pt)};function j(ie,Me,ye,it){for(var lt=0,Lt=Me,Pt=ye-it;Lt<ye;Lt+=it)lt+=(ie[Pt]-ie[Lt])*(ie[Lt+1]+ie[Pt+1]),Pt=Lt;return lt}N.flatten=function(ie){for(var Me=ie[0][0].length,ye={vertices:[],holes:[],dimensions:Me},it=0,lt=0;lt<ie.length;lt++){for(var Lt=0;Lt<ie[lt].length;Lt++)for(var Pt=0;Pt<Me;Pt++)ye.vertices.push(ie[lt][Lt][Pt]);lt>0&&(it+=ie[lt-1].length,ye.holes.push(it))}return ye}},67499:function(Rr){function N(re){var E=re.target||re.srcElement;E.__resizeRAF__&&cancelAnimationFrame(E.__resizeRAF__),E.__resizeRAF__=requestAnimationFrame(function(){var p=E.__resizeTrigger__,me=p&&p.__resizeListeners__;me&&me.forEach(function(te){te.call(p,re)})})}var b=function(E,p){var me=this,te=me.document,ue,ae=te.attachEvent;typeof navigator!="undefined"&&(ue=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Ne(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",N)}if(!E.__resizeListeners__)if(E.__resizeListeners__=[],ae)E.__resizeTrigger__=E,E.attachEvent("onresize",N);else{getComputedStyle(E).position==="static"&&(E.style.position="relative");var K=E.__resizeTrigger__=te.createElement("object");K.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),K.setAttribute("class","resize-sensor"),K.setAttribute("tabindex","-1"),K.setAttribute("title",""),K.__resizeElement__=E,K.onload=Ne,K.type="text/html",ue&&E.appendChild(K),K.data="about:blank",ue||E.appendChild(K)}E.__resizeListeners__.push(p)};Rr.exports=typeof window=="undefined"?b:b.bind(window),Rr.exports.unbind=function(re,E){var p=document.attachEvent,me=re.__resizeListeners__||[];if(E){var te=me.indexOf(E);te!==-1&&me.splice(te,1)}else me=re.__resizeListeners__=[];if(!me.length){if(p)re.detachEvent("onresize",N);else if(re.__resizeTrigger__){var ue=re.__resizeTrigger__.contentDocument,ae=ue&&ue.defaultView;ae&&(ae.removeEventListener("resize",N),delete ae.__resizeTrigger__),re.__resizeTrigger__=!re.removeChild(re.__resizeTrigger__)}delete re.__resizeListeners__}}},40666:function(Rr){"use strict";var N=Object.prototype.hasOwnProperty,b="~";function re(){}Object.create&&(re.prototype=Object.create(null),new re().__proto__||(b=!1));function E(ue,ae,Ne){this.fn=ue,this.context=ae,this.once=Ne||!1}function p(ue,ae,Ne,K,Qe){if(typeof Ne!="function")throw new TypeError("The listener must be a function");var xt=new E(Ne,K||ue,Qe),Ht=b?b+ae:ae;return ue._events[Ht]?ue._events[Ht].fn?ue._events[Ht]=[ue._events[Ht],xt]:ue._events[Ht].push(xt):(ue._events[Ht]=xt,ue._eventsCount++),ue}function me(ue,ae){--ue._eventsCount==0?ue._events=new re:delete ue._events[ae]}function te(){this._events=new re,this._eventsCount=0}te.prototype.eventNames=function(){var ae=[],Ne,K;if(this._eventsCount===0)return ae;for(K in Ne=this._events)N.call(Ne,K)&&ae.push(b?K.slice(1):K);return Object.getOwnPropertySymbols?ae.concat(Object.getOwnPropertySymbols(Ne)):ae},te.prototype.listeners=function(ae){var Ne=b?b+ae:ae,K=this._events[Ne];if(!K)return[];if(K.fn)return[K.fn];for(var Qe=0,xt=K.length,Ht=new Array(xt);Qe<xt;Qe++)Ht[Qe]=K[Qe].fn;return Ht},te.prototype.listenerCount=function(ae){var Ne=b?b+ae:ae,K=this._events[Ne];return K?K.fn?1:K.length:0},te.prototype.emit=function(ae,Ne,K,Qe,xt,Ht){var $t=b?b+ae:ae;if(!this._events[$t])return!1;var Jt=this._events[$t],Ft=arguments.length,Gt,At;if(Jt.fn){switch(Jt.once&&this.removeListener(ae,Jt.fn,void 0,!0),Ft){case 1:return Jt.fn.call(Jt.context),!0;case 2:return Jt.fn.call(Jt.context,Ne),!0;case 3:return Jt.fn.call(Jt.context,Ne,K),!0;case 4:return Jt.fn.call(Jt.context,Ne,K,Qe),!0;case 5:return Jt.fn.call(Jt.context,Ne,K,Qe,xt),!0;case 6:return Jt.fn.call(Jt.context,Ne,K,Qe,xt,Ht),!0}for(At=1,Gt=new Array(Ft-1);At<Ft;At++)Gt[At-1]=arguments[At];Jt.fn.apply(Jt.context,Gt)}else{var Et=Jt.length,bt;for(At=0;At<Et;At++)switch(Jt[At].once&&this.removeListener(ae,Jt[At].fn,void 0,!0),Ft){case 1:Jt[At].fn.call(Jt[At].context);break;case 2:Jt[At].fn.call(Jt[At].context,Ne);break;case 3:Jt[At].fn.call(Jt[At].context,Ne,K);break;case 4:Jt[At].fn.call(Jt[At].context,Ne,K,Qe);break;default:if(!Gt)for(bt=1,Gt=new Array(Ft-1);bt<Ft;bt++)Gt[bt-1]=arguments[bt];Jt[At].fn.apply(Jt[At].context,Gt)}}return!0},te.prototype.on=function(ae,Ne,K){return p(this,ae,Ne,K,!1)},te.prototype.once=function(ae,Ne,K){return p(this,ae,Ne,K,!0)},te.prototype.removeListener=function(ae,Ne,K,Qe){var xt=b?b+ae:ae;if(!this._events[xt])return this;if(!Ne)return me(this,xt),this;var Ht=this._events[xt];if(Ht.fn)Ht.fn===Ne&&(!Qe||Ht.once)&&(!K||Ht.context===K)&&me(this,xt);else{for(var $t=0,Jt=[],Ft=Ht.length;$t<Ft;$t++)(Ht[$t].fn!==Ne||Qe&&!Ht[$t].once||K&&Ht[$t].context!==K)&&Jt.push(Ht[$t]);Jt.length?this._events[xt]=Jt.length===1?Jt[0]:Jt:me(this,xt)}return this},te.prototype.removeAllListeners=function(ae){var Ne;return ae?(Ne=b?b+ae:ae,this._events[Ne]&&me(this,Ne)):(this._events=new re,this._eventsCount=0),this},te.prototype.off=te.prototype.removeListener,te.prototype.addListener=te.prototype.on,te.prefixed=b,te.EventEmitter=te,Rr.exports=te},74768:function(Rr,N,b){"use strict";b.r(N),b.d(N,{create:function(){return E},clone:function(){return p},copy:function(){return me},fromValues:function(){return te},set:function(){return ue},identity:function(){return ae},transpose:function(){return Ne},invert:function(){return K},adjoint:function(){return Qe},determinant:function(){return xt},multiply:function(){return Ht},translate:function(){return $t},scale:function(){return Jt},rotate:function(){return Ft},rotateX:function(){return Gt},rotateY:function(){return At},rotateZ:function(){return Et},fromTranslation:function(){return bt},fromScaling:function(){return er},fromRotation:function(){return q},fromXRotation:function(){return Bt},fromYRotation:function(){return et},fromZRotation:function(){return je},fromRotationTranslation:function(){return nt},fromQuat2:function(){return De},getTranslation:function(){return It},getScaling:function(){return hr},getRotation:function(){return tr},fromRotationTranslationScale:function(){return j},fromRotationTranslationScaleOrigin:function(){return ie},fromQuat:function(){return Me},frustum:function(){return ye},perspectiveNO:function(){return it},perspective:function(){return lt},perspectiveZO:function(){return Lt},perspectiveFromFieldOfView:function(){return Pt},orthoNO:function(){return Lr},ortho:function(){return cn},orthoZO:function(){return qr},lookAt:function(){return fi},targetTo:function(){return Yt},str:function(){return he},frob:function(){return Te},add:function(){return Ze},subtract:function(){return Oe},multiplyScalar:function(){return Ot},multiplyScalarAndAdd:function(){return ar},exactEquals:function(){return ur},equals:function(){return Pr},mul:function(){return or},sub:function(){return nn}});var re=b(72988);function E(){var C=new re.WT(16);return re.WT!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[11]=0,C[12]=0,C[13]=0,C[14]=0),C[0]=1,C[5]=1,C[10]=1,C[15]=1,C}function p(C){var V=new re.WT(16);return V[0]=C[0],V[1]=C[1],V[2]=C[2],V[3]=C[3],V[4]=C[4],V[5]=C[5],V[6]=C[6],V[7]=C[7],V[8]=C[8],V[9]=C[9],V[10]=C[10],V[11]=C[11],V[12]=C[12],V[13]=C[13],V[14]=C[14],V[15]=C[15],V}function me(C,V){return C[0]=V[0],C[1]=V[1],C[2]=V[2],C[3]=V[3],C[4]=V[4],C[5]=V[5],C[6]=V[6],C[7]=V[7],C[8]=V[8],C[9]=V[9],C[10]=V[10],C[11]=V[11],C[12]=V[12],C[13]=V[13],C[14]=V[14],C[15]=V[15],C}function te(C,V,Ve,$e,ct,Ct,J,Wt,Tr,Mr,Ke,ht,Mt,Nt,br,Sr){var Je=new re.WT(16);return Je[0]=C,Je[1]=V,Je[2]=Ve,Je[3]=$e,Je[4]=ct,Je[5]=Ct,Je[6]=J,Je[7]=Wt,Je[8]=Tr,Je[9]=Mr,Je[10]=Ke,Je[11]=ht,Je[12]=Mt,Je[13]=Nt,Je[14]=br,Je[15]=Sr,Je}function ue(C,V,Ve,$e,ct,Ct,J,Wt,Tr,Mr,Ke,ht,Mt,Nt,br,Sr,Je){return C[0]=V,C[1]=Ve,C[2]=$e,C[3]=ct,C[4]=Ct,C[5]=J,C[6]=Wt,C[7]=Tr,C[8]=Mr,C[9]=Ke,C[10]=ht,C[11]=Mt,C[12]=Nt,C[13]=br,C[14]=Sr,C[15]=Je,C}function ae(C){return C[0]=1,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=1,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=1,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function Ne(C,V){if(C===V){var Ve=V[1],$e=V[2],ct=V[3],Ct=V[6],J=V[7],Wt=V[11];C[1]=V[4],C[2]=V[8],C[3]=V[12],C[4]=Ve,C[6]=V[9],C[7]=V[13],C[8]=$e,C[9]=Ct,C[11]=V[14],C[12]=ct,C[13]=J,C[14]=Wt}else C[0]=V[0],C[1]=V[4],C[2]=V[8],C[3]=V[12],C[4]=V[1],C[5]=V[5],C[6]=V[9],C[7]=V[13],C[8]=V[2],C[9]=V[6],C[10]=V[10],C[11]=V[14],C[12]=V[3],C[13]=V[7],C[14]=V[11],C[15]=V[15];return C}function K(C,V){var Ve=V[0],$e=V[1],ct=V[2],Ct=V[3],J=V[4],Wt=V[5],Tr=V[6],Mr=V[7],Ke=V[8],ht=V[9],Mt=V[10],Nt=V[11],br=V[12],Sr=V[13],Je=V[14],Hr=V[15],Xr=Ve*Wt-$e*J,yn=Ve*Tr-ct*J,vr=Ve*Mr-Ct*J,Or=$e*Tr-ct*Wt,St=$e*Mr-Ct*Wt,Kn=ct*Mr-Ct*Tr,Ln=Ke*Sr-ht*br,zr=Ke*Je-Mt*br,Y=Ke*Hr-Nt*br,ce=ht*Je-Mt*Sr,ve=ht*Hr-Nt*Sr,B=Mt*Hr-Nt*Je,ee=Xr*B-yn*ve+vr*ce+Or*Y-St*zr+Kn*Ln;return ee?(ee=1/ee,C[0]=(Wt*B-Tr*ve+Mr*ce)*ee,C[1]=(ct*ve-$e*B-Ct*ce)*ee,C[2]=(Sr*Kn-Je*St+Hr*Or)*ee,C[3]=(Mt*St-ht*Kn-Nt*Or)*ee,C[4]=(Tr*Y-J*B-Mr*zr)*ee,C[5]=(Ve*B-ct*Y+Ct*zr)*ee,C[6]=(Je*vr-br*Kn-Hr*yn)*ee,C[7]=(Ke*Kn-Mt*vr+Nt*yn)*ee,C[8]=(J*ve-Wt*Y+Mr*Ln)*ee,C[9]=($e*Y-Ve*ve-Ct*Ln)*ee,C[10]=(br*St-Sr*vr+Hr*Xr)*ee,C[11]=(ht*vr-Ke*St-Nt*Xr)*ee,C[12]=(Wt*zr-J*ce-Tr*Ln)*ee,C[13]=(Ve*ce-$e*zr+ct*Ln)*ee,C[14]=(Sr*yn-br*Or-Je*Xr)*ee,C[15]=(Ke*Or-ht*yn+Mt*Xr)*ee,C):null}function Qe(C,V){var Ve=V[0],$e=V[1],ct=V[2],Ct=V[3],J=V[4],Wt=V[5],Tr=V[6],Mr=V[7],Ke=V[8],ht=V[9],Mt=V[10],Nt=V[11],br=V[12],Sr=V[13],Je=V[14],Hr=V[15];return C[0]=Wt*(Mt*Hr-Nt*Je)-ht*(Tr*Hr-Mr*Je)+Sr*(Tr*Nt-Mr*Mt),C[1]=-($e*(Mt*Hr-Nt*Je)-ht*(ct*Hr-Ct*Je)+Sr*(ct*Nt-Ct*Mt)),C[2]=$e*(Tr*Hr-Mr*Je)-Wt*(ct*Hr-Ct*Je)+Sr*(ct*Mr-Ct*Tr),C[3]=-($e*(Tr*Nt-Mr*Mt)-Wt*(ct*Nt-Ct*Mt)+ht*(ct*Mr-Ct*Tr)),C[4]=-(J*(Mt*Hr-Nt*Je)-Ke*(Tr*Hr-Mr*Je)+br*(Tr*Nt-Mr*Mt)),C[5]=Ve*(Mt*Hr-Nt*Je)-Ke*(ct*Hr-Ct*Je)+br*(ct*Nt-Ct*Mt),C[6]=-(Ve*(Tr*Hr-Mr*Je)-J*(ct*Hr-Ct*Je)+br*(ct*Mr-Ct*Tr)),C[7]=Ve*(Tr*Nt-Mr*Mt)-J*(ct*Nt-Ct*Mt)+Ke*(ct*Mr-Ct*Tr),C[8]=J*(ht*Hr-Nt*Sr)-Ke*(Wt*Hr-Mr*Sr)+br*(Wt*Nt-Mr*ht),C[9]=-(Ve*(ht*Hr-Nt*Sr)-Ke*($e*Hr-Ct*Sr)+br*($e*Nt-Ct*ht)),C[10]=Ve*(Wt*Hr-Mr*Sr)-J*($e*Hr-Ct*Sr)+br*($e*Mr-Ct*Wt),C[11]=-(Ve*(Wt*Nt-Mr*ht)-J*($e*Nt-Ct*ht)+Ke*($e*Mr-Ct*Wt)),C[12]=-(J*(ht*Je-Mt*Sr)-Ke*(Wt*Je-Tr*Sr)+br*(Wt*Mt-Tr*ht)),C[13]=Ve*(ht*Je-Mt*Sr)-Ke*($e*Je-ct*Sr)+br*($e*Mt-ct*ht),C[14]=-(Ve*(Wt*Je-Tr*Sr)-J*($e*Je-ct*Sr)+br*($e*Tr-ct*Wt)),C[15]=Ve*(Wt*Mt-Tr*ht)-J*($e*Mt-ct*ht)+Ke*($e*Tr-ct*Wt),C}function xt(C){var V=C[0],Ve=C[1],$e=C[2],ct=C[3],Ct=C[4],J=C[5],Wt=C[6],Tr=C[7],Mr=C[8],Ke=C[9],ht=C[10],Mt=C[11],Nt=C[12],br=C[13],Sr=C[14],Je=C[15],Hr=V*J-Ve*Ct,Xr=V*Wt-$e*Ct,yn=V*Tr-ct*Ct,vr=Ve*Wt-$e*J,Or=Ve*Tr-ct*J,St=$e*Tr-ct*Wt,Kn=Mr*br-Ke*Nt,Ln=Mr*Sr-ht*Nt,zr=Mr*Je-Mt*Nt,Y=Ke*Sr-ht*br,ce=Ke*Je-Mt*br,ve=ht*Je-Mt*Sr;return Hr*ve-Xr*ce+yn*Y+vr*zr-Or*Ln+St*Kn}function Ht(C,V,Ve){var $e=V[0],ct=V[1],Ct=V[2],J=V[3],Wt=V[4],Tr=V[5],Mr=V[6],Ke=V[7],ht=V[8],Mt=V[9],Nt=V[10],br=V[11],Sr=V[12],Je=V[13],Hr=V[14],Xr=V[15],yn=Ve[0],vr=Ve[1],Or=Ve[2],St=Ve[3];return C[0]=yn*$e+vr*Wt+Or*ht+St*Sr,C[1]=yn*ct+vr*Tr+Or*Mt+St*Je,C[2]=yn*Ct+vr*Mr+Or*Nt+St*Hr,C[3]=yn*J+vr*Ke+Or*br+St*Xr,yn=Ve[4],vr=Ve[5],Or=Ve[6],St=Ve[7],C[4]=yn*$e+vr*Wt+Or*ht+St*Sr,C[5]=yn*ct+vr*Tr+Or*Mt+St*Je,C[6]=yn*Ct+vr*Mr+Or*Nt+St*Hr,C[7]=yn*J+vr*Ke+Or*br+St*Xr,yn=Ve[8],vr=Ve[9],Or=Ve[10],St=Ve[11],C[8]=yn*$e+vr*Wt+Or*ht+St*Sr,C[9]=yn*ct+vr*Tr+Or*Mt+St*Je,C[10]=yn*Ct+vr*Mr+Or*Nt+St*Hr,C[11]=yn*J+vr*Ke+Or*br+St*Xr,yn=Ve[12],vr=Ve[13],Or=Ve[14],St=Ve[15],C[12]=yn*$e+vr*Wt+Or*ht+St*Sr,C[13]=yn*ct+vr*Tr+Or*Mt+St*Je,C[14]=yn*Ct+vr*Mr+Or*Nt+St*Hr,C[15]=yn*J+vr*Ke+Or*br+St*Xr,C}function $t(C,V,Ve){var $e=Ve[0],ct=Ve[1],Ct=Ve[2],J,Wt,Tr,Mr,Ke,ht,Mt,Nt,br,Sr,Je,Hr;return V===C?(C[12]=V[0]*$e+V[4]*ct+V[8]*Ct+V[12],C[13]=V[1]*$e+V[5]*ct+V[9]*Ct+V[13],C[14]=V[2]*$e+V[6]*ct+V[10]*Ct+V[14],C[15]=V[3]*$e+V[7]*ct+V[11]*Ct+V[15]):(J=V[0],Wt=V[1],Tr=V[2],Mr=V[3],Ke=V[4],ht=V[5],Mt=V[6],Nt=V[7],br=V[8],Sr=V[9],Je=V[10],Hr=V[11],C[0]=J,C[1]=Wt,C[2]=Tr,C[3]=Mr,C[4]=Ke,C[5]=ht,C[6]=Mt,C[7]=Nt,C[8]=br,C[9]=Sr,C[10]=Je,C[11]=Hr,C[12]=J*$e+Ke*ct+br*Ct+V[12],C[13]=Wt*$e+ht*ct+Sr*Ct+V[13],C[14]=Tr*$e+Mt*ct+Je*Ct+V[14],C[15]=Mr*$e+Nt*ct+Hr*Ct+V[15]),C}function Jt(C,V,Ve){var $e=Ve[0],ct=Ve[1],Ct=Ve[2];return C[0]=V[0]*$e,C[1]=V[1]*$e,C[2]=V[2]*$e,C[3]=V[3]*$e,C[4]=V[4]*ct,C[5]=V[5]*ct,C[6]=V[6]*ct,C[7]=V[7]*ct,C[8]=V[8]*Ct,C[9]=V[9]*Ct,C[10]=V[10]*Ct,C[11]=V[11]*Ct,C[12]=V[12],C[13]=V[13],C[14]=V[14],C[15]=V[15],C}function Ft(C,V,Ve,$e){var ct=$e[0],Ct=$e[1],J=$e[2],Wt=Math.hypot(ct,Ct,J),Tr,Mr,Ke,ht,Mt,Nt,br,Sr,Je,Hr,Xr,yn,vr,Or,St,Kn,Ln,zr,Y,ce,ve,B,ee,pe;return Wt<re.Ib?null:(Wt=1/Wt,ct*=Wt,Ct*=Wt,J*=Wt,Tr=Math.sin(Ve),Mr=Math.cos(Ve),Ke=1-Mr,ht=V[0],Mt=V[1],Nt=V[2],br=V[3],Sr=V[4],Je=V[5],Hr=V[6],Xr=V[7],yn=V[8],vr=V[9],Or=V[10],St=V[11],Kn=ct*ct*Ke+Mr,Ln=Ct*ct*Ke+J*Tr,zr=J*ct*Ke-Ct*Tr,Y=ct*Ct*Ke-J*Tr,ce=Ct*Ct*Ke+Mr,ve=J*Ct*Ke+ct*Tr,B=ct*J*Ke+Ct*Tr,ee=Ct*J*Ke-ct*Tr,pe=J*J*Ke+Mr,C[0]=ht*Kn+Sr*Ln+yn*zr,C[1]=Mt*Kn+Je*Ln+vr*zr,C[2]=Nt*Kn+Hr*Ln+Or*zr,C[3]=br*Kn+Xr*Ln+St*zr,C[4]=ht*Y+Sr*ce+yn*ve,C[5]=Mt*Y+Je*ce+vr*ve,C[6]=Nt*Y+Hr*ce+Or*ve,C[7]=br*Y+Xr*ce+St*ve,C[8]=ht*B+Sr*ee+yn*pe,C[9]=Mt*B+Je*ee+vr*pe,C[10]=Nt*B+Hr*ee+Or*pe,C[11]=br*B+Xr*ee+St*pe,V!==C&&(C[12]=V[12],C[13]=V[13],C[14]=V[14],C[15]=V[15]),C)}function Gt(C,V,Ve){var $e=Math.sin(Ve),ct=Math.cos(Ve),Ct=V[4],J=V[5],Wt=V[6],Tr=V[7],Mr=V[8],Ke=V[9],ht=V[10],Mt=V[11];return V!==C&&(C[0]=V[0],C[1]=V[1],C[2]=V[2],C[3]=V[3],C[12]=V[12],C[13]=V[13],C[14]=V[14],C[15]=V[15]),C[4]=Ct*ct+Mr*$e,C[5]=J*ct+Ke*$e,C[6]=Wt*ct+ht*$e,C[7]=Tr*ct+Mt*$e,C[8]=Mr*ct-Ct*$e,C[9]=Ke*ct-J*$e,C[10]=ht*ct-Wt*$e,C[11]=Mt*ct-Tr*$e,C}function At(C,V,Ve){var $e=Math.sin(Ve),ct=Math.cos(Ve),Ct=V[0],J=V[1],Wt=V[2],Tr=V[3],Mr=V[8],Ke=V[9],ht=V[10],Mt=V[11];return V!==C&&(C[4]=V[4],C[5]=V[5],C[6]=V[6],C[7]=V[7],C[12]=V[12],C[13]=V[13],C[14]=V[14],C[15]=V[15]),C[0]=Ct*ct-Mr*$e,C[1]=J*ct-Ke*$e,C[2]=Wt*ct-ht*$e,C[3]=Tr*ct-Mt*$e,C[8]=Ct*$e+Mr*ct,C[9]=J*$e+Ke*ct,C[10]=Wt*$e+ht*ct,C[11]=Tr*$e+Mt*ct,C}function Et(C,V,Ve){var $e=Math.sin(Ve),ct=Math.cos(Ve),Ct=V[0],J=V[1],Wt=V[2],Tr=V[3],Mr=V[4],Ke=V[5],ht=V[6],Mt=V[7];return V!==C&&(C[8]=V[8],C[9]=V[9],C[10]=V[10],C[11]=V[11],C[12]=V[12],C[13]=V[13],C[14]=V[14],C[15]=V[15]),C[0]=Ct*ct+Mr*$e,C[1]=J*ct+Ke*$e,C[2]=Wt*ct+ht*$e,C[3]=Tr*ct+Mt*$e,C[4]=Mr*ct-Ct*$e,C[5]=Ke*ct-J*$e,C[6]=ht*ct-Wt*$e,C[7]=Mt*ct-Tr*$e,C}function bt(C,V){return C[0]=1,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=1,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=1,C[11]=0,C[12]=V[0],C[13]=V[1],C[14]=V[2],C[15]=1,C}function er(C,V){return C[0]=V[0],C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=V[1],C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=V[2],C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function q(C,V,Ve){var $e=Ve[0],ct=Ve[1],Ct=Ve[2],J=Math.hypot($e,ct,Ct),Wt,Tr,Mr;return J<re.Ib?null:(J=1/J,$e*=J,ct*=J,Ct*=J,Wt=Math.sin(V),Tr=Math.cos(V),Mr=1-Tr,C[0]=$e*$e*Mr+Tr,C[1]=ct*$e*Mr+Ct*Wt,C[2]=Ct*$e*Mr-ct*Wt,C[3]=0,C[4]=$e*ct*Mr-Ct*Wt,C[5]=ct*ct*Mr+Tr,C[6]=Ct*ct*Mr+$e*Wt,C[7]=0,C[8]=$e*Ct*Mr+ct*Wt,C[9]=ct*Ct*Mr-$e*Wt,C[10]=Ct*Ct*Mr+Tr,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C)}function Bt(C,V){var Ve=Math.sin(V),$e=Math.cos(V);return C[0]=1,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=$e,C[6]=Ve,C[7]=0,C[8]=0,C[9]=-Ve,C[10]=$e,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function et(C,V){var Ve=Math.sin(V),$e=Math.cos(V);return C[0]=$e,C[1]=0,C[2]=-Ve,C[3]=0,C[4]=0,C[5]=1,C[6]=0,C[7]=0,C[8]=Ve,C[9]=0,C[10]=$e,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function je(C,V){var Ve=Math.sin(V),$e=Math.cos(V);return C[0]=$e,C[1]=Ve,C[2]=0,C[3]=0,C[4]=-Ve,C[5]=$e,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=1,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function nt(C,V,Ve){var $e=V[0],ct=V[1],Ct=V[2],J=V[3],Wt=$e+$e,Tr=ct+ct,Mr=Ct+Ct,Ke=$e*Wt,ht=$e*Tr,Mt=$e*Mr,Nt=ct*Tr,br=ct*Mr,Sr=Ct*Mr,Je=J*Wt,Hr=J*Tr,Xr=J*Mr;return C[0]=1-(Nt+Sr),C[1]=ht+Xr,C[2]=Mt-Hr,C[3]=0,C[4]=ht-Xr,C[5]=1-(Ke+Sr),C[6]=br+Je,C[7]=0,C[8]=Mt+Hr,C[9]=br-Je,C[10]=1-(Ke+Nt),C[11]=0,C[12]=Ve[0],C[13]=Ve[1],C[14]=Ve[2],C[15]=1,C}function De(C,V){var Ve=new re.WT(3),$e=-V[0],ct=-V[1],Ct=-V[2],J=V[3],Wt=V[4],Tr=V[5],Mr=V[6],Ke=V[7],ht=$e*$e+ct*ct+Ct*Ct+J*J;return ht>0?(Ve[0]=(Wt*J+Ke*$e+Tr*Ct-Mr*ct)*2/ht,Ve[1]=(Tr*J+Ke*ct+Mr*$e-Wt*Ct)*2/ht,Ve[2]=(Mr*J+Ke*Ct+Wt*ct-Tr*$e)*2/ht):(Ve[0]=(Wt*J+Ke*$e+Tr*Ct-Mr*ct)*2,Ve[1]=(Tr*J+Ke*ct+Mr*$e-Wt*Ct)*2,Ve[2]=(Mr*J+Ke*Ct+Wt*ct-Tr*$e)*2),nt(C,V,Ve),C}function It(C,V){return C[0]=V[12],C[1]=V[13],C[2]=V[14],C}function hr(C,V){var Ve=V[0],$e=V[1],ct=V[2],Ct=V[4],J=V[5],Wt=V[6],Tr=V[8],Mr=V[9],Ke=V[10];return C[0]=Math.hypot(Ve,$e,ct),C[1]=Math.hypot(Ct,J,Wt),C[2]=Math.hypot(Tr,Mr,Ke),C}function tr(C,V){var Ve=new re.WT(3);hr(Ve,V);var $e=1/Ve[0],ct=1/Ve[1],Ct=1/Ve[2],J=V[0]*$e,Wt=V[1]*ct,Tr=V[2]*Ct,Mr=V[4]*$e,Ke=V[5]*ct,ht=V[6]*Ct,Mt=V[8]*$e,Nt=V[9]*ct,br=V[10]*Ct,Sr=J+Ke+br,Je=0;return Sr>0?(Je=Math.sqrt(Sr+1)*2,C[3]=.25*Je,C[0]=(ht-Nt)/Je,C[1]=(Mt-Tr)/Je,C[2]=(Wt-Mr)/Je):J>Ke&&J>br?(Je=Math.sqrt(1+J-Ke-br)*2,C[3]=(ht-Nt)/Je,C[0]=.25*Je,C[1]=(Wt+Mr)/Je,C[2]=(Mt+Tr)/Je):Ke>br?(Je=Math.sqrt(1+Ke-J-br)*2,C[3]=(Mt-Tr)/Je,C[0]=(Wt+Mr)/Je,C[1]=.25*Je,C[2]=(ht+Nt)/Je):(Je=Math.sqrt(1+br-J-Ke)*2,C[3]=(Wt-Mr)/Je,C[0]=(Mt+Tr)/Je,C[1]=(ht+Nt)/Je,C[2]=.25*Je),C}function j(C,V,Ve,$e){var ct=V[0],Ct=V[1],J=V[2],Wt=V[3],Tr=ct+ct,Mr=Ct+Ct,Ke=J+J,ht=ct*Tr,Mt=ct*Mr,Nt=ct*Ke,br=Ct*Mr,Sr=Ct*Ke,Je=J*Ke,Hr=Wt*Tr,Xr=Wt*Mr,yn=Wt*Ke,vr=$e[0],Or=$e[1],St=$e[2];return C[0]=(1-(br+Je))*vr,C[1]=(Mt+yn)*vr,C[2]=(Nt-Xr)*vr,C[3]=0,C[4]=(Mt-yn)*Or,C[5]=(1-(ht+Je))*Or,C[6]=(Sr+Hr)*Or,C[7]=0,C[8]=(Nt+Xr)*St,C[9]=(Sr-Hr)*St,C[10]=(1-(ht+br))*St,C[11]=0,C[12]=Ve[0],C[13]=Ve[1],C[14]=Ve[2],C[15]=1,C}function ie(C,V,Ve,$e,ct){var Ct=V[0],J=V[1],Wt=V[2],Tr=V[3],Mr=Ct+Ct,Ke=J+J,ht=Wt+Wt,Mt=Ct*Mr,Nt=Ct*Ke,br=Ct*ht,Sr=J*Ke,Je=J*ht,Hr=Wt*ht,Xr=Tr*Mr,yn=Tr*Ke,vr=Tr*ht,Or=$e[0],St=$e[1],Kn=$e[2],Ln=ct[0],zr=ct[1],Y=ct[2],ce=(1-(Sr+Hr))*Or,ve=(Nt+vr)*Or,B=(br-yn)*Or,ee=(Nt-vr)*St,pe=(1-(Mt+Hr))*St,Ae=(Je+Xr)*St,oe=(br+yn)*Kn,_e=(Je-Xr)*Kn,dt=(1-(Mt+Sr))*Kn;return C[0]=ce,C[1]=ve,C[2]=B,C[3]=0,C[4]=ee,C[5]=pe,C[6]=Ae,C[7]=0,C[8]=oe,C[9]=_e,C[10]=dt,C[11]=0,C[12]=Ve[0]+Ln-(ce*Ln+ee*zr+oe*Y),C[13]=Ve[1]+zr-(ve*Ln+pe*zr+_e*Y),C[14]=Ve[2]+Y-(B*Ln+Ae*zr+dt*Y),C[15]=1,C}function Me(C,V){var Ve=V[0],$e=V[1],ct=V[2],Ct=V[3],J=Ve+Ve,Wt=$e+$e,Tr=ct+ct,Mr=Ve*J,Ke=$e*J,ht=$e*Wt,Mt=ct*J,Nt=ct*Wt,br=ct*Tr,Sr=Ct*J,Je=Ct*Wt,Hr=Ct*Tr;return C[0]=1-ht-br,C[1]=Ke+Hr,C[2]=Mt-Je,C[3]=0,C[4]=Ke-Hr,C[5]=1-Mr-br,C[6]=Nt+Sr,C[7]=0,C[8]=Mt+Je,C[9]=Nt-Sr,C[10]=1-Mr-ht,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function ye(C,V,Ve,$e,ct,Ct,J){var Wt=1/(Ve-V),Tr=1/(ct-$e),Mr=1/(Ct-J);return C[0]=Ct*2*Wt,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=Ct*2*Tr,C[6]=0,C[7]=0,C[8]=(Ve+V)*Wt,C[9]=(ct+$e)*Tr,C[10]=(J+Ct)*Mr,C[11]=-1,C[12]=0,C[13]=0,C[14]=J*Ct*2*Mr,C[15]=0,C}function it(C,V,Ve,$e,ct){var Ct=1/Math.tan(V/2),J;return C[0]=Ct/Ve,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=Ct,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[11]=-1,C[12]=0,C[13]=0,C[15]=0,ct!=null&&ct!==Infinity?(J=1/($e-ct),C[10]=(ct+$e)*J,C[14]=2*ct*$e*J):(C[10]=-1,C[14]=-2*$e),C}var lt=it;function Lt(C,V,Ve,$e,ct){var Ct=1/Math.tan(V/2),J;return C[0]=Ct/Ve,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=Ct,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[11]=-1,C[12]=0,C[13]=0,C[15]=0,ct!=null&&ct!==Infinity?(J=1/($e-ct),C[10]=ct*J,C[14]=ct*$e*J):(C[10]=-1,C[14]=-$e),C}function Pt(C,V,Ve,$e){var ct=Math.tan(V.upDegrees*Math.PI/180),Ct=Math.tan(V.downDegrees*Math.PI/180),J=Math.tan(V.leftDegrees*Math.PI/180),Wt=Math.tan(V.rightDegrees*Math.PI/180),Tr=2/(J+Wt),Mr=2/(ct+Ct);return C[0]=Tr,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=Mr,C[6]=0,C[7]=0,C[8]=-((J-Wt)*Tr*.5),C[9]=(ct-Ct)*Mr*.5,C[10]=$e/(Ve-$e),C[11]=-1,C[12]=0,C[13]=0,C[14]=$e*Ve/(Ve-$e),C[15]=0,C}function Lr(C,V,Ve,$e,ct,Ct,J){var Wt=1/(V-Ve),Tr=1/($e-ct),Mr=1/(Ct-J);return C[0]=-2*Wt,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=-2*Tr,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=2*Mr,C[11]=0,C[12]=(V+Ve)*Wt,C[13]=(ct+$e)*Tr,C[14]=(J+Ct)*Mr,C[15]=1,C}var cn=Lr;function qr(C,V,Ve,$e,ct,Ct,J){var Wt=1/(V-Ve),Tr=1/($e-ct),Mr=1/(Ct-J);return C[0]=-2*Wt,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=-2*Tr,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=Mr,C[11]=0,C[12]=(V+Ve)*Wt,C[13]=(ct+$e)*Tr,C[14]=Ct*Mr,C[15]=1,C}function fi(C,V,Ve,$e){var ct,Ct,J,Wt,Tr,Mr,Ke,ht,Mt,Nt,br=V[0],Sr=V[1],Je=V[2],Hr=$e[0],Xr=$e[1],yn=$e[2],vr=Ve[0],Or=Ve[1],St=Ve[2];return Math.abs(br-vr)<re.Ib&&Math.abs(Sr-Or)<re.Ib&&Math.abs(Je-St)<re.Ib?ae(C):(Ke=br-vr,ht=Sr-Or,Mt=Je-St,Nt=1/Math.hypot(Ke,ht,Mt),Ke*=Nt,ht*=Nt,Mt*=Nt,ct=Xr*Mt-yn*ht,Ct=yn*Ke-Hr*Mt,J=Hr*ht-Xr*Ke,Nt=Math.hypot(ct,Ct,J),Nt?(Nt=1/Nt,ct*=Nt,Ct*=Nt,J*=Nt):(ct=0,Ct=0,J=0),Wt=ht*J-Mt*Ct,Tr=Mt*ct-Ke*J,Mr=Ke*Ct-ht*ct,Nt=Math.hypot(Wt,Tr,Mr),Nt?(Nt=1/Nt,Wt*=Nt,Tr*=Nt,Mr*=Nt):(Wt=0,Tr=0,Mr=0),C[0]=ct,C[1]=Wt,C[2]=Ke,C[3]=0,C[4]=Ct,C[5]=Tr,C[6]=ht,C[7]=0,C[8]=J,C[9]=Mr,C[10]=Mt,C[11]=0,C[12]=-(ct*br+Ct*Sr+J*Je),C[13]=-(Wt*br+Tr*Sr+Mr*Je),C[14]=-(Ke*br+ht*Sr+Mt*Je),C[15]=1,C)}function Yt(C,V,Ve,$e){var ct=V[0],Ct=V[1],J=V[2],Wt=$e[0],Tr=$e[1],Mr=$e[2],Ke=ct-Ve[0],ht=Ct-Ve[1],Mt=J-Ve[2],Nt=Ke*Ke+ht*ht+Mt*Mt;Nt>0&&(Nt=1/Math.sqrt(Nt),Ke*=Nt,ht*=Nt,Mt*=Nt);var br=Tr*Mt-Mr*ht,Sr=Mr*Ke-Wt*Mt,Je=Wt*ht-Tr*Ke;return Nt=br*br+Sr*Sr+Je*Je,Nt>0&&(Nt=1/Math.sqrt(Nt),br*=Nt,Sr*=Nt,Je*=Nt),C[0]=br,C[1]=Sr,C[2]=Je,C[3]=0,C[4]=ht*Je-Mt*Sr,C[5]=Mt*br-Ke*Je,C[6]=Ke*Sr-ht*br,C[7]=0,C[8]=Ke,C[9]=ht,C[10]=Mt,C[11]=0,C[12]=ct,C[13]=Ct,C[14]=J,C[15]=1,C}function he(C){return"mat4("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+", "+C[4]+", "+C[5]+", "+C[6]+", "+C[7]+", "+C[8]+", "+C[9]+", "+C[10]+", "+C[11]+", "+C[12]+", "+C[13]+", "+C[14]+", "+C[15]+")"}function Te(C){return Math.hypot(C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15])}function Ze(C,V,Ve){return C[0]=V[0]+Ve[0],C[1]=V[1]+Ve[1],C[2]=V[2]+Ve[2],C[3]=V[3]+Ve[3],C[4]=V[4]+Ve[4],C[5]=V[5]+Ve[5],C[6]=V[6]+Ve[6],C[7]=V[7]+Ve[7],C[8]=V[8]+Ve[8],C[9]=V[9]+Ve[9],C[10]=V[10]+Ve[10],C[11]=V[11]+Ve[11],C[12]=V[12]+Ve[12],C[13]=V[13]+Ve[13],C[14]=V[14]+Ve[14],C[15]=V[15]+Ve[15],C}function Oe(C,V,Ve){return C[0]=V[0]-Ve[0],C[1]=V[1]-Ve[1],C[2]=V[2]-Ve[2],C[3]=V[3]-Ve[3],C[4]=V[4]-Ve[4],C[5]=V[5]-Ve[5],C[6]=V[6]-Ve[6],C[7]=V[7]-Ve[7],C[8]=V[8]-Ve[8],C[9]=V[9]-Ve[9],C[10]=V[10]-Ve[10],C[11]=V[11]-Ve[11],C[12]=V[12]-Ve[12],C[13]=V[13]-Ve[13],C[14]=V[14]-Ve[14],C[15]=V[15]-Ve[15],C}function Ot(C,V,Ve){return C[0]=V[0]*Ve,C[1]=V[1]*Ve,C[2]=V[2]*Ve,C[3]=V[3]*Ve,C[4]=V[4]*Ve,C[5]=V[5]*Ve,C[6]=V[6]*Ve,C[7]=V[7]*Ve,C[8]=V[8]*Ve,C[9]=V[9]*Ve,C[10]=V[10]*Ve,C[11]=V[11]*Ve,C[12]=V[12]*Ve,C[13]=V[13]*Ve,C[14]=V[14]*Ve,C[15]=V[15]*Ve,C}function ar(C,V,Ve,$e){return C[0]=V[0]+Ve[0]*$e,C[1]=V[1]+Ve[1]*$e,C[2]=V[2]+Ve[2]*$e,C[3]=V[3]+Ve[3]*$e,C[4]=V[4]+Ve[4]*$e,C[5]=V[5]+Ve[5]*$e,C[6]=V[6]+Ve[6]*$e,C[7]=V[7]+Ve[7]*$e,C[8]=V[8]+Ve[8]*$e,C[9]=V[9]+Ve[9]*$e,C[10]=V[10]+Ve[10]*$e,C[11]=V[11]+Ve[11]*$e,C[12]=V[12]+Ve[12]*$e,C[13]=V[13]+Ve[13]*$e,C[14]=V[14]+Ve[14]*$e,C[15]=V[15]+Ve[15]*$e,C}function ur(C,V){return C[0]===V[0]&&C[1]===V[1]&&C[2]===V[2]&&C[3]===V[3]&&C[4]===V[4]&&C[5]===V[5]&&C[6]===V[6]&&C[7]===V[7]&&C[8]===V[8]&&C[9]===V[9]&&C[10]===V[10]&&C[11]===V[11]&&C[12]===V[12]&&C[13]===V[13]&&C[14]===V[14]&&C[15]===V[15]}function Pr(C,V){var Ve=C[0],$e=C[1],ct=C[2],Ct=C[3],J=C[4],Wt=C[5],Tr=C[6],Mr=C[7],Ke=C[8],ht=C[9],Mt=C[10],Nt=C[11],br=C[12],Sr=C[13],Je=C[14],Hr=C[15],Xr=V[0],yn=V[1],vr=V[2],Or=V[3],St=V[4],Kn=V[5],Ln=V[6],zr=V[7],Y=V[8],ce=V[9],ve=V[10],B=V[11],ee=V[12],pe=V[13],Ae=V[14],oe=V[15];return Math.abs(Ve-Xr)<=re.Ib*Math.max(1,Math.abs(Ve),Math.abs(Xr))&&Math.abs($e-yn)<=re.Ib*Math.max(1,Math.abs($e),Math.abs(yn))&&Math.abs(ct-vr)<=re.Ib*Math.max(1,Math.abs(ct),Math.abs(vr))&&Math.abs(Ct-Or)<=re.Ib*Math.max(1,Math.abs(Ct),Math.abs(Or))&&Math.abs(J-St)<=re.Ib*Math.max(1,Math.abs(J),Math.abs(St))&&Math.abs(Wt-Kn)<=re.Ib*Math.max(1,Math.abs(Wt),Math.abs(Kn))&&Math.abs(Tr-Ln)<=re.Ib*Math.max(1,Math.abs(Tr),Math.abs(Ln))&&Math.abs(Mr-zr)<=re.Ib*Math.max(1,Math.abs(Mr),Math.abs(zr))&&Math.abs(Ke-Y)<=re.Ib*Math.max(1,Math.abs(Ke),Math.abs(Y))&&Math.abs(ht-ce)<=re.Ib*Math.max(1,Math.abs(ht),Math.abs(ce))&&Math.abs(Mt-ve)<=re.Ib*Math.max(1,Math.abs(Mt),Math.abs(ve))&&Math.abs(Nt-B)<=re.Ib*Math.max(1,Math.abs(Nt),Math.abs(B))&&Math.abs(br-ee)<=re.Ib*Math.max(1,Math.abs(br),Math.abs(ee))&&Math.abs(Sr-pe)<=re.Ib*Math.max(1,Math.abs(Sr),Math.abs(pe))&&Math.abs(Je-Ae)<=re.Ib*Math.max(1,Math.abs(Je),Math.abs(Ae))&&Math.abs(Hr-oe)<=re.Ib*Math.max(1,Math.abs(Hr),Math.abs(oe))}var or=Ht,nn=Oe},93311:function(Rr,N,b){"use strict";b.d(N,{Ue:function(){return E},al:function(){return me},bA:function(){return Gt},fF:function(){return tr}});var re=b(72988);function E(){var he=new re.WT(4);return re.WT!=Float32Array&&(he[0]=0,he[1]=0,he[2]=0,he[3]=0),he}function p(he){var Te=new glMatrix.ARRAY_TYPE(4);return Te[0]=he[0],Te[1]=he[1],Te[2]=he[2],Te[3]=he[3],Te}function me(he,Te,Ze,Oe){var Ot=new re.WT(4);return Ot[0]=he,Ot[1]=Te,Ot[2]=Ze,Ot[3]=Oe,Ot}function te(he,Te){return he[0]=Te[0],he[1]=Te[1],he[2]=Te[2],he[3]=Te[3],he}function ue(he,Te,Ze,Oe,Ot){return he[0]=Te,he[1]=Ze,he[2]=Oe,he[3]=Ot,he}function ae(he,Te,Ze){return he[0]=Te[0]+Ze[0],he[1]=Te[1]+Ze[1],he[2]=Te[2]+Ze[2],he[3]=Te[3]+Ze[3],he}function Ne(he,Te,Ze){return he[0]=Te[0]-Ze[0],he[1]=Te[1]-Ze[1],he[2]=Te[2]-Ze[2],he[3]=Te[3]-Ze[3],he}function K(he,Te,Ze){return he[0]=Te[0]*Ze[0],he[1]=Te[1]*Ze[1],he[2]=Te[2]*Ze[2],he[3]=Te[3]*Ze[3],he}function Qe(he,Te,Ze){return he[0]=Te[0]/Ze[0],he[1]=Te[1]/Ze[1],he[2]=Te[2]/Ze[2],he[3]=Te[3]/Ze[3],he}function xt(he,Te){return he[0]=Math.ceil(Te[0]),he[1]=Math.ceil(Te[1]),he[2]=Math.ceil(Te[2]),he[3]=Math.ceil(Te[3]),he}function Ht(he,Te){return he[0]=Math.floor(Te[0]),he[1]=Math.floor(Te[1]),he[2]=Math.floor(Te[2]),he[3]=Math.floor(Te[3]),he}function $t(he,Te,Ze){return he[0]=Math.min(Te[0],Ze[0]),he[1]=Math.min(Te[1],Ze[1]),he[2]=Math.min(Te[2],Ze[2]),he[3]=Math.min(Te[3],Ze[3]),he}function Jt(he,Te,Ze){return he[0]=Math.max(Te[0],Ze[0]),he[1]=Math.max(Te[1],Ze[1]),he[2]=Math.max(Te[2],Ze[2]),he[3]=Math.max(Te[3],Ze[3]),he}function Ft(he,Te){return he[0]=Math.round(Te[0]),he[1]=Math.round(Te[1]),he[2]=Math.round(Te[2]),he[3]=Math.round(Te[3]),he}function Gt(he,Te,Ze){return he[0]=Te[0]*Ze,he[1]=Te[1]*Ze,he[2]=Te[2]*Ze,he[3]=Te[3]*Ze,he}function At(he,Te,Ze,Oe){return he[0]=Te[0]+Ze[0]*Oe,he[1]=Te[1]+Ze[1]*Oe,he[2]=Te[2]+Ze[2]*Oe,he[3]=Te[3]+Ze[3]*Oe,he}function Et(he,Te){var Ze=Te[0]-he[0],Oe=Te[1]-he[1],Ot=Te[2]-he[2],ar=Te[3]-he[3];return Math.hypot(Ze,Oe,Ot,ar)}function bt(he,Te){var Ze=Te[0]-he[0],Oe=Te[1]-he[1],Ot=Te[2]-he[2],ar=Te[3]-he[3];return Ze*Ze+Oe*Oe+Ot*Ot+ar*ar}function er(he){var Te=he[0],Ze=he[1],Oe=he[2],Ot=he[3];return Math.hypot(Te,Ze,Oe,Ot)}function q(he){var Te=he[0],Ze=he[1],Oe=he[2],Ot=he[3];return Te*Te+Ze*Ze+Oe*Oe+Ot*Ot}function Bt(he,Te){return he[0]=-Te[0],he[1]=-Te[1],he[2]=-Te[2],he[3]=-Te[3],he}function et(he,Te){return he[0]=1/Te[0],he[1]=1/Te[1],he[2]=1/Te[2],he[3]=1/Te[3],he}function je(he,Te){var Ze=Te[0],Oe=Te[1],Ot=Te[2],ar=Te[3],ur=Ze*Ze+Oe*Oe+Ot*Ot+ar*ar;return ur>0&&(ur=1/Math.sqrt(ur)),he[0]=Ze*ur,he[1]=Oe*ur,he[2]=Ot*ur,he[3]=ar*ur,he}function nt(he,Te){return he[0]*Te[0]+he[1]*Te[1]+he[2]*Te[2]+he[3]*Te[3]}function De(he,Te,Ze,Oe){var Ot=Ze[0]*Oe[1]-Ze[1]*Oe[0],ar=Ze[0]*Oe[2]-Ze[2]*Oe[0],ur=Ze[0]*Oe[3]-Ze[3]*Oe[0],Pr=Ze[1]*Oe[2]-Ze[2]*Oe[1],or=Ze[1]*Oe[3]-Ze[3]*Oe[1],nn=Ze[2]*Oe[3]-Ze[3]*Oe[2],C=Te[0],V=Te[1],Ve=Te[2],$e=Te[3];return he[0]=V*nn-Ve*or+$e*Pr,he[1]=-(C*nn)+Ve*ur-$e*ar,he[2]=C*or-V*ur+$e*Ot,he[3]=-(C*Pr)+V*ar-Ve*Ot,he}function It(he,Te,Ze,Oe){var Ot=Te[0],ar=Te[1],ur=Te[2],Pr=Te[3];return he[0]=Ot+Oe*(Ze[0]-Ot),he[1]=ar+Oe*(Ze[1]-ar),he[2]=ur+Oe*(Ze[2]-ur),he[3]=Pr+Oe*(Ze[3]-Pr),he}function hr(he,Te){Te=Te||1;var Ze,Oe,Ot,ar,ur,Pr;do Ze=glMatrix.RANDOM()*2-1,Oe=glMatrix.RANDOM()*2-1,ur=Ze*Ze+Oe*Oe;while(ur>=1);do Ot=glMatrix.RANDOM()*2-1,ar=glMatrix.RANDOM()*2-1,Pr=Ot*Ot+ar*ar;while(Pr>=1);var or=Math.sqrt((1-ur)/Pr);return he[0]=Te*Ze,he[1]=Te*Oe,he[2]=Te*Ot*or,he[3]=Te*ar*or,he}function tr(he,Te,Ze){var Oe=Te[0],Ot=Te[1],ar=Te[2],ur=Te[3];return he[0]=Ze[0]*Oe+Ze[4]*Ot+Ze[8]*ar+Ze[12]*ur,he[1]=Ze[1]*Oe+Ze[5]*Ot+Ze[9]*ar+Ze[13]*ur,he[2]=Ze[2]*Oe+Ze[6]*Ot+Ze[10]*ar+Ze[14]*ur,he[3]=Ze[3]*Oe+Ze[7]*Ot+Ze[11]*ar+Ze[15]*ur,he}function j(he,Te,Ze){var Oe=Te[0],Ot=Te[1],ar=Te[2],ur=Ze[0],Pr=Ze[1],or=Ze[2],nn=Ze[3],C=nn*Oe+Pr*ar-or*Ot,V=nn*Ot+or*Oe-ur*ar,Ve=nn*ar+ur*Ot-Pr*Oe,$e=-ur*Oe-Pr*Ot-or*ar;return he[0]=C*nn+$e*-ur+V*-or-Ve*-Pr,he[1]=V*nn+$e*-Pr+Ve*-ur-C*-or,he[2]=Ve*nn+$e*-or+C*-Pr-V*-ur,he[3]=Te[3],he}function ie(he){return he[0]=0,he[1]=0,he[2]=0,he[3]=0,he}function Me(he){return"vec4("+he[0]+", "+he[1]+", "+he[2]+", "+he[3]+")"}function ye(he,Te){return he[0]===Te[0]&&he[1]===Te[1]&&he[2]===Te[2]&&he[3]===Te[3]}function it(he,Te){var Ze=he[0],Oe=he[1],Ot=he[2],ar=he[3],ur=Te[0],Pr=Te[1],or=Te[2],nn=Te[3];return Math.abs(Ze-ur)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ze),Math.abs(ur))&&Math.abs(Oe-Pr)<=glMatrix.EPSILON*Math.max(1,Math.abs(Oe),Math.abs(Pr))&&Math.abs(Ot-or)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ot),Math.abs(or))&&Math.abs(ar-nn)<=glMatrix.EPSILON*Math.max(1,Math.abs(ar),Math.abs(nn))}var lt=null,Lt=null,Pt=null,Lr=null,cn=null,qr=null,fi=null,Yt=function(){var he=E();return function(Te,Ze,Oe,Ot,ar,ur){var Pr,or;for(Ze||(Ze=4),Oe||(Oe=0),Ot?or=Math.min(Ot*Ze+Oe,Te.length):or=Te.length,Pr=Oe;Pr<or;Pr+=Ze)he[0]=Te[Pr],he[1]=Te[Pr+1],he[2]=Te[Pr+2],he[3]=Te[Pr+3],ar(he,he,ur),Te[Pr]=he[0],Te[Pr+1]=he[1],Te[Pr+2]=he[2],Te[Pr+3]=he[3];return Te}}()},83959:function(Rr,N,b){var re;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(E,p,me,te){"use strict";var ue=["","webkit","Moz","MS","ms","o"],ae=p.createElement("div"),Ne="function",K=Math.round,Qe=Math.abs,xt=Date.now;function Ht(Se,ke,yt){return setTimeout(er(Se,yt),ke)}function $t(Se,ke,yt){return Array.isArray(Se)?(Jt(Se,yt[ke],yt),!0):!1}function Jt(Se,ke,yt){var O;if(!!Se)if(Se.forEach)Se.forEach(ke,yt);else if(Se.length!==te)for(O=0;O<Se.length;)ke.call(yt,Se[O],O,Se),O++;else for(O in Se)Se.hasOwnProperty(O)&&ke.call(yt,Se[O],O,Se)}function Ft(Se,ke,yt){var O="DEPRECATED METHOD: "+ke+`
`+yt+` AT 
`;return function(){var Qr=new Error("get-stack-trace"),oi=Qr&&Qr.stack?Qr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ai=E.console&&(E.console.warn||E.console.log);return Ai&&Ai.call(E.console,O,oi),Se.apply(this,arguments)}}var Gt;typeof Object.assign!="function"?Gt=function(ke){if(ke===te||ke===null)throw new TypeError("Cannot convert undefined or null to object");for(var yt=Object(ke),O=1;O<arguments.length;O++){var Qr=arguments[O];if(Qr!==te&&Qr!==null)for(var oi in Qr)Qr.hasOwnProperty(oi)&&(yt[oi]=Qr[oi])}return yt}:Gt=Object.assign;var At=Ft(function(ke,yt,O){for(var Qr=Object.keys(yt),oi=0;oi<Qr.length;)(!O||O&&ke[Qr[oi]]===te)&&(ke[Qr[oi]]=yt[Qr[oi]]),oi++;return ke},"extend","Use `assign`."),Et=Ft(function(ke,yt){return At(ke,yt,!0)},"merge","Use `assign`.");function bt(Se,ke,yt){var O=ke.prototype,Qr;Qr=Se.prototype=Object.create(O),Qr.constructor=Se,Qr._super=O,yt&&Gt(Qr,yt)}function er(Se,ke){return function(){return Se.apply(ke,arguments)}}function q(Se,ke){return typeof Se==Ne?Se.apply(ke&&ke[0]||te,ke):Se}function Bt(Se,ke){return Se===te?ke:Se}function et(Se,ke,yt){Jt(It(ke),function(O){Se.addEventListener(O,yt,!1)})}function je(Se,ke,yt){Jt(It(ke),function(O){Se.removeEventListener(O,yt,!1)})}function nt(Se,ke){for(;Se;){if(Se==ke)return!0;Se=Se.parentNode}return!1}function De(Se,ke){return Se.indexOf(ke)>-1}function It(Se){return Se.trim().split(/\s+/g)}function hr(Se,ke,yt){if(Se.indexOf&&!yt)return Se.indexOf(ke);for(var O=0;O<Se.length;){if(yt&&Se[O][yt]==ke||!yt&&Se[O]===ke)return O;O++}return-1}function tr(Se){return Array.prototype.slice.call(Se,0)}function j(Se,ke,yt){for(var O=[],Qr=[],oi=0;oi<Se.length;){var Ai=ke?Se[oi][ke]:Se[oi];hr(Qr,Ai)<0&&O.push(Se[oi]),Qr[oi]=Ai,oi++}return yt&&(ke?O=O.sort(function(Qa,Wa){return Qa[ke]>Wa[ke]}):O=O.sort()),O}function ie(Se,ke){for(var yt,O,Qr=ke[0].toUpperCase()+ke.slice(1),oi=0;oi<ue.length;){if(yt=ue[oi],O=yt?yt+Qr:ke,O in Se)return O;oi++}return te}var Me=1;function ye(){return Me++}function it(Se){var ke=Se.ownerDocument||Se;return ke.defaultView||ke.parentWindow||E}var lt=/mobile|tablet|ip(ad|hone|od)|android/i,Lt="ontouchstart"in E,Pt=ie(E,"PointerEvent")!==te,Lr=Lt&&lt.test(navigator.userAgent),cn="touch",qr="pen",fi="mouse",Yt="kinect",he=25,Te=1,Ze=2,Oe=4,Ot=8,ar=1,ur=2,Pr=4,or=8,nn=16,C=ur|Pr,V=or|nn,Ve=C|V,$e=["x","y"],ct=["clientX","clientY"];function Ct(Se,ke){var yt=this;this.manager=Se,this.callback=ke,this.element=Se.element,this.target=Se.options.inputTarget,this.domHandler=function(O){q(Se.options.enable,[Se])&&yt.handler(O)},this.init()}Ct.prototype={handler:function(){},init:function(){this.evEl&&et(this.element,this.evEl,this.domHandler),this.evTarget&&et(this.target,this.evTarget,this.domHandler),this.evWin&&et(it(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&je(this.element,this.evEl,this.domHandler),this.evTarget&&je(this.target,this.evTarget,this.domHandler),this.evWin&&je(it(this.element),this.evWin,this.domHandler)}};function J(Se){var ke,yt=Se.options.inputClass;return yt?ke=yt:Pt?ke=ce:Lr?ke=dt:Lt?ke=Zr:ke=St,new ke(Se,Wt)}function Wt(Se,ke,yt){var O=yt.pointers.length,Qr=yt.changedPointers.length,oi=ke&Te&&O-Qr==0,Ai=ke&(Oe|Ot)&&O-Qr==0;yt.isFirst=!!oi,yt.isFinal=!!Ai,oi&&(Se.session={}),yt.eventType=ke,Tr(Se,yt),Se.emit("hammer.input",yt),Se.recognize(yt),Se.session.prevInput=yt}function Tr(Se,ke){var yt=Se.session,O=ke.pointers,Qr=O.length;yt.firstInput||(yt.firstInput=ht(ke)),Qr>1&&!yt.firstMultiple?yt.firstMultiple=ht(ke):Qr===1&&(yt.firstMultiple=!1);var oi=yt.firstInput,Ai=yt.firstMultiple,po=Ai?Ai.center:oi.center,Qa=ke.center=Mt(O);ke.timeStamp=xt(),ke.deltaTime=ke.timeStamp-oi.timeStamp,ke.angle=Je(po,Qa),ke.distance=Sr(po,Qa),Mr(yt,ke),ke.offsetDirection=br(ke.deltaX,ke.deltaY);var Wa=Nt(ke.deltaTime,ke.deltaX,ke.deltaY);ke.overallVelocityX=Wa.x,ke.overallVelocityY=Wa.y,ke.overallVelocity=Qe(Wa.x)>Qe(Wa.y)?Wa.x:Wa.y,ke.scale=Ai?Xr(Ai.pointers,O):1,ke.rotation=Ai?Hr(Ai.pointers,O):0,ke.maxPointers=yt.prevInput?ke.pointers.length>yt.prevInput.maxPointers?ke.pointers.length:yt.prevInput.maxPointers:ke.pointers.length,Ke(yt,ke);var os=Se.element;nt(ke.srcEvent.target,os)&&(os=ke.srcEvent.target),ke.target=os}function Mr(Se,ke){var yt=ke.center,O=Se.offsetDelta||{},Qr=Se.prevDelta||{},oi=Se.prevInput||{};(ke.eventType===Te||oi.eventType===Oe)&&(Qr=Se.prevDelta={x:oi.deltaX||0,y:oi.deltaY||0},O=Se.offsetDelta={x:yt.x,y:yt.y}),ke.deltaX=Qr.x+(yt.x-O.x),ke.deltaY=Qr.y+(yt.y-O.y)}function Ke(Se,ke){var yt=Se.lastInterval||ke,O=ke.timeStamp-yt.timeStamp,Qr,oi,Ai,po;if(ke.eventType!=Ot&&(O>he||yt.velocity===te)){var Qa=ke.deltaX-yt.deltaX,Wa=ke.deltaY-yt.deltaY,os=Nt(O,Qa,Wa);oi=os.x,Ai=os.y,Qr=Qe(os.x)>Qe(os.y)?os.x:os.y,po=br(Qa,Wa),Se.lastInterval=ke}else Qr=yt.velocity,oi=yt.velocityX,Ai=yt.velocityY,po=yt.direction;ke.velocity=Qr,ke.velocityX=oi,ke.velocityY=Ai,ke.direction=po}function ht(Se){for(var ke=[],yt=0;yt<Se.pointers.length;)ke[yt]={clientX:K(Se.pointers[yt].clientX),clientY:K(Se.pointers[yt].clientY)},yt++;return{timeStamp:xt(),pointers:ke,center:Mt(ke),deltaX:Se.deltaX,deltaY:Se.deltaY}}function Mt(Se){var ke=Se.length;if(ke===1)return{x:K(Se[0].clientX),y:K(Se[0].clientY)};for(var yt=0,O=0,Qr=0;Qr<ke;)yt+=Se[Qr].clientX,O+=Se[Qr].clientY,Qr++;return{x:K(yt/ke),y:K(O/ke)}}function Nt(Se,ke,yt){return{x:ke/Se||0,y:yt/Se||0}}function br(Se,ke){return Se===ke?ar:Qe(Se)>=Qe(ke)?Se<0?ur:Pr:ke<0?or:nn}function Sr(Se,ke,yt){yt||(yt=$e);var O=ke[yt[0]]-Se[yt[0]],Qr=ke[yt[1]]-Se[yt[1]];return Math.sqrt(O*O+Qr*Qr)}function Je(Se,ke,yt){yt||(yt=$e);var O=ke[yt[0]]-Se[yt[0]],Qr=ke[yt[1]]-Se[yt[1]];return Math.atan2(Qr,O)*180/Math.PI}function Hr(Se,ke){return Je(ke[1],ke[0],ct)+Je(Se[1],Se[0],ct)}function Xr(Se,ke){return Sr(ke[0],ke[1],ct)/Sr(Se[0],Se[1],ct)}var yn={mousedown:Te,mousemove:Ze,mouseup:Oe},vr="mousedown",Or="mousemove mouseup";function St(){this.evEl=vr,this.evWin=Or,this.pressed=!1,Ct.apply(this,arguments)}bt(St,Ct,{handler:function(ke){var yt=yn[ke.type];yt&Te&&ke.button===0&&(this.pressed=!0),yt&Ze&&ke.which!==1&&(yt=Oe),!!this.pressed&&(yt&Oe&&(this.pressed=!1),this.callback(this.manager,yt,{pointers:[ke],changedPointers:[ke],pointerType:fi,srcEvent:ke}))}});var Kn={pointerdown:Te,pointermove:Ze,pointerup:Oe,pointercancel:Ot,pointerout:Ot},Ln={2:cn,3:qr,4:fi,5:Yt},zr="pointerdown",Y="pointermove pointerup pointercancel";E.MSPointerEvent&&!E.PointerEvent&&(zr="MSPointerDown",Y="MSPointerMove MSPointerUp MSPointerCancel");function ce(){this.evEl=zr,this.evWin=Y,Ct.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}bt(ce,Ct,{handler:function(ke){var yt=this.store,O=!1,Qr=ke.type.toLowerCase().replace("ms",""),oi=Kn[Qr],Ai=Ln[ke.pointerType]||ke.pointerType,po=Ai==cn,Qa=hr(yt,ke.pointerId,"pointerId");oi&Te&&(ke.button===0||po)?Qa<0&&(yt.push(ke),Qa=yt.length-1):oi&(Oe|Ot)&&(O=!0),!(Qa<0)&&(yt[Qa]=ke,this.callback(this.manager,oi,{pointers:yt,changedPointers:[ke],pointerType:Ai,srcEvent:ke}),O&&yt.splice(Qa,1))}});var ve={touchstart:Te,touchmove:Ze,touchend:Oe,touchcancel:Ot},B="touchstart",ee="touchstart touchmove touchend touchcancel";function pe(){this.evTarget=B,this.evWin=ee,this.started=!1,Ct.apply(this,arguments)}bt(pe,Ct,{handler:function(ke){var yt=ve[ke.type];if(yt===Te&&(this.started=!0),!!this.started){var O=Ae.call(this,ke,yt);yt&(Oe|Ot)&&O[0].length-O[1].length==0&&(this.started=!1),this.callback(this.manager,yt,{pointers:O[0],changedPointers:O[1],pointerType:cn,srcEvent:ke})}}});function Ae(Se,ke){var yt=tr(Se.touches),O=tr(Se.changedTouches);return ke&(Oe|Ot)&&(yt=j(yt.concat(O),"identifier",!0)),[yt,O]}var oe={touchstart:Te,touchmove:Ze,touchend:Oe,touchcancel:Ot},_e="touchstart touchmove touchend touchcancel";function dt(){this.evTarget=_e,this.targetIds={},Ct.apply(this,arguments)}bt(dt,Ct,{handler:function(ke){var yt=oe[ke.type],O=Er.call(this,ke,yt);!O||this.callback(this.manager,yt,{pointers:O[0],changedPointers:O[1],pointerType:cn,srcEvent:ke})}});function Er(Se,ke){var yt=tr(Se.touches),O=this.targetIds;if(ke&(Te|Ze)&&yt.length===1)return O[yt[0].identifier]=!0,[yt,yt];var Qr,oi,Ai=tr(Se.changedTouches),po=[],Qa=this.target;if(oi=yt.filter(function(Wa){return nt(Wa.target,Qa)}),ke===Te)for(Qr=0;Qr<oi.length;)O[oi[Qr].identifier]=!0,Qr++;for(Qr=0;Qr<Ai.length;)O[Ai[Qr].identifier]&&po.push(Ai[Qr]),ke&(Oe|Ot)&&delete O[Ai[Qr].identifier],Qr++;if(!!po.length)return[j(oi.concat(po),"identifier",!0),po]}var Kt=2500,ir=25;function Zr(){Ct.apply(this,arguments);var Se=er(this.handler,this);this.touch=new dt(this.manager,Se),this.mouse=new St(this.manager,Se),this.primaryTouch=null,this.lastTouches=[]}bt(Zr,Ct,{handler:function(ke,yt,O){var Qr=O.pointerType==cn,oi=O.pointerType==fi;if(!(oi&&O.sourceCapabilities&&O.sourceCapabilities.firesTouchEvents)){if(Qr)Bn.call(this,yt,O);else if(oi&&nr.call(this,O))return;this.callback(ke,yt,O)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Bn(Se,ke){Se&Te?(this.primaryTouch=ke.changedPointers[0].identifier,Fn.call(this,ke)):Se&(Oe|Ot)&&Fn.call(this,ke)}function Fn(Se){var ke=Se.changedPointers[0];if(ke.identifier===this.primaryTouch){var yt={x:ke.clientX,y:ke.clientY};this.lastTouches.push(yt);var O=this.lastTouches,Qr=function(){var oi=O.indexOf(yt);oi>-1&&O.splice(oi,1)};setTimeout(Qr,Kt)}}function nr(Se){for(var ke=Se.srcEvent.clientX,yt=Se.srcEvent.clientY,O=0;O<this.lastTouches.length;O++){var Qr=this.lastTouches[O],oi=Math.abs(ke-Qr.x),Ai=Math.abs(yt-Qr.y);if(oi<=ir&&Ai<=ir)return!0}return!1}var In=ie(ae.style,"touchAction"),vn=In!==te,xn="compute",zi="auto",Tn="manipulation",Di="none",ra="pan-x",hi="pan-y",na=ya();function Yi(Se,ke){this.manager=Se,this.set(ke)}Yi.prototype={set:function(Se){Se==xn&&(Se=this.compute()),vn&&this.manager.element.style&&na[Se]&&(this.manager.element.style[In]=Se),this.actions=Se.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Se=[];return Jt(this.manager.recognizers,function(ke){q(ke.options.enable,[ke])&&(Se=Se.concat(ke.getTouchAction()))}),Ii(Se.join(" "))},preventDefaults:function(Se){var ke=Se.srcEvent,yt=Se.offsetDirection;if(this.manager.session.prevented){ke.preventDefault();return}var O=this.actions,Qr=De(O,Di)&&!na[Di],oi=De(O,hi)&&!na[hi],Ai=De(O,ra)&&!na[ra];if(Qr){var po=Se.pointers.length===1,Qa=Se.distance<2,Wa=Se.deltaTime<250;if(po&&Qa&&Wa)return}if(!(Ai&&oi)&&(Qr||oi&&yt&C||Ai&&yt&V))return this.preventSrc(ke)},preventSrc:function(Se){this.manager.session.prevented=!0,Se.preventDefault()}};function Ii(Se){if(De(Se,Di))return Di;var ke=De(Se,ra),yt=De(Se,hi);return ke&&yt?Di:ke||yt?ke?ra:hi:De(Se,Tn)?Tn:zi}function ya(){if(!vn)return!1;var Se={},ke=E.CSS&&E.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(yt){Se[yt]=ke?E.CSS.supports("touch-action",yt):!0}),Se}var Fa=1,Ki=2,Zi=4,$i=8,so=$i,Jo=16,za=32;function qi(Se){this.options=Gt({},this.defaults,Se||{}),this.id=ye(),this.manager=null,this.options.enable=Bt(this.options.enable,!0),this.state=Fa,this.simultaneous={},this.requireFail=[]}qi.prototype={defaults:{},set:function(Se){return Gt(this.options,Se),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Se){if($t(Se,"recognizeWith",this))return this;var ke=this.simultaneous;return Se=Ji(Se,this),ke[Se.id]||(ke[Se.id]=Se,Se.recognizeWith(this)),this},dropRecognizeWith:function(Se){return $t(Se,"dropRecognizeWith",this)?this:(Se=Ji(Se,this),delete this.simultaneous[Se.id],this)},requireFailure:function(Se){if($t(Se,"requireFailure",this))return this;var ke=this.requireFail;return Se=Ji(Se,this),hr(ke,Se)===-1&&(ke.push(Se),Se.requireFailure(this)),this},dropRequireFailure:function(Se){if($t(Se,"dropRequireFailure",this))return this;Se=Ji(Se,this);var ke=hr(this.requireFail,Se);return ke>-1&&this.requireFail.splice(ke,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Se){return!!this.simultaneous[Se.id]},emit:function(Se){var ke=this,yt=this.state;function O(Qr){ke.manager.emit(Qr,Se)}yt<$i&&O(ke.options.event+ou(yt)),O(ke.options.event),Se.additionalEvent&&O(Se.additionalEvent),yt>=$i&&O(ke.options.event+ou(yt))},tryEmit:function(Se){if(this.canEmit())return this.emit(Se);this.state=za},canEmit:function(){for(var Se=0;Se<this.requireFail.length;){if(!(this.requireFail[Se].state&(za|Fa)))return!1;Se++}return!0},recognize:function(Se){var ke=Gt({},Se);if(!q(this.options.enable,[this,ke])){this.reset(),this.state=za;return}this.state&(so|Jo|za)&&(this.state=Fa),this.state=this.process(ke),this.state&(Ki|Zi|$i|Jo)&&this.tryEmit(ke)},process:function(Se){},getTouchAction:function(){},reset:function(){}};function ou(Se){return Se&Jo?"cancel":Se&$i?"end":Se&Zi?"move":Se&Ki?"start":""}function Cu(Se){return Se==nn?"down":Se==or?"up":Se==ur?"left":Se==Pr?"right":""}function Ji(Se,ke){var yt=ke.manager;return yt?yt.get(Se):Se}function xo(){qi.apply(this,arguments)}bt(xo,qi,{defaults:{pointers:1},attrTest:function(Se){var ke=this.options.pointers;return ke===0||Se.pointers.length===ke},process:function(Se){var ke=this.state,yt=Se.eventType,O=ke&(Ki|Zi),Qr=this.attrTest(Se);return O&&(yt&Ot||!Qr)?ke|Jo:O||Qr?yt&Oe?ke|$i:ke&Ki?ke|Zi:Ki:za}});function Qi(){xo.apply(this,arguments),this.pX=null,this.pY=null}bt(Qi,xo,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ve},getTouchAction:function(){var Se=this.options.direction,ke=[];return Se&C&&ke.push(hi),Se&V&&ke.push(ra),ke},directionTest:function(Se){var ke=this.options,yt=!0,O=Se.distance,Qr=Se.direction,oi=Se.deltaX,Ai=Se.deltaY;return Qr&ke.direction||(ke.direction&C?(Qr=oi===0?ar:oi<0?ur:Pr,yt=oi!=this.pX,O=Math.abs(Se.deltaX)):(Qr=Ai===0?ar:Ai<0?or:nn,yt=Ai!=this.pY,O=Math.abs(Se.deltaY))),Se.direction=Qr,yt&&O>ke.threshold&&Qr&ke.direction},attrTest:function(Se){return xo.prototype.attrTest.call(this,Se)&&(this.state&Ki||!(this.state&Ki)&&this.directionTest(Se))},emit:function(Se){this.pX=Se.deltaX,this.pY=Se.deltaY;var ke=Cu(Se.direction);ke&&(Se.additionalEvent=this.options.event+ke),this._super.emit.call(this,Se)}});function Ja(){xo.apply(this,arguments)}bt(Ja,xo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Di]},attrTest:function(Se){return this._super.attrTest.call(this,Se)&&(Math.abs(Se.scale-1)>this.options.threshold||this.state&Ki)},emit:function(Se){if(Se.scale!==1){var ke=Se.scale<1?"in":"out";Se.additionalEvent=this.options.event+ke}this._super.emit.call(this,Se)}});function Qo(){qi.apply(this,arguments),this._timer=null,this._input=null}bt(Qo,qi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[zi]},process:function(Se){var ke=this.options,yt=Se.pointers.length===ke.pointers,O=Se.distance<ke.threshold,Qr=Se.deltaTime>ke.time;if(this._input=Se,!O||!yt||Se.eventType&(Oe|Ot)&&!Qr)this.reset();else if(Se.eventType&Te)this.reset(),this._timer=Ht(function(){this.state=so,this.tryEmit()},ke.time,this);else if(Se.eventType&Oe)return so;return za},reset:function(){clearTimeout(this._timer)},emit:function(Se){this.state===so&&(Se&&Se.eventType&Oe?this.manager.emit(this.options.event+"up",Se):(this._input.timeStamp=xt(),this.manager.emit(this.options.event,this._input)))}});function Ea(){xo.apply(this,arguments)}bt(Ea,xo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Di]},attrTest:function(Se){return this._super.attrTest.call(this,Se)&&(Math.abs(Se.rotation)>this.options.threshold||this.state&Ki)}});function Do(){xo.apply(this,arguments)}bt(Do,xo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:C|V,pointers:1},getTouchAction:function(){return Qi.prototype.getTouchAction.call(this)},attrTest:function(Se){var ke=this.options.direction,yt;return ke&(C|V)?yt=Se.overallVelocity:ke&C?yt=Se.overallVelocityX:ke&V&&(yt=Se.overallVelocityY),this._super.attrTest.call(this,Se)&&ke&Se.offsetDirection&&Se.distance>this.options.threshold&&Se.maxPointers==this.options.pointers&&Qe(yt)>this.options.velocity&&Se.eventType&Oe},emit:function(Se){var ke=Cu(Se.offsetDirection);ke&&this.manager.emit(this.options.event+ke,Se),this.manager.emit(this.options.event,Se)}});function ko(){qi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}bt(ko,qi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Tn]},process:function(Se){var ke=this.options,yt=Se.pointers.length===ke.pointers,O=Se.distance<ke.threshold,Qr=Se.deltaTime<ke.time;if(this.reset(),Se.eventType&Te&&this.count===0)return this.failTimeout();if(O&&Qr&&yt){if(Se.eventType!=Oe)return this.failTimeout();var oi=this.pTime?Se.timeStamp-this.pTime<ke.interval:!0,Ai=!this.pCenter||Sr(this.pCenter,Se.center)<ke.posThreshold;this.pTime=Se.timeStamp,this.pCenter=Se.center,!Ai||!oi?this.count=1:this.count+=1,this._input=Se;var po=this.count%ke.taps;if(po===0)return this.hasRequireFailures()?(this._timer=Ht(function(){this.state=so,this.tryEmit()},ke.interval,this),Ki):so}return za},failTimeout:function(){return this._timer=Ht(function(){this.state=za},this.options.interval,this),za},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==so&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ks(Se,ke){return ke=ke||{},ke.recognizers=Bt(ke.recognizers,ks.defaults.preset),new Ba(Se,ke)}ks.VERSION="2.0.7",ks.defaults={domEvents:!1,touchAction:xn,enable:!0,inputTarget:null,inputClass:null,preset:[[Ea,{enable:!1}],[Ja,{enable:!1},["rotate"]],[Do,{direction:C}],[Qi,{direction:C},["swipe"]],[ko],[ko,{event:"doubletap",taps:2},["tap"]],[Qo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var yo=1,Go=2;function Ba(Se,ke){this.options=Gt({},ks.defaults,ke||{}),this.options.inputTarget=this.options.inputTarget||Se,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Se,this.input=J(this),this.touchAction=new Yi(this,this.options.touchAction),ho(this,!0),Jt(this.options.recognizers,function(yt){var O=this.add(new yt[0](yt[1]));yt[2]&&O.recognizeWith(yt[2]),yt[3]&&O.requireFailure(yt[3])},this)}Ba.prototype={set:function(Se){return Gt(this.options,Se),Se.touchAction&&this.touchAction.update(),Se.inputTarget&&(this.input.destroy(),this.input.target=Se.inputTarget,this.input.init()),this},stop:function(Se){this.session.stopped=Se?Go:yo},recognize:function(Se){var ke=this.session;if(!ke.stopped){this.touchAction.preventDefaults(Se);var yt,O=this.recognizers,Qr=ke.curRecognizer;(!Qr||Qr&&Qr.state&so)&&(Qr=ke.curRecognizer=null);for(var oi=0;oi<O.length;)yt=O[oi],ke.stopped!==Go&&(!Qr||yt==Qr||yt.canRecognizeWith(Qr))?yt.recognize(Se):yt.reset(),!Qr&&yt.state&(Ki|Zi|$i)&&(Qr=ke.curRecognizer=yt),oi++}},get:function(Se){if(Se instanceof qi)return Se;for(var ke=this.recognizers,yt=0;yt<ke.length;yt++)if(ke[yt].options.event==Se)return ke[yt];return null},add:function(Se){if($t(Se,"add",this))return this;var ke=this.get(Se.options.event);return ke&&this.remove(ke),this.recognizers.push(Se),Se.manager=this,this.touchAction.update(),Se},remove:function(Se){if($t(Se,"remove",this))return this;if(Se=this.get(Se),Se){var ke=this.recognizers,yt=hr(ke,Se);yt!==-1&&(ke.splice(yt,1),this.touchAction.update())}return this},on:function(Se,ke){if(Se!==te&&ke!==te){var yt=this.handlers;return Jt(It(Se),function(O){yt[O]=yt[O]||[],yt[O].push(ke)}),this}},off:function(Se,ke){if(Se!==te){var yt=this.handlers;return Jt(It(Se),function(O){ke?yt[O]&&yt[O].splice(hr(yt[O],ke),1):delete yt[O]}),this}},emit:function(Se,ke){this.options.domEvents&&as(Se,ke);var yt=this.handlers[Se]&&this.handlers[Se].slice();if(!(!yt||!yt.length)){ke.type=Se,ke.preventDefault=function(){ke.srcEvent.preventDefault()};for(var O=0;O<yt.length;)yt[O](ke),O++}},destroy:function(){this.element&&ho(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ho(Se,ke){var yt=Se.element;if(!!yt.style){var O;Jt(Se.options.cssProps,function(Qr,oi){O=ie(yt.style,oi),ke?(Se.oldCssProps[O]=yt.style[O],yt.style[O]=Qr):yt.style[O]=Se.oldCssProps[O]||""}),ke||(Se.oldCssProps={})}}function as(Se,ke){var yt=p.createEvent("Event");yt.initEvent(Se,!0,!0),yt.gesture=ke,ke.target.dispatchEvent(yt)}Gt(ks,{INPUT_START:Te,INPUT_MOVE:Ze,INPUT_END:Oe,INPUT_CANCEL:Ot,STATE_POSSIBLE:Fa,STATE_BEGAN:Ki,STATE_CHANGED:Zi,STATE_ENDED:$i,STATE_RECOGNIZED:so,STATE_CANCELLED:Jo,STATE_FAILED:za,DIRECTION_NONE:ar,DIRECTION_LEFT:ur,DIRECTION_RIGHT:Pr,DIRECTION_UP:or,DIRECTION_DOWN:nn,DIRECTION_HORIZONTAL:C,DIRECTION_VERTICAL:V,DIRECTION_ALL:Ve,Manager:Ba,Input:Ct,TouchAction:Yi,TouchInput:dt,MouseInput:St,PointerEventInput:ce,TouchMouseInput:Zr,SingleTouchInput:pe,Recognizer:qi,AttrRecognizer:xo,Tap:ko,Pan:Qi,Swipe:Do,Pinch:Ja,Rotate:Ea,Press:Qo,on:et,off:je,each:Jt,merge:Et,extend:At,assign:Gt,inherit:bt,bindFn:er,prefixed:ie});var Fo=typeof E!="undefined"?E:typeof self!="undefined"?self:{};Fo.Hammer=ks,re=function(){return ks}.call(N,b,N,Rr),re!==te&&(Rr.exports=re)})(window,document,"Hammer")},3039:function(Rr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0});var b=Symbol.for("INJECTION");function re(ue,ae,Ne,K){function Qe(){return K&&!Reflect.hasMetadata(b,this,ae)&&Reflect.defineMetadata(b,Ne(),this,ae),Reflect.hasMetadata(b,this,ae)?Reflect.getMetadata(b,this,ae):Ne()}function xt(Ht){Reflect.defineMetadata(b,Ht,this,ae)}Object.defineProperty(ue,ae,{configurable:!0,enumerable:!0,get:Qe,set:xt})}function E(ue,ae){return function(Ne){return function(K,Qe){var xt=function(){return ue.get(Ne)};re(K,Qe,xt,ae)}}}N.makePropertyInjectDecorator=E;function p(ue,ae){return function(Ne,K){return function(Qe,xt){var Ht=function(){return ue.getNamed(Ne,K)};re(Qe,xt,Ht,ae)}}}N.makePropertyInjectNamedDecorator=p;function me(ue,ae){return function(Ne,K,Qe){return function(xt,Ht){var $t=function(){return ue.getTagged(Ne,K,Qe)};re(xt,Ht,$t,ae)}}}N.makePropertyInjectTaggedDecorator=me;function te(ue,ae){return function(Ne){return function(K,Qe){var xt=function(){return ue.getAll(Ne)};re(K,Qe,xt,ae)}}}N.makePropertyMultiInjectDecorator=te},11922:function(Rr,N,b){"use strict";var re;re={value:!0};var E=b(3039);function p(me,te){te===void 0&&(te=!0);var ue=E.makePropertyInjectDecorator(me,te),ae=E.makePropertyInjectNamedDecorator(me,te),Ne=E.makePropertyInjectTaggedDecorator(me,te),K=E.makePropertyMultiInjectDecorator(me,te);return{lazyInject:ue,lazyInjectNamed:ae,lazyInjectTagged:Ne,lazyMultiInject:K}}N.Z=p},80626:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.tagProperty=N.tagParameter=N.decorate=void 0;var re=b(36078),E=b(50295);function p(K,Qe,xt,Ht){var $t=E.TAGGED;te($t,K,Qe,Ht,xt)}N.tagParameter=p;function me(K,Qe,xt){var Ht=E.TAGGED_PROP;te(Ht,K.constructor,Qe,xt)}N.tagProperty=me;function te(K,Qe,xt,Ht,$t){var Jt={},Ft=typeof $t=="number",Gt=$t!==void 0&&Ft?$t.toString():xt;if(Ft&&xt!==void 0)throw new Error(re.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(K,Qe)&&(Jt=Reflect.getMetadata(K,Qe));var At=Jt[Gt];if(!Array.isArray(At))At=[];else for(var Et=0,bt=At;Et<bt.length;Et++){var er=bt[Et];if(er.key===Ht.key)throw new Error(re.DUPLICATED_METADATA+" "+er.key.toString())}At.push(Ht),Jt[Gt]=At,Reflect.defineMetadata(K,Jt,Qe)}function ue(K,Qe){Reflect.decorate(K,Qe)}function ae(K,Qe){return function(xt,Ht){Qe(xt,Ht,K)}}function Ne(K,Qe,xt){typeof xt=="number"?ue([ae(xt,K)],Qe):typeof xt=="string"?Reflect.decorate([K],Qe,xt):ue([K],Qe)}N.decorate=Ne},76213:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.inject=N.LazyServiceIdentifer=void 0;var re=b(36078),E=b(50295),p=b(25092),me=b(80626),te=function(){function ae(Ne){this._cb=Ne}return ae.prototype.unwrap=function(){return this._cb()},ae}();N.LazyServiceIdentifer=te;function ue(ae){return function(Ne,K,Qe){if(ae===void 0)throw new Error(re.UNDEFINED_INJECT_ANNOTATION(Ne.name));var xt=new p.Metadata(E.INJECT_TAG,ae);typeof Qe=="number"?me.tagParameter(Ne,K,Qe,xt):me.tagProperty(Ne,K,xt)}}N.inject=ue},91773:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.injectable=void 0;var re=b(36078),E=b(50295);function p(){return function(me){if(Reflect.hasOwnMetadata(E.PARAM_TYPES,me))throw new Error(re.DUPLICATED_INJECTABLE_DECORATOR);var te=Reflect.getMetadata(E.DESIGN_PARAM_TYPES,me)||[];return Reflect.defineMetadata(E.PARAM_TYPES,te,me),me}}N.injectable=p},41528:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.multiInject=void 0;var re=b(50295),E=b(25092),p=b(80626);function me(te){return function(ue,ae,Ne){var K=new E.Metadata(re.MULTI_INJECT_TAG,te);typeof Ne=="number"?p.tagParameter(ue,ae,Ne,K):p.tagProperty(ue,ae,K)}}N.multiInject=me},79817:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.named=void 0;var re=b(50295),E=b(25092),p=b(80626);function me(te){return function(ue,ae,Ne){var K=new E.Metadata(re.NAMED_TAG,te);typeof Ne=="number"?p.tagParameter(ue,ae,Ne,K):p.tagProperty(ue,ae,K)}}N.named=me},71316:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.optional=void 0;var re=b(50295),E=b(25092),p=b(80626);function me(){return function(te,ue,ae){var Ne=new E.Metadata(re.OPTIONAL_TAG,!0);typeof ae=="number"?p.tagParameter(te,ue,ae,Ne):p.tagProperty(te,ue,Ne)}}N.optional=me},71971:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.postConstruct=void 0;var re=b(36078),E=b(50295),p=b(25092);function me(){return function(te,ue,ae){var Ne=new p.Metadata(E.POST_CONSTRUCT,ue);if(Reflect.hasOwnMetadata(E.POST_CONSTRUCT,te.constructor))throw new Error(re.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(E.POST_CONSTRUCT,Ne,te.constructor)}}N.postConstruct=me},79189:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.tagged=void 0;var re=b(25092),E=b(80626);function p(me,te){return function(ue,ae,Ne){var K=new re.Metadata(me,te);typeof Ne=="number"?E.tagParameter(ue,ae,Ne,K):E.tagProperty(ue,ae,K)}}N.tagged=p},8245:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.targetName=void 0;var re=b(50295),E=b(25092),p=b(80626);function me(te){return function(ue,ae,Ne){var K=new E.Metadata(re.NAME_TAG,te);p.tagParameter(ue,ae,Ne,K)}}N.targetName=me},19235:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.unmanaged=void 0;var re=b(50295),E=b(25092),p=b(80626);function me(){return function(te,ue,ae){var Ne=new E.Metadata(re.UNMANAGED_TAG,!0);p.tagParameter(te,ue,ae,Ne)}}N.unmanaged=me},30683:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.Binding=void 0;var re=b(77690),E=b(70023),p=function(){function me(te,ue){this.id=E.id(),this.activated=!1,this.serviceIdentifier=te,this.scope=ue,this.type=re.BindingTypeEnum.Invalid,this.constraint=function(ae){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return me.prototype.clone=function(){var te=new me(this.serviceIdentifier,this.scope);return te.activated=te.scope===re.BindingScopeEnum.Singleton?this.activated:!1,te.implementationType=this.implementationType,te.dynamicValue=this.dynamicValue,te.scope=this.scope,te.type=this.type,te.factory=this.factory,te.provider=this.provider,te.constraint=this.constraint,te.onActivation=this.onActivation,te.cache=this.cache,te},me}();N.Binding=p},13497:function(Rr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.BindingCount=void 0;var b={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};N.BindingCount=b},36078:function(Rr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.STACK_OVERFLOW=N.CIRCULAR_DEPENDENCY_IN_FACTORY=N.POST_CONSTRUCT_ERROR=N.MULTIPLE_POST_CONSTRUCT_METHODS=N.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=N.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=N.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=N.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=N.ARGUMENTS_LENGTH_MISMATCH=N.INVALID_DECORATOR_OPERATION=N.INVALID_TO_SELF_VALUE=N.INVALID_FUNCTION_BINDING=N.INVALID_MIDDLEWARE_RETURN=N.NO_MORE_SNAPSHOTS_AVAILABLE=N.INVALID_BINDING_TYPE=N.NOT_IMPLEMENTED=N.CIRCULAR_DEPENDENCY=N.UNDEFINED_INJECT_ANNOTATION=N.MISSING_INJECT_ANNOTATION=N.MISSING_INJECTABLE_ANNOTATION=N.NOT_REGISTERED=N.CANNOT_UNBIND=N.AMBIGUOUS_MATCH=N.KEY_NOT_FOUND=N.NULL_ARGUMENT=N.DUPLICATED_METADATA=N.DUPLICATED_INJECTABLE_DECORATOR=void 0,N.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",N.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",N.NULL_ARGUMENT="NULL argument",N.KEY_NOT_FOUND="Key Not Found",N.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",N.CANNOT_UNBIND="Could not unbind serviceIdentifier:",N.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",N.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",N.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var b=function(me){return"@inject called with undefined this could mean that the class "+me+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};N.UNDEFINED_INJECT_ANNOTATION=b,N.CIRCULAR_DEPENDENCY="Circular dependency found:",N.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",N.INVALID_BINDING_TYPE="Invalid binding type:",N.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",N.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",N.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",N.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",N.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var re=function(){for(var me=[],te=0;te<arguments.length;te++)me[te]=arguments[te];return"The number of constructor arguments in the derived class "+(me[0]+" must be >= than the number of constructor arguments of its base class.")};N.ARGUMENTS_LENGTH_MISMATCH=re,N.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",N.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",N.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",N.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",N.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var E=function(){for(var me=[],te=0;te<arguments.length;te++)me[te]=arguments[te];return"@postConstruct error in class "+me[0]+": "+me[1]};N.POST_CONSTRUCT_ERROR=E;var p=function(){for(var me=[],te=0;te<arguments.length;te++)me[te]=arguments[te];return"It looks like there is a circular dependency "+("in one of the '"+me[0]+"' bindings. Please investigate bindings with")+("service identifier '"+me[1]+"'.")};N.CIRCULAR_DEPENDENCY_IN_FACTORY=p,N.STACK_OVERFLOW="Maximum call stack size exceeded"},77690:function(Rr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.TargetTypeEnum=N.BindingTypeEnum=N.BindingScopeEnum=void 0;var b={Request:"Request",Singleton:"Singleton",Transient:"Transient"};N.BindingScopeEnum=b;var re={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};N.BindingTypeEnum=re;var E={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};N.TargetTypeEnum=E},50295:function(Rr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.NON_CUSTOM_TAG_KEYS=N.POST_CONSTRUCT=N.DESIGN_PARAM_TYPES=N.PARAM_TYPES=N.TAGGED_PROP=N.TAGGED=N.MULTI_INJECT_TAG=N.INJECT_TAG=N.OPTIONAL_TAG=N.UNMANAGED_TAG=N.NAME_TAG=N.NAMED_TAG=void 0,N.NAMED_TAG="named",N.NAME_TAG="name",N.UNMANAGED_TAG="unmanaged",N.OPTIONAL_TAG="optional",N.INJECT_TAG="inject",N.MULTI_INJECT_TAG="multi_inject",N.TAGGED="inversify:tagged",N.TAGGED_PROP="inversify:tagged_props",N.PARAM_TYPES="inversify:paramtypes",N.DESIGN_PARAM_TYPES="design:paramtypes",N.POST_CONSTRUCT="post_construct";function b(){return[N.INJECT_TAG,N.MULTI_INJECT_TAG,N.NAME_TAG,N.UNMANAGED_TAG,N.NAMED_TAG,N.OPTIONAL_TAG]}N.NON_CUSTOM_TAG_KEYS=b()},70596:function(Rr,N,b){"use strict";var re=this&&this.__awaiter||function(At,Et,bt,er){function q(Bt){return Bt instanceof bt?Bt:new bt(function(et){et(Bt)})}return new(bt||(bt=Promise))(function(Bt,et){function je(It){try{De(er.next(It))}catch(hr){et(hr)}}function nt(It){try{De(er.throw(It))}catch(hr){et(hr)}}function De(It){It.done?Bt(It.value):q(It.value).then(je,nt)}De((er=er.apply(At,Et||[])).next())})},E=this&&this.__generator||function(At,Et){var bt={label:0,sent:function(){if(Bt[0]&1)throw Bt[1];return Bt[1]},trys:[],ops:[]},er,q,Bt,et;return et={next:je(0),throw:je(1),return:je(2)},typeof Symbol=="function"&&(et[Symbol.iterator]=function(){return this}),et;function je(De){return function(It){return nt([De,It])}}function nt(De){if(er)throw new TypeError("Generator is already executing.");for(;bt;)try{if(er=1,q&&(Bt=De[0]&2?q.return:De[0]?q.throw||((Bt=q.return)&&Bt.call(q),0):q.next)&&!(Bt=Bt.call(q,De[1])).done)return Bt;switch(q=0,Bt&&(De=[De[0]&2,Bt.value]),De[0]){case 0:case 1:Bt=De;break;case 4:return bt.label++,{value:De[1],done:!1};case 5:bt.label++,q=De[1],De=[0];continue;case 7:De=bt.ops.pop(),bt.trys.pop();continue;default:if(Bt=bt.trys,!(Bt=Bt.length>0&&Bt[Bt.length-1])&&(De[0]===6||De[0]===2)){bt=0;continue}if(De[0]===3&&(!Bt||De[1]>Bt[0]&&De[1]<Bt[3])){bt.label=De[1];break}if(De[0]===6&&bt.label<Bt[1]){bt.label=Bt[1],Bt=De;break}if(Bt&&bt.label<Bt[2]){bt.label=Bt[2],bt.ops.push(De);break}Bt[2]&&bt.ops.pop(),bt.trys.pop();continue}De=Et.call(At,bt)}catch(It){De=[6,It],q=0}finally{er=Bt=0}if(De[0]&5)throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}},p=this&&this.__spreadArray||function(At,Et){for(var bt=0,er=Et.length,q=At.length;bt<er;bt++,q++)At[q]=Et[bt];return At};Object.defineProperty(N,"__esModule",{value:!0}),N.Container=void 0;var me=b(30683),te=b(36078),ue=b(77690),ae=b(50295),Ne=b(43870),K=b(54142),Qe=b(9386),xt=b(43313),Ht=b(70023),$t=b(29552),Jt=b(71878),Ft=b(82543),Gt=function(){function At(Et){this._appliedMiddleware=[];var bt=Et||{};if(typeof bt!="object")throw new Error(""+te.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(bt.defaultScope===void 0)bt.defaultScope=ue.BindingScopeEnum.Transient;else if(bt.defaultScope!==ue.BindingScopeEnum.Singleton&&bt.defaultScope!==ue.BindingScopeEnum.Transient&&bt.defaultScope!==ue.BindingScopeEnum.Request)throw new Error(""+te.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(bt.autoBindInjectable===void 0)bt.autoBindInjectable=!1;else if(typeof bt.autoBindInjectable!="boolean")throw new Error(""+te.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(bt.skipBaseClassChecks===void 0)bt.skipBaseClassChecks=!1;else if(typeof bt.skipBaseClassChecks!="boolean")throw new Error(""+te.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:bt.autoBindInjectable,defaultScope:bt.defaultScope,skipBaseClassChecks:bt.skipBaseClassChecks},this.id=Ht.id(),this._bindingDictionary=new Ft.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Ne.MetadataReader}return At.merge=function(Et,bt){for(var er=[],q=2;q<arguments.length;q++)er[q-2]=arguments[q];var Bt=new At,et=p([Et,bt],er).map(function(De){return K.getBindingDictionary(De)}),je=K.getBindingDictionary(Bt);function nt(De,It){De.traverse(function(hr,tr){tr.forEach(function(j){It.add(j.serviceIdentifier,j.clone())})})}return et.forEach(function(De){nt(De,je)}),Bt},At.prototype.load=function(){for(var Et=[],bt=0;bt<arguments.length;bt++)Et[bt]=arguments[bt];for(var er=this._getContainerModuleHelpersFactory(),q=0,Bt=Et;q<Bt.length;q++){var et=Bt[q],je=er(et.id);et.registry(je.bindFunction,je.unbindFunction,je.isboundFunction,je.rebindFunction)}},At.prototype.loadAsync=function(){for(var Et=[],bt=0;bt<arguments.length;bt++)Et[bt]=arguments[bt];return re(this,void 0,void 0,function(){var er,q,Bt,et,je;return E(this,function(nt){switch(nt.label){case 0:er=this._getContainerModuleHelpersFactory(),q=0,Bt=Et,nt.label=1;case 1:return q<Bt.length?(et=Bt[q],je=er(et.id),[4,et.registry(je.bindFunction,je.unbindFunction,je.isboundFunction,je.rebindFunction)]):[3,4];case 2:nt.sent(),nt.label=3;case 3:return q++,[3,1];case 4:return[2]}})})},At.prototype.unload=function(){for(var Et=this,bt=[],er=0;er<arguments.length;er++)bt[er]=arguments[er];var q=function(Bt){return function(et){return et.moduleId===Bt}};bt.forEach(function(Bt){var et=q(Bt.id);Et._bindingDictionary.removeByCondition(et)})},At.prototype.bind=function(Et){var bt=this.options.defaultScope||ue.BindingScopeEnum.Transient,er=new me.Binding(Et,bt);return this._bindingDictionary.add(Et,er),new xt.BindingToSyntax(er)},At.prototype.rebind=function(Et){return this.unbind(Et),this.bind(Et)},At.prototype.unbind=function(Et){try{this._bindingDictionary.remove(Et)}catch(bt){throw new Error(te.CANNOT_UNBIND+" "+$t.getServiceIdentifierAsString(Et))}},At.prototype.unbindAll=function(){this._bindingDictionary=new Ft.Lookup},At.prototype.isBound=function(Et){var bt=this._bindingDictionary.hasKey(Et);return!bt&&this.parent&&(bt=this.parent.isBound(Et)),bt},At.prototype.isBoundNamed=function(Et,bt){return this.isBoundTagged(Et,ae.NAMED_TAG,bt)},At.prototype.isBoundTagged=function(Et,bt,er){var q=!1;if(this._bindingDictionary.hasKey(Et)){var Bt=this._bindingDictionary.get(Et),et=K.createMockRequest(this,Et,bt,er);q=Bt.some(function(je){return je.constraint(et)})}return!q&&this.parent&&(q=this.parent.isBoundTagged(Et,bt,er)),q},At.prototype.snapshot=function(){this._snapshots.push(Jt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},At.prototype.restore=function(){var Et=this._snapshots.pop();if(Et===void 0)throw new Error(te.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=Et.bindings,this._middleware=Et.middleware},At.prototype.createChild=function(Et){var bt=new At(Et||this.options);return bt.parent=this,bt},At.prototype.applyMiddleware=function(){for(var Et=[],bt=0;bt<arguments.length;bt++)Et[bt]=arguments[bt];this._appliedMiddleware=this._appliedMiddleware.concat(Et);var er=this._middleware?this._middleware:this._planAndResolve();this._middleware=Et.reduce(function(q,Bt){return Bt(q)},er)},At.prototype.applyCustomMetadataReader=function(Et){this._metadataReader=Et},At.prototype.get=function(Et){return this._get(!1,!1,ue.TargetTypeEnum.Variable,Et)},At.prototype.getTagged=function(Et,bt,er){return this._get(!1,!1,ue.TargetTypeEnum.Variable,Et,bt,er)},At.prototype.getNamed=function(Et,bt){return this.getTagged(Et,ae.NAMED_TAG,bt)},At.prototype.getAll=function(Et){return this._get(!0,!0,ue.TargetTypeEnum.Variable,Et)},At.prototype.getAllTagged=function(Et,bt,er){return this._get(!1,!0,ue.TargetTypeEnum.Variable,Et,bt,er)},At.prototype.getAllNamed=function(Et,bt){return this.getAllTagged(Et,ae.NAMED_TAG,bt)},At.prototype.resolve=function(Et){var bt=this.createChild();return bt.bind(Et).toSelf(),this._appliedMiddleware.forEach(function(er){bt.applyMiddleware(er)}),bt.get(Et)},At.prototype._getContainerModuleHelpersFactory=function(){var Et=this,bt=function(je,nt){je._binding.moduleId=nt},er=function(je){return function(nt){var De=Et.bind.bind(Et),It=De(nt);return bt(It,je),It}},q=function(je){return function(nt){var De=Et.unbind.bind(Et);De(nt)}},Bt=function(je){return function(nt){var De=Et.isBound.bind(Et);return De(nt)}},et=function(je){return function(nt){var De=Et.rebind.bind(Et),It=De(nt);return bt(It,je),It}};return function(je){return{bindFunction:er(je),isboundFunction:Bt(je),rebindFunction:et(je),unbindFunction:q(je)}}},At.prototype._get=function(Et,bt,er,q,Bt,et){var je=null,nt={avoidConstraints:Et,contextInterceptor:function(De){return De},isMultiInject:bt,key:Bt,serviceIdentifier:q,targetType:er,value:et};if(this._middleware){if(je=this._middleware(nt),je==null)throw new Error(te.INVALID_MIDDLEWARE_RETURN)}else je=this._planAndResolve()(nt);return je},At.prototype._planAndResolve=function(){var Et=this;return function(bt){var er=K.plan(Et._metadataReader,Et,bt.isMultiInject,bt.targetType,bt.serviceIdentifier,bt.key,bt.value,bt.avoidConstraints);er=bt.contextInterceptor(er);var q=Qe.resolve(er);return q}},At}();N.Container=Gt},55607:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.AsyncContainerModule=N.ContainerModule=void 0;var re=b(70023),E=function(){function me(te){this.id=re.id(),this.registry=te}return me}();N.ContainerModule=E;var p=function(){function me(te){this.id=re.id(),this.registry=te}return me}();N.AsyncContainerModule=p},71878:function(Rr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.ContainerSnapshot=void 0;var b=function(){function re(){}return re.of=function(E,p){var me=new re;return me.bindings=E,me.middleware=p,me},re}();N.ContainerSnapshot=b},82543:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.Lookup=void 0;var re=b(36078),E=function(){function p(){this._map=new Map}return p.prototype.getMap=function(){return this._map},p.prototype.add=function(me,te){if(me==null)throw new Error(re.NULL_ARGUMENT);if(te==null)throw new Error(re.NULL_ARGUMENT);var ue=this._map.get(me);ue!==void 0?(ue.push(te),this._map.set(me,ue)):this._map.set(me,[te])},p.prototype.get=function(me){if(me==null)throw new Error(re.NULL_ARGUMENT);var te=this._map.get(me);if(te!==void 0)return te;throw new Error(re.KEY_NOT_FOUND)},p.prototype.remove=function(me){if(me==null)throw new Error(re.NULL_ARGUMENT);if(!this._map.delete(me))throw new Error(re.KEY_NOT_FOUND)},p.prototype.removeByCondition=function(me){var te=this;this._map.forEach(function(ue,ae){var Ne=ue.filter(function(K){return!me(K)});Ne.length>0?te._map.set(ae,Ne):te._map.delete(ae)})},p.prototype.hasKey=function(me){if(me==null)throw new Error(re.NULL_ARGUMENT);return this._map.has(me)},p.prototype.clone=function(){var me=new p;return this._map.forEach(function(te,ue){te.forEach(function(ae){return me.add(ue,ae.clone())})}),me},p.prototype.traverse=function(me){this._map.forEach(function(te,ue){me(ue,te)})},p}();N.Lookup=E},99311:function(Rr,N,b){"use strict";var re;re={value:!0},re=re=re=re=re=re=N.GW=re=re=N.zY=re=re=re=re=re=N.f3=re=re=N.b2=re=re=re=re=re=N.W2=re=void 0;var E=b(50295);re=E;var p=b(70596);Object.defineProperty(N,"W2",{enumerable:!0,get:function(){return p.Container}});var me=b(77690);re={enumerable:!0,get:function(){return me.BindingScopeEnum}},re={enumerable:!0,get:function(){return me.BindingTypeEnum}},re={enumerable:!0,get:function(){return me.TargetTypeEnum}};var te=b(55607);re={enumerable:!0,get:function(){return te.AsyncContainerModule}},re={enumerable:!0,get:function(){return te.ContainerModule}};var ue=b(91773);Object.defineProperty(N,"b2",{enumerable:!0,get:function(){return ue.injectable}});var ae=b(79189);re={enumerable:!0,get:function(){return ae.tagged}};var Ne=b(79817);re={enumerable:!0,get:function(){return Ne.named}};var K=b(76213);Object.defineProperty(N,"f3",{enumerable:!0,get:function(){return K.inject}}),re={enumerable:!0,get:function(){return K.LazyServiceIdentifer}};var Qe=b(71316);re={enumerable:!0,get:function(){return Qe.optional}};var xt=b(19235);re={enumerable:!0,get:function(){return xt.unmanaged}};var Ht=b(41528);re={enumerable:!0,get:function(){return Ht.multiInject}};var $t=b(8245);re={enumerable:!0,get:function(){return $t.targetName}};var Jt=b(71971);Object.defineProperty(N,"zY",{enumerable:!0,get:function(){return Jt.postConstruct}});var Ft=b(43870);re={enumerable:!0,get:function(){return Ft.MetadataReader}};var Gt=b(70023);re={enumerable:!0,get:function(){return Gt.id}};var At=b(80626);Object.defineProperty(N,"GW",{enumerable:!0,get:function(){return At.decorate}});var Et=b(83140);re={enumerable:!0,get:function(){return Et.traverseAncerstors}},re={enumerable:!0,get:function(){return Et.taggedConstraint}},re={enumerable:!0,get:function(){return Et.namedConstraint}},re={enumerable:!0,get:function(){return Et.typeConstraint}};var bt=b(29552);re={enumerable:!0,get:function(){return bt.getServiceIdentifierAsString}};var er=b(34384);re={enumerable:!0,get:function(){return er.multiBindToService}}},91519:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.Context=void 0;var re=b(70023),E=function(){function p(me){this.id=re.id(),this.container=me}return p.prototype.addPlan=function(me){this.plan=me},p.prototype.setCurrentRequest=function(me){this.currentRequest=me},p}();N.Context=E},25092:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.Metadata=void 0;var re=b(50295),E=function(){function p(me,te){this.key=me,this.value=te}return p.prototype.toString=function(){return this.key===re.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},p}();N.Metadata=E},43870:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.MetadataReader=void 0;var re=b(50295),E=function(){function p(){}return p.prototype.getConstructorMetadata=function(me){var te=Reflect.getMetadata(re.PARAM_TYPES,me),ue=Reflect.getMetadata(re.TAGGED,me);return{compilerGeneratedMetadata:te,userGeneratedMetadata:ue||{}}},p.prototype.getPropertiesMetadata=function(me){var te=Reflect.getMetadata(re.TAGGED_PROP,me)||[];return te},p}();N.MetadataReader=E},6335:function(Rr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.Plan=void 0;var b=function(){function re(E,p){this.parentContext=E,this.rootRequest=p}return re}();N.Plan=b},54142:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.getBindingDictionary=N.createMockRequest=N.plan=void 0;var re=b(13497),E=b(36078),p=b(77690),me=b(50295),te=b(92542),ue=b(29552),ae=b(91519),Ne=b(25092),K=b(6335),Qe=b(16664),xt=b(14810),Ht=b(69660);function $t(q){return q._bindingDictionary}N.getBindingDictionary=$t;function Jt(q,Bt,et,je,nt,De){var It=q?me.MULTI_INJECT_TAG:me.INJECT_TAG,hr=new Ne.Metadata(It,et),tr=new Ht.Target(Bt,je,et,hr);if(nt!==void 0){var j=new Ne.Metadata(nt,De);tr.metadata.push(j)}return tr}function Ft(q,Bt,et,je,nt){var De=Et(et.container,nt.serviceIdentifier),It=[];return De.length===re.BindingCount.NoBindingsAvailable&&et.container.options.autoBindInjectable&&typeof nt.serviceIdentifier=="function"&&q.getConstructorMetadata(nt.serviceIdentifier).compilerGeneratedMetadata&&(et.container.bind(nt.serviceIdentifier).toSelf(),De=Et(et.container,nt.serviceIdentifier)),Bt?It=De:It=De.filter(function(hr){var tr=new xt.Request(hr.serviceIdentifier,et,je,hr,nt);return hr.constraint(tr)}),Gt(nt.serviceIdentifier,It,nt,et.container),It}function Gt(q,Bt,et,je){switch(Bt.length){case re.BindingCount.NoBindingsAvailable:if(et.isOptional())return Bt;var nt=ue.getServiceIdentifierAsString(q),De=E.NOT_REGISTERED;throw De+=ue.listMetadataForTarget(nt,et),De+=ue.listRegisteredBindingsForServiceIdentifier(je,nt,Et),new Error(De);case re.BindingCount.OnlyOneBindingAvailable:if(!et.isArray())return Bt;case re.BindingCount.MultipleBindingsAvailable:default:if(et.isArray())return Bt;var nt=ue.getServiceIdentifierAsString(q),De=E.AMBIGUOUS_MATCH+" "+nt;throw De+=ue.listRegisteredBindingsForServiceIdentifier(je,nt,Et),new Error(De)}}function At(q,Bt,et,je,nt,De){var It,hr;if(nt===null){It=Ft(q,Bt,je,null,De),hr=new xt.Request(et,je,null,It,De);var tr=new K.Plan(je,hr);je.addPlan(tr)}else It=Ft(q,Bt,je,nt,De),hr=nt.addChildRequest(De.serviceIdentifier,It,De);It.forEach(function(j){var ie=null;if(De.isArray())ie=hr.addChildRequest(j.serviceIdentifier,j,De);else{if(j.cache)return;ie=hr}if(j.type===p.BindingTypeEnum.Instance&&j.implementationType!==null){var Me=Qe.getDependencies(q,j.implementationType);if(!je.container.options.skipBaseClassChecks){var ye=Qe.getBaseClassDependencyCount(q,j.implementationType);if(Me.length<ye){var it=E.ARGUMENTS_LENGTH_MISMATCH(Qe.getFunctionName(j.implementationType));throw new Error(it)}}Me.forEach(function(lt){At(q,!1,lt.serviceIdentifier,je,ie,lt)})}})}function Et(q,Bt){var et=[],je=$t(q);return je.hasKey(Bt)?et=je.get(Bt):q.parent!==null&&(et=Et(q.parent,Bt)),et}function bt(q,Bt,et,je,nt,De,It,hr){hr===void 0&&(hr=!1);var tr=new ae.Context(Bt),j=Jt(et,je,nt,"",De,It);try{return At(q,hr,nt,tr,null,j),tr}catch(ie){throw te.isStackOverflowExeption(ie)&&tr.plan&&ue.circularDependencyToException(tr.plan.rootRequest),ie}}N.plan=bt;function er(q,Bt,et,je){var nt=new Ht.Target(p.TargetTypeEnum.Variable,"",Bt,new Ne.Metadata(et,je)),De=new ae.Context(q),It=new xt.Request(Bt,De,null,[],nt);return It}N.createMockRequest=er},68634:function(Rr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.QueryableString=void 0;var b=function(){function re(E){this.str=E}return re.prototype.startsWith=function(E){return this.str.indexOf(E)===0},re.prototype.endsWith=function(E){var p="",me=E.split("").reverse().join("");return p=this.str.split("").reverse().join(""),this.startsWith.call({str:p},me)},re.prototype.contains=function(E){return this.str.indexOf(E)!==-1},re.prototype.equals=function(E){return this.str===E},re.prototype.value=function(){return this.str},re}();N.QueryableString=b},16664:function(Rr,N,b){"use strict";var re=this&&this.__spreadArray||function(Ft,Gt){for(var At=0,Et=Gt.length,bt=Ft.length;At<Et;At++,bt++)Ft[bt]=Gt[At];return Ft};Object.defineProperty(N,"__esModule",{value:!0}),N.getFunctionName=N.getBaseClassDependencyCount=N.getDependencies=void 0;var E=b(76213),p=b(36078),me=b(77690),te=b(50295),ue=b(29552);Object.defineProperty(N,"getFunctionName",{enumerable:!0,get:function(){return ue.getFunctionName}});var ae=b(69660);function Ne(Ft,Gt){var At=ue.getFunctionName(Gt),Et=K(Ft,At,Gt,!1);return Et}N.getDependencies=Ne;function K(Ft,Gt,At,Et){var bt=Ft.getConstructorMetadata(At),er=bt.compilerGeneratedMetadata;if(er===void 0){var q=p.MISSING_INJECTABLE_ANNOTATION+" "+Gt+".";throw new Error(q)}var Bt=bt.userGeneratedMetadata,et=Object.keys(Bt),je=At.length===0&&et.length>0,nt=et.length>At.length,De=je||nt?et.length:At.length,It=xt(Et,Gt,er,Bt,De),hr=Ht(Ft,At),tr=re(re([],It),hr);return tr}function Qe(Ft,Gt,At,Et,bt){var er=bt[Ft.toString()]||[],q=Jt(er),Bt=q.unmanaged!==!0,et=Et[Ft],je=q.inject||q.multiInject;if(et=je||et,et instanceof E.LazyServiceIdentifer&&(et=et.unwrap()),Bt){var nt=et===Object,De=et===Function,It=et===void 0,hr=nt||De||It;if(!Gt&&hr){var tr=p.MISSING_INJECT_ANNOTATION+" argument "+Ft+" in class "+At+".";throw new Error(tr)}var j=new ae.Target(me.TargetTypeEnum.ConstructorArgument,q.targetName,et);return j.metadata=er,j}return null}function xt(Ft,Gt,At,Et,bt){for(var er=[],q=0;q<bt;q++){var Bt=q,et=Qe(Bt,Ft,Gt,At,Et);et!==null&&er.push(et)}return er}function Ht(Ft,Gt){for(var At=Ft.getPropertiesMetadata(Gt),Et=[],bt=Object.keys(At),er=0,q=bt;er<q.length;er++){var Bt=q[er],et=At[Bt],je=Jt(At[Bt]),nt=je.targetName||Bt,De=je.inject||je.multiInject,It=new ae.Target(me.TargetTypeEnum.ClassProperty,nt,De);It.metadata=et,Et.push(It)}var hr=Object.getPrototypeOf(Gt.prototype).constructor;if(hr!==Object){var tr=Ht(Ft,hr);Et=re(re([],Et),tr)}return Et}function $t(Ft,Gt){var At=Object.getPrototypeOf(Gt.prototype).constructor;if(At!==Object){var Et=ue.getFunctionName(At),bt=K(Ft,Et,At,!0),er=bt.map(function(et){return et.metadata.filter(function(je){return je.key===te.UNMANAGED_TAG})}),q=[].concat.apply([],er).length,Bt=bt.length-q;return Bt>0?Bt:$t(Ft,At)}else return 0}N.getBaseClassDependencyCount=$t;function Jt(Ft){var Gt={};return Ft.forEach(function(At){Gt[At.key.toString()]=At.value}),{inject:Gt[te.INJECT_TAG],multiInject:Gt[te.MULTI_INJECT_TAG],targetName:Gt[te.NAME_TAG],unmanaged:Gt[te.UNMANAGED_TAG]}}},14810:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.Request=void 0;var re=b(70023),E=function(){function p(me,te,ue,ae,Ne){this.id=re.id(),this.serviceIdentifier=me,this.parentContext=te,this.parentRequest=ue,this.target=Ne,this.childRequests=[],this.bindings=Array.isArray(ae)?ae:[ae],this.requestScope=ue===null?new Map:null}return p.prototype.addChildRequest=function(me,te,ue){var ae=new p(me,this.parentContext,this,te,ue);return this.childRequests.push(ae),ae},p}();N.Request=E},69660:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.Target=void 0;var re=b(50295),E=b(70023),p=b(25092),me=b(68634),te=function(){function ue(ae,Ne,K,Qe){this.id=E.id(),this.type=ae,this.serviceIdentifier=K,this.name=new me.QueryableString(Ne||""),this.metadata=new Array;var xt=null;typeof Qe=="string"?xt=new p.Metadata(re.NAMED_TAG,Qe):Qe instanceof p.Metadata&&(xt=Qe),xt!==null&&this.metadata.push(xt)}return ue.prototype.hasTag=function(ae){for(var Ne=0,K=this.metadata;Ne<K.length;Ne++){var Qe=K[Ne];if(Qe.key===ae)return!0}return!1},ue.prototype.isArray=function(){return this.hasTag(re.MULTI_INJECT_TAG)},ue.prototype.matchesArray=function(ae){return this.matchesTag(re.MULTI_INJECT_TAG)(ae)},ue.prototype.isNamed=function(){return this.hasTag(re.NAMED_TAG)},ue.prototype.isTagged=function(){return this.metadata.some(function(ae){return re.NON_CUSTOM_TAG_KEYS.every(function(Ne){return ae.key!==Ne})})},ue.prototype.isOptional=function(){return this.matchesTag(re.OPTIONAL_TAG)(!0)},ue.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ae){return ae.key===re.NAMED_TAG})[0]:null},ue.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ae){return re.NON_CUSTOM_TAG_KEYS.every(function(Ne){return ae.key!==Ne})}):null},ue.prototype.matchesNamedTag=function(ae){return this.matchesTag(re.NAMED_TAG)(ae)},ue.prototype.matchesTag=function(ae){var Ne=this;return function(K){for(var Qe=0,xt=Ne.metadata;Qe<xt.length;Qe++){var Ht=xt[Qe];if(Ht.key===ae&&Ht.value===K)return!0}return!1}},ue}();N.Target=te},74962:function(Rr,N,b){"use strict";var re=this&&this.__spreadArray||function(K,Qe){for(var xt=0,Ht=Qe.length,$t=K.length;xt<Ht;xt++,$t++)K[$t]=Qe[xt];return K};Object.defineProperty(N,"__esModule",{value:!0}),N.resolveInstance=void 0;var E=b(36078),p=b(77690),me=b(50295);function te(K,Qe,xt){var Ht=Qe.filter(function(Jt){return Jt.target!==null&&Jt.target.type===p.TargetTypeEnum.ClassProperty}),$t=Ht.map(xt);return Ht.forEach(function(Jt,Ft){var Gt="";Gt=Jt.target.name.value();var At=$t[Ft];K[Gt]=At}),K}function ue(K,Qe){return new(K.bind.apply(K,re([void 0],Qe)))}function ae(K,Qe){if(Reflect.hasMetadata(me.POST_CONSTRUCT,K)){var xt=Reflect.getMetadata(me.POST_CONSTRUCT,K);try{Qe[xt.value]()}catch(Ht){throw new Error(E.POST_CONSTRUCT_ERROR(K.name,Ht.message))}}}function Ne(K,Qe,xt){var Ht=null;if(Qe.length>0){var $t=Qe.filter(function(Ft){return Ft.target!==null&&Ft.target.type===p.TargetTypeEnum.ConstructorArgument}),Jt=$t.map(xt);Ht=ue(K,Jt),Ht=te(Ht,Qe,xt)}else Ht=new K;return ae(K,Ht),Ht}N.resolveInstance=Ne},9386:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.resolve=void 0;var re=b(36078),E=b(77690),p=b(92542),me=b(29552),te=b(74962),ue=function(K,Qe,xt){try{return xt()}catch(Ht){throw p.isStackOverflowExeption(Ht)?new Error(re.CIRCULAR_DEPENDENCY_IN_FACTORY(K,Qe.toString())):Ht}},ae=function(K){return function(Qe){Qe.parentContext.setCurrentRequest(Qe);var xt=Qe.bindings,Ht=Qe.childRequests,$t=Qe.target&&Qe.target.isArray(),Jt=!Qe.parentRequest||!Qe.parentRequest.target||!Qe.target||!Qe.parentRequest.target.matchesArray(Qe.target.serviceIdentifier);if($t&&Jt)return Ht.map(function(er){var q=ae(K);return q(er)});var Ft=null;if(Qe.target.isOptional()&&xt.length===0)return;var Gt=xt[0],At=Gt.scope===E.BindingScopeEnum.Singleton,Et=Gt.scope===E.BindingScopeEnum.Request;if(At&&Gt.activated)return Gt.cache;if(Et&&K!==null&&K.has(Gt.id))return K.get(Gt.id);if(Gt.type===E.BindingTypeEnum.ConstantValue)Ft=Gt.cache,Gt.activated=!0;else if(Gt.type===E.BindingTypeEnum.Function)Ft=Gt.cache,Gt.activated=!0;else if(Gt.type===E.BindingTypeEnum.Constructor)Ft=Gt.implementationType;else if(Gt.type===E.BindingTypeEnum.DynamicValue&&Gt.dynamicValue!==null)Ft=ue("toDynamicValue",Gt.serviceIdentifier,function(){return Gt.dynamicValue(Qe.parentContext)});else if(Gt.type===E.BindingTypeEnum.Factory&&Gt.factory!==null)Ft=ue("toFactory",Gt.serviceIdentifier,function(){return Gt.factory(Qe.parentContext)});else if(Gt.type===E.BindingTypeEnum.Provider&&Gt.provider!==null)Ft=ue("toProvider",Gt.serviceIdentifier,function(){return Gt.provider(Qe.parentContext)});else if(Gt.type===E.BindingTypeEnum.Instance&&Gt.implementationType!==null)Ft=te.resolveInstance(Gt.implementationType,Ht,ae(K));else{var bt=me.getServiceIdentifierAsString(Qe.serviceIdentifier);throw new Error(re.INVALID_BINDING_TYPE+" "+bt)}return typeof Gt.onActivation=="function"&&(Ft=Gt.onActivation(Qe.parentContext,Ft)),At&&(Gt.cache=Ft,Gt.activated=!0),Et&&K!==null&&!K.has(Gt.id)&&K.set(Gt.id,Ft),Ft}};function Ne(K){var Qe=ae(K.plan.rootRequest.requestScope);return Qe(K.plan.rootRequest)}N.resolve=Ne},91640:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.BindingInSyntax=void 0;var re=b(77690),E=b(46890),p=function(){function me(te){this._binding=te}return me.prototype.inRequestScope=function(){return this._binding.scope=re.BindingScopeEnum.Request,new E.BindingWhenOnSyntax(this._binding)},me.prototype.inSingletonScope=function(){return this._binding.scope=re.BindingScopeEnum.Singleton,new E.BindingWhenOnSyntax(this._binding)},me.prototype.inTransientScope=function(){return this._binding.scope=re.BindingScopeEnum.Transient,new E.BindingWhenOnSyntax(this._binding)},me}();N.BindingInSyntax=p},82386:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.BindingInWhenOnSyntax=void 0;var re=b(91640),E=b(8926),p=b(36890),me=function(){function te(ue){this._binding=ue,this._bindingWhenSyntax=new p.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new E.BindingOnSyntax(this._binding),this._bindingInSyntax=new re.BindingInSyntax(ue)}return te.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},te.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},te.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},te.prototype.when=function(ue){return this._bindingWhenSyntax.when(ue)},te.prototype.whenTargetNamed=function(ue){return this._bindingWhenSyntax.whenTargetNamed(ue)},te.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},te.prototype.whenTargetTagged=function(ue,ae){return this._bindingWhenSyntax.whenTargetTagged(ue,ae)},te.prototype.whenInjectedInto=function(ue){return this._bindingWhenSyntax.whenInjectedInto(ue)},te.prototype.whenParentNamed=function(ue){return this._bindingWhenSyntax.whenParentNamed(ue)},te.prototype.whenParentTagged=function(ue,ae){return this._bindingWhenSyntax.whenParentTagged(ue,ae)},te.prototype.whenAnyAncestorIs=function(ue){return this._bindingWhenSyntax.whenAnyAncestorIs(ue)},te.prototype.whenNoAncestorIs=function(ue){return this._bindingWhenSyntax.whenNoAncestorIs(ue)},te.prototype.whenAnyAncestorNamed=function(ue){return this._bindingWhenSyntax.whenAnyAncestorNamed(ue)},te.prototype.whenAnyAncestorTagged=function(ue,ae){return this._bindingWhenSyntax.whenAnyAncestorTagged(ue,ae)},te.prototype.whenNoAncestorNamed=function(ue){return this._bindingWhenSyntax.whenNoAncestorNamed(ue)},te.prototype.whenNoAncestorTagged=function(ue,ae){return this._bindingWhenSyntax.whenNoAncestorTagged(ue,ae)},te.prototype.whenAnyAncestorMatches=function(ue){return this._bindingWhenSyntax.whenAnyAncestorMatches(ue)},te.prototype.whenNoAncestorMatches=function(ue){return this._bindingWhenSyntax.whenNoAncestorMatches(ue)},te.prototype.onActivation=function(ue){return this._bindingOnSyntax.onActivation(ue)},te}();N.BindingInWhenOnSyntax=me},8926:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.BindingOnSyntax=void 0;var re=b(36890),E=function(){function p(me){this._binding=me}return p.prototype.onActivation=function(me){return this._binding.onActivation=me,new re.BindingWhenSyntax(this._binding)},p}();N.BindingOnSyntax=E},43313:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.BindingToSyntax=void 0;var re=b(36078),E=b(77690),p=b(82386),me=b(46890),te=function(){function ue(ae){this._binding=ae}return ue.prototype.to=function(ae){return this._binding.type=E.BindingTypeEnum.Instance,this._binding.implementationType=ae,new p.BindingInWhenOnSyntax(this._binding)},ue.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+re.INVALID_TO_SELF_VALUE);var ae=this._binding.serviceIdentifier;return this.to(ae)},ue.prototype.toConstantValue=function(ae){return this._binding.type=E.BindingTypeEnum.ConstantValue,this._binding.cache=ae,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=E.BindingScopeEnum.Singleton,new me.BindingWhenOnSyntax(this._binding)},ue.prototype.toDynamicValue=function(ae){return this._binding.type=E.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ae,this._binding.implementationType=null,new p.BindingInWhenOnSyntax(this._binding)},ue.prototype.toConstructor=function(ae){return this._binding.type=E.BindingTypeEnum.Constructor,this._binding.implementationType=ae,this._binding.scope=E.BindingScopeEnum.Singleton,new me.BindingWhenOnSyntax(this._binding)},ue.prototype.toFactory=function(ae){return this._binding.type=E.BindingTypeEnum.Factory,this._binding.factory=ae,this._binding.scope=E.BindingScopeEnum.Singleton,new me.BindingWhenOnSyntax(this._binding)},ue.prototype.toFunction=function(ae){if(typeof ae!="function")throw new Error(re.INVALID_FUNCTION_BINDING);var Ne=this.toConstantValue(ae);return this._binding.type=E.BindingTypeEnum.Function,this._binding.scope=E.BindingScopeEnum.Singleton,Ne},ue.prototype.toAutoFactory=function(ae){return this._binding.type=E.BindingTypeEnum.Factory,this._binding.factory=function(Ne){var K=function(){return Ne.container.get(ae)};return K},this._binding.scope=E.BindingScopeEnum.Singleton,new me.BindingWhenOnSyntax(this._binding)},ue.prototype.toProvider=function(ae){return this._binding.type=E.BindingTypeEnum.Provider,this._binding.provider=ae,this._binding.scope=E.BindingScopeEnum.Singleton,new me.BindingWhenOnSyntax(this._binding)},ue.prototype.toService=function(ae){this.toDynamicValue(function(Ne){return Ne.container.get(ae)})},ue}();N.BindingToSyntax=te},46890:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.BindingWhenOnSyntax=void 0;var re=b(8926),E=b(36890),p=function(){function me(te){this._binding=te,this._bindingWhenSyntax=new E.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new re.BindingOnSyntax(this._binding)}return me.prototype.when=function(te){return this._bindingWhenSyntax.when(te)},me.prototype.whenTargetNamed=function(te){return this._bindingWhenSyntax.whenTargetNamed(te)},me.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},me.prototype.whenTargetTagged=function(te,ue){return this._bindingWhenSyntax.whenTargetTagged(te,ue)},me.prototype.whenInjectedInto=function(te){return this._bindingWhenSyntax.whenInjectedInto(te)},me.prototype.whenParentNamed=function(te){return this._bindingWhenSyntax.whenParentNamed(te)},me.prototype.whenParentTagged=function(te,ue){return this._bindingWhenSyntax.whenParentTagged(te,ue)},me.prototype.whenAnyAncestorIs=function(te){return this._bindingWhenSyntax.whenAnyAncestorIs(te)},me.prototype.whenNoAncestorIs=function(te){return this._bindingWhenSyntax.whenNoAncestorIs(te)},me.prototype.whenAnyAncestorNamed=function(te){return this._bindingWhenSyntax.whenAnyAncestorNamed(te)},me.prototype.whenAnyAncestorTagged=function(te,ue){return this._bindingWhenSyntax.whenAnyAncestorTagged(te,ue)},me.prototype.whenNoAncestorNamed=function(te){return this._bindingWhenSyntax.whenNoAncestorNamed(te)},me.prototype.whenNoAncestorTagged=function(te,ue){return this._bindingWhenSyntax.whenNoAncestorTagged(te,ue)},me.prototype.whenAnyAncestorMatches=function(te){return this._bindingWhenSyntax.whenAnyAncestorMatches(te)},me.prototype.whenNoAncestorMatches=function(te){return this._bindingWhenSyntax.whenNoAncestorMatches(te)},me.prototype.onActivation=function(te){return this._bindingOnSyntax.onActivation(te)},me}();N.BindingWhenOnSyntax=p},36890:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.BindingWhenSyntax=void 0;var re=b(8926),E=b(83140),p=function(){function me(te){this._binding=te}return me.prototype.when=function(te){return this._binding.constraint=te,new re.BindingOnSyntax(this._binding)},me.prototype.whenTargetNamed=function(te){return this._binding.constraint=E.namedConstraint(te),new re.BindingOnSyntax(this._binding)},me.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(te){var ue=te.target!==null&&!te.target.isNamed()&&!te.target.isTagged();return ue},new re.BindingOnSyntax(this._binding)},me.prototype.whenTargetTagged=function(te,ue){return this._binding.constraint=E.taggedConstraint(te)(ue),new re.BindingOnSyntax(this._binding)},me.prototype.whenInjectedInto=function(te){return this._binding.constraint=function(ue){return E.typeConstraint(te)(ue.parentRequest)},new re.BindingOnSyntax(this._binding)},me.prototype.whenParentNamed=function(te){return this._binding.constraint=function(ue){return E.namedConstraint(te)(ue.parentRequest)},new re.BindingOnSyntax(this._binding)},me.prototype.whenParentTagged=function(te,ue){return this._binding.constraint=function(ae){return E.taggedConstraint(te)(ue)(ae.parentRequest)},new re.BindingOnSyntax(this._binding)},me.prototype.whenAnyAncestorIs=function(te){return this._binding.constraint=function(ue){return E.traverseAncerstors(ue,E.typeConstraint(te))},new re.BindingOnSyntax(this._binding)},me.prototype.whenNoAncestorIs=function(te){return this._binding.constraint=function(ue){return!E.traverseAncerstors(ue,E.typeConstraint(te))},new re.BindingOnSyntax(this._binding)},me.prototype.whenAnyAncestorNamed=function(te){return this._binding.constraint=function(ue){return E.traverseAncerstors(ue,E.namedConstraint(te))},new re.BindingOnSyntax(this._binding)},me.prototype.whenNoAncestorNamed=function(te){return this._binding.constraint=function(ue){return!E.traverseAncerstors(ue,E.namedConstraint(te))},new re.BindingOnSyntax(this._binding)},me.prototype.whenAnyAncestorTagged=function(te,ue){return this._binding.constraint=function(ae){return E.traverseAncerstors(ae,E.taggedConstraint(te)(ue))},new re.BindingOnSyntax(this._binding)},me.prototype.whenNoAncestorTagged=function(te,ue){return this._binding.constraint=function(ae){return!E.traverseAncerstors(ae,E.taggedConstraint(te)(ue))},new re.BindingOnSyntax(this._binding)},me.prototype.whenAnyAncestorMatches=function(te){return this._binding.constraint=function(ue){return E.traverseAncerstors(ue,te)},new re.BindingOnSyntax(this._binding)},me.prototype.whenNoAncestorMatches=function(te){return this._binding.constraint=function(ue){return!E.traverseAncerstors(ue,te)},new re.BindingOnSyntax(this._binding)},me}();N.BindingWhenSyntax=p},83140:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.typeConstraint=N.namedConstraint=N.taggedConstraint=N.traverseAncerstors=void 0;var re=b(50295),E=b(25092),p=function(ae,Ne){var K=ae.parentRequest;return K!==null?Ne(K)?!0:p(K,Ne):!1};N.traverseAncerstors=p;var me=function(ae){return function(Ne){var K=function(Qe){return Qe!==null&&Qe.target!==null&&Qe.target.matchesTag(ae)(Ne)};return K.metaData=new E.Metadata(ae,Ne),K}};N.taggedConstraint=me;var te=me(re.NAMED_TAG);N.namedConstraint=te;var ue=function(ae){return function(Ne){var K=null;if(Ne!==null)if(K=Ne.bindings[0],typeof ae=="string"){var Qe=K.serviceIdentifier;return Qe===ae}else{var xt=Ne.bindings[0].implementationType;return ae===xt}return!1}};N.typeConstraint=ue},34384:function(Rr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.multiBindToService=void 0;var b=function(re){return function(E){return function(){for(var p=[],me=0;me<arguments.length;me++)p[me]=arguments[me];return p.forEach(function(te){return re.bind(te).toService(E)})}}};N.multiBindToService=b},92542:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.isStackOverflowExeption=void 0;var re=b(36078);function E(p){return p instanceof RangeError||p.message===re.STACK_OVERFLOW}N.isStackOverflowExeption=E},70023:function(Rr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.id=void 0;var b=0;function re(){return b++}N.id=re},29552:function(Rr,N,b){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.circularDependencyToException=N.listMetadataForTarget=N.listRegisteredBindingsForServiceIdentifier=N.getServiceIdentifierAsString=N.getFunctionName=void 0;var re=b(36078);function E(K){if(typeof K=="function"){var Qe=K;return Qe.name}else{if(typeof K=="symbol")return K.toString();var Qe=K;return Qe}}N.getServiceIdentifierAsString=E;function p(K,Qe,xt){var Ht="",$t=xt(K,Qe);return $t.length!==0&&(Ht=`
Registered bindings:`,$t.forEach(function(Jt){var Ft="Object";Jt.implementationType!==null&&(Ft=Ne(Jt.implementationType)),Ht=Ht+`
 `+Ft,Jt.constraint.metaData&&(Ht=Ht+" - "+Jt.constraint.metaData)})),Ht}N.listRegisteredBindingsForServiceIdentifier=p;function me(K,Qe){return K.parentRequest===null?!1:K.parentRequest.serviceIdentifier===Qe?!0:me(K.parentRequest,Qe)}function te(K){function Qe(Ht,$t){$t===void 0&&($t=[]);var Jt=E(Ht.serviceIdentifier);return $t.push(Jt),Ht.parentRequest!==null?Qe(Ht.parentRequest,$t):$t}var xt=Qe(K);return xt.reverse().join(" --> ")}function ue(K){K.childRequests.forEach(function(Qe){if(me(Qe,Qe.serviceIdentifier)){var xt=te(Qe);throw new Error(re.CIRCULAR_DEPENDENCY+" "+xt)}else ue(Qe)})}N.circularDependencyToException=ue;function ae(K,Qe){if(Qe.isTagged()||Qe.isNamed()){var xt="",Ht=Qe.getNamedTag(),$t=Qe.getCustomTags();return Ht!==null&&(xt+=Ht.toString()+`
`),$t!==null&&$t.forEach(function(Jt){xt+=Jt.toString()+`
`})," "+K+`
 `+K+" - "+xt}else return" "+K}N.listMetadataForTarget=ae;function Ne(K){if(K.name)return K.name;var Qe=K.toString(),xt=Qe.match(/^function\s*([^\s(]+)/);return xt?xt[1]:"Anonymous function: "+Qe}N.getFunctionName=Ne},40077:function(Rr,N,b){"use strict";b.r(N),b.d(N,{Function:function(){return Us},Interpreter:function(){return wo},default:function(){return _l},evaluate:function(){return Lu},vm:function(){return re}});var re={};b.r(re),b.d(re,{Script:function(){return gl},compileFunction:function(){return yl},createContext:function(){return ml},runInContext:function(){return qu},runInNewContext:function(){return Jl}});var E={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},p="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",me={5:p,"5module":p+" export import",6:p+" const class extends export import super"},te=/^in(stanceof)?$/,ue="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",ae="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Ne=new RegExp("["+ue+"]"),K=new RegExp("["+ue+ae+"]");ue=ae=null;var Qe=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],xt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Ht(m,w){for(var z=65536,I=0;I<w.length;I+=2){if(z+=w[I],z>m)return!1;if(z+=w[I+1],z>=m)return!0}}function $t(m,w){return m<65?m===36:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&Ne.test(String.fromCharCode(m)):w===!1?!1:Ht(m,Qe)}function Jt(m,w){return m<48?m===36:m<58?!0:m<65?!1:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&K.test(String.fromCharCode(m)):w===!1?!1:Ht(m,Qe)||Ht(m,xt)}var Ft=function(w,z){z===void 0&&(z={}),this.label=w,this.keyword=z.keyword,this.beforeExpr=!!z.beforeExpr,this.startsExpr=!!z.startsExpr,this.isLoop=!!z.isLoop,this.isAssign=!!z.isAssign,this.prefix=!!z.prefix,this.postfix=!!z.postfix,this.binop=z.binop||null,this.updateContext=null};function Gt(m,w){return new Ft(m,{beforeExpr:!0,binop:w})}var At={beforeExpr:!0},Et={startsExpr:!0},bt={};function er(m,w){return w===void 0&&(w={}),w.keyword=m,bt[m]=new Ft(m,w)}var q={num:new Ft("num",Et),regexp:new Ft("regexp",Et),string:new Ft("string",Et),name:new Ft("name",Et),eof:new Ft("eof"),bracketL:new Ft("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Ft("]"),braceL:new Ft("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Ft("}"),parenL:new Ft("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Ft(")"),comma:new Ft(",",At),semi:new Ft(";",At),colon:new Ft(":",At),dot:new Ft("."),question:new Ft("?",At),questionDot:new Ft("?."),arrow:new Ft("=>",At),template:new Ft("template"),invalidTemplate:new Ft("invalidTemplate"),ellipsis:new Ft("...",At),backQuote:new Ft("`",Et),dollarBraceL:new Ft("${",{beforeExpr:!0,startsExpr:!0}),eq:new Ft("=",{beforeExpr:!0,isAssign:!0}),assign:new Ft("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Ft("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Ft("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Gt("||",1),logicalAND:Gt("&&",2),bitwiseOR:Gt("|",3),bitwiseXOR:Gt("^",4),bitwiseAND:Gt("&",5),equality:Gt("==/!=/===/!==",6),relational:Gt("</>/<=/>=",7),bitShift:Gt("<</>>/>>>",8),plusMin:new Ft("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Gt("%",10),star:Gt("*",10),slash:Gt("/",10),starstar:new Ft("**",{beforeExpr:!0}),coalesce:Gt("??",1),_break:er("break"),_case:er("case",At),_catch:er("catch"),_continue:er("continue"),_debugger:er("debugger"),_default:er("default",At),_do:er("do",{isLoop:!0,beforeExpr:!0}),_else:er("else",At),_finally:er("finally"),_for:er("for",{isLoop:!0}),_function:er("function",Et),_if:er("if"),_return:er("return",At),_switch:er("switch"),_throw:er("throw",At),_try:er("try"),_var:er("var"),_const:er("const"),_while:er("while",{isLoop:!0}),_with:er("with"),_new:er("new",{beforeExpr:!0,startsExpr:!0}),_this:er("this",Et),_super:er("super",Et),_class:er("class",Et),_extends:er("extends",At),_export:er("export"),_import:er("import",Et),_null:er("null",Et),_true:er("true",Et),_false:er("false",Et),_in:er("in",{beforeExpr:!0,binop:7}),_instanceof:er("instanceof",{beforeExpr:!0,binop:7}),_typeof:er("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:er("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:er("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Bt=/\r\n?|\n|\u2028|\u2029/,et=new RegExp(Bt.source,"g");function je(m,w){return m===10||m===13||!w&&(m===8232||m===8233)}var nt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,De=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,It=Object.prototype,hr=It.hasOwnProperty,tr=It.toString;function j(m,w){return hr.call(m,w)}var ie=Array.isArray||function(m){return tr.call(m)==="[object Array]"};function Me(m){return new RegExp("^(?:"+m.replace(/ /g,"|")+")$")}var ye=function(w,z){this.line=w,this.column=z};ye.prototype.offset=function(w){return new ye(this.line,this.column+w)};var it=function(w,z,I){this.start=z,this.end=I,w.sourceFile!==null&&(this.source=w.sourceFile)};function lt(m,w){for(var z=1,I=0;;){et.lastIndex=I;var fe=et.exec(m);if(fe&&fe.index<w)++z,I=fe.index+fe[0].length;else return new ye(z,w-I)}}var Lt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Pt(m){var w={};for(var z in Lt)w[z]=m&&j(m,z)?m[z]:Lt[z];if(w.ecmaVersion>=2015&&(w.ecmaVersion-=2009),w.allowReserved==null&&(w.allowReserved=w.ecmaVersion<5),ie(w.onToken)){var I=w.onToken;w.onToken=function(fe){return I.push(fe)}}return ie(w.onComment)&&(w.onComment=Lr(w,w.onComment)),w}function Lr(m,w){return function(z,I,fe,Le,pt,Zt){var jt={type:z?"Block":"Line",value:I,start:fe,end:Le};m.locations&&(jt.loc=new it(this,pt,Zt)),m.ranges&&(jt.range=[fe,Le]),w.push(jt)}}var cn=1,qr=2,fi=cn|qr,Yt=4,he=8,Te=16,Ze=32,Oe=64,Ot=128;function ar(m,w){return qr|(m?Yt:0)|(w?he:0)}var ur=0,Pr=1,or=2,nn=3,C=4,V=5,Ve=function(w,z,I){this.options=w=Pt(w),this.sourceFile=w.sourceFile,this.keywords=Me(me[w.ecmaVersion>=6?6:w.sourceType==="module"?"5module":5]);var fe="";if(w.allowReserved!==!0){for(var Le=w.ecmaVersion;!(fe=E[Le]);Le--);w.sourceType==="module"&&(fe+=" await")}this.reservedWords=Me(fe);var pt=(fe?fe+" ":"")+E.strict;this.reservedWordsStrict=Me(pt),this.reservedWordsStrictBind=Me(pt+" "+E.strictBind),this.input=String(z),this.containsEsc=!1,I?(this.pos=I,this.lineStart=this.input.lastIndexOf(`
`,I-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Bt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=q.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=w.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&w.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(cn),this.regexpState=null},$e={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Ve.prototype.parse=function(){var w=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(w)},$e.inFunction.get=function(){return(this.currentVarScope().flags&qr)>0},$e.inGenerator.get=function(){return(this.currentVarScope().flags&he)>0},$e.inAsync.get=function(){return(this.currentVarScope().flags&Yt)>0},$e.allowSuper.get=function(){return(this.currentThisScope().flags&Oe)>0},$e.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Ot)>0},$e.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Ve.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&qr)>0},Ve.extend=function(){for(var w=[],z=arguments.length;z--;)w[z]=arguments[z];for(var I=this,fe=0;fe<w.length;fe++)I=w[fe](I);return I},Ve.parse=function(w,z){return new this(z,w).parse()},Ve.parseExpressionAt=function(w,z,I){var fe=new this(I,w,z);return fe.nextToken(),fe.parseExpression()},Ve.tokenizer=function(w,z){return new this(z,w)},Object.defineProperties(Ve.prototype,$e);var ct=Ve.prototype,Ct=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;ct.strictDirective=function(m){for(;;){De.lastIndex=m,m+=De.exec(this.input)[0].length;var w=Ct.exec(this.input.slice(m));if(!w)return!1;if((w[1]||w[2])==="use strict"){De.lastIndex=m+w[0].length;var z=De.exec(this.input),I=z.index+z[0].length,fe=this.input.charAt(I);return fe===";"||fe==="}"||Bt.test(z[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(fe)||fe==="!"&&this.input.charAt(I+1)==="=")}m+=w[0].length,De.lastIndex=m,m+=De.exec(this.input)[0].length,this.input[m]===";"&&m++}},ct.eat=function(m){return this.type===m?(this.next(),!0):!1},ct.isContextual=function(m){return this.type===q.name&&this.value===m&&!this.containsEsc},ct.eatContextual=function(m){return this.isContextual(m)?(this.next(),!0):!1},ct.expectContextual=function(m){this.eatContextual(m)||this.unexpected()},ct.canInsertSemicolon=function(){return this.type===q.eof||this.type===q.braceR||Bt.test(this.input.slice(this.lastTokEnd,this.start))},ct.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},ct.semicolon=function(){!this.eat(q.semi)&&!this.insertSemicolon()&&this.unexpected()},ct.afterTrailingComma=function(m,w){if(this.type===m)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),w||this.next(),!0},ct.expect=function(m){this.eat(m)||this.unexpected()},ct.unexpected=function(m){this.raise(m!=null?m:this.start,"Unexpected token")};function J(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}ct.checkPatternErrors=function(m,w){if(!!m){m.trailingComma>-1&&this.raiseRecoverable(m.trailingComma,"Comma is not permitted after the rest element");var z=w?m.parenthesizedAssign:m.parenthesizedBind;z>-1&&this.raiseRecoverable(z,"Parenthesized pattern")}},ct.checkExpressionErrors=function(m,w){if(!m)return!1;var z=m.shorthandAssign,I=m.doubleProto;if(!w)return z>=0||I>=0;z>=0&&this.raise(z,"Shorthand property assignments are valid only in destructuring patterns"),I>=0&&this.raiseRecoverable(I,"Redefinition of __proto__ property")},ct.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},ct.isSimpleAssignTarget=function(m){return m.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(m.expression):m.type==="Identifier"||m.type==="MemberExpression"};var Wt=Ve.prototype;Wt.parseTopLevel=function(m){var w={};for(m.body||(m.body=[]);this.type!==q.eof;){var z=this.parseStatement(null,!0,w);m.body.push(z)}if(this.inModule)for(var I=0,fe=Object.keys(this.undefinedExports);I<fe.length;I+=1){var Le=fe[I];this.raiseRecoverable(this.undefinedExports[Le].start,"Export '"+Le+"' is not defined")}return this.adaptDirectivePrologue(m.body),this.next(),m.sourceType=this.options.sourceType,this.finishNode(m,"Program")};var Tr={kind:"loop"},Mr={kind:"switch"};Wt.isLet=function(m){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;De.lastIndex=this.pos;var w=De.exec(this.input),z=this.pos+w[0].length,I=this.input.charCodeAt(z);if(I===91)return!0;if(m)return!1;if(I===123)return!0;if($t(I,!0)){for(var fe=z+1;Jt(this.input.charCodeAt(fe),!0);)++fe;var Le=this.input.slice(z,fe);if(!te.test(Le))return!0}return!1},Wt.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;De.lastIndex=this.pos;var m=De.exec(this.input),w=this.pos+m[0].length;return!Bt.test(this.input.slice(this.pos,w))&&this.input.slice(w,w+8)==="function"&&(w+8===this.input.length||!Jt(this.input.charAt(w+8)))},Wt.parseStatement=function(m,w,z){var I=this.type,fe=this.startNode(),Le;switch(this.isLet(m)&&(I=q._var,Le="let"),I){case q._break:case q._continue:return this.parseBreakContinueStatement(fe,I.keyword);case q._debugger:return this.parseDebuggerStatement(fe);case q._do:return this.parseDoStatement(fe);case q._for:return this.parseForStatement(fe);case q._function:return m&&(this.strict||m!=="if"&&m!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(fe,!1,!m);case q._class:return m&&this.unexpected(),this.parseClass(fe,!0);case q._if:return this.parseIfStatement(fe);case q._return:return this.parseReturnStatement(fe);case q._switch:return this.parseSwitchStatement(fe);case q._throw:return this.parseThrowStatement(fe);case q._try:return this.parseTryStatement(fe);case q._const:case q._var:return Le=Le||this.value,m&&Le!=="var"&&this.unexpected(),this.parseVarStatement(fe,Le);case q._while:return this.parseWhileStatement(fe);case q._with:return this.parseWithStatement(fe);case q.braceL:return this.parseBlock(!0,fe);case q.semi:return this.parseEmptyStatement(fe);case q._export:case q._import:if(this.options.ecmaVersion>10&&I===q._import){De.lastIndex=this.pos;var pt=De.exec(this.input),Zt=this.pos+pt[0].length,jt=this.input.charCodeAt(Zt);if(jt===40||jt===46)return this.parseExpressionStatement(fe,this.parseExpression())}return this.options.allowImportExportEverywhere||(w||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),I===q._import?this.parseImport(fe):this.parseExport(fe,z);default:if(this.isAsyncFunction())return m&&this.unexpected(),this.next(),this.parseFunctionStatement(fe,!0,!m);var Fr=this.value,Wr=this.parseExpression();return I===q.name&&Wr.type==="Identifier"&&this.eat(q.colon)?this.parseLabeledStatement(fe,Fr,Wr,m):this.parseExpressionStatement(fe,Wr)}},Wt.parseBreakContinueStatement=function(m,w){var z=w==="break";this.next(),this.eat(q.semi)||this.insertSemicolon()?m.label=null:this.type!==q.name?this.unexpected():(m.label=this.parseIdent(),this.semicolon());for(var I=0;I<this.labels.length;++I){var fe=this.labels[I];if((m.label==null||fe.name===m.label.name)&&(fe.kind!=null&&(z||fe.kind==="loop")||m.label&&z))break}return I===this.labels.length&&this.raise(m.start,"Unsyntactic "+w),this.finishNode(m,z?"BreakStatement":"ContinueStatement")},Wt.parseDebuggerStatement=function(m){return this.next(),this.semicolon(),this.finishNode(m,"DebuggerStatement")},Wt.parseDoStatement=function(m){return this.next(),this.labels.push(Tr),m.body=this.parseStatement("do"),this.labels.pop(),this.expect(q._while),m.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(q.semi):this.semicolon(),this.finishNode(m,"DoWhileStatement")},Wt.parseForStatement=function(m){this.next();var w=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Tr),this.enterScope(0),this.expect(q.parenL),this.type===q.semi)return w>-1&&this.unexpected(w),this.parseFor(m,null);var z=this.isLet();if(this.type===q._var||this.type===q._const||z){var I=this.startNode(),fe=z?"let":this.value;return this.next(),this.parseVar(I,!0,fe),this.finishNode(I,"VariableDeclaration"),(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&I.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===q._in?w>-1&&this.unexpected(w):m.await=w>-1),this.parseForIn(m,I)):(w>-1&&this.unexpected(w),this.parseFor(m,I))}var Le=new J,pt=this.parseExpression(!0,Le);return this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===q._in?w>-1&&this.unexpected(w):m.await=w>-1),this.toAssignable(pt,!1,Le),this.checkLVal(pt),this.parseForIn(m,pt)):(this.checkExpressionErrors(Le,!0),w>-1&&this.unexpected(w),this.parseFor(m,pt))},Wt.parseFunctionStatement=function(m,w,z){return this.next(),this.parseFunction(m,ht|(z?0:Mt),!1,w)},Wt.parseIfStatement=function(m){return this.next(),m.test=this.parseParenExpression(),m.consequent=this.parseStatement("if"),m.alternate=this.eat(q._else)?this.parseStatement("if"):null,this.finishNode(m,"IfStatement")},Wt.parseReturnStatement=function(m){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(q.semi)||this.insertSemicolon()?m.argument=null:(m.argument=this.parseExpression(),this.semicolon()),this.finishNode(m,"ReturnStatement")},Wt.parseSwitchStatement=function(m){this.next(),m.discriminant=this.parseParenExpression(),m.cases=[],this.expect(q.braceL),this.labels.push(Mr),this.enterScope(0);for(var w,z=!1;this.type!==q.braceR;)if(this.type===q._case||this.type===q._default){var I=this.type===q._case;w&&this.finishNode(w,"SwitchCase"),m.cases.push(w=this.startNode()),w.consequent=[],this.next(),I?w.test=this.parseExpression():(z&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),z=!0,w.test=null),this.expect(q.colon)}else w||this.unexpected(),w.consequent.push(this.parseStatement(null));return this.exitScope(),w&&this.finishNode(w,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(m,"SwitchStatement")},Wt.parseThrowStatement=function(m){return this.next(),Bt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),m.argument=this.parseExpression(),this.semicolon(),this.finishNode(m,"ThrowStatement")};var Ke=[];Wt.parseTryStatement=function(m){if(this.next(),m.block=this.parseBlock(),m.handler=null,this.type===q._catch){var w=this.startNode();if(this.next(),this.eat(q.parenL)){w.param=this.parseBindingAtom();var z=w.param.type==="Identifier";this.enterScope(z?Ze:0),this.checkLVal(w.param,z?C:or),this.expect(q.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),w.param=null,this.enterScope(0);w.body=this.parseBlock(!1),this.exitScope(),m.handler=this.finishNode(w,"CatchClause")}return m.finalizer=this.eat(q._finally)?this.parseBlock():null,!m.handler&&!m.finalizer&&this.raise(m.start,"Missing catch or finally clause"),this.finishNode(m,"TryStatement")},Wt.parseVarStatement=function(m,w){return this.next(),this.parseVar(m,!1,w),this.semicolon(),this.finishNode(m,"VariableDeclaration")},Wt.parseWhileStatement=function(m){return this.next(),m.test=this.parseParenExpression(),this.labels.push(Tr),m.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(m,"WhileStatement")},Wt.parseWithStatement=function(m){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),m.object=this.parseParenExpression(),m.body=this.parseStatement("with"),this.finishNode(m,"WithStatement")},Wt.parseEmptyStatement=function(m){return this.next(),this.finishNode(m,"EmptyStatement")},Wt.parseLabeledStatement=function(m,w,z,I){for(var fe=0,Le=this.labels;fe<Le.length;fe+=1){var pt=Le[fe];pt.name===w&&this.raise(z.start,"Label '"+w+"' is already declared")}for(var Zt=this.type.isLoop?"loop":this.type===q._switch?"switch":null,jt=this.labels.length-1;jt>=0;jt--){var Fr=this.labels[jt];if(Fr.statementStart===m.start)Fr.statementStart=this.start,Fr.kind=Zt;else break}return this.labels.push({name:w,kind:Zt,statementStart:this.start}),m.body=this.parseStatement(I?I.indexOf("label")===-1?I+"label":I:"label"),this.labels.pop(),m.label=z,this.finishNode(m,"LabeledStatement")},Wt.parseExpressionStatement=function(m,w){return m.expression=w,this.semicolon(),this.finishNode(m,"ExpressionStatement")},Wt.parseBlock=function(m,w,z){for(m===void 0&&(m=!0),w===void 0&&(w=this.startNode()),w.body=[],this.expect(q.braceL),m&&this.enterScope(0);this.type!==q.braceR;){var I=this.parseStatement(null);w.body.push(I)}return z&&(this.strict=!1),this.next(),m&&this.exitScope(),this.finishNode(w,"BlockStatement")},Wt.parseFor=function(m,w){return m.init=w,this.expect(q.semi),m.test=this.type===q.semi?null:this.parseExpression(),this.expect(q.semi),m.update=this.type===q.parenR?null:this.parseExpression(),this.expect(q.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,"ForStatement")},Wt.parseForIn=function(m,w){var z=this.type===q._in;return this.next(),w.type==="VariableDeclaration"&&w.declarations[0].init!=null&&(!z||this.options.ecmaVersion<8||this.strict||w.kind!=="var"||w.declarations[0].id.type!=="Identifier")?this.raise(w.start,(z?"for-in":"for-of")+" loop variable declaration may not have an initializer"):w.type==="AssignmentPattern"&&this.raise(w.start,"Invalid left-hand side in for-loop"),m.left=w,m.right=z?this.parseExpression():this.parseMaybeAssign(),this.expect(q.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,z?"ForInStatement":"ForOfStatement")},Wt.parseVar=function(m,w,z){for(m.declarations=[],m.kind=z;;){var I=this.startNode();if(this.parseVarId(I,z),this.eat(q.eq)?I.init=this.parseMaybeAssign(w):z==="const"&&!(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():I.id.type!=="Identifier"&&!(w&&(this.type===q._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):I.init=null,m.declarations.push(this.finishNode(I,"VariableDeclarator")),!this.eat(q.comma))break}return m},Wt.parseVarId=function(m,w){m.id=this.parseBindingAtom(),this.checkLVal(m.id,w==="var"?Pr:or,!1)};var ht=1,Mt=2,Nt=4;Wt.parseFunction=function(m,w,z,I){this.initFunction(m),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!I)&&(this.type===q.star&&w&Mt&&this.unexpected(),m.generator=this.eat(q.star)),this.options.ecmaVersion>=8&&(m.async=!!I),w&ht&&(m.id=w&Nt&&this.type!==q.name?null:this.parseIdent(),m.id&&!(w&Mt)&&this.checkLVal(m.id,this.strict||m.generator||m.async?this.treatFunctionsAsVar?Pr:or:nn));var fe=this.yieldPos,Le=this.awaitPos,pt=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ar(m.async,m.generator)),w&ht||(m.id=this.type===q.name?this.parseIdent():null),this.parseFunctionParams(m),this.parseFunctionBody(m,z,!1),this.yieldPos=fe,this.awaitPos=Le,this.awaitIdentPos=pt,this.finishNode(m,w&ht?"FunctionDeclaration":"FunctionExpression")},Wt.parseFunctionParams=function(m){this.expect(q.parenL),m.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Wt.parseClass=function(m,w){this.next();var z=this.strict;this.strict=!0,this.parseClassId(m,w),this.parseClassSuper(m);var I=this.startNode(),fe=!1;for(I.body=[],this.expect(q.braceL);this.type!==q.braceR;){var Le=this.parseClassElement(m.superClass!==null);Le&&(I.body.push(Le),Le.type==="MethodDefinition"&&Le.kind==="constructor"&&(fe&&this.raise(Le.start,"Duplicate constructor in the same class"),fe=!0))}return this.strict=z,this.next(),m.body=this.finishNode(I,"ClassBody"),this.finishNode(m,w?"ClassDeclaration":"ClassExpression")},Wt.parseClassElement=function(m){var w=this;if(this.eat(q.semi))return null;var z=this.startNode(),I=function(jt,Fr){Fr===void 0&&(Fr=!1);var Wr=w.start,hn=w.startLoc;return w.eatContextual(jt)?w.type!==q.parenL&&(!Fr||!w.canInsertSemicolon())?!0:(z.key&&w.unexpected(),z.computed=!1,z.key=w.startNodeAt(Wr,hn),z.key.name=jt,w.finishNode(z.key,"Identifier"),!1):!1};z.kind="method",z.static=I("static");var fe=this.eat(q.star),Le=!1;fe||(this.options.ecmaVersion>=8&&I("async",!0)?(Le=!0,fe=this.options.ecmaVersion>=9&&this.eat(q.star)):I("get")?z.kind="get":I("set")&&(z.kind="set")),z.key||this.parsePropertyName(z);var pt=z.key,Zt=!1;return!z.computed&&!z.static&&(pt.type==="Identifier"&&pt.name==="constructor"||pt.type==="Literal"&&pt.value==="constructor")?(z.kind!=="method"&&this.raise(pt.start,"Constructor can't have get/set modifier"),fe&&this.raise(pt.start,"Constructor can't be a generator"),Le&&this.raise(pt.start,"Constructor can't be an async method"),z.kind="constructor",Zt=m):z.static&&pt.type==="Identifier"&&pt.name==="prototype"&&this.raise(pt.start,"Classes may not have a static property named prototype"),this.parseClassMethod(z,fe,Le,Zt),z.kind==="get"&&z.value.params.length!==0&&this.raiseRecoverable(z.value.start,"getter should have no params"),z.kind==="set"&&z.value.params.length!==1&&this.raiseRecoverable(z.value.start,"setter should have exactly one param"),z.kind==="set"&&z.value.params[0].type==="RestElement"&&this.raiseRecoverable(z.value.params[0].start,"Setter cannot use rest params"),z},Wt.parseClassMethod=function(m,w,z,I){return m.value=this.parseMethod(w,z,I),this.finishNode(m,"MethodDefinition")},Wt.parseClassId=function(m,w){this.type===q.name?(m.id=this.parseIdent(),w&&this.checkLVal(m.id,or,!1)):(w===!0&&this.unexpected(),m.id=null)},Wt.parseClassSuper=function(m){m.superClass=this.eat(q._extends)?this.parseExprSubscripts():null},Wt.parseExport=function(m,w){if(this.next(),this.eat(q.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(m.exported=this.parseIdent(!0),this.checkExport(w,m.exported.name,this.lastTokStart)):m.exported=null),this.expectContextual("from"),this.type!==q.string&&this.unexpected(),m.source=this.parseExprAtom(),this.semicolon(),this.finishNode(m,"ExportAllDeclaration");if(this.eat(q._default)){this.checkExport(w,"default",this.lastTokStart);var z;if(this.type===q._function||(z=this.isAsyncFunction())){var I=this.startNode();this.next(),z&&this.next(),m.declaration=this.parseFunction(I,ht|Nt,!1,z)}else if(this.type===q._class){var fe=this.startNode();m.declaration=this.parseClass(fe,"nullableID")}else m.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(m,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())m.declaration=this.parseStatement(null),m.declaration.type==="VariableDeclaration"?this.checkVariableExport(w,m.declaration.declarations):this.checkExport(w,m.declaration.id.name,m.declaration.id.start),m.specifiers=[],m.source=null;else{if(m.declaration=null,m.specifiers=this.parseExportSpecifiers(w),this.eatContextual("from"))this.type!==q.string&&this.unexpected(),m.source=this.parseExprAtom();else{for(var Le=0,pt=m.specifiers;Le<pt.length;Le+=1){var Zt=pt[Le];this.checkUnreserved(Zt.local),this.checkLocalExport(Zt.local)}m.source=null}this.semicolon()}return this.finishNode(m,"ExportNamedDeclaration")},Wt.checkExport=function(m,w,z){!m||(j(m,w)&&this.raiseRecoverable(z,"Duplicate export '"+w+"'"),m[w]=!0)},Wt.checkPatternExport=function(m,w){var z=w.type;if(z==="Identifier")this.checkExport(m,w.name,w.start);else if(z==="ObjectPattern")for(var I=0,fe=w.properties;I<fe.length;I+=1){var Le=fe[I];this.checkPatternExport(m,Le)}else if(z==="ArrayPattern")for(var pt=0,Zt=w.elements;pt<Zt.length;pt+=1){var jt=Zt[pt];jt&&this.checkPatternExport(m,jt)}else z==="Property"?this.checkPatternExport(m,w.value):z==="AssignmentPattern"?this.checkPatternExport(m,w.left):z==="RestElement"?this.checkPatternExport(m,w.argument):z==="ParenthesizedExpression"&&this.checkPatternExport(m,w.expression)},Wt.checkVariableExport=function(m,w){if(!!m)for(var z=0,I=w;z<I.length;z+=1){var fe=I[z];this.checkPatternExport(m,fe.id)}},Wt.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Wt.parseExportSpecifiers=function(m){var w=[],z=!0;for(this.expect(q.braceL);!this.eat(q.braceR);){if(z)z=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var I=this.startNode();I.local=this.parseIdent(!0),I.exported=this.eatContextual("as")?this.parseIdent(!0):I.local,this.checkExport(m,I.exported.name,I.exported.start),w.push(this.finishNode(I,"ExportSpecifier"))}return w},Wt.parseImport=function(m){return this.next(),this.type===q.string?(m.specifiers=Ke,m.source=this.parseExprAtom()):(m.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),m.source=this.type===q.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(m,"ImportDeclaration")},Wt.parseImportSpecifiers=function(){var m=[],w=!0;if(this.type===q.name){var z=this.startNode();if(z.local=this.parseIdent(),this.checkLVal(z.local,or),m.push(this.finishNode(z,"ImportDefaultSpecifier")),!this.eat(q.comma))return m}if(this.type===q.star){var I=this.startNode();return this.next(),this.expectContextual("as"),I.local=this.parseIdent(),this.checkLVal(I.local,or),m.push(this.finishNode(I,"ImportNamespaceSpecifier")),m}for(this.expect(q.braceL);!this.eat(q.braceR);){if(w)w=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var fe=this.startNode();fe.imported=this.parseIdent(!0),this.eatContextual("as")?fe.local=this.parseIdent():(this.checkUnreserved(fe.imported),fe.local=fe.imported),this.checkLVal(fe.local,or),m.push(this.finishNode(fe,"ImportSpecifier"))}return m},Wt.adaptDirectivePrologue=function(m){for(var w=0;w<m.length&&this.isDirectiveCandidate(m[w]);++w)m[w].directive=m[w].expression.raw.slice(1,-1)},Wt.isDirectiveCandidate=function(m){return m.type==="ExpressionStatement"&&m.expression.type==="Literal"&&typeof m.expression.value=="string"&&(this.input[m.start]==='"'||this.input[m.start]==="'")};var br=Ve.prototype;br.toAssignable=function(m,w,z){if(this.options.ecmaVersion>=6&&m)switch(m.type){case"Identifier":this.inAsync&&m.name==="await"&&this.raise(m.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":m.type="ObjectPattern",z&&this.checkPatternErrors(z,!0);for(var I=0,fe=m.properties;I<fe.length;I+=1){var Le=fe[I];this.toAssignable(Le,w),Le.type==="RestElement"&&(Le.argument.type==="ArrayPattern"||Le.argument.type==="ObjectPattern")&&this.raise(Le.argument.start,"Unexpected token")}break;case"Property":m.kind!=="init"&&this.raise(m.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(m.value,w);break;case"ArrayExpression":m.type="ArrayPattern",z&&this.checkPatternErrors(z,!0),this.toAssignableList(m.elements,w);break;case"SpreadElement":m.type="RestElement",this.toAssignable(m.argument,w),m.argument.type==="AssignmentPattern"&&this.raise(m.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":m.operator!=="="&&this.raise(m.left.end,"Only '=' operator can be used for specifying default value."),m.type="AssignmentPattern",delete m.operator,this.toAssignable(m.left,w);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(m.expression,w,z);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!w)break;default:this.raise(m.start,"Assigning to rvalue")}else z&&this.checkPatternErrors(z,!0);return m},br.toAssignableList=function(m,w){for(var z=m.length,I=0;I<z;I++){var fe=m[I];fe&&this.toAssignable(fe,w)}if(z){var Le=m[z-1];this.options.ecmaVersion===6&&w&&Le&&Le.type==="RestElement"&&Le.argument.type!=="Identifier"&&this.unexpected(Le.argument.start)}return m},br.parseSpread=function(m){var w=this.startNode();return this.next(),w.argument=this.parseMaybeAssign(!1,m),this.finishNode(w,"SpreadElement")},br.parseRestBinding=function(){var m=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==q.name&&this.unexpected(),m.argument=this.parseBindingAtom(),this.finishNode(m,"RestElement")},br.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case q.bracketL:var m=this.startNode();return this.next(),m.elements=this.parseBindingList(q.bracketR,!0,!0),this.finishNode(m,"ArrayPattern");case q.braceL:return this.parseObj(!0)}return this.parseIdent()},br.parseBindingList=function(m,w,z){for(var I=[],fe=!0;!this.eat(m);)if(fe?fe=!1:this.expect(q.comma),w&&this.type===q.comma)I.push(null);else{if(z&&this.afterTrailingComma(m))break;if(this.type===q.ellipsis){var Le=this.parseRestBinding();this.parseBindingListItem(Le),I.push(Le),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(m);break}else{var pt=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(pt),I.push(pt)}}return I},br.parseBindingListItem=function(m){return m},br.parseMaybeDefault=function(m,w,z){if(z=z||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(q.eq))return z;var I=this.startNodeAt(m,w);return I.left=z,I.right=this.parseMaybeAssign(),this.finishNode(I,"AssignmentPattern")},br.checkLVal=function(m,w,z){switch(w===void 0&&(w=ur),m.type){case"Identifier":w===or&&m.name==="let"&&this.raiseRecoverable(m.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(m.name)&&this.raiseRecoverable(m.start,(w?"Binding ":"Assigning to ")+m.name+" in strict mode"),z&&(j(z,m.name)&&this.raiseRecoverable(m.start,"Argument name clash"),z[m.name]=!0),w!==ur&&w!==V&&this.declareName(m.name,w,m.start);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":w&&this.raiseRecoverable(m.start,"Binding member expression");break;case"ObjectPattern":for(var I=0,fe=m.properties;I<fe.length;I+=1){var Le=fe[I];this.checkLVal(Le,w,z)}break;case"Property":this.checkLVal(m.value,w,z);break;case"ArrayPattern":for(var pt=0,Zt=m.elements;pt<Zt.length;pt+=1){var jt=Zt[pt];jt&&this.checkLVal(jt,w,z)}break;case"AssignmentPattern":this.checkLVal(m.left,w,z);break;case"RestElement":this.checkLVal(m.argument,w,z);break;case"ParenthesizedExpression":this.checkLVal(m.expression,w,z);break;default:this.raise(m.start,(w?"Binding":"Assigning to")+" rvalue")}};var Sr=Ve.prototype;Sr.checkPropClash=function(m,w,z){if(!(this.options.ecmaVersion>=9&&m.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(m.computed||m.method||m.shorthand))){var I=m.key,fe;switch(I.type){case"Identifier":fe=I.name;break;case"Literal":fe=String(I.value);break;default:return}var Le=m.kind;if(this.options.ecmaVersion>=6){fe==="__proto__"&&Le==="init"&&(w.proto&&(z?z.doubleProto<0&&(z.doubleProto=I.start):this.raiseRecoverable(I.start,"Redefinition of __proto__ property")),w.proto=!0);return}fe="$"+fe;var pt=w[fe];if(pt){var Zt;Le==="init"?Zt=this.strict&&pt.init||pt.get||pt.set:Zt=pt.init||pt[Le],Zt&&this.raiseRecoverable(I.start,"Redefinition of property")}else pt=w[fe]={init:!1,get:!1,set:!1};pt[Le]=!0}},Sr.parseExpression=function(m,w){var z=this.start,I=this.startLoc,fe=this.parseMaybeAssign(m,w);if(this.type===q.comma){var Le=this.startNodeAt(z,I);for(Le.expressions=[fe];this.eat(q.comma);)Le.expressions.push(this.parseMaybeAssign(m,w));return this.finishNode(Le,"SequenceExpression")}return fe},Sr.parseMaybeAssign=function(m,w,z){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(m);this.exprAllowed=!1}var I=!1,fe=-1,Le=-1;w?(fe=w.parenthesizedAssign,Le=w.trailingComma,w.parenthesizedAssign=w.trailingComma=-1):(w=new J,I=!0);var pt=this.start,Zt=this.startLoc;(this.type===q.parenL||this.type===q.name)&&(this.potentialArrowAt=this.start);var jt=this.parseMaybeConditional(m,w);if(z&&(jt=z.call(this,jt,pt,Zt)),this.type.isAssign){var Fr=this.startNodeAt(pt,Zt);return Fr.operator=this.value,Fr.left=this.type===q.eq?this.toAssignable(jt,!1,w):jt,I||(w.parenthesizedAssign=w.trailingComma=w.doubleProto=-1),w.shorthandAssign>=Fr.left.start&&(w.shorthandAssign=-1),this.checkLVal(jt),this.next(),Fr.right=this.parseMaybeAssign(m),this.finishNode(Fr,"AssignmentExpression")}else I&&this.checkExpressionErrors(w,!0);return fe>-1&&(w.parenthesizedAssign=fe),Le>-1&&(w.trailingComma=Le),jt},Sr.parseMaybeConditional=function(m,w){var z=this.start,I=this.startLoc,fe=this.parseExprOps(m,w);if(this.checkExpressionErrors(w))return fe;if(this.eat(q.question)){var Le=this.startNodeAt(z,I);return Le.test=fe,Le.consequent=this.parseMaybeAssign(),this.expect(q.colon),Le.alternate=this.parseMaybeAssign(m),this.finishNode(Le,"ConditionalExpression")}return fe},Sr.parseExprOps=function(m,w){var z=this.start,I=this.startLoc,fe=this.parseMaybeUnary(w,!1);return this.checkExpressionErrors(w)||fe.start===z&&fe.type==="ArrowFunctionExpression"?fe:this.parseExprOp(fe,z,I,-1,m)},Sr.parseExprOp=function(m,w,z,I,fe){var Le=this.type.binop;if(Le!=null&&(!fe||this.type!==q._in)&&Le>I){var pt=this.type===q.logicalOR||this.type===q.logicalAND,Zt=this.type===q.coalesce;Zt&&(Le=q.logicalAND.binop);var jt=this.value;this.next();var Fr=this.start,Wr=this.startLoc,hn=this.parseExprOp(this.parseMaybeUnary(null,!1),Fr,Wr,Le,fe),Oi=this.buildBinary(w,z,m,hn,jt,pt||Zt);return(pt&&this.type===q.coalesce||Zt&&(this.type===q.logicalOR||this.type===q.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Oi,w,z,I,fe)}return m},Sr.buildBinary=function(m,w,z,I,fe,Le){var pt=this.startNodeAt(m,w);return pt.left=z,pt.operator=fe,pt.right=I,this.finishNode(pt,Le?"LogicalExpression":"BinaryExpression")},Sr.parseMaybeUnary=function(m,w){var z=this.start,I=this.startLoc,fe;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))fe=this.parseAwait(),w=!0;else if(this.type.prefix){var Le=this.startNode(),pt=this.type===q.incDec;Le.operator=this.value,Le.prefix=!0,this.next(),Le.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(m,!0),pt?this.checkLVal(Le.argument):this.strict&&Le.operator==="delete"&&Le.argument.type==="Identifier"?this.raiseRecoverable(Le.start,"Deleting local variable in strict mode"):w=!0,fe=this.finishNode(Le,pt?"UpdateExpression":"UnaryExpression")}else{if(fe=this.parseExprSubscripts(m),this.checkExpressionErrors(m))return fe;for(;this.type.postfix&&!this.canInsertSemicolon();){var Zt=this.startNodeAt(z,I);Zt.operator=this.value,Zt.prefix=!1,Zt.argument=fe,this.checkLVal(fe),this.next(),fe=this.finishNode(Zt,"UpdateExpression")}}return!w&&this.eat(q.starstar)?this.buildBinary(z,I,fe,this.parseMaybeUnary(null,!1),"**",!1):fe},Sr.parseExprSubscripts=function(m){var w=this.start,z=this.startLoc,I=this.parseExprAtom(m);if(I.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return I;var fe=this.parseSubscripts(I,w,z);return m&&fe.type==="MemberExpression"&&(m.parenthesizedAssign>=fe.start&&(m.parenthesizedAssign=-1),m.parenthesizedBind>=fe.start&&(m.parenthesizedBind=-1)),fe},Sr.parseSubscripts=function(m,w,z,I){for(var fe=this.options.ecmaVersion>=8&&m.type==="Identifier"&&m.name==="async"&&this.lastTokEnd===m.end&&!this.canInsertSemicolon()&&m.end-m.start==5&&this.potentialArrowAt===m.start,Le=!1;;){var pt=this.parseSubscript(m,w,z,I,fe,Le);if(pt.optional&&(Le=!0),pt===m||pt.type==="ArrowFunctionExpression"){if(Le){var Zt=this.startNodeAt(w,z);Zt.expression=pt,pt=this.finishNode(Zt,"ChainExpression")}return pt}m=pt}},Sr.parseSubscript=function(m,w,z,I,fe,Le){var pt=this.options.ecmaVersion>=11,Zt=pt&&this.eat(q.questionDot);I&&Zt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var jt=this.eat(q.bracketL);if(jt||Zt&&this.type!==q.parenL&&this.type!==q.backQuote||this.eat(q.dot)){var Fr=this.startNodeAt(w,z);Fr.object=m,Fr.property=jt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Fr.computed=!!jt,jt&&this.expect(q.bracketR),pt&&(Fr.optional=Zt),m=this.finishNode(Fr,"MemberExpression")}else if(!I&&this.eat(q.parenL)){var Wr=new J,hn=this.yieldPos,Oi=this.awaitPos,Ei=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var pa=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1,Wr);if(fe&&!Zt&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(Wr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=hn,this.awaitPos=Oi,this.awaitIdentPos=Ei,this.parseArrowExpression(this.startNodeAt(w,z),pa,!0);this.checkExpressionErrors(Wr,!0),this.yieldPos=hn||this.yieldPos,this.awaitPos=Oi||this.awaitPos,this.awaitIdentPos=Ei||this.awaitIdentPos;var Ma=this.startNodeAt(w,z);Ma.callee=m,Ma.arguments=pa,pt&&(Ma.optional=Zt),m=this.finishNode(Ma,"CallExpression")}else if(this.type===q.backQuote){(Zt||Le)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var ga=this.startNodeAt(w,z);ga.tag=m,ga.quasi=this.parseTemplate({isTagged:!0}),m=this.finishNode(ga,"TaggedTemplateExpression")}return m},Sr.parseExprAtom=function(m){this.type===q.slash&&this.readRegexp();var w,z=this.potentialArrowAt===this.start;switch(this.type){case q._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),w=this.startNode(),this.next(),this.type===q.parenL&&!this.allowDirectSuper&&this.raise(w.start,"super() call outside constructor of a subclass"),this.type!==q.dot&&this.type!==q.bracketL&&this.type!==q.parenL&&this.unexpected(),this.finishNode(w,"Super");case q._this:return w=this.startNode(),this.next(),this.finishNode(w,"ThisExpression");case q.name:var I=this.start,fe=this.startLoc,Le=this.containsEsc,pt=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Le&&pt.name==="async"&&!this.canInsertSemicolon()&&this.eat(q._function))return this.parseFunction(this.startNodeAt(I,fe),0,!1,!0);if(z&&!this.canInsertSemicolon()){if(this.eat(q.arrow))return this.parseArrowExpression(this.startNodeAt(I,fe),[pt],!1);if(this.options.ecmaVersion>=8&&pt.name==="async"&&this.type===q.name&&!Le)return pt=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(q.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(I,fe),[pt],!0)}return pt;case q.regexp:var Zt=this.value;return w=this.parseLiteral(Zt.value),w.regex={pattern:Zt.pattern,flags:Zt.flags},w;case q.num:case q.string:return this.parseLiteral(this.value);case q._null:case q._true:case q._false:return w=this.startNode(),w.value=this.type===q._null?null:this.type===q._true,w.raw=this.type.keyword,this.next(),this.finishNode(w,"Literal");case q.parenL:var jt=this.start,Fr=this.parseParenAndDistinguishExpression(z);return m&&(m.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Fr)&&(m.parenthesizedAssign=jt),m.parenthesizedBind<0&&(m.parenthesizedBind=jt)),Fr;case q.bracketL:return w=this.startNode(),this.next(),w.elements=this.parseExprList(q.bracketR,!0,!0,m),this.finishNode(w,"ArrayExpression");case q.braceL:return this.parseObj(!1,m);case q._function:return w=this.startNode(),this.next(),this.parseFunction(w,0);case q._class:return this.parseClass(this.startNode(),!1);case q._new:return this.parseNew();case q.backQuote:return this.parseTemplate();case q._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Sr.parseExprImport=function(){var m=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var w=this.parseIdent(!0);switch(this.type){case q.parenL:return this.parseDynamicImport(m);case q.dot:return m.meta=w,this.parseImportMeta(m);default:this.unexpected()}},Sr.parseDynamicImport=function(m){if(this.next(),m.source=this.parseMaybeAssign(),!this.eat(q.parenR)){var w=this.start;this.eat(q.comma)&&this.eat(q.parenR)?this.raiseRecoverable(w,"Trailing comma is not allowed in import()"):this.unexpected(w)}return this.finishNode(m,"ImportExpression")},Sr.parseImportMeta=function(m){this.next();var w=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="meta"&&this.raiseRecoverable(m.property.start,"The only valid meta property for import is 'import.meta'"),w&&this.raiseRecoverable(m.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(m.start,"Cannot use 'import.meta' outside a module"),this.finishNode(m,"MetaProperty")},Sr.parseLiteral=function(m){var w=this.startNode();return w.value=m,w.raw=this.input.slice(this.start,this.end),w.raw.charCodeAt(w.raw.length-1)===110&&(w.bigint=w.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(w,"Literal")},Sr.parseParenExpression=function(){this.expect(q.parenL);var m=this.parseExpression();return this.expect(q.parenR),m},Sr.parseParenAndDistinguishExpression=function(m){var w=this.start,z=this.startLoc,I,fe=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Le=this.start,pt=this.startLoc,Zt=[],jt=!0,Fr=!1,Wr=new J,hn=this.yieldPos,Oi=this.awaitPos,Ei;for(this.yieldPos=0,this.awaitPos=0;this.type!==q.parenR;)if(jt?jt=!1:this.expect(q.comma),fe&&this.afterTrailingComma(q.parenR,!0)){Fr=!0;break}else if(this.type===q.ellipsis){Ei=this.start,Zt.push(this.parseParenItem(this.parseRestBinding())),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Zt.push(this.parseMaybeAssign(!1,Wr,this.parseParenItem));var pa=this.start,Ma=this.startLoc;if(this.expect(q.parenR),m&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(Wr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=hn,this.awaitPos=Oi,this.parseParenArrowList(w,z,Zt);(!Zt.length||Fr)&&this.unexpected(this.lastTokStart),Ei&&this.unexpected(Ei),this.checkExpressionErrors(Wr,!0),this.yieldPos=hn||this.yieldPos,this.awaitPos=Oi||this.awaitPos,Zt.length>1?(I=this.startNodeAt(Le,pt),I.expressions=Zt,this.finishNodeAt(I,"SequenceExpression",pa,Ma)):I=Zt[0]}else I=this.parseParenExpression();if(this.options.preserveParens){var ga=this.startNodeAt(w,z);return ga.expression=I,this.finishNode(ga,"ParenthesizedExpression")}else return I},Sr.parseParenItem=function(m){return m},Sr.parseParenArrowList=function(m,w,z){return this.parseArrowExpression(this.startNodeAt(m,w),z)};var Je=[];Sr.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var m=this.startNode(),w=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(q.dot)){m.meta=w;var z=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="target"&&this.raiseRecoverable(m.property.start,"The only valid meta property for new is 'new.target'"),z&&this.raiseRecoverable(m.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(m.start,"'new.target' can only be used in functions"),this.finishNode(m,"MetaProperty")}var I=this.start,fe=this.startLoc,Le=this.type===q._import;return m.callee=this.parseSubscripts(this.parseExprAtom(),I,fe,!0),Le&&m.callee.type==="ImportExpression"&&this.raise(I,"Cannot use new with import()"),this.eat(q.parenL)?m.arguments=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1):m.arguments=Je,this.finishNode(m,"NewExpression")},Sr.parseTemplateElement=function(m){var w=m.isTagged,z=this.startNode();return this.type===q.invalidTemplate?(w||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),z.value={raw:this.value,cooked:null}):z.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),z.tail=this.type===q.backQuote,this.finishNode(z,"TemplateElement")},Sr.parseTemplate=function(m){m===void 0&&(m={});var w=m.isTagged;w===void 0&&(w=!1);var z=this.startNode();this.next(),z.expressions=[];var I=this.parseTemplateElement({isTagged:w});for(z.quasis=[I];!I.tail;)this.type===q.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(q.dollarBraceL),z.expressions.push(this.parseExpression()),this.expect(q.braceR),z.quasis.push(I=this.parseTemplateElement({isTagged:w}));return this.next(),this.finishNode(z,"TemplateLiteral")},Sr.isAsyncProp=function(m){return!m.computed&&m.key.type==="Identifier"&&m.key.name==="async"&&(this.type===q.name||this.type===q.num||this.type===q.string||this.type===q.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===q.star)&&!Bt.test(this.input.slice(this.lastTokEnd,this.start))},Sr.parseObj=function(m,w){var z=this.startNode(),I=!0,fe={};for(z.properties=[],this.next();!this.eat(q.braceR);){if(I)I=!1;else if(this.expect(q.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(q.braceR))break;var Le=this.parseProperty(m,w);m||this.checkPropClash(Le,fe,w),z.properties.push(Le)}return this.finishNode(z,m?"ObjectPattern":"ObjectExpression")},Sr.parseProperty=function(m,w){var z=this.startNode(),I,fe,Le,pt;if(this.options.ecmaVersion>=9&&this.eat(q.ellipsis))return m?(z.argument=this.parseIdent(!1),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(z,"RestElement")):(this.type===q.parenL&&w&&(w.parenthesizedAssign<0&&(w.parenthesizedAssign=this.start),w.parenthesizedBind<0&&(w.parenthesizedBind=this.start)),z.argument=this.parseMaybeAssign(!1,w),this.type===q.comma&&w&&w.trailingComma<0&&(w.trailingComma=this.start),this.finishNode(z,"SpreadElement"));this.options.ecmaVersion>=6&&(z.method=!1,z.shorthand=!1,(m||w)&&(Le=this.start,pt=this.startLoc),m||(I=this.eat(q.star)));var Zt=this.containsEsc;return this.parsePropertyName(z),!m&&!Zt&&this.options.ecmaVersion>=8&&!I&&this.isAsyncProp(z)?(fe=!0,I=this.options.ecmaVersion>=9&&this.eat(q.star),this.parsePropertyName(z,w)):fe=!1,this.parsePropertyValue(z,m,I,fe,Le,pt,w,Zt),this.finishNode(z,"Property")},Sr.parsePropertyValue=function(m,w,z,I,fe,Le,pt,Zt){if((z||I)&&this.type===q.colon&&this.unexpected(),this.eat(q.colon))m.value=w?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,pt),m.kind="init";else if(this.options.ecmaVersion>=6&&this.type===q.parenL)w&&this.unexpected(),m.kind="init",m.method=!0,m.value=this.parseMethod(z,I);else if(!w&&!Zt&&this.options.ecmaVersion>=5&&!m.computed&&m.key.type==="Identifier"&&(m.key.name==="get"||m.key.name==="set")&&this.type!==q.comma&&this.type!==q.braceR&&this.type!==q.eq){(z||I)&&this.unexpected(),m.kind=m.key.name,this.parsePropertyName(m),m.value=this.parseMethod(!1);var jt=m.kind==="get"?0:1;if(m.value.params.length!==jt){var Fr=m.value.start;m.kind==="get"?this.raiseRecoverable(Fr,"getter should have no params"):this.raiseRecoverable(Fr,"setter should have exactly one param")}else m.kind==="set"&&m.value.params[0].type==="RestElement"&&this.raiseRecoverable(m.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!m.computed&&m.key.type==="Identifier"?((z||I)&&this.unexpected(),this.checkUnreserved(m.key),m.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=fe),m.kind="init",w?m.value=this.parseMaybeDefault(fe,Le,m.key):this.type===q.eq&&pt?(pt.shorthandAssign<0&&(pt.shorthandAssign=this.start),m.value=this.parseMaybeDefault(fe,Le,m.key)):m.value=m.key,m.shorthand=!0):this.unexpected()},Sr.parsePropertyName=function(m){if(this.options.ecmaVersion>=6){if(this.eat(q.bracketL))return m.computed=!0,m.key=this.parseMaybeAssign(),this.expect(q.bracketR),m.key;m.computed=!1}return m.key=this.type===q.num||this.type===q.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Sr.initFunction=function(m){m.id=null,this.options.ecmaVersion>=6&&(m.generator=m.expression=!1),this.options.ecmaVersion>=8&&(m.async=!1)},Sr.parseMethod=function(m,w,z){var I=this.startNode(),fe=this.yieldPos,Le=this.awaitPos,pt=this.awaitIdentPos;return this.initFunction(I),this.options.ecmaVersion>=6&&(I.generator=m),this.options.ecmaVersion>=8&&(I.async=!!w),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ar(w,I.generator)|Oe|(z?Ot:0)),this.expect(q.parenL),I.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(I,!1,!0),this.yieldPos=fe,this.awaitPos=Le,this.awaitIdentPos=pt,this.finishNode(I,"FunctionExpression")},Sr.parseArrowExpression=function(m,w,z){var I=this.yieldPos,fe=this.awaitPos,Le=this.awaitIdentPos;return this.enterScope(ar(z,!1)|Te),this.initFunction(m),this.options.ecmaVersion>=8&&(m.async=!!z),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,m.params=this.toAssignableList(w,!0),this.parseFunctionBody(m,!0,!1),this.yieldPos=I,this.awaitPos=fe,this.awaitIdentPos=Le,this.finishNode(m,"ArrowFunctionExpression")},Sr.parseFunctionBody=function(m,w,z){var I=w&&this.type!==q.braceL,fe=this.strict,Le=!1;if(I)m.body=this.parseMaybeAssign(),m.expression=!0,this.checkParams(m,!1);else{var pt=this.options.ecmaVersion>=7&&!this.isSimpleParamList(m.params);(!fe||pt)&&(Le=this.strictDirective(this.end),Le&&pt&&this.raiseRecoverable(m.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Zt=this.labels;this.labels=[],Le&&(this.strict=!0),this.checkParams(m,!fe&&!Le&&!w&&!z&&this.isSimpleParamList(m.params)),this.strict&&m.id&&this.checkLVal(m.id,V),m.body=this.parseBlock(!1,void 0,Le&&!fe),m.expression=!1,this.adaptDirectivePrologue(m.body.body),this.labels=Zt}this.exitScope()},Sr.isSimpleParamList=function(m){for(var w=0,z=m;w<z.length;w+=1){var I=z[w];if(I.type!=="Identifier")return!1}return!0},Sr.checkParams=function(m,w){for(var z={},I=0,fe=m.params;I<fe.length;I+=1){var Le=fe[I];this.checkLVal(Le,Pr,w?null:z)}},Sr.parseExprList=function(m,w,z,I){for(var fe=[],Le=!0;!this.eat(m);){if(Le)Le=!1;else if(this.expect(q.comma),w&&this.afterTrailingComma(m))break;var pt=void 0;z&&this.type===q.comma?pt=null:this.type===q.ellipsis?(pt=this.parseSpread(I),I&&this.type===q.comma&&I.trailingComma<0&&(I.trailingComma=this.start)):pt=this.parseMaybeAssign(!1,I),fe.push(pt)}return fe},Sr.checkUnreserved=function(m){var w=m.start,z=m.end,I=m.name;if(this.inGenerator&&I==="yield"&&this.raiseRecoverable(w,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&I==="await"&&this.raiseRecoverable(w,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(I)&&this.raise(w,"Unexpected keyword '"+I+"'"),!(this.options.ecmaVersion<6&&this.input.slice(w,z).indexOf("\\")!==-1)){var fe=this.strict?this.reservedWordsStrict:this.reservedWords;fe.test(I)&&(!this.inAsync&&I==="await"&&this.raiseRecoverable(w,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(w,"The keyword '"+I+"' is reserved"))}},Sr.parseIdent=function(m,w){var z=this.startNode();return this.type===q.name?z.name=this.value:this.type.keyword?(z.name=this.type.keyword,(z.name==="class"||z.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!m),this.finishNode(z,"Identifier"),m||(this.checkUnreserved(z),z.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=z.start)),z},Sr.parseYield=function(m){this.yieldPos||(this.yieldPos=this.start);var w=this.startNode();return this.next(),this.type===q.semi||this.canInsertSemicolon()||this.type!==q.star&&!this.type.startsExpr?(w.delegate=!1,w.argument=null):(w.delegate=this.eat(q.star),w.argument=this.parseMaybeAssign(m)),this.finishNode(w,"YieldExpression")},Sr.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var m=this.startNode();return this.next(),m.argument=this.parseMaybeUnary(null,!1),this.finishNode(m,"AwaitExpression")};var Hr=Ve.prototype;Hr.raise=function(m,w){var z=lt(this.input,m);w+=" ("+z.line+":"+z.column+")";var I=new SyntaxError(w);throw I.pos=m,I.loc=z,I.raisedAt=this.pos,I},Hr.raiseRecoverable=Hr.raise,Hr.curPosition=function(){if(this.options.locations)return new ye(this.curLine,this.pos-this.lineStart)};var Xr=Ve.prototype,yn=function(w){this.flags=w,this.var=[],this.lexical=[],this.functions=[]};Xr.enterScope=function(m){this.scopeStack.push(new yn(m))},Xr.exitScope=function(){this.scopeStack.pop()},Xr.treatFunctionsAsVarInScope=function(m){return m.flags&qr||!this.inModule&&m.flags&cn},Xr.declareName=function(m,w,z){var I=!1;if(w===or){var fe=this.currentScope();I=fe.lexical.indexOf(m)>-1||fe.functions.indexOf(m)>-1||fe.var.indexOf(m)>-1,fe.lexical.push(m),this.inModule&&fe.flags&cn&&delete this.undefinedExports[m]}else if(w===C){var Le=this.currentScope();Le.lexical.push(m)}else if(w===nn){var pt=this.currentScope();this.treatFunctionsAsVar?I=pt.lexical.indexOf(m)>-1:I=pt.lexical.indexOf(m)>-1||pt.var.indexOf(m)>-1,pt.functions.push(m)}else for(var Zt=this.scopeStack.length-1;Zt>=0;--Zt){var jt=this.scopeStack[Zt];if(jt.lexical.indexOf(m)>-1&&!(jt.flags&Ze&&jt.lexical[0]===m)||!this.treatFunctionsAsVarInScope(jt)&&jt.functions.indexOf(m)>-1){I=!0;break}if(jt.var.push(m),this.inModule&&jt.flags&cn&&delete this.undefinedExports[m],jt.flags&fi)break}I&&this.raiseRecoverable(z,"Identifier '"+m+"' has already been declared")},Xr.checkLocalExport=function(m){this.scopeStack[0].lexical.indexOf(m.name)===-1&&this.scopeStack[0].var.indexOf(m.name)===-1&&(this.undefinedExports[m.name]=m)},Xr.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Xr.currentVarScope=function(){for(var m=this.scopeStack.length-1;;m--){var w=this.scopeStack[m];if(w.flags&fi)return w}},Xr.currentThisScope=function(){for(var m=this.scopeStack.length-1;;m--){var w=this.scopeStack[m];if(w.flags&fi&&!(w.flags&Te))return w}};var vr=function(w,z,I){this.type="",this.start=z,this.end=0,w.options.locations&&(this.loc=new it(w,I)),w.options.directSourceFile&&(this.sourceFile=w.options.directSourceFile),w.options.ranges&&(this.range=[z,0])},Or=Ve.prototype;Or.startNode=function(){return new vr(this,this.start,this.startLoc)},Or.startNodeAt=function(m,w){return new vr(this,m,w)};function St(m,w,z,I){return m.type=w,m.end=z,this.options.locations&&(m.loc.end=I),this.options.ranges&&(m.range[1]=z),m}Or.finishNode=function(m,w){return St.call(this,m,w,this.lastTokEnd,this.lastTokEndLoc)},Or.finishNodeAt=function(m,w,z,I){return St.call(this,m,w,z,I)};var Kn=function(w,z,I,fe,Le){this.token=w,this.isExpr=!!z,this.preserveSpace=!!I,this.override=fe,this.generator=!!Le},Ln={b_stat:new Kn("{",!1),b_expr:new Kn("{",!0),b_tmpl:new Kn("${",!1),p_stat:new Kn("(",!1),p_expr:new Kn("(",!0),q_tmpl:new Kn("`",!0,!0,function(m){return m.tryReadTemplateToken()}),f_stat:new Kn("function",!1),f_expr:new Kn("function",!0),f_expr_gen:new Kn("function",!0,!1,null,!0),f_gen:new Kn("function",!1,!1,null,!0)},zr=Ve.prototype;zr.initialContext=function(){return[Ln.b_stat]},zr.braceIsBlock=function(m){var w=this.curContext();return w===Ln.f_expr||w===Ln.f_stat?!0:m===q.colon&&(w===Ln.b_stat||w===Ln.b_expr)?!w.isExpr:m===q._return||m===q.name&&this.exprAllowed?Bt.test(this.input.slice(this.lastTokEnd,this.start)):m===q._else||m===q.semi||m===q.eof||m===q.parenR||m===q.arrow?!0:m===q.braceL?w===Ln.b_stat:m===q._var||m===q._const||m===q.name?!1:!this.exprAllowed},zr.inGeneratorContext=function(){for(var m=this.context.length-1;m>=1;m--){var w=this.context[m];if(w.token==="function")return w.generator}return!1},zr.updateContext=function(m){var w,z=this.type;z.keyword&&m===q.dot?this.exprAllowed=!1:(w=z.updateContext)?w.call(this,m):this.exprAllowed=z.beforeExpr},q.parenR.updateContext=q.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var m=this.context.pop();m===Ln.b_stat&&this.curContext().token==="function"&&(m=this.context.pop()),this.exprAllowed=!m.isExpr},q.braceL.updateContext=function(m){this.context.push(this.braceIsBlock(m)?Ln.b_stat:Ln.b_expr),this.exprAllowed=!0},q.dollarBraceL.updateContext=function(){this.context.push(Ln.b_tmpl),this.exprAllowed=!0},q.parenL.updateContext=function(m){var w=m===q._if||m===q._for||m===q._with||m===q._while;this.context.push(w?Ln.p_stat:Ln.p_expr),this.exprAllowed=!0},q.incDec.updateContext=function(){},q._function.updateContext=q._class.updateContext=function(m){m.beforeExpr&&m!==q.semi&&m!==q._else&&!(m===q._return&&Bt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((m===q.colon||m===q.braceL)&&this.curContext()===Ln.b_stat)?this.context.push(Ln.f_expr):this.context.push(Ln.f_stat),this.exprAllowed=!1},q.backQuote.updateContext=function(){this.curContext()===Ln.q_tmpl?this.context.pop():this.context.push(Ln.q_tmpl),this.exprAllowed=!1},q.star.updateContext=function(m){if(m===q._function){var w=this.context.length-1;this.context[w]===Ln.f_expr?this.context[w]=Ln.f_expr_gen:this.context[w]=Ln.f_gen}this.exprAllowed=!0},q.name.updateContext=function(m){var w=!1;this.options.ecmaVersion>=6&&m!==q.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(w=!0),this.exprAllowed=w};var Y="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ce=Y+" Extended_Pictographic",ve=ce,B={9:Y,10:ce,11:ve},ee="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",pe="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Ae=pe+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",oe=Ae+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",_e={9:pe,10:Ae,11:oe},dt={};function Er(m){var w=dt[m]={binary:Me(B[m]+" "+ee),nonBinary:{General_Category:Me(ee),Script:Me(_e[m])}};w.nonBinary.Script_Extensions=w.nonBinary.Script,w.nonBinary.gc=w.nonBinary.General_Category,w.nonBinary.sc=w.nonBinary.Script,w.nonBinary.scx=w.nonBinary.Script_Extensions}Er(9),Er(10),Er(11);var Kt=Ve.prototype,ir=function(w){this.parser=w,this.validFlags="gim"+(w.options.ecmaVersion>=6?"uy":"")+(w.options.ecmaVersion>=9?"s":""),this.unicodeProperties=dt[w.options.ecmaVersion>=11?11:w.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};ir.prototype.reset=function(w,z,I){var fe=I.indexOf("u")!==-1;this.start=w|0,this.source=z+"",this.flags=I,this.switchU=fe&&this.parser.options.ecmaVersion>=6,this.switchN=fe&&this.parser.options.ecmaVersion>=9},ir.prototype.raise=function(w){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+w)},ir.prototype.at=function(w,z){z===void 0&&(z=!1);var I=this.source,fe=I.length;if(w>=fe)return-1;var Le=I.charCodeAt(w);if(!(z||this.switchU)||Le<=55295||Le>=57344||w+1>=fe)return Le;var pt=I.charCodeAt(w+1);return pt>=56320&&pt<=57343?(Le<<10)+pt-56613888:Le},ir.prototype.nextIndex=function(w,z){z===void 0&&(z=!1);var I=this.source,fe=I.length;if(w>=fe)return fe;var Le=I.charCodeAt(w),pt;return!(z||this.switchU)||Le<=55295||Le>=57344||w+1>=fe||(pt=I.charCodeAt(w+1))<56320||pt>57343?w+1:w+2},ir.prototype.current=function(w){return w===void 0&&(w=!1),this.at(this.pos,w)},ir.prototype.lookahead=function(w){return w===void 0&&(w=!1),this.at(this.nextIndex(this.pos,w),w)},ir.prototype.advance=function(w){w===void 0&&(w=!1),this.pos=this.nextIndex(this.pos,w)},ir.prototype.eat=function(w,z){return z===void 0&&(z=!1),this.current(z)===w?(this.advance(z),!0):!1};function Zr(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Kt.validateRegExpFlags=function(m){for(var w=m.validFlags,z=m.flags,I=0;I<z.length;I++){var fe=z.charAt(I);w.indexOf(fe)===-1&&this.raise(m.start,"Invalid regular expression flag"),z.indexOf(fe,I+1)>-1&&this.raise(m.start,"Duplicate regular expression flag")}},Kt.validateRegExpPattern=function(m){this.regexp_pattern(m),!m.switchN&&this.options.ecmaVersion>=9&&m.groupNames.length>0&&(m.switchN=!0,this.regexp_pattern(m))},Kt.regexp_pattern=function(m){m.pos=0,m.lastIntValue=0,m.lastStringValue="",m.lastAssertionIsQuantifiable=!1,m.numCapturingParens=0,m.maxBackReference=0,m.groupNames.length=0,m.backReferenceNames.length=0,this.regexp_disjunction(m),m.pos!==m.source.length&&(m.eat(41)&&m.raise("Unmatched ')'"),(m.eat(93)||m.eat(125))&&m.raise("Lone quantifier brackets")),m.maxBackReference>m.numCapturingParens&&m.raise("Invalid escape");for(var w=0,z=m.backReferenceNames;w<z.length;w+=1){var I=z[w];m.groupNames.indexOf(I)===-1&&m.raise("Invalid named capture referenced")}},Kt.regexp_disjunction=function(m){for(this.regexp_alternative(m);m.eat(124);)this.regexp_alternative(m);this.regexp_eatQuantifier(m,!0)&&m.raise("Nothing to repeat"),m.eat(123)&&m.raise("Lone quantifier brackets")},Kt.regexp_alternative=function(m){for(;m.pos<m.source.length&&this.regexp_eatTerm(m););},Kt.regexp_eatTerm=function(m){return this.regexp_eatAssertion(m)?(m.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(m)&&m.switchU&&m.raise("Invalid quantifier"),!0):(m.switchU?this.regexp_eatAtom(m):this.regexp_eatExtendedAtom(m))?(this.regexp_eatQuantifier(m),!0):!1},Kt.regexp_eatAssertion=function(m){var w=m.pos;if(m.lastAssertionIsQuantifiable=!1,m.eat(94)||m.eat(36))return!0;if(m.eat(92)){if(m.eat(66)||m.eat(98))return!0;m.pos=w}if(m.eat(40)&&m.eat(63)){var z=!1;if(this.options.ecmaVersion>=9&&(z=m.eat(60)),m.eat(61)||m.eat(33))return this.regexp_disjunction(m),m.eat(41)||m.raise("Unterminated group"),m.lastAssertionIsQuantifiable=!z,!0}return m.pos=w,!1},Kt.regexp_eatQuantifier=function(m,w){return w===void 0&&(w=!1),this.regexp_eatQuantifierPrefix(m,w)?(m.eat(63),!0):!1},Kt.regexp_eatQuantifierPrefix=function(m,w){return m.eat(42)||m.eat(43)||m.eat(63)||this.regexp_eatBracedQuantifier(m,w)},Kt.regexp_eatBracedQuantifier=function(m,w){var z=m.pos;if(m.eat(123)){var I=0,fe=-1;if(this.regexp_eatDecimalDigits(m)&&(I=m.lastIntValue,m.eat(44)&&this.regexp_eatDecimalDigits(m)&&(fe=m.lastIntValue),m.eat(125)))return fe!==-1&&fe<I&&!w&&m.raise("numbers out of order in {} quantifier"),!0;m.switchU&&!w&&m.raise("Incomplete quantifier"),m.pos=z}return!1},Kt.regexp_eatAtom=function(m){return this.regexp_eatPatternCharacters(m)||m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)},Kt.regexp_eatReverseSolidusAtomEscape=function(m){var w=m.pos;if(m.eat(92)){if(this.regexp_eatAtomEscape(m))return!0;m.pos=w}return!1},Kt.regexp_eatUncapturingGroup=function(m){var w=m.pos;if(m.eat(40)){if(m.eat(63)&&m.eat(58)){if(this.regexp_disjunction(m),m.eat(41))return!0;m.raise("Unterminated group")}m.pos=w}return!1},Kt.regexp_eatCapturingGroup=function(m){if(m.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(m):m.current()===63&&m.raise("Invalid group"),this.regexp_disjunction(m),m.eat(41))return m.numCapturingParens+=1,!0;m.raise("Unterminated group")}return!1},Kt.regexp_eatExtendedAtom=function(m){return m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)||this.regexp_eatInvalidBracedQuantifier(m)||this.regexp_eatExtendedPatternCharacter(m)},Kt.regexp_eatInvalidBracedQuantifier=function(m){return this.regexp_eatBracedQuantifier(m,!0)&&m.raise("Nothing to repeat"),!1},Kt.regexp_eatSyntaxCharacter=function(m){var w=m.current();return Bn(w)?(m.lastIntValue=w,m.advance(),!0):!1};function Bn(m){return m===36||m>=40&&m<=43||m===46||m===63||m>=91&&m<=94||m>=123&&m<=125}Kt.regexp_eatPatternCharacters=function(m){for(var w=m.pos,z=0;(z=m.current())!==-1&&!Bn(z);)m.advance();return m.pos!==w},Kt.regexp_eatExtendedPatternCharacter=function(m){var w=m.current();return w!==-1&&w!==36&&!(w>=40&&w<=43)&&w!==46&&w!==63&&w!==91&&w!==94&&w!==124?(m.advance(),!0):!1},Kt.regexp_groupSpecifier=function(m){if(m.eat(63)){if(this.regexp_eatGroupName(m)){m.groupNames.indexOf(m.lastStringValue)!==-1&&m.raise("Duplicate capture group name"),m.groupNames.push(m.lastStringValue);return}m.raise("Invalid group")}},Kt.regexp_eatGroupName=function(m){if(m.lastStringValue="",m.eat(60)){if(this.regexp_eatRegExpIdentifierName(m)&&m.eat(62))return!0;m.raise("Invalid capture group name")}return!1},Kt.regexp_eatRegExpIdentifierName=function(m){if(m.lastStringValue="",this.regexp_eatRegExpIdentifierStart(m)){for(m.lastStringValue+=Zr(m.lastIntValue);this.regexp_eatRegExpIdentifierPart(m);)m.lastStringValue+=Zr(m.lastIntValue);return!0}return!1},Kt.regexp_eatRegExpIdentifierStart=function(m){var w=m.pos,z=this.options.ecmaVersion>=11,I=m.current(z);return m.advance(z),I===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,z)&&(I=m.lastIntValue),Fn(I)?(m.lastIntValue=I,!0):(m.pos=w,!1)};function Fn(m){return $t(m,!0)||m===36||m===95}Kt.regexp_eatRegExpIdentifierPart=function(m){var w=m.pos,z=this.options.ecmaVersion>=11,I=m.current(z);return m.advance(z),I===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,z)&&(I=m.lastIntValue),nr(I)?(m.lastIntValue=I,!0):(m.pos=w,!1)};function nr(m){return Jt(m,!0)||m===36||m===95||m===8204||m===8205}Kt.regexp_eatAtomEscape=function(m){return this.regexp_eatBackReference(m)||this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)||m.switchN&&this.regexp_eatKGroupName(m)?!0:(m.switchU&&(m.current()===99&&m.raise("Invalid unicode escape"),m.raise("Invalid escape")),!1)},Kt.regexp_eatBackReference=function(m){var w=m.pos;if(this.regexp_eatDecimalEscape(m)){var z=m.lastIntValue;if(m.switchU)return z>m.maxBackReference&&(m.maxBackReference=z),!0;if(z<=m.numCapturingParens)return!0;m.pos=w}return!1},Kt.regexp_eatKGroupName=function(m){if(m.eat(107)){if(this.regexp_eatGroupName(m))return m.backReferenceNames.push(m.lastStringValue),!0;m.raise("Invalid named reference")}return!1},Kt.regexp_eatCharacterEscape=function(m){return this.regexp_eatControlEscape(m)||this.regexp_eatCControlLetter(m)||this.regexp_eatZero(m)||this.regexp_eatHexEscapeSequence(m)||this.regexp_eatRegExpUnicodeEscapeSequence(m,!1)||!m.switchU&&this.regexp_eatLegacyOctalEscapeSequence(m)||this.regexp_eatIdentityEscape(m)},Kt.regexp_eatCControlLetter=function(m){var w=m.pos;if(m.eat(99)){if(this.regexp_eatControlLetter(m))return!0;m.pos=w}return!1},Kt.regexp_eatZero=function(m){return m.current()===48&&!Di(m.lookahead())?(m.lastIntValue=0,m.advance(),!0):!1},Kt.regexp_eatControlEscape=function(m){var w=m.current();return w===116?(m.lastIntValue=9,m.advance(),!0):w===110?(m.lastIntValue=10,m.advance(),!0):w===118?(m.lastIntValue=11,m.advance(),!0):w===102?(m.lastIntValue=12,m.advance(),!0):w===114?(m.lastIntValue=13,m.advance(),!0):!1},Kt.regexp_eatControlLetter=function(m){var w=m.current();return In(w)?(m.lastIntValue=w%32,m.advance(),!0):!1};function In(m){return m>=65&&m<=90||m>=97&&m<=122}Kt.regexp_eatRegExpUnicodeEscapeSequence=function(m,w){w===void 0&&(w=!1);var z=m.pos,I=w||m.switchU;if(m.eat(117)){if(this.regexp_eatFixedHexDigits(m,4)){var fe=m.lastIntValue;if(I&&fe>=55296&&fe<=56319){var Le=m.pos;if(m.eat(92)&&m.eat(117)&&this.regexp_eatFixedHexDigits(m,4)){var pt=m.lastIntValue;if(pt>=56320&&pt<=57343)return m.lastIntValue=(fe-55296)*1024+(pt-56320)+65536,!0}m.pos=Le,m.lastIntValue=fe}return!0}if(I&&m.eat(123)&&this.regexp_eatHexDigits(m)&&m.eat(125)&&vn(m.lastIntValue))return!0;I&&m.raise("Invalid unicode escape"),m.pos=z}return!1};function vn(m){return m>=0&&m<=1114111}Kt.regexp_eatIdentityEscape=function(m){if(m.switchU)return this.regexp_eatSyntaxCharacter(m)?!0:m.eat(47)?(m.lastIntValue=47,!0):!1;var w=m.current();return w!==99&&(!m.switchN||w!==107)?(m.lastIntValue=w,m.advance(),!0):!1},Kt.regexp_eatDecimalEscape=function(m){m.lastIntValue=0;var w=m.current();if(w>=49&&w<=57){do m.lastIntValue=10*m.lastIntValue+(w-48),m.advance();while((w=m.current())>=48&&w<=57);return!0}return!1},Kt.regexp_eatCharacterClassEscape=function(m){var w=m.current();if(xn(w))return m.lastIntValue=-1,m.advance(),!0;if(m.switchU&&this.options.ecmaVersion>=9&&(w===80||w===112)){if(m.lastIntValue=-1,m.advance(),m.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(m)&&m.eat(125))return!0;m.raise("Invalid property name")}return!1};function xn(m){return m===100||m===68||m===115||m===83||m===119||m===87}Kt.regexp_eatUnicodePropertyValueExpression=function(m){var w=m.pos;if(this.regexp_eatUnicodePropertyName(m)&&m.eat(61)){var z=m.lastStringValue;if(this.regexp_eatUnicodePropertyValue(m)){var I=m.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(m,z,I),!0}}if(m.pos=w,this.regexp_eatLoneUnicodePropertyNameOrValue(m)){var fe=m.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(m,fe),!0}return!1},Kt.regexp_validateUnicodePropertyNameAndValue=function(m,w,z){j(m.unicodeProperties.nonBinary,w)||m.raise("Invalid property name"),m.unicodeProperties.nonBinary[w].test(z)||m.raise("Invalid property value")},Kt.regexp_validateUnicodePropertyNameOrValue=function(m,w){m.unicodeProperties.binary.test(w)||m.raise("Invalid property name")},Kt.regexp_eatUnicodePropertyName=function(m){var w=0;for(m.lastStringValue="";zi(w=m.current());)m.lastStringValue+=Zr(w),m.advance();return m.lastStringValue!==""};function zi(m){return In(m)||m===95}Kt.regexp_eatUnicodePropertyValue=function(m){var w=0;for(m.lastStringValue="";Tn(w=m.current());)m.lastStringValue+=Zr(w),m.advance();return m.lastStringValue!==""};function Tn(m){return zi(m)||Di(m)}Kt.regexp_eatLoneUnicodePropertyNameOrValue=function(m){return this.regexp_eatUnicodePropertyValue(m)},Kt.regexp_eatCharacterClass=function(m){if(m.eat(91)){if(m.eat(94),this.regexp_classRanges(m),m.eat(93))return!0;m.raise("Unterminated character class")}return!1},Kt.regexp_classRanges=function(m){for(;this.regexp_eatClassAtom(m);){var w=m.lastIntValue;if(m.eat(45)&&this.regexp_eatClassAtom(m)){var z=m.lastIntValue;m.switchU&&(w===-1||z===-1)&&m.raise("Invalid character class"),w!==-1&&z!==-1&&w>z&&m.raise("Range out of order in character class")}}},Kt.regexp_eatClassAtom=function(m){var w=m.pos;if(m.eat(92)){if(this.regexp_eatClassEscape(m))return!0;if(m.switchU){var z=m.current();(z===99||na(z))&&m.raise("Invalid class escape"),m.raise("Invalid escape")}m.pos=w}var I=m.current();return I!==93?(m.lastIntValue=I,m.advance(),!0):!1},Kt.regexp_eatClassEscape=function(m){var w=m.pos;if(m.eat(98))return m.lastIntValue=8,!0;if(m.switchU&&m.eat(45))return m.lastIntValue=45,!0;if(!m.switchU&&m.eat(99)){if(this.regexp_eatClassControlLetter(m))return!0;m.pos=w}return this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)},Kt.regexp_eatClassControlLetter=function(m){var w=m.current();return Di(w)||w===95?(m.lastIntValue=w%32,m.advance(),!0):!1},Kt.regexp_eatHexEscapeSequence=function(m){var w=m.pos;if(m.eat(120)){if(this.regexp_eatFixedHexDigits(m,2))return!0;m.switchU&&m.raise("Invalid escape"),m.pos=w}return!1},Kt.regexp_eatDecimalDigits=function(m){var w=m.pos,z=0;for(m.lastIntValue=0;Di(z=m.current());)m.lastIntValue=10*m.lastIntValue+(z-48),m.advance();return m.pos!==w};function Di(m){return m>=48&&m<=57}Kt.regexp_eatHexDigits=function(m){var w=m.pos,z=0;for(m.lastIntValue=0;ra(z=m.current());)m.lastIntValue=16*m.lastIntValue+hi(z),m.advance();return m.pos!==w};function ra(m){return m>=48&&m<=57||m>=65&&m<=70||m>=97&&m<=102}function hi(m){return m>=65&&m<=70?10+(m-65):m>=97&&m<=102?10+(m-97):m-48}Kt.regexp_eatLegacyOctalEscapeSequence=function(m){if(this.regexp_eatOctalDigit(m)){var w=m.lastIntValue;if(this.regexp_eatOctalDigit(m)){var z=m.lastIntValue;w<=3&&this.regexp_eatOctalDigit(m)?m.lastIntValue=w*64+z*8+m.lastIntValue:m.lastIntValue=w*8+z}else m.lastIntValue=w;return!0}return!1},Kt.regexp_eatOctalDigit=function(m){var w=m.current();return na(w)?(m.lastIntValue=w-48,m.advance(),!0):(m.lastIntValue=0,!1)};function na(m){return m>=48&&m<=55}Kt.regexp_eatFixedHexDigits=function(m,w){var z=m.pos;m.lastIntValue=0;for(var I=0;I<w;++I){var fe=m.current();if(!ra(fe))return m.pos=z,!1;m.lastIntValue=16*m.lastIntValue+hi(fe),m.advance()}return!0};var Yi=function(w){this.type=w.type,this.value=w.value,this.start=w.start,this.end=w.end,w.options.locations&&(this.loc=new it(w,w.startLoc,w.endLoc)),w.options.ranges&&(this.range=[w.start,w.end])},Ii=Ve.prototype;Ii.next=function(m){!m&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Yi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Ii.getToken=function(){return this.next(),new Yi(this)},typeof Symbol!="undefined"&&(Ii[Symbol.iterator]=function(){var m=this;return{next:function(){var w=m.getToken();return{done:w.type===q.eof,value:w}}}}),Ii.curContext=function(){return this.context[this.context.length-1]},Ii.nextToken=function(){var m=this.curContext();if((!m||!m.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(q.eof);if(m.override)return m.override(this);this.readToken(this.fullCharCodeAtPos())},Ii.readToken=function(m){return $t(m,this.options.ecmaVersion>=6)||m===92?this.readWord():this.getTokenFromCode(m)},Ii.fullCharCodeAtPos=function(){var m=this.input.charCodeAt(this.pos);if(m<=55295||m>=57344)return m;var w=this.input.charCodeAt(this.pos+1);return(m<<10)+w-56613888},Ii.skipBlockComment=function(){var m=this.options.onComment&&this.curPosition(),w=this.pos,z=this.input.indexOf("*/",this.pos+=2);if(z===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=z+2,this.options.locations){et.lastIndex=w;for(var I;(I=et.exec(this.input))&&I.index<this.pos;)++this.curLine,this.lineStart=I.index+I[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(w+2,z),w,this.pos,m,this.curPosition())},Ii.skipLineComment=function(m){for(var w=this.pos,z=this.options.onComment&&this.curPosition(),I=this.input.charCodeAt(this.pos+=m);this.pos<this.input.length&&!je(I);)I=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(w+m,this.pos),w,this.pos,z,this.curPosition())},Ii.skipSpace=function(){e:for(;this.pos<this.input.length;){var m=this.input.charCodeAt(this.pos);switch(m){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(m>8&&m<14||m>=5760&&nt.test(String.fromCharCode(m)))++this.pos;else break e}}},Ii.finishToken=function(m,w){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var z=this.type;this.type=m,this.value=w,this.updateContext(z)},Ii.readToken_dot=function(){var m=this.input.charCodeAt(this.pos+1);if(m>=48&&m<=57)return this.readNumber(!0);var w=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&m===46&&w===46?(this.pos+=3,this.finishToken(q.ellipsis)):(++this.pos,this.finishToken(q.dot))},Ii.readToken_slash=function(){var m=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):m===61?this.finishOp(q.assign,2):this.finishOp(q.slash,1)},Ii.readToken_mult_modulo_exp=function(m){var w=this.input.charCodeAt(this.pos+1),z=1,I=m===42?q.star:q.modulo;return this.options.ecmaVersion>=7&&m===42&&w===42&&(++z,I=q.starstar,w=this.input.charCodeAt(this.pos+2)),w===61?this.finishOp(q.assign,z+1):this.finishOp(I,z)},Ii.readToken_pipe_amp=function(m){var w=this.input.charCodeAt(this.pos+1);if(w===m){if(this.options.ecmaVersion>=12){var z=this.input.charCodeAt(this.pos+2);if(z===61)return this.finishOp(q.assign,3)}return this.finishOp(m===124?q.logicalOR:q.logicalAND,2)}return w===61?this.finishOp(q.assign,2):this.finishOp(m===124?q.bitwiseOR:q.bitwiseAND,1)},Ii.readToken_caret=function(){var m=this.input.charCodeAt(this.pos+1);return m===61?this.finishOp(q.assign,2):this.finishOp(q.bitwiseXOR,1)},Ii.readToken_plus_min=function(m){var w=this.input.charCodeAt(this.pos+1);return w===m?w===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Bt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(q.incDec,2):w===61?this.finishOp(q.assign,2):this.finishOp(q.plusMin,1)},Ii.readToken_lt_gt=function(m){var w=this.input.charCodeAt(this.pos+1),z=1;return w===m?(z=m===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+z)===61?this.finishOp(q.assign,z+1):this.finishOp(q.bitShift,z)):w===33&&m===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(w===61&&(z=2),this.finishOp(q.relational,z))},Ii.readToken_eq_excl=function(m){var w=this.input.charCodeAt(this.pos+1);return w===61?this.finishOp(q.equality,this.input.charCodeAt(this.pos+2)===61?3:2):m===61&&w===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(q.arrow)):this.finishOp(m===61?q.eq:q.prefix,1)},Ii.readToken_question=function(){var m=this.options.ecmaVersion;if(m>=11){var w=this.input.charCodeAt(this.pos+1);if(w===46){var z=this.input.charCodeAt(this.pos+2);if(z<48||z>57)return this.finishOp(q.questionDot,2)}if(w===63){if(m>=12){var I=this.input.charCodeAt(this.pos+2);if(I===61)return this.finishOp(q.assign,3)}return this.finishOp(q.coalesce,2)}}return this.finishOp(q.question,1)},Ii.getTokenFromCode=function(m){switch(m){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(q.parenL);case 41:return++this.pos,this.finishToken(q.parenR);case 59:return++this.pos,this.finishToken(q.semi);case 44:return++this.pos,this.finishToken(q.comma);case 91:return++this.pos,this.finishToken(q.bracketL);case 93:return++this.pos,this.finishToken(q.bracketR);case 123:return++this.pos,this.finishToken(q.braceL);case 125:return++this.pos,this.finishToken(q.braceR);case 58:return++this.pos,this.finishToken(q.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(q.backQuote);case 48:var w=this.input.charCodeAt(this.pos+1);if(w===120||w===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(w===111||w===79)return this.readRadixNumber(8);if(w===98||w===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(m);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(m);case 124:case 38:return this.readToken_pipe_amp(m);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(m);case 60:case 62:return this.readToken_lt_gt(m);case 61:case 33:return this.readToken_eq_excl(m);case 63:return this.readToken_question();case 126:return this.finishOp(q.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ki(m)+"'")},Ii.finishOp=function(m,w){var z=this.input.slice(this.pos,this.pos+w);return this.pos+=w,this.finishToken(m,z)},Ii.readRegexp=function(){for(var m,w,z=this.pos;;){this.pos>=this.input.length&&this.raise(z,"Unterminated regular expression");var I=this.input.charAt(this.pos);if(Bt.test(I)&&this.raise(z,"Unterminated regular expression"),m)m=!1;else{if(I==="[")w=!0;else if(I==="]"&&w)w=!1;else if(I==="/"&&!w)break;m=I==="\\"}++this.pos}var fe=this.input.slice(z,this.pos);++this.pos;var Le=this.pos,pt=this.readWord1();this.containsEsc&&this.unexpected(Le);var Zt=this.regexpState||(this.regexpState=new ir(this));Zt.reset(z,fe,pt),this.validateRegExpFlags(Zt),this.validateRegExpPattern(Zt);var jt=null;try{jt=new RegExp(fe,pt)}catch(Fr){}return this.finishToken(q.regexp,{pattern:fe,flags:pt,value:jt})},Ii.readInt=function(m,w,z){for(var I=this.options.ecmaVersion>=12&&w===void 0,fe=z&&this.input.charCodeAt(this.pos)===48,Le=this.pos,pt=0,Zt=0,jt=0,Fr=w==null?Infinity:w;jt<Fr;++jt,++this.pos){var Wr=this.input.charCodeAt(this.pos),hn=void 0;if(I&&Wr===95){fe&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Zt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),jt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Zt=Wr;continue}if(Wr>=97?hn=Wr-97+10:Wr>=65?hn=Wr-65+10:Wr>=48&&Wr<=57?hn=Wr-48:hn=Infinity,hn>=m)break;Zt=Wr,pt=pt*m+hn}return I&&Zt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Le||w!=null&&this.pos-Le!==w?null:pt};function ya(m,w){return w?parseInt(m,8):parseFloat(m.replace(/_/g,""))}function Fa(m){return typeof BigInt!="function"?null:BigInt(m.replace(/_/g,""))}Ii.readRadixNumber=function(m){var w=this.pos;this.pos+=2;var z=this.readInt(m);return z==null&&this.raise(this.start+2,"Expected number in radix "+m),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(z=Fa(this.input.slice(w,this.pos)),++this.pos):$t(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,z)},Ii.readNumber=function(m){var w=this.pos;!m&&this.readInt(10,void 0,!0)===null&&this.raise(w,"Invalid number");var z=this.pos-w>=2&&this.input.charCodeAt(w)===48;z&&this.strict&&this.raise(w,"Invalid number");var I=this.input.charCodeAt(this.pos);if(!z&&!m&&this.options.ecmaVersion>=11&&I===110){var fe=Fa(this.input.slice(w,this.pos));return++this.pos,$t(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,fe)}z&&/[89]/.test(this.input.slice(w,this.pos))&&(z=!1),I===46&&!z&&(++this.pos,this.readInt(10),I=this.input.charCodeAt(this.pos)),(I===69||I===101)&&!z&&(I=this.input.charCodeAt(++this.pos),(I===43||I===45)&&++this.pos,this.readInt(10)===null&&this.raise(w,"Invalid number")),$t(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Le=ya(this.input.slice(w,this.pos),z);return this.finishToken(q.num,Le)},Ii.readCodePoint=function(){var m=this.input.charCodeAt(this.pos),w;if(m===123){this.options.ecmaVersion<6&&this.unexpected();var z=++this.pos;w=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,w>1114111&&this.invalidStringToken(z,"Code point out of bounds")}else w=this.readHexChar(4);return w};function Ki(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Ii.readString=function(m){for(var w="",z=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var I=this.input.charCodeAt(this.pos);if(I===m)break;I===92?(w+=this.input.slice(z,this.pos),w+=this.readEscapedChar(!1),z=this.pos):(je(I,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return w+=this.input.slice(z,this.pos++),this.finishToken(q.string,w)};var Zi={};Ii.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(m){if(m===Zi)this.readInvalidTemplateToken();else throw m}this.inTemplateElement=!1},Ii.invalidStringToken=function(m,w){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Zi;this.raise(m,w)},Ii.readTmplToken=function(){for(var m="",w=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var z=this.input.charCodeAt(this.pos);if(z===96||z===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===q.template||this.type===q.invalidTemplate)?z===36?(this.pos+=2,this.finishToken(q.dollarBraceL)):(++this.pos,this.finishToken(q.backQuote)):(m+=this.input.slice(w,this.pos),this.finishToken(q.template,m));if(z===92)m+=this.input.slice(w,this.pos),m+=this.readEscapedChar(!0),w=this.pos;else if(je(z)){switch(m+=this.input.slice(w,this.pos),++this.pos,z){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:m+=`
`;break;default:m+=String.fromCharCode(z);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),w=this.pos}else++this.pos}},Ii.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(q.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Ii.readEscapedChar=function(m){var w=this.input.charCodeAt(++this.pos);switch(++this.pos,w){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ki(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(m){var z=this.pos-1;return this.invalidStringToken(z,"Invalid escape sequence in template string"),null}default:if(w>=48&&w<=55){var I=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],fe=parseInt(I,8);return fe>255&&(I=I.slice(0,-1),fe=parseInt(I,8)),this.pos+=I.length-1,w=this.input.charCodeAt(this.pos),(I!=="0"||w===56||w===57)&&(this.strict||m)&&this.invalidStringToken(this.pos-1-I.length,m?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(fe)}return je(w)?"":String.fromCharCode(w)}},Ii.readHexChar=function(m){var w=this.pos,z=this.readInt(16,m);return z===null&&this.invalidStringToken(w,"Bad character escape sequence"),z},Ii.readWord1=function(){this.containsEsc=!1;for(var m="",w=!0,z=this.pos,I=this.options.ecmaVersion>=6;this.pos<this.input.length;){var fe=this.fullCharCodeAtPos();if(Jt(fe,I))this.pos+=fe<=65535?1:2;else if(fe===92){this.containsEsc=!0,m+=this.input.slice(z,this.pos);var Le=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var pt=this.readCodePoint();(w?$t:Jt)(pt,I)||this.invalidStringToken(Le,"Invalid Unicode escape"),m+=Ki(pt),z=this.pos}else break;w=!1}return m+this.input.slice(z,this.pos)},Ii.readWord=function(){var m=this.readWord1(),w=q.name;return this.keywords.test(m)&&(w=bt[m]),this.finishToken(w,m)};var $i="7.4.1";Ve.acorn={Parser:Ve,version:$i,defaultOptions:Lt,Position:ye,SourceLocation:it,getLineInfo:lt,Node:vr,TokenType:Ft,tokTypes:q,keywordTypes:bt,TokContext:Kn,tokContexts:Ln,isIdentifierChar:Jt,isIdentifierStart:$t,Token:Yi,isNewLine:je,lineBreak:Bt,lineBreakG:et,nonASCIIwhitespace:nt};function so(m,w){return Ve.parse(m,w)}function Jo(m,w,z){return Ve.parseExpressionAt(m,w,z)}function za(m,w){return Ve.tokenizer(m,w)}function qi(m,w){m.prototype=Object.create(w.prototype),m.prototype.constructor=m,m.__proto__=w}function ou(m){var w=typeof Map=="function"?new Map:void 0;return ou=function(I){if(I===null||!xo(I))return I;if(typeof I!="function")throw new TypeError("Super expression must either be null or a function");if(typeof w!="undefined"){if(w.has(I))return w.get(I);w.set(I,fe)}function fe(){return Ji(I,arguments,Ja(this).constructor)}return fe.prototype=Object.create(I.prototype,{constructor:{value:fe,enumerable:!1,writable:!0,configurable:!0}}),Qi(fe,I)},ou(m)}function Cu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function Ji(m,w,z){return Cu()?Ji=Reflect.construct:Ji=function(fe,Le,pt){var Zt=[null];Zt.push.apply(Zt,Le);var jt=Function.bind.apply(fe,Zt),Fr=new jt;return pt&&Qi(Fr,pt.prototype),Fr},Ji.apply(null,arguments)}function xo(m){return Function.toString.call(m).indexOf("[native code]")!==-1}function Qi(m,w){return Qi=Object.setPrototypeOf||function(I,fe){return I.__proto__=fe,I},Qi(m,w)}function Ja(m){return Ja=Object.setPrototypeOf?Object.getPrototypeOf:function(z){return z.__proto__||Object.getPrototypeOf(z)},Ja(m)}var Qo=function(m){qi(w,m);function w(){return m.apply(this,arguments)||this}return w}(ou(Error)),Ea=function(m){qi(w,m);function w(){return m.apply(this,arguments)||this}return w}(ou(SyntaxError)),Do=function(m){qi(w,m);function w(){return m.apply(this,arguments)||this}return w}(ou(ReferenceError)),ko=function(m){qi(w,m);function w(){return m.apply(this,arguments)||this}return w}(ou(TypeError)),ks=function(m){qi(w,m);function w(){return m.apply(this,arguments)||this}return w}(Qo),yo=function(m){qi(w,m);function w(){return m.apply(this,arguments)||this}return w}(Ea),Go=function(m){qi(w,m);function w(){return m.apply(this,arguments)||this}return w}(Do),Ba={UnknownError:[3001,"%0",ks],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",ks],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Go],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Go],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Go],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Go],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Go],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Go],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Go],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Go],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Go],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Go],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Do],VariableUndefinedReferenceError:[2002,"%0 is not defined",Do],IsNotConstructor:[2003,"%0 is not a constructor",ko]};function ho(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function as(m,w,z){return ho()?as=Reflect.construct:as=function(fe,Le,pt){var Zt=[null];Zt.push.apply(Zt,Le);var jt=Function.bind.apply(fe,Zt),Fr=new jt;return pt&&Fo(Fr,pt.prototype),Fr},as.apply(null,arguments)}function Fo(m,w){return Fo=Object.setPrototypeOf||function(I,fe){return I.__proto__=fe,I},Fo(m,w)}var Se="0.0.2";function ke(m,w){Object.defineProperty(m,"name",{value:w,writable:!1,enumerable:!1,configurable:!0})}var yt=Object.prototype.hasOwnProperty,O=Symbol("Break"),Qr=Symbol("Continue"),oi=Symbol("DefaultCase"),Ai=Symbol("EmptyStatementReturn"),po=Symbol("WithScopeName"),Qa=Symbol("SuperScopeName"),Wa=Symbol("RootScopeName"),os=Symbol("GlobalScopeName");function su(m){return typeof m=="function"}var wu=function(){function m(z){this.interpreter=z}var w=m.prototype;return w.generator=function(){var I=this.interpreter;function fe(){return this.getCurrentScope()}function Le(){return this.getGlobalScope()}function pt(){return this.getCurrentContext()}return{getOptions:I.getOptions.bind(I),getCurrentScope:fe.bind(I),getGlobalScope:Le.bind(I),getCurrentContext:pt.bind(I),getExecStartTime:I.getExecStartTime.bind(I)}},m}();function Qu(m,w,z){if(z===void 0&&(z=!0),!(m instanceof wu))throw new Error("Illegal call");if(typeof w!="string")return w;if(!!w){var I=m.generator(),fe=I.getOptions(),Le={timeout:fe.timeout,_initEnv:function(){z||this.setCurrentContext(I.getCurrentContext()),this.execStartTime=I.getExecStartTime(),this.execEndTime=this.execStartTime}},pt=z?I.getGlobalScope():I.getCurrentScope(),Zt=new wo(pt,Le);return Zt.evaluate(w)}}Object.defineProperty(Qu,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function qo(m){if(!(m instanceof wu))throw new Error("Illegal call");for(var w=m.generator(),z=arguments.length,I=new Array(z>1?z-1:0),fe=1;fe<z;fe++)I[fe-1]=arguments[fe];var Le=I.pop(),pt=new wo(w.getGlobalScope(),w.getOptions()),Zt=`
		    (function anonymous(`+I.join(",")+`){
		        `+Le+`
		    });
		    `;return pt.evaluate(Zt)}Object.defineProperty(qo,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var es=function(w){this.value=w},ss=function(w){this.value=w},As=function(w){this.value=w},us=function(w,z,I){z===void 0&&(z=null),this.name=I,this.parent=z,this.data=w,this.labelStack=[]};function Zs(){}function Ys(m,w){return m===void 0&&(m=null),new us(Object.create(null),m,w)}function Ts(m){return Object.create(m)}var Aa={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Qu,Function:qo};typeof JSON!="undefined"&&(Aa.JSON=JSON),typeof Promise!="undefined"&&(Aa.Promise=Promise),typeof Set!="undefined"&&(Aa.Set=Set),typeof Map!="undefined"&&(Aa.Map=Map),typeof Symbol!="undefined"&&(Aa.Symbol=Symbol),typeof Proxy!="undefined"&&(Aa.Proxy=Proxy),typeof WeakMap!="undefined"&&(Aa.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(Aa.WeakSet=WeakSet),typeof Reflect!="undefined"&&(Aa.Reflect=Reflect);var wo=function(){function m(z,I){z===void 0&&(z=m.global),I===void 0&&(I={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:I.ecmaVersion||m.ecmaVersion,timeout:I.timeout||0,rootContext:I.rootContext,globalContextInFunction:I.globalContextInFunction===void 0?m.globalContextInFunction:I.globalContextInFunction,_initEnv:I._initEnv},this.context=z||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var w=m.prototype;return w.initEnvironment=function(I){var fe;if(I instanceof us)fe=I;else{var Le=null,pt=this.createSuperScope(I);this.options.rootContext&&(Le=new us(Ts(this.options.rootContext),pt,Wa)),fe=new us(I,Le||pt,os)}this.globalScope=fe,this.currentScope=this.globalScope,this.globalContext=fe.data,this.currentContext=fe.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Zt=this.options._initEnv;Zt&&Zt.call(this)},w.getExecStartTime=function(){return this.execStartTime},w.getExecutionTime=function(){return this.execEndTime-this.execStartTime},w.setExecTimeout=function(I){I===void 0&&(I=0),this.options.timeout=I},w.getOptions=function(){return this.options},w.getGlobalScope=function(){return this.globalScope},w.getCurrentScope=function(){return this.currentScope},w.getCurrentContext=function(){return this.currentContext},w.isInterruptThrow=function(I){return I instanceof ks||I instanceof Go||I instanceof yo},w.createSuperScope=function(I){var fe=Object.assign({},Aa),Le=Object.keys(fe);return Le.forEach(function(pt){pt in I&&delete fe[pt]}),new us(fe,null,Qa)},w.setCurrentContext=function(I){this.currentContext=I},w.setCurrentScope=function(I){this.currentScope=I},w.evaluate=function(I){I===void 0&&(I="");var fe;if(!!I)return fe=so(I,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||m.ecmaVersion}),this.evaluateNode(fe,I)},w.appendCode=function(I){return this.evaluate(I)},w.evaluateNode=function(I,fe){var Le=this;fe===void 0&&(fe=""),this.value=void 0,this.source=fe,this.sourceList.push(fe),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var pt=this.getCurrentScope(),Zt=this.getCurrentContext(),jt=pt.labelStack.concat([]),Fr=this.callStack.concat([]),Wr=function(){Le.setCurrentScope(pt),Le.setCurrentContext(Zt),pt.labelStack=jt,Le.callStack=Fr};try{var hn=this.createClosure(I);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),hn()}catch(Oi){throw Oi}finally{Wr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},w.createErrorMessage=function(I,fe,Le){var pt=I[1].replace("%0",String(fe));return Le!==null&&(pt+=this.getNodePosition(Le||this.lastExecNode)),pt},w.createError=function(I,fe){return new fe(I)},w.createThrowError=function(I,fe){return this.createError(I,fe)},w.createInternalThrowError=function(I,fe,Le){return this.createError(this.createErrorMessage(I,fe,Le),I[2])},w.checkTimeout=function(){if(!this.isRunning)return!1;var I=this.options.timeout||0,fe=Date.now();return fe-this.execStartTime>I},w.getNodePosition=function(I){if(I){var fe="";return I.loc?" ["+I.loc.start.line+":"+I.loc.start.column+"]"+fe:""}return""},w.createClosure=function(I){var fe=this,Le;switch(I.type){case"BinaryExpression":Le=this.binaryExpressionHandler(I);break;case"LogicalExpression":Le=this.logicalExpressionHandler(I);break;case"UnaryExpression":Le=this.unaryExpressionHandler(I);break;case"UpdateExpression":Le=this.updateExpressionHandler(I);break;case"ObjectExpression":Le=this.objectExpressionHandler(I);break;case"ArrayExpression":Le=this.arrayExpressionHandler(I);break;case"CallExpression":Le=this.callExpressionHandler(I);break;case"NewExpression":Le=this.newExpressionHandler(I);break;case"MemberExpression":Le=this.memberExpressionHandler(I);break;case"ThisExpression":Le=this.thisExpressionHandler(I);break;case"SequenceExpression":Le=this.sequenceExpressionHandler(I);break;case"Literal":Le=this.literalHandler(I);break;case"Identifier":Le=this.identifierHandler(I);break;case"AssignmentExpression":Le=this.assignmentExpressionHandler(I);break;case"FunctionDeclaration":Le=this.functionDeclarationHandler(I);break;case"VariableDeclaration":Le=this.variableDeclarationHandler(I);break;case"BlockStatement":case"Program":Le=this.programHandler(I);break;case"ExpressionStatement":Le=this.expressionStatementHandler(I);break;case"EmptyStatement":Le=this.emptyStatementHandler(I);break;case"ReturnStatement":Le=this.returnStatementHandler(I);break;case"FunctionExpression":Le=this.functionExpressionHandler(I);break;case"IfStatement":Le=this.ifStatementHandler(I);break;case"ConditionalExpression":Le=this.conditionalExpressionHandler(I);break;case"ForStatement":Le=this.forStatementHandler(I);break;case"WhileStatement":Le=this.whileStatementHandler(I);break;case"DoWhileStatement":Le=this.doWhileStatementHandler(I);break;case"ForInStatement":Le=this.forInStatementHandler(I);break;case"WithStatement":Le=this.withStatementHandler(I);break;case"ThrowStatement":Le=this.throwStatementHandler(I);break;case"TryStatement":Le=this.tryStatementHandler(I);break;case"ContinueStatement":Le=this.continueStatementHandler(I);break;case"BreakStatement":Le=this.breakStatementHandler(I);break;case"SwitchStatement":Le=this.switchStatementHandler(I);break;case"LabeledStatement":Le=this.labeledStatementHandler(I);break;case"DebuggerStatement":Le=this.debuggerStatementHandler(I);break;default:throw this.createInternalThrowError(Ba.NodeTypeSyntaxError,I.type,I)}return function(){var pt=fe.options.timeout;if(pt&&pt>0&&fe.checkTimeout())throw fe.createInternalThrowError(Ba.ExecutionTimeOutError,pt,null);return fe.lastExecNode=I,Le.apply(void 0,arguments)}},w.binaryExpressionHandler=function(I){var fe=this,Le=this.createClosure(I.left),pt=this.createClosure(I.right);return function(){var Zt=Le(),jt=pt();switch(I.operator){case"==":return Zt==jt;case"!=":return Zt!=jt;case"===":return Zt===jt;case"!==":return Zt!==jt;case"<":return Zt<jt;case"<=":return Zt<=jt;case">":return Zt>jt;case">=":return Zt>=jt;case"<<":return Zt<<jt;case">>":return Zt>>jt;case">>>":return Zt>>>jt;case"+":return Zt+jt;case"-":return Zt-jt;case"*":return Zt*jt;case"**":return Math.pow(Zt,jt);case"/":return Zt/jt;case"%":return Zt%jt;case"|":return Zt|jt;case"^":return Zt^jt;case"&":return Zt&jt;case"in":return Zt in jt;case"instanceof":return Zt instanceof jt;default:throw fe.createInternalThrowError(Ba.BinaryOperatorSyntaxError,I.operator,I)}}},w.logicalExpressionHandler=function(I){var fe=this,Le=this.createClosure(I.left),pt=this.createClosure(I.right);return function(){switch(I.operator){case"||":return Le()||pt();case"&&":return Le()&&pt();default:throw fe.createInternalThrowError(Ba.LogicalOperatorSyntaxError,I.operator,I)}}},w.unaryExpressionHandler=function(I){var fe=this;switch(I.operator){case"delete":var Le=this.createObjectGetter(I.argument),pt=this.createNameGetter(I.argument);return function(){var Wr=Le(),hn=pt();return delete Wr[hn]};default:var Zt;if(I.operator==="typeof"&&I.argument.type==="Identifier"){var jt=this.createObjectGetter(I.argument),Fr=this.createNameGetter(I.argument);Zt=function(){return jt()[Fr()]}}else Zt=this.createClosure(I.argument);return function(){var Wr=Zt();switch(I.operator){case"-":return-Wr;case"+":return+Wr;case"!":return!Wr;case"~":return~Wr;case"void":return;case"typeof":return typeof Wr;default:throw fe.createInternalThrowError(Ba.UnaryOperatorSyntaxError,I.operator,I)}}}},w.updateExpressionHandler=function(I){var fe=this,Le=this.createObjectGetter(I.argument),pt=this.createNameGetter(I.argument);return function(){var Zt=Le(),jt=pt();switch(fe.assertVariable(Zt,jt,I),I.operator){case"++":return I.prefix?++Zt[jt]:Zt[jt]++;case"--":return I.prefix?--Zt[jt]:Zt[jt]--;default:throw fe.createInternalThrowError(Ba.UpdateOperatorSyntaxError,I.operator,I)}}},w.objectExpressionHandler=function(I){var fe=this,Le=[];function pt(jt){return jt.type==="Identifier"?jt.name:jt.type==="Literal"?jt.value:this.throwError(Ba.ObjectStructureSyntaxError,jt.type,jt)}var Zt=Object.create(null);return I.properties.forEach(function(jt){var Fr=jt.kind,Wr=pt(jt.key);(!Zt[Wr]||Fr==="init")&&(Zt[Wr]={}),Zt[Wr][Fr]=fe.createClosure(jt.value),Le.push({key:Wr,property:jt})}),function(){for(var jt={},Fr=Le.length,Wr=0;Wr<Fr;Wr++){var hn=Le[Wr],Oi=hn.key,Ei=Zt[Oi],pa=Ei.init?Ei.init():void 0,Ma=Ei.get?Ei.get():function(){},ga=Ei.set?Ei.set():function(Ks){};if("set"in Ei||"get"in Ei){var _i={configurable:!0,enumerable:!0,get:Ma,set:ga};Object.defineProperty(jt,Oi,_i)}else{var go=hn.property,Ao=go.kind;go.key.type==="Identifier"&&go.value.type==="FunctionExpression"&&Ao==="init"&&!go.value.id&&ke(pa,go.key.name),jt[Oi]=pa}}return jt}},w.arrayExpressionHandler=function(I){var fe=this,Le=I.elements.map(function(pt){return pt&&fe.createClosure(pt)});return function(){for(var pt=Le.length,Zt=Array(pt),jt=0;jt<pt;jt++){var Fr=Le[jt];Fr&&(Zt[jt]=Fr())}return Zt}},w.safeObjectGet=function(I,fe,Le){return I[fe]},w.createCallFunctionGetter=function(I){var fe=this;switch(I.type){case"MemberExpression":var Le=this.createClosure(I.object),pt=this.createMemberKeyGetter(I),Zt=this.source;return function(){var Fr=Le(),Wr=pt(),hn=fe.safeObjectGet(Fr,Wr,I);if(!hn||!su(hn)){var Oi=Zt.slice(I.start,I.end);throw fe.createInternalThrowError(Ba.FunctionUndefinedReferenceError,Oi,I)}return hn.__IS_EVAL_FUNC?function(Ei){return hn(new wu(fe),Ei,!0)}:hn.__IS_FUNCTION_FUNC?function(){for(var Ei=arguments.length,pa=new Array(Ei),Ma=0;Ma<Ei;Ma++)pa[Ma]=arguments[Ma];return hn.apply(void 0,[new wu(fe)].concat(pa))}:hn.bind(Fr)};default:var jt=this.createClosure(I);return function(){var Fr="";I.type==="Identifier"&&(Fr=I.name);var Wr=jt();if(!Wr||!su(Wr))throw fe.createInternalThrowError(Ba.FunctionUndefinedReferenceError,Fr,I);if(I.type==="Identifier"&&Wr.__IS_EVAL_FUNC&&Fr==="eval")return function(Ei){var pa=fe.getScopeFromName(Fr,fe.getCurrentScope()),Ma=pa.name===Qa||pa.name===os||pa.name===Wa;return Wr(new wu(fe),Ei,!Ma)};if(Wr.__IS_EVAL_FUNC)return function(Ei){return Wr(new wu(fe),Ei,!0)};if(Wr.__IS_FUNCTION_FUNC)return function(){for(var Ei=arguments.length,pa=new Array(Ei),Ma=0;Ma<Ei;Ma++)pa[Ma]=arguments[Ma];return Wr.apply(void 0,[new wu(fe)].concat(pa))};var hn=fe.options.globalContextInFunction;if(I.type==="Identifier"){var Oi=fe.getIdentifierScope(I);Oi.name===po&&(hn=Oi.data)}return Wr.bind(hn)}}},w.callExpressionHandler=function(I){var fe=this,Le=this.createCallFunctionGetter(I.callee),pt=I.arguments.map(function(Zt){return fe.createClosure(Zt)});return function(){return Le().apply(void 0,pt.map(function(Zt){return Zt()}))}},w.functionExpressionHandler=function(I){var fe=this,Le=this,pt=this.source,Zt=this.collectDeclVars,jt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Fr=I.id?I.id.name:"",Wr=I.params.length,hn=I.params.map(function(Ma){return fe.createParamNameGetter(Ma)}),Oi=this.createClosure(I.body),Ei=this.collectDeclVars,pa=this.collectDeclFuncs;return this.collectDeclVars=Zt,this.collectDeclFuncs=jt,function(){var Ma=Le.getCurrentScope(),ga=function _i(){for(var go=arguments.length,Ao=new Array(go),Ks=0;Ks<go;Ks++)Ao[Ks]=arguments[Ks];Le.callStack.push(""+Fr);var uu=Le.getCurrentScope(),$s=Ys(Ma,"FunctionScope("+Fr+")");Le.setCurrentScope($s),Le.addDeclarationsToScope(Ei,pa,$s),Fr&&($s.data[Fr]=_i),$s.data.arguments=arguments,hn.forEach(function(_s,uo){$s.data[_s()]=Ao[uo]});var Ru=Le.getCurrentContext();Le.setCurrentContext(this);var Ho=Oi();if(Le.setCurrentContext(Ru),Le.setCurrentScope(uu),Le.callStack.pop(),Ho instanceof es)return Ho.value};return ke(ga,Fr),Object.defineProperty(ga,"length",{value:Wr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(ga,"toString",{value:function(){return pt.slice(I.start,I.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(ga,"valueOf",{value:function(){return pt.slice(I.start,I.end)},writable:!0,configurable:!0,enumerable:!1}),ga}},w.newExpressionHandler=function(I){var fe=this,Le=this.source,pt=this.createClosure(I.callee),Zt=I.arguments.map(function(jt){return fe.createClosure(jt)});return function(){var jt=pt();if(!su(jt)||jt.__IS_EVAL_FUNC){var Fr=I.callee,Wr=Le.slice(Fr.start,Fr.end);throw fe.createInternalThrowError(Ba.IsNotConstructor,Wr,I)}return jt.__IS_FUNCTION_FUNC?jt.apply(void 0,[new wu(fe)].concat(Zt.map(function(hn){return hn()}))):as(jt,Zt.map(function(hn){return hn()}))}},w.memberExpressionHandler=function(I){var fe=this.createClosure(I.object),Le=this.createMemberKeyGetter(I);return function(){var pt=fe(),Zt=Le();return pt[Zt]}},w.thisExpressionHandler=function(I){var fe=this;return function(){return fe.getCurrentContext()}},w.sequenceExpressionHandler=function(I){var fe=this,Le=I.expressions.map(function(pt){return fe.createClosure(pt)});return function(){for(var pt,Zt=Le.length,jt=0;jt<Zt;jt++){var Fr=Le[jt];pt=Fr()}return pt}},w.literalHandler=function(I){return function(){return I.regex?new RegExp(I.regex.pattern,I.regex.flags):I.value}},w.identifierHandler=function(I){var fe=this;return function(){var Le=fe.getCurrentScope(),pt=fe.getScopeDataFromName(I.name,Le);return fe.assertVariable(pt,I.name,I),pt[I.name]}},w.getIdentifierScope=function(I){var fe=this.getCurrentScope(),Le=this.getScopeFromName(I.name,fe);return Le},w.assignmentExpressionHandler=function(I){var fe=this;I.left.type==="Identifier"&&I.right.type==="FunctionExpression"&&!I.right.id&&(I.right.id={type:"Identifier",name:I.left.name});var Le=this.createObjectGetter(I.left),pt=this.createNameGetter(I.left),Zt=this.createClosure(I.right);return function(){var jt=Le(),Fr=pt(),Wr=Zt();switch(I.operator!=="="&&fe.assertVariable(jt,Fr,I),I.operator){case"=":return jt[Fr]=Wr;case"+=":return jt[Fr]+=Wr;case"-=":return jt[Fr]-=Wr;case"*=":return jt[Fr]*=Wr;case"**=":return jt[Fr]=Math.pow(jt[Fr],Wr);case"/=":return jt[Fr]/=Wr;case"%=":return jt[Fr]%=Wr;case"<<=":return jt[Fr]<<=Wr;case">>=":return jt[Fr]>>=Wr;case">>>=":return jt[Fr]>>>=Wr;case"&=":return jt[Fr]&=Wr;case"^=":return jt[Fr]^=Wr;case"|=":return jt[Fr]|=Wr;default:throw fe.createInternalThrowError(Ba.AssignmentExpressionSyntaxError,I.type,I)}}},w.functionDeclarationHandler=function(I){if(I.id){var fe=this.functionExpressionHandler(I);Object.defineProperty(fe,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(I.id.name,fe)}return function(){return Ai}},w.getVariableName=function(I){if(I.type==="Identifier")return I.name;throw this.createInternalThrowError(Ba.VariableTypeSyntaxError,I.type,I)},w.variableDeclarationHandler=function(I){for(var fe=this,Le,pt=[],Zt=0;Zt<I.declarations.length;Zt++){var jt=I.declarations[Zt];this.varDeclaration(this.getVariableName(jt.id)),jt.init&&pt.push({type:"AssignmentExpression",operator:"=",left:jt.id,right:jt.init})}return pt.length&&(Le=this.createClosure({type:"BlockStatement",body:pt})),function(){if(Le){var Fr=fe.isVarDeclMode;fe.isVarDeclMode=!0,Le(),fe.isVarDeclMode=Fr}return Ai}},w.assertVariable=function(I,fe,Le){if(I===this.globalScope.data&&!(fe in I))throw this.createInternalThrowError(Ba.VariableUndefinedReferenceError,fe,Le)},w.programHandler=function(I){var fe=this,Le=I.body.map(function(pt){return fe.createClosure(pt)});return function(){for(var pt=Ai,Zt=0;Zt<Le.length;Zt++){var jt=Le[Zt],Fr=fe.setValue(jt());if(Fr!==Ai&&(pt=Fr,pt instanceof es||pt instanceof ss||pt instanceof As||pt===O||pt===Qr))break}return pt}},w.expressionStatementHandler=function(I){return this.createClosure(I.expression)},w.emptyStatementHandler=function(I){return function(){return Ai}},w.returnStatementHandler=function(I){var fe=I.argument?this.createClosure(I.argument):Zs;return function(){return new es(fe())}},w.ifStatementHandler=function(I){var fe=this.createClosure(I.test),Le=this.createClosure(I.consequent),pt=I.alternate?this.createClosure(I.alternate):function(){return Ai};return function(){return fe()?Le():pt()}},w.conditionalExpressionHandler=function(I){return this.ifStatementHandler(I)},w.forStatementHandler=function(I){var fe=this,Le=Zs,pt=I.test?this.createClosure(I.test):function(){return!0},Zt=Zs,jt=this.createClosure(I.body);return I.type==="ForStatement"&&(Le=I.init?this.createClosure(I.init):Le,Zt=I.update?this.createClosure(I.update):Zs),function(Fr){var Wr,hn=Ai,Oi=I.type==="DoWhileStatement";for(Fr&&Fr.type==="LabeledStatement"&&(Wr=Fr.label.name),Le();Oi||pt();Zt()){Oi=!1;var Ei=fe.setValue(jt());if(!(Ei===Ai||Ei===Qr)){if(Ei===O)break;if(hn=Ei,hn instanceof As&&hn.value===Wr){hn=Ai;continue}if(hn instanceof es||hn instanceof ss||hn instanceof As)break}}return hn}},w.whileStatementHandler=function(I){return this.forStatementHandler(I)},w.doWhileStatementHandler=function(I){return this.forStatementHandler(I)},w.forInStatementHandler=function(I){var fe=this,Le=I.left,pt=this.createClosure(I.right),Zt=this.createClosure(I.body);return I.left.type==="VariableDeclaration"&&(this.createClosure(I.left)(),Le=I.left.declarations[0].id),function(jt){var Fr,Wr=Ai,hn;jt&&jt.type==="LabeledStatement"&&(Fr=jt.label.name);var Oi=pt();for(hn in Oi){fe.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Le,right:{type:"Literal",value:hn}})();var Ei=fe.setValue(Zt());if(!(Ei===Ai||Ei===Qr)){if(Ei===O)break;if(Wr=Ei,Wr instanceof As&&Wr.value===Fr){Wr=Ai;continue}if(Wr instanceof es||Wr instanceof ss||Wr instanceof As)break}}return Wr}},w.withStatementHandler=function(I){var fe=this,Le=this.createClosure(I.object),pt=this.createClosure(I.body);return function(){var Zt=Le(),jt=fe.getCurrentScope(),Fr=new us(Zt,jt,po);fe.setCurrentScope(Fr);var Wr=fe.setValue(pt());return fe.setCurrentScope(jt),Wr}},w.throwStatementHandler=function(I){var fe=this,Le=this.createClosure(I.argument);return function(){throw fe.setValue(void 0),Le()}},w.tryStatementHandler=function(I){var fe=this,Le=this.createClosure(I.block),pt=I.handler?this.catchClauseHandler(I.handler):null,Zt=I.finalizer?this.createClosure(I.finalizer):null;return function(){var jt=fe.getCurrentScope(),Fr=fe.getCurrentContext(),Wr=jt.labelStack.concat([]),hn=fe.callStack.concat([]),Oi=Ai,Ei,pa,Ma=function(){fe.setCurrentScope(jt),fe.setCurrentContext(Fr),jt.labelStack=Wr,fe.callStack=hn};try{Oi=fe.setValue(Le()),Oi instanceof es&&(Ei=Oi)}catch(ga){if(Ma(),fe.isInterruptThrow(ga))throw ga;if(pt)try{Oi=fe.setValue(pt(ga)),Oi instanceof es&&(Ei=Oi)}catch(_i){if(Ma(),fe.isInterruptThrow(_i))throw _i;pa=_i}}if(Zt)try{Oi=Zt(),Oi instanceof es&&(Ei=Oi)}catch(ga){if(Ma(),fe.isInterruptThrow(ga))throw ga;pa=ga}if(pa)throw pa;return Ei||Oi}},w.catchClauseHandler=function(I){var fe=this,Le=this.createParamNameGetter(I.param),pt=this.createClosure(I.body);return function(Zt){var jt,Fr=fe.getCurrentScope(),Wr=Fr.data,hn=Le(),Oi=yt.call(Wr,hn),Ei=Wr[hn];return Wr[hn]=Zt,jt=pt(),Oi?Wr[hn]=Ei:delete Wr[hn],jt}},w.continueStatementHandler=function(I){return function(){return I.label?new As(I.label.name):Qr}},w.breakStatementHandler=function(I){return function(){return I.label?new ss(I.label.name):O}},w.switchStatementHandler=function(I){var fe=this,Le=this.createClosure(I.discriminant),pt=I.cases.map(function(Zt){return fe.switchCaseHandler(Zt)});return function(){for(var Zt=Le(),jt=!1,Fr,Wr,hn,Oi=0;Oi<pt.length;Oi++){var Ei=pt[Oi](),pa=Ei.testClosure();if(pa===oi){hn=Ei;continue}if(jt||pa===Zt){if(jt=!0,Wr=fe.setValue(Ei.bodyClosure()),Wr===Ai)continue;if(Wr===O||(Fr=Wr,Fr instanceof es||Fr instanceof ss||Fr instanceof As||Fr===Qr))break}}if(!jt&&hn){Wr=fe.setValue(hn.bodyClosure());var Ma=Wr===Ai||Wr===O||Wr===Qr;Ma||(Fr=Wr)}return Fr}},w.switchCaseHandler=function(I){var fe=I.test?this.createClosure(I.test):function(){return oi},Le=this.createClosure({type:"BlockStatement",body:I.consequent});return function(){return{testClosure:fe,bodyClosure:Le}}},w.labeledStatementHandler=function(I){var fe=this,Le=I.label.name,pt=this.createClosure(I.body);return function(){var Zt,jt=fe.getCurrentScope();return jt.labelStack.push(Le),Zt=pt(I),Zt instanceof ss&&Zt.value===Le&&(Zt=Ai),jt.labelStack.pop(),Zt}},w.debuggerStatementHandler=function(I){return function(){debugger;return Ai}},w.createParamNameGetter=function(I){if(I.type==="Identifier")return function(){return I.name};throw this.createInternalThrowError(Ba.ParamTypeSyntaxError,I.type,I)},w.createObjectKeyGetter=function(I){var fe;return I.type==="Identifier"?fe=function(){return I.name}:fe=this.createClosure(I),function(){return fe()}},w.createMemberKeyGetter=function(I){return I.computed?this.createClosure(I.property):this.createObjectKeyGetter(I.property)},w.createObjectGetter=function(I){var fe=this;switch(I.type){case"Identifier":return function(){return fe.getScopeDataFromName(I.name,fe.getCurrentScope())};case"MemberExpression":return this.createClosure(I.object);default:throw this.createInternalThrowError(Ba.AssignmentTypeSyntaxError,I.type,I)}},w.createNameGetter=function(I){switch(I.type){case"Identifier":return function(){return I.name};case"MemberExpression":return this.createMemberKeyGetter(I);default:throw this.createInternalThrowError(Ba.AssignmentTypeSyntaxError,I.type,I)}},w.varDeclaration=function(I){var fe=this.collectDeclVars;fe[I]=void 0},w.funcDeclaration=function(I,fe){var Le=this.collectDeclFuncs;Le[I]=fe},w.addDeclarationsToScope=function(I,fe,Le){var pt=Le.data;for(var Zt in fe){var jt=fe[Zt];pt[Zt]=jt&&jt()}for(var Fr in I)Fr in pt||(pt[Fr]=void 0)},w.getScopeValue=function(I,fe){var Le=this.getScopeFromName(I,fe);return Le.data[I]},w.getScopeDataFromName=function(I,fe){return this.getScopeFromName(I,fe).data},w.getScopeFromName=function(I,fe){var Le=fe;do if(I in Le.data)return Le;while(Le=Le.parent);return this.globalScope},w.setValue=function(I){var fe=this.callStack.length;return this.isVarDeclMode||fe||I===Ai||I===O||I===Qr||I instanceof ss||I instanceof As||(this.value=I instanceof es?I.value:I),I},w.getValue=function(){return this.value},m}();wo.version=Se,wo.eval=Qu,wo.Function=qo,wo.ecmaVersion=5,wo.globalContextInFunction=void 0,wo.global=Object.create(null);function ml(m){return m===void 0&&(m=Object.create(null)),m}function yl(m,w,z){w===void 0&&(w=[]),z===void 0&&(z={});var I=z.parsingContext,fe=z.timeout===void 0?0:z.timeout,Le=`
    (function anonymous(`+w.join(",")+`){
         `+m+`
    });
    `,pt=new wo(I,{ecmaVersion:z.ecmaVersion,timeout:fe,rootContext:z.rootContext,globalContextInFunction:z.globalContextInFunction});return pt.evaluate(Le)}function qu(m,w,z){var I=new wo(w,z);return I.evaluate(m)}var Jl=qu,gl=function(){function m(z){this._code=z}var w=m.prototype;return w.runInContext=function(I){return qu(this._code,I)},w.runInNewContext=function(I){return qu(this._code,I)},m}(),Lu=function(m,w,z){return qu(m,w,z)};function Us(){for(var m=arguments.length,w=new Array(m),z=0;z<m;z++)w[z]=arguments[z];var I=w.pop();return yl(I||"",w)}var _l=Lu},30954:function(Rr,N,b){(function(re,E){Rr.exports=E(b(40077))})(this,function(re){"use strict";var E=function(Z){return Z instanceof Uint8Array||Z instanceof Uint16Array||Z instanceof Uint32Array||Z instanceof Int8Array||Z instanceof Int16Array||Z instanceof Int32Array||Z instanceof Float32Array||Z instanceof Float64Array||Z instanceof Uint8ClampedArray},p=function(Z,Ie){for(var qe=Object.keys(Ie),pr=0;pr<qe.length;++pr)Z[qe[pr]]=Ie[qe[pr]];return Z},me=`
`;function te(Z){return typeof atob!="undefined"?atob(Z):"base64:"+Z}function ue(Z){var Ie=new Error("(regl) "+Z);throw console.error(Ie),Ie}function ae(Z,Ie){Z||ue(Ie)}function Ne(Z){return Z?": "+Z:""}function K(Z,Ie,qe){Z in Ie||ue("unknown parameter ("+Z+")"+Ne(qe)+". possible values: "+Object.keys(Ie).join())}function Qe(Z,Ie){E(Z)||ue("invalid parameter type"+Ne(Ie)+". must be a typed array")}function xt(Z,Ie){switch(Ie){case"number":return typeof Z=="number";case"object":return typeof Z=="object";case"string":return typeof Z=="string";case"boolean":return typeof Z=="boolean";case"function":return typeof Z=="function";case"undefined":return typeof Z=="undefined";case"symbol":return typeof Z=="symbol"}}function Ht(Z,Ie,qe){xt(Z,Ie)||ue("invalid parameter type"+Ne(qe)+". expected "+Ie+", got "+typeof Z)}function $t(Z,Ie){Z>=0&&(Z|0)===Z||ue("invalid parameter type, ("+Z+")"+Ne(Ie)+". must be a nonnegative integer")}function Jt(Z,Ie,qe){Ie.indexOf(Z)<0&&ue("invalid value"+Ne(qe)+". must be one of: "+Ie)}var Ft=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Gt(Z){Object.keys(Z).forEach(function(Ie){Ft.indexOf(Ie)<0&&ue('invalid regl constructor argument "'+Ie+'". must be one of '+Ft)})}function At(Z,Ie){for(Z=Z+"";Z.length<Ie;)Z=" "+Z;return Z}function Et(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function bt(Z,Ie){this.number=Z,this.line=Ie,this.errors=[]}function er(Z,Ie,qe){this.file=Z,this.line=Ie,this.message=qe}function q(){var Z=new Error,Ie=(Z.stack||Z).toString(),qe=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Ie);if(qe)return qe[1];var pr=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Ie);return pr?pr[1]:"unknown"}function Bt(){var Z=new Error,Ie=(Z.stack||Z).toString(),qe=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Ie);if(qe)return qe[1];var pr=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Ie);return pr?pr[1]:"unknown"}function et(Z,Ie){var qe=Z.split(`
`),pr=1,Br=0,lr={unknown:new Et,0:new Et};lr.unknown.name=lr[0].name=Ie||q(),lr.unknown.lines.push(new bt(0,""));for(var Ir=0;Ir<qe.length;++Ir){var Vr=qe[Ir],$r=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Vr);if($r)switch($r[1]){case"line":var en=/(\d+)(\s+\d+)?/.exec($r[2]);en&&(pr=en[1]|0,en[2]&&(Br=en[2]|0,Br in lr||(lr[Br]=new Et)));break;case"define":var tn=/SHADER_NAME(_B64)?\s+(.*)$/.exec($r[2]);tn&&(lr[Br].name=tn[1]?te(tn[2]):tn[2]);break}lr[Br].lines.push(new bt(pr++,Vr))}return Object.keys(lr).forEach(function(sn){var bn=lr[sn];bn.lines.forEach(function(Yr){bn.index[Yr.number]=Yr})}),lr}function je(Z){var Ie=[];return Z.split(`
`).forEach(function(qe){if(!(qe.length<5)){var pr=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(qe);pr?Ie.push(new er(pr[1]|0,pr[2]|0,pr[3].trim())):qe.length>0&&Ie.push(new er("unknown",0,qe))}}),Ie}function nt(Z,Ie){Ie.forEach(function(qe){var pr=Z[qe.file];if(pr){var Br=pr.index[qe.line];if(Br){Br.errors.push(qe),pr.hasErrors=!0;return}}Z.unknown.hasErrors=!0,Z.unknown.lines[0].errors.push(qe)})}function De(Z,Ie,qe,pr,Br){if(!Z.getShaderParameter(Ie,Z.COMPILE_STATUS)){var lr=Z.getShaderInfoLog(Ie),Ir=pr===Z.FRAGMENT_SHADER?"fragment":"vertex";ye(qe,"string",Ir+" shader source must be a string",Br);var Vr=et(qe,Br),$r=je(lr);nt(Vr,$r),Object.keys(Vr).forEach(function(en){var tn=Vr[en];if(!tn.hasErrors)return;var sn=[""],bn=[""];function Yr(un,zt){sn.push(un),bn.push(zt||"")}Yr("file number "+en+": "+tn.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),tn.lines.forEach(function(un){if(un.errors.length>0){Yr(At(un.number,4)+"|  ","background-color:yellow; font-weight:bold"),Yr(un.line+me,"color:red; background-color:yellow; font-weight:bold");var zt=0;un.errors.forEach(function(gr){var Jr=gr.message,Dn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Jr);if(Dn){var Dr=Dn[1];switch(Jr=Dn[2],Dr){case"assign":Dr="=";break}zt=Math.max(un.line.indexOf(Dr,zt),0)}else zt=0;Yr(At("| ",6)),Yr(At("^^^",zt+3)+me,"font-weight:bold"),Yr(At("| ",6)),Yr(Jr+me,"font-weight:bold")}),Yr(At("| ",6)+me)}else Yr(At(un.number,4)+"|  "),Yr(un.line+me,"color:red")}),typeof document!="undefined"&&!window.chrome?(bn[0]=sn.join("%c"),console.log.apply(console,bn)):console.log(sn.join(""))}),ae.raise("Error compiling "+Ir+" shader, "+Vr[0].name)}}function It(Z,Ie,qe,pr,Br){if(!Z.getProgramParameter(Ie,Z.LINK_STATUS)){var lr=Z.getProgramInfoLog(Ie),Ir=et(qe,Br),Vr=et(pr,Br),$r='Error linking program with vertex shader, "'+Vr[0].name+'", and fragment shader "'+Ir[0].name+'"';typeof document!="undefined"?console.log("%c"+$r+me+"%c"+lr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log($r+me+lr),ae.raise($r)}}function hr(Z){Z._commandRef=q()}function tr(Z,Ie,qe,pr){hr(Z);function Br($r){return $r?pr.id($r):0}Z._fragId=Br(Z.static.frag),Z._vertId=Br(Z.static.vert);function lr($r,en){Object.keys(en).forEach(function(tn){$r[pr.id(tn)]=!0})}var Ir=Z._uniformSet={};lr(Ir,Ie.static),lr(Ir,Ie.dynamic);var Vr=Z._attributeSet={};lr(Vr,qe.static),lr(Vr,qe.dynamic),Z._hasCount="count"in Z.static||"count"in Z.dynamic||"elements"in Z.static||"elements"in Z.dynamic}function j(Z,Ie){var qe=Bt();ue(Z+" in command "+(Ie||q())+(qe==="unknown"?"":" called from "+qe))}function ie(Z,Ie,qe){Z||j(Ie,qe||q())}function Me(Z,Ie,qe,pr){Z in Ie||j("unknown parameter ("+Z+")"+Ne(qe)+". possible values: "+Object.keys(Ie).join(),pr||q())}function ye(Z,Ie,qe,pr){xt(Z,Ie)||j("invalid parameter type"+Ne(qe)+". expected "+Ie+", got "+typeof Z,pr||q())}function it(Z){Z()}function lt(Z,Ie,qe){Z.texture?Jt(Z.texture._texture.internalformat,Ie,"unsupported texture format for attachment"):Jt(Z.renderbuffer._renderbuffer.format,qe,"unsupported renderbuffer format for attachment")}var Lt=33071,Pt=9728,Lr=9984,cn=9985,qr=9986,fi=9987,Yt=5120,he=5121,Te=5122,Ze=5123,Oe=5124,Ot=5125,ar=5126,ur=32819,Pr=32820,or=33635,nn=34042,C=36193,V={};V[Yt]=V[he]=1,V[Te]=V[Ze]=V[C]=V[or]=V[ur]=V[Pr]=2,V[Oe]=V[Ot]=V[ar]=V[nn]=4;function Ve(Z,Ie){return Z===Pr||Z===ur||Z===or?2:Z===nn?4:V[Z]*Ie}function $e(Z){return!(Z&Z-1)&&!!Z}function ct(Z,Ie,qe){var pr,Br=Ie.width,lr=Ie.height,Ir=Ie.channels;ae(Br>0&&Br<=qe.maxTextureSize&&lr>0&&lr<=qe.maxTextureSize,"invalid texture shape"),(Z.wrapS!==Lt||Z.wrapT!==Lt)&&ae($e(Br)&&$e(lr),"incompatible wrap mode for texture, both width and height must be power of 2"),Ie.mipmask===1?Br!==1&&lr!==1&&ae(Z.minFilter!==Lr&&Z.minFilter!==qr&&Z.minFilter!==cn&&Z.minFilter!==fi,"min filter requires mipmap"):(ae($e(Br)&&$e(lr),"texture must be a square power of 2 to support mipmapping"),ae(Ie.mipmask===(Br<<1)-1,"missing or incomplete mipmap data")),Ie.type===ar&&(qe.extensions.indexOf("oes_texture_float_linear")<0&&ae(Z.minFilter===Pt&&Z.magFilter===Pt,"filter not supported, must enable oes_texture_float_linear"),ae(!Z.genMipmaps,"mipmap generation not supported with float textures"));var Vr=Ie.images;for(pr=0;pr<16;++pr)if(Vr[pr]){var $r=Br>>pr,en=lr>>pr;ae(Ie.mipmask&1<<pr,"missing mipmap data");var tn=Vr[pr];if(ae(tn.width===$r&&tn.height===en,"invalid shape for mip images"),ae(tn.format===Ie.format&&tn.internalformat===Ie.internalformat&&tn.type===Ie.type,"incompatible type for mip image"),!tn.compressed)if(tn.data){var sn=Math.ceil(Ve(tn.type,Ir)*$r/tn.unpackAlignment)*tn.unpackAlignment;ae(tn.data.byteLength===sn*en,"invalid data for image, buffer size is inconsistent with image format")}else tn.element||tn.copy}else Z.genMipmaps||ae((Ie.mipmask&1<<pr)==0,"extra mipmap data");Ie.compressed&&ae(!Z.genMipmaps,"mipmap generation for compressed images not supported")}function Ct(Z,Ie,qe,pr){var Br=Z.width,lr=Z.height,Ir=Z.channels;ae(Br>0&&Br<=pr.maxTextureSize&&lr>0&&lr<=pr.maxTextureSize,"invalid texture shape"),ae(Br===lr,"cube map must be square"),ae(Ie.wrapS===Lt&&Ie.wrapT===Lt,"wrap mode not supported by cube map");for(var Vr=0;Vr<qe.length;++Vr){var $r=qe[Vr];ae($r.width===Br&&$r.height===lr,"inconsistent cube map face shape"),Ie.genMipmaps&&(ae(!$r.compressed,"can not generate mipmap for compressed textures"),ae($r.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var en=$r.images,tn=0;tn<16;++tn){var sn=en[tn];if(sn){var bn=Br>>tn,Yr=lr>>tn;ae($r.mipmask&1<<tn,"missing mipmap data"),ae(sn.width===bn&&sn.height===Yr,"invalid shape for mip images"),ae(sn.format===Z.format&&sn.internalformat===Z.internalformat&&sn.type===Z.type,"incompatible type for mip image"),sn.compressed||(sn.data?ae(sn.data.byteLength===bn*Yr*Math.max(Ve(sn.type,Ir),sn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):sn.element||sn.copy)}}}}var J=p(ae,{optional:it,raise:ue,commandRaise:j,command:ie,parameter:K,commandParameter:Me,constructor:Gt,type:Ht,commandType:ye,isTypedArray:Qe,nni:$t,oneOf:Jt,shaderError:De,linkError:It,callSite:Bt,saveCommandRef:hr,saveDrawInfo:tr,framebufferFormat:lt,guessCommand:q,texture2D:ct,textureCube:Ct}),Wt=0,Tr=0,Mr=5,Ke=6;function ht(Z,Ie){this.id=Wt++,this.type=Z,this.data=Ie}function Mt(Z){return Z.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Nt(Z){if(Z.length===0)return[];var Ie=Z.charAt(0),qe=Z.charAt(Z.length-1);if(Z.length>1&&Ie===qe&&(Ie==='"'||Ie==="'"))return['"'+Mt(Z.substr(1,Z.length-2))+'"'];var pr=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(Z);if(pr)return Nt(Z.substr(0,pr.index)).concat(Nt(pr[1])).concat(Nt(Z.substr(pr.index+pr[0].length)));var Br=Z.split(".");if(Br.length===1)return['"'+Mt(Z)+'"'];for(var lr=[],Ir=0;Ir<Br.length;++Ir)lr=lr.concat(Nt(Br[Ir]));return lr}function br(Z){return"["+Nt(Z).join("][")+"]"}function Sr(Z,Ie){return new ht(Z,br(Ie+""))}function Je(Z){return typeof Z=="function"&&!Z._reglType||Z instanceof ht}function Hr(Z,Ie){if(typeof Z=="function")return new ht(Tr,Z);if(typeof Z=="number"||typeof Z=="boolean")return new ht(Mr,Z);if(Array.isArray(Z))return new ht(Ke,Z.map(function(qe,pr){return Hr(qe,Ie+"["+pr+"]")}));if(Z instanceof ht)return Z;J(!1,"invalid option type in uniform "+Ie)}var Xr={DynamicVariable:ht,define:Sr,isDynamic:Je,unbox:Hr,accessor:br},yn={next:typeof requestAnimationFrame=="function"?function(Z){return requestAnimationFrame(Z)}:function(Z){return setTimeout(Z,16)},cancel:typeof cancelAnimationFrame=="function"?function(Z){return cancelAnimationFrame(Z)}:clearTimeout},vr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Or=vr?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function St(){var Z={"":0},Ie=[""];return{id:function(qe){var pr=Z[qe];return pr||(pr=Z[qe]=Ie.length,Ie.push(qe),pr)},str:function(qe){return Ie[qe]}}}function Kn(Z,Ie,qe){var pr=document.createElement("canvas");p(pr.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),Z.appendChild(pr),Z===document.body&&(pr.style.position="absolute",p(Z.style,{margin:0,padding:0}));function Br(){var Vr=window.innerWidth,$r=window.innerHeight;if(Z!==document.body){var en=pr.getBoundingClientRect();Vr=en.right-en.left,$r=en.bottom-en.top}pr.width=qe*Vr,pr.height=qe*$r}var lr;Z!==document.body&&typeof ResizeObserver=="function"?(lr=new ResizeObserver(function(){setTimeout(Br)}),lr.observe(Z)):window.addEventListener("resize",Br,!1);function Ir(){lr?lr.disconnect():window.removeEventListener("resize",Br),Z.removeChild(pr)}return Br(),{canvas:pr,onDestroy:Ir}}function Ln(Z,Ie){function qe(pr){try{return Z.getContext(pr,Ie)}catch(Br){return null}}return qe("webgl")||qe("experimental-webgl")||qe("webgl-experimental")}function zr(Z){return typeof Z.nodeName=="string"&&typeof Z.appendChild=="function"&&typeof Z.getBoundingClientRect=="function"}function Y(Z){return typeof Z.drawArrays=="function"||typeof Z.drawElements=="function"}function ce(Z){return typeof Z=="string"?Z.split():(J(Array.isArray(Z),"invalid extension array"),Z)}function ve(Z){return typeof Z=="string"?(J(typeof document!="undefined","not supported outside of DOM"),document.querySelector(Z)):Z}function B(Z){var Ie=Z||{},qe,pr,Br,lr,Ir={},Vr=[],$r=[],en=typeof window=="undefined"?1:window.devicePixelRatio,tn=!1,sn=function(un){un&&J.raise(un)},bn=function(){};if(typeof Ie=="string"?(J(typeof document!="undefined","selector queries only supported in DOM environments"),qe=document.querySelector(Ie),J(qe,"invalid query string for element")):typeof Ie=="object"?zr(Ie)?qe=Ie:Y(Ie)?(lr=Ie,Br=lr.canvas):(J.constructor(Ie),"gl"in Ie?lr=Ie.gl:"canvas"in Ie?Br=ve(Ie.canvas):"container"in Ie&&(pr=ve(Ie.container)),"attributes"in Ie&&(Ir=Ie.attributes,J.type(Ir,"object","invalid context attributes")),"extensions"in Ie&&(Vr=ce(Ie.extensions)),"optionalExtensions"in Ie&&($r=ce(Ie.optionalExtensions)),"onDone"in Ie&&(J.type(Ie.onDone,"function","invalid or missing onDone callback"),sn=Ie.onDone),"profile"in Ie&&(tn=!!Ie.profile),"pixelRatio"in Ie&&(en=+Ie.pixelRatio,J(en>0,"invalid pixel ratio"))):J.raise("invalid arguments to regl"),qe&&(qe.nodeName.toLowerCase()==="canvas"?Br=qe:pr=qe),!lr){if(!Br){J(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Yr=Kn(pr||document.body,sn,en);if(!Yr)return null;Br=Yr.canvas,bn=Yr.onDestroy}Ir.premultipliedAlpha===void 0&&(Ir.premultipliedAlpha=!0),lr=Ln(Br,Ir)}return lr?{gl:lr,canvas:Br,container:pr,extensions:Vr,optionalExtensions:$r,pixelRatio:en,profile:tn,onDone:sn,onDestroy:bn}:(bn(),sn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function ee(Z,Ie){var qe={};function pr(Vr){J.type(Vr,"string","extension name must be string");var $r=Vr.toLowerCase(),en;try{en=qe[$r]=Br(Vr)}catch(tn){}return!!en}function Br(Vr){return Z.getExtension(Vr)?Z.getExtension(Vr):Z.getExtension(Vr.toLowerCase())?Z.getExtension(Vr.toLowerCase()):null}for(var lr=0;lr<Ie.extensions.length;++lr){var Ir=Ie.extensions[lr];if(!pr(Ir))return Ie.onDestroy(),Ie.onDone('"'+Ir+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Ie.optionalExtensions.forEach(pr),{extensions:qe,restore:function(){Object.keys(qe).forEach(function(Vr){if(qe[Vr]&&!pr(Vr))throw new Error("(regl): error restoring extension "+Vr)})}}}function pe(Z,Ie){for(var qe=Array(Z),pr=0;pr<Z;++pr)qe[pr]=Ie(pr);return qe}var Ae=5120,oe=5121,_e=5122,dt=5123,Er=5124,Kt=5125,ir=5126;function Zr(Z){for(var Ie=16;Ie<=1<<28;Ie*=16)if(Z<=Ie)return Ie;return 0}function Bn(Z){var Ie,qe;return Ie=(Z>65535)<<4,Z>>>=Ie,qe=(Z>255)<<3,Z>>>=qe,Ie|=qe,qe=(Z>15)<<2,Z>>>=qe,Ie|=qe,qe=(Z>3)<<1,Z>>>=qe,Ie|=qe,Ie|Z>>1}function Fn(){var Z=pe(8,function(){return[]});function Ie(lr){var Ir=Zr(lr),Vr=Z[Bn(Ir)>>2];return Vr.length>0?Vr.pop():new ArrayBuffer(Ir)}function qe(lr){Z[Bn(lr.byteLength)>>2].push(lr)}function pr(lr,Ir){var Vr=null;switch(lr){case Ae:Vr=new Int8Array(Ie(Ir),0,Ir);break;case oe:Vr=new Uint8Array(Ie(Ir),0,Ir);break;case _e:Vr=new Int16Array(Ie(2*Ir),0,Ir);break;case dt:Vr=new Uint16Array(Ie(2*Ir),0,Ir);break;case Er:Vr=new Int32Array(Ie(4*Ir),0,Ir);break;case Kt:Vr=new Uint32Array(Ie(4*Ir),0,Ir);break;case ir:Vr=new Float32Array(Ie(4*Ir),0,Ir);break;default:return null}return Vr.length!==Ir?Vr.subarray(0,Ir):Vr}function Br(lr){qe(lr.buffer)}return{alloc:Ie,free:qe,allocType:pr,freeType:Br}}var nr=Fn();nr.zero=Fn();var In=3408,vn=3410,xn=3411,zi=3412,Tn=3413,Di=3414,ra=3415,hi=33901,na=33902,Yi=3379,Ii=3386,ya=34921,Fa=36347,Ki=36348,Zi=35661,$i=35660,so=34930,Jo=36349,za=34076,qi=34024,ou=7936,Cu=7937,Ji=7938,xo=35724,Qi=34047,Ja=36063,Qo=34852,Ea=3553,Do=34067,ko=34069,ks=33984,yo=6408,Go=5126,Ba=5121,ho=36160,as=36053,Fo=36064,Se=16384,ke=function(Z,Ie){var qe=1;Ie.ext_texture_filter_anisotropic&&(qe=Z.getParameter(Qi));var pr=1,Br=1;Ie.webgl_draw_buffers&&(pr=Z.getParameter(Qo),Br=Z.getParameter(Ja));var lr=!!Ie.oes_texture_float;if(lr){var Ir=Z.createTexture();Z.bindTexture(Ea,Ir),Z.texImage2D(Ea,0,yo,1,1,0,yo,Go,null);var Vr=Z.createFramebuffer();if(Z.bindFramebuffer(ho,Vr),Z.framebufferTexture2D(ho,Fo,Ea,Ir,0),Z.bindTexture(Ea,null),Z.checkFramebufferStatus(ho)!==as)lr=!1;else{Z.viewport(0,0,1,1),Z.clearColor(1,0,0,1),Z.clear(Se);var $r=nr.allocType(Go,4);Z.readPixels(0,0,1,1,yo,Go,$r),Z.getError()?lr=!1:(Z.deleteFramebuffer(Vr),Z.deleteTexture(Ir),lr=$r[0]===1),nr.freeType($r)}}var en=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),tn=!0;if(!en){var sn=Z.createTexture(),bn=nr.allocType(Ba,36);Z.activeTexture(ks),Z.bindTexture(Do,sn),Z.texImage2D(ko,0,yo,3,3,0,yo,Ba,bn),nr.freeType(bn),Z.bindTexture(Do,null),Z.deleteTexture(sn),tn=!Z.getError()}return{colorBits:[Z.getParameter(vn),Z.getParameter(xn),Z.getParameter(zi),Z.getParameter(Tn)],depthBits:Z.getParameter(Di),stencilBits:Z.getParameter(ra),subpixelBits:Z.getParameter(In),extensions:Object.keys(Ie).filter(function(Yr){return!!Ie[Yr]}),maxAnisotropic:qe,maxDrawbuffers:pr,maxColorAttachments:Br,pointSizeDims:Z.getParameter(hi),lineWidthDims:Z.getParameter(na),maxViewportDims:Z.getParameter(Ii),maxCombinedTextureUnits:Z.getParameter(Zi),maxCubeMapSize:Z.getParameter(za),maxRenderbufferSize:Z.getParameter(qi),maxTextureUnits:Z.getParameter(so),maxTextureSize:Z.getParameter(Yi),maxAttributes:Z.getParameter(ya),maxVertexUniforms:Z.getParameter(Fa),maxVertexTextureUnits:Z.getParameter($i),maxVaryingVectors:Z.getParameter(Ki),maxFragmentUniforms:Z.getParameter(Jo),glsl:Z.getParameter(xo),renderer:Z.getParameter(Cu),vendor:Z.getParameter(ou),version:Z.getParameter(Ji),readFloat:lr,npotTextureCube:tn}};function yt(Z){return!!Z&&typeof Z=="object"&&Array.isArray(Z.shape)&&Array.isArray(Z.stride)&&typeof Z.offset=="number"&&Z.shape.length===Z.stride.length&&(Array.isArray(Z.data)||E(Z.data))}var O=function(Z){return Object.keys(Z).map(function(Ie){return Z[Ie]})},Qr={shape:os,flatten:Wa};function oi(Z,Ie,qe){for(var pr=0;pr<Ie;++pr)qe[pr]=Z[pr]}function Ai(Z,Ie,qe,pr){for(var Br=0,lr=0;lr<Ie;++lr)for(var Ir=Z[lr],Vr=0;Vr<qe;++Vr)pr[Br++]=Ir[Vr]}function po(Z,Ie,qe,pr,Br,lr){for(var Ir=lr,Vr=0;Vr<Ie;++Vr)for(var $r=Z[Vr],en=0;en<qe;++en)for(var tn=$r[en],sn=0;sn<pr;++sn)Br[Ir++]=tn[sn]}function Qa(Z,Ie,qe,pr,Br){for(var lr=1,Ir=qe+1;Ir<Ie.length;++Ir)lr*=Ie[Ir];var Vr=Ie[qe];if(Ie.length-qe==4){var $r=Ie[qe+1],en=Ie[qe+2],tn=Ie[qe+3];for(Ir=0;Ir<Vr;++Ir)po(Z[Ir],$r,en,tn,pr,Br),Br+=lr}else for(Ir=0;Ir<Vr;++Ir)Qa(Z[Ir],Ie,qe+1,pr,Br),Br+=lr}function Wa(Z,Ie,qe,pr){var Br=1;if(Ie.length)for(var lr=0;lr<Ie.length;++lr)Br*=Ie[lr];else Br=0;var Ir=pr||nr.allocType(qe,Br);switch(Ie.length){case 0:break;case 1:oi(Z,Ie[0],Ir);break;case 2:Ai(Z,Ie[0],Ie[1],Ir);break;case 3:po(Z,Ie[0],Ie[1],Ie[2],Ir,0);break;default:Qa(Z,Ie,0,Ir,0)}return Ir}function os(Z){for(var Ie=[],qe=Z;qe.length;qe=qe[0])Ie.push(qe.length);return Ie}var su={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},wu=5120,Qu=5122,qo=5124,es=5121,ss=5123,As=5125,us=5126,Zs=5126,Ys={int8:wu,int16:Qu,int32:qo,uint8:es,uint16:ss,uint32:As,float:us,float32:Zs},Ts=35048,Aa=35040,wo={dynamic:Ts,stream:Aa,static:35044},ml=Qr.flatten,yl=Qr.shape,qu=35044,Jl=35040,gl=5121,Lu=5126,Us=[];Us[5120]=1,Us[5122]=2,Us[5124]=4,Us[5121]=1,Us[5123]=2,Us[5125]=4,Us[5126]=4;function _l(Z){return su[Object.prototype.toString.call(Z)]|0}function m(Z,Ie){for(var qe=0;qe<Ie.length;++qe)Z[qe]=Ie[qe]}function w(Z,Ie,qe,pr,Br,lr,Ir){for(var Vr=0,$r=0;$r<qe;++$r)for(var en=0;en<pr;++en)Z[Vr++]=Ie[Br*$r+lr*en+Ir]}function z(Z,Ie,qe,pr){var Br=0,lr={};function Ir(zt){this.id=Br++,this.buffer=Z.createBuffer(),this.type=zt,this.usage=qu,this.byteLength=0,this.dimension=1,this.dtype=gl,this.persistentData=null,qe.profile&&(this.stats={size:0})}Ir.prototype.bind=function(){Z.bindBuffer(this.type,this.buffer)},Ir.prototype.destroy=function(){bn(this)};var Vr=[];function $r(zt,gr){var Jr=Vr.pop();return Jr||(Jr=new Ir(zt)),Jr.bind(),sn(Jr,gr,Jl,0,1,!1),Jr}function en(zt){Vr.push(zt)}function tn(zt,gr,Jr){zt.byteLength=gr.byteLength,Z.bufferData(zt.type,gr,Jr)}function sn(zt,gr,Jr,Dn,Dr,Pn){var fn;if(zt.usage=Jr,Array.isArray(gr)){if(zt.dtype=Dn||Lu,gr.length>0){var pi;if(Array.isArray(gr[0])){fn=yl(gr);for(var kr=1,Ar=1;Ar<fn.length;++Ar)kr*=fn[Ar];zt.dimension=kr,pi=ml(gr,fn,zt.dtype),tn(zt,pi,Jr),Pn?zt.persistentData=pi:nr.freeType(pi)}else if(typeof gr[0]=="number"){zt.dimension=Dr;var ri=nr.allocType(zt.dtype,gr.length);m(ri,gr),tn(zt,ri,Jr),Pn?zt.persistentData=ri:nr.freeType(ri)}else E(gr[0])?(zt.dimension=gr[0].length,zt.dtype=Dn||_l(gr[0])||Lu,pi=ml(gr,[gr.length,gr[0].length],zt.dtype),tn(zt,pi,Jr),Pn?zt.persistentData=pi:nr.freeType(pi)):J.raise("invalid buffer data")}}else if(E(gr))zt.dtype=Dn||_l(gr),zt.dimension=Dr,tn(zt,gr,Jr),Pn&&(zt.persistentData=new Uint8Array(new Uint8Array(gr.buffer)));else if(yt(gr)){fn=gr.shape;var Cn=gr.stride,rn=gr.offset,Mn=0,On=0,Gi=0,Bi=0;fn.length===1?(Mn=fn[0],On=1,Gi=Cn[0],Bi=0):fn.length===2?(Mn=fn[0],On=fn[1],Gi=Cn[0],Bi=Cn[1]):J.raise("invalid shape"),zt.dtype=Dn||_l(gr.data)||Lu,zt.dimension=On;var kn=nr.allocType(zt.dtype,Mn*On);w(kn,gr.data,Mn,On,Gi,Bi,rn),tn(zt,kn,Jr),Pn?zt.persistentData=kn:nr.freeType(kn)}else gr instanceof ArrayBuffer?(zt.dtype=gl,zt.dimension=Dr,tn(zt,gr,Jr),Pn&&(zt.persistentData=new Uint8Array(new Uint8Array(gr)))):J.raise("invalid buffer data")}function bn(zt){Ie.bufferCount--,pr(zt);var gr=zt.buffer;J(gr,"buffer must not be deleted already"),Z.deleteBuffer(gr),zt.buffer=null,delete lr[zt.id]}function Yr(zt,gr,Jr,Dn){Ie.bufferCount++;var Dr=new Ir(gr);lr[Dr.id]=Dr;function Pn(kr){var Ar=qu,ri=null,Cn=0,rn=0,Mn=1;return Array.isArray(kr)||E(kr)||yt(kr)||kr instanceof ArrayBuffer?ri=kr:typeof kr=="number"?Cn=kr|0:kr&&(J.type(kr,"object","buffer arguments must be an object, a number or an array"),"data"in kr&&(J(ri===null||Array.isArray(ri)||E(ri)||yt(ri),"invalid data for buffer"),ri=kr.data),"usage"in kr&&(J.parameter(kr.usage,wo,"invalid buffer usage"),Ar=wo[kr.usage]),"type"in kr&&(J.parameter(kr.type,Ys,"invalid buffer type"),rn=Ys[kr.type]),"dimension"in kr&&(J.type(kr.dimension,"number","invalid dimension"),Mn=kr.dimension|0),"length"in kr&&(J.nni(Cn,"buffer length must be a nonnegative integer"),Cn=kr.length|0)),Dr.bind(),ri?sn(Dr,ri,Ar,rn,Mn,Dn):(Cn&&Z.bufferData(Dr.type,Cn,Ar),Dr.dtype=rn||gl,Dr.usage=Ar,Dr.dimension=Mn,Dr.byteLength=Cn),qe.profile&&(Dr.stats.size=Dr.byteLength*Us[Dr.dtype]),Pn}function fn(kr,Ar){J(Ar+kr.byteLength<=Dr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+kr.byteLength+" starting from offset "+Ar+" to a buffer of size "+Dr.byteLength),Z.bufferSubData(Dr.type,Ar,kr)}function pi(kr,Ar){var ri=(Ar||0)|0,Cn;if(Dr.bind(),E(kr)||kr instanceof ArrayBuffer)fn(kr,ri);else if(Array.isArray(kr)){if(kr.length>0)if(typeof kr[0]=="number"){var rn=nr.allocType(Dr.dtype,kr.length);m(rn,kr),fn(rn,ri),nr.freeType(rn)}else if(Array.isArray(kr[0])||E(kr[0])){Cn=yl(kr);var Mn=ml(kr,Cn,Dr.dtype);fn(Mn,ri),nr.freeType(Mn)}else J.raise("invalid buffer data")}else if(yt(kr)){Cn=kr.shape;var On=kr.stride,Gi=0,Bi=0,kn=0,An=0;Cn.length===1?(Gi=Cn[0],Bi=1,kn=On[0],An=0):Cn.length===2?(Gi=Cn[0],Bi=Cn[1],kn=On[0],An=On[1]):J.raise("invalid shape");var Ti=Array.isArray(kr.data)?Dr.dtype:_l(kr.data),Ui=nr.allocType(Ti,Gi*Bi);w(Ui,kr.data,Gi,Bi,kn,An,kr.offset),fn(Ui,ri),nr.freeType(Ui)}else J.raise("invalid data for buffer subdata");return Pn}return Jr||Pn(zt),Pn._reglType="buffer",Pn._buffer=Dr,Pn.subdata=pi,qe.profile&&(Pn.stats=Dr.stats),Pn.destroy=function(){bn(Dr)},Pn}function un(){O(lr).forEach(function(zt){zt.buffer=Z.createBuffer(),Z.bindBuffer(zt.type,zt.buffer),Z.bufferData(zt.type,zt.persistentData||zt.byteLength,zt.usage)})}return qe.profile&&(Ie.getTotalBufferSize=function(){var zt=0;return Object.keys(lr).forEach(function(gr){zt+=lr[gr].stats.size}),zt}),{create:Yr,createStream:$r,destroyStream:en,clear:function(){O(lr).forEach(bn),Vr.forEach(bn)},getBuffer:function(zt){return zt&&zt._buffer instanceof Ir?zt._buffer:null},restore:un,_initBuffer:sn}}var I=0,fe=0,Le=1,pt=1,Zt=4,jt=4,Fr={points:I,point:fe,lines:Le,line:pt,triangles:Zt,triangle:jt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Wr=0,hn=1,Oi=4,Ei=5120,pa=5121,Ma=5122,ga=5123,_i=5124,go=5125,Ao=34963,Ks=35040,uu=35044;function $s(Z,Ie,qe,pr){var Br={},lr=0,Ir={uint8:pa,uint16:ga};Ie.oes_element_index_uint&&(Ir.uint32=go);function Vr(un){this.id=lr++,Br[this.id]=this,this.buffer=un,this.primType=Oi,this.vertCount=0,this.type=0}Vr.prototype.bind=function(){this.buffer.bind()};var $r=[];function en(un){var zt=$r.pop();return zt||(zt=new Vr(qe.create(null,Ao,!0,!1)._buffer)),sn(zt,un,Ks,-1,-1,0,0),zt}function tn(un){$r.push(un)}function sn(un,zt,gr,Jr,Dn,Dr,Pn){un.buffer.bind();var fn;if(zt){var pi=Pn;!Pn&&(!E(zt)||yt(zt)&&!E(zt.data))&&(pi=Ie.oes_element_index_uint?go:ga),qe._initBuffer(un.buffer,zt,gr,pi,3)}else Z.bufferData(Ao,Dr,gr),un.buffer.dtype=fn||pa,un.buffer.usage=gr,un.buffer.dimension=3,un.buffer.byteLength=Dr;if(fn=Pn,!Pn){switch(un.buffer.dtype){case pa:case Ei:fn=pa;break;case ga:case Ma:fn=ga;break;case go:case _i:fn=go;break;default:J.raise("unsupported type for element array")}un.buffer.dtype=fn}un.type=fn,J(fn!==go||!!Ie.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var kr=Dn;kr<0&&(kr=un.buffer.byteLength,fn===ga?kr>>=1:fn===go&&(kr>>=2)),un.vertCount=kr;var Ar=Jr;if(Jr<0){Ar=Oi;var ri=un.buffer.dimension;ri===1&&(Ar=Wr),ri===2&&(Ar=hn),ri===3&&(Ar=Oi)}un.primType=Ar}function bn(un){pr.elementsCount--,J(un.buffer!==null,"must not double destroy elements"),delete Br[un.id],un.buffer.destroy(),un.buffer=null}function Yr(un,zt){var gr=qe.create(null,Ao,!0),Jr=new Vr(gr._buffer);pr.elementsCount++;function Dn(Dr){if(!Dr)gr(),Jr.primType=Oi,Jr.vertCount=0,Jr.type=pa;else if(typeof Dr=="number")gr(Dr),Jr.primType=Oi,Jr.vertCount=Dr|0,Jr.type=pa;else{var Pn=null,fn=uu,pi=-1,kr=-1,Ar=0,ri=0;Array.isArray(Dr)||E(Dr)||yt(Dr)?Pn=Dr:(J.type(Dr,"object","invalid arguments for elements"),"data"in Dr&&(Pn=Dr.data,J(Array.isArray(Pn)||E(Pn)||yt(Pn),"invalid data for element buffer")),"usage"in Dr&&(J.parameter(Dr.usage,wo,"invalid element buffer usage"),fn=wo[Dr.usage]),"primitive"in Dr&&(J.parameter(Dr.primitive,Fr,"invalid element buffer primitive"),pi=Fr[Dr.primitive]),"count"in Dr&&(J(typeof Dr.count=="number"&&Dr.count>=0,"invalid vertex count for elements"),kr=Dr.count|0),"type"in Dr&&(J.parameter(Dr.type,Ir,"invalid buffer type"),ri=Ir[Dr.type]),"length"in Dr?Ar=Dr.length|0:(Ar=kr,ri===ga||ri===Ma?Ar*=2:(ri===go||ri===_i)&&(Ar*=4))),sn(Jr,Pn,fn,pi,kr,Ar,ri)}return Dn}return Dn(un),Dn._reglType="elements",Dn._elements=Jr,Dn.subdata=function(Dr,Pn){return gr.subdata(Dr,Pn),Dn},Dn.destroy=function(){bn(Jr)},Dn}return{create:Yr,createStream:en,destroyStream:tn,getElements:function(un){return typeof un=="function"&&un._elements instanceof Vr?un._elements:null},clear:function(){O(Br).forEach(bn)}}}var Ru=new Float32Array(1),Ho=new Uint32Array(Ru.buffer),_s=5123;function uo(Z){for(var Ie=nr.allocType(_s,Z.length),qe=0;qe<Z.length;++qe)if(isNaN(Z[qe]))Ie[qe]=65535;else if(Z[qe]===Infinity)Ie[qe]=31744;else if(Z[qe]===-Infinity)Ie[qe]=64512;else{Ru[0]=Z[qe];var pr=Ho[0],Br=pr>>>31<<15,lr=(pr<<1>>>24)-127,Ir=pr>>13&(1<<10)-1;if(lr<-24)Ie[qe]=Br;else if(lr<-14){var Vr=-14-lr;Ie[qe]=Br+(Ir+(1<<10)>>Vr)}else lr>15?Ie[qe]=Br+31744:Ie[qe]=Br+(lr+15<<10)+Ir}return Ie}function La(Z){return Array.isArray(Z)||E(Z)}var Js=function(Z){return!(Z&Z-1)&&!!Z},xl=34467,xs=3553,kl=34067,Qs=34069,qs=6408,mc=6406,Du=6407,Ra=6409,bl=6410,Kc=32854,ku=32855,Sl=36194,$c=32819,el=32820,Ql=33635,Au=34042,tl=6402,El=34041,Cl=35904,rl=35906,wl=36193,nl=33776,eu=33777,ql=33778,Fu=33779,Dc=35986,il=35987,Al=34798,Fl=35840,yc=35841,Bl=35842,kc=35843,ec=36196,vu=5121,Xa=5123,lo=5125,Bu=5126,Fs=10242,tc=10243,Nl=10497,Nu=33071,Tl=33648,zu=10240,qa=10241,zl=9728,js=9729,mu=9984,la=9985,Pi=9986,Ps=9987,tu=33170,Zu=4352,ts=4353,pf=4354,gc=34046,Zl=3317,Ul=37440,yu=37441,To=37443,Tu=37444,Pl=33984,Po=[mu,Pi,la,Ps],Vn=[0,Ra,bl,Du,qs],Na={};Na[Ra]=Na[mc]=Na[tl]=1,Na[El]=Na[bl]=2,Na[Du]=Na[Cl]=3,Na[qs]=Na[rl]=4;function gu(Z){return"[object "+Z+"]"}var Uu=gu("HTMLCanvasElement"),eo=gu("OffscreenCanvas"),Ms=gu("CanvasRenderingContext2D"),_c=gu("ImageBitmap"),En=gu("HTMLImageElement"),Pu=gu("HTMLVideoElement"),xc=Object.keys(su).concat([Uu,eo,Ms,_c,En,Pu]),lu=[];lu[vu]=1,lu[Bu]=4,lu[wl]=2,lu[Xa]=2,lu[lo]=4;var ja=[];ja[Kc]=2,ja[ku]=2,ja[Sl]=2,ja[El]=4,ja[nl]=.5,ja[eu]=.5,ja[ql]=1,ja[Fu]=1,ja[Dc]=.5,ja[il]=1,ja[Al]=1,ja[Fl]=.5,ja[yc]=.25,ja[Bl]=.5,ja[kc]=.25,ja[ec]=.5;function bs(Z){return Array.isArray(Z)&&(Z.length===0||typeof Z[0]=="number")}function Ml(Z){if(!Array.isArray(Z))return!1;var Ie=Z.length;return!(Ie===0||!La(Z[0]))}function Vs(Z){return Object.prototype.toString.call(Z)}function Is(Z){return Vs(Z)===Uu}function _u(Z){return Vs(Z)===eo}function Jc(Z){return Vs(Z)===Ms}function rc(Z){return Vs(Z)===_c}function bc(Z){return Vs(Z)===En}function Bo(Z){return Vs(Z)===Pu}function Gs(Z){var Ie=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(Ie&&Z&&Z.getContext)}function Mo(Z){if(!Z)return!1;if(Gs(Z))return!0;var Ie=Vs(Z);return xc.indexOf(Ie)>=0?!0:bs(Z)||Ml(Z)||yt(Z)}function ea(Z){return su[Object.prototype.toString.call(Z)]|0}function ju(Z,Ie){var qe=Ie.length;switch(Z.type){case vu:case Xa:case lo:case Bu:var pr=nr.allocType(Z.type,qe);pr.set(Ie),Z.data=pr;break;case wl:Z.data=uo(Ie);break;default:J.raise("unsupported texture type, must specify a typed array")}}function cu(Z,Ie){return nr.allocType(Z.type===wl?Bu:Z.type,Ie)}function Wo(Z,Ie){Z.type===wl?(Z.data=uo(Ie),nr.freeType(Ie)):Z.data=Ie}function al(Z,Ie,qe,pr,Br,lr){for(var Ir=Z.width,Vr=Z.height,$r=Z.channels,en=Ir*Vr*$r,tn=cu(Z,en),sn=0,bn=0;bn<Vr;++bn)for(var Yr=0;Yr<Ir;++Yr)for(var un=0;un<$r;++un)tn[sn++]=Ie[qe*Yr+pr*bn+Br*un+lr];Wo(Z,tn)}function Mu(Z,Ie,qe,pr,Br,lr){var Ir;if(typeof ja[Z]!="undefined"?Ir=ja[Z]:Ir=Na[Z]*lu[Ie],lr&&(Ir*=6),Br){for(var Vr=0,$r=qe;$r>=1;)Vr+=Ir*$r*$r,$r/=2;return Vr}else return Ir*qe*pr}function xi(Z,Ie,qe,pr,Br,lr,Ir){var Vr={"don't care":Zu,"dont care":Zu,nice:pf,fast:ts},$r={repeat:Nl,clamp:Nu,mirror:Tl},en={nearest:zl,linear:js},tn=p({mipmap:Ps,"nearest mipmap nearest":mu,"linear mipmap nearest":la,"nearest mipmap linear":Pi,"linear mipmap linear":Ps},en),sn={none:0,browser:Tu},bn={uint8:vu,rgba4:$c,rgb565:Ql,"rgb5 a1":el},Yr={alpha:mc,luminance:Ra,"luminance alpha":bl,rgb:Du,rgba:qs,rgba4:Kc,"rgb5 a1":ku,rgb565:Sl},un={};Ie.ext_srgb&&(Yr.srgb=Cl,Yr.srgba=rl),Ie.oes_texture_float&&(bn.float32=bn.float=Bu),Ie.oes_texture_half_float&&(bn.float16=bn["half float"]=wl),Ie.webgl_depth_texture&&(p(Yr,{depth:tl,"depth stencil":El}),p(bn,{uint16:Xa,uint32:lo,"depth stencil":Au})),Ie.webgl_compressed_texture_s3tc&&p(un,{"rgb s3tc dxt1":nl,"rgba s3tc dxt1":eu,"rgba s3tc dxt3":ql,"rgba s3tc dxt5":Fu}),Ie.webgl_compressed_texture_atc&&p(un,{"rgb atc":Dc,"rgba atc explicit alpha":il,"rgba atc interpolated alpha":Al}),Ie.webgl_compressed_texture_pvrtc&&p(un,{"rgb pvrtc 4bppv1":Fl,"rgb pvrtc 2bppv1":yc,"rgba pvrtc 4bppv1":Bl,"rgba pvrtc 2bppv1":kc}),Ie.webgl_compressed_texture_etc1&&(un["rgb etc1"]=ec);var zt=Array.prototype.slice.call(Z.getParameter(xl)||new Uint32Array(0));Object.keys(un).forEach(function(Ge){var sr=un[Ge];zt.indexOf(sr)>=0&&(Yr[Ge]=sr)});var gr=Object.keys(Yr);qe.textureFormats=gr;var Jr=[];Object.keys(Yr).forEach(function(Ge){var sr=Yr[Ge];Jr[sr]=Ge});var Dn=[];Object.keys(bn).forEach(function(Ge){var sr=bn[Ge];Dn[sr]=Ge});var Dr=[];Object.keys(en).forEach(function(Ge){var sr=en[Ge];Dr[sr]=Ge});var Pn=[];Object.keys(tn).forEach(function(Ge){var sr=tn[Ge];Pn[sr]=Ge});var fn=[];Object.keys($r).forEach(function(Ge){var sr=$r[Ge];fn[sr]=Ge});var pi=gr.reduce(function(Ge,sr){var rr=Yr[sr];return rr===Ra||rr===mc||rr===Ra||rr===bl||rr===tl||rr===El||Ie.ext_srgb&&(rr===Cl||rr===rl)?Ge[rr]=rr:rr===ku||sr.indexOf("rgba")>=0?Ge[rr]=qs:Ge[rr]=Du,Ge},{});function kr(){this.internalformat=qs,this.format=qs,this.type=vu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Tu,this.width=0,this.height=0,this.channels=0}function Ar(Ge,sr){Ge.internalformat=sr.internalformat,Ge.format=sr.format,Ge.type=sr.type,Ge.compressed=sr.compressed,Ge.premultiplyAlpha=sr.premultiplyAlpha,Ge.flipY=sr.flipY,Ge.unpackAlignment=sr.unpackAlignment,Ge.colorSpace=sr.colorSpace,Ge.width=sr.width,Ge.height=sr.height,Ge.channels=sr.channels}function ri(Ge,sr){if(!(typeof sr!="object"||!sr)){if("premultiplyAlpha"in sr&&(J.type(sr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ge.premultiplyAlpha=sr.premultiplyAlpha),"flipY"in sr&&(J.type(sr.flipY,"boolean","invalid texture flip"),Ge.flipY=sr.flipY),"alignment"in sr&&(J.oneOf(sr.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ge.unpackAlignment=sr.alignment),"colorSpace"in sr&&(J.parameter(sr.colorSpace,sn,"invalid colorSpace"),Ge.colorSpace=sn[sr.colorSpace]),"type"in sr){var rr=sr.type;J(Ie.oes_texture_float||!(rr==="float"||rr==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),J(Ie.oes_texture_half_float||!(rr==="half float"||rr==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),J(Ie.webgl_depth_texture||!(rr==="uint16"||rr==="uint32"||rr==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),J.parameter(rr,bn,"invalid texture type"),Ge.type=bn[rr]}var Xn=Ge.width,ha=Ge.height,Fe=Ge.channels,xe=!1;"shape"in sr?(J(Array.isArray(sr.shape)&&sr.shape.length>=2,"shape must be an array"),Xn=sr.shape[0],ha=sr.shape[1],sr.shape.length===3&&(Fe=sr.shape[2],J(Fe>0&&Fe<=4,"invalid number of channels"),xe=!0),J(Xn>=0&&Xn<=qe.maxTextureSize,"invalid width"),J(ha>=0&&ha<=qe.maxTextureSize,"invalid height")):("radius"in sr&&(Xn=ha=sr.radius,J(Xn>=0&&Xn<=qe.maxTextureSize,"invalid radius")),"width"in sr&&(Xn=sr.width,J(Xn>=0&&Xn<=qe.maxTextureSize,"invalid width")),"height"in sr&&(ha=sr.height,J(ha>=0&&ha<=qe.maxTextureSize,"invalid height")),"channels"in sr&&(Fe=sr.channels,J(Fe>0&&Fe<=4,"invalid number of channels"),xe=!0)),Ge.width=Xn|0,Ge.height=ha|0,Ge.channels=Fe|0;var tt=!1;if("format"in sr){var Ut=sr.format;J(Ie.webgl_depth_texture||!(Ut==="depth"||Ut==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),J.parameter(Ut,Yr,"invalid texture format");var fr=Ge.internalformat=Yr[Ut];Ge.format=pi[fr],Ut in bn&&("type"in sr||(Ge.type=bn[Ut])),Ut in un&&(Ge.compressed=!0),tt=!0}!xe&&tt?Ge.channels=Na[Ge.format]:xe&&!tt?Ge.channels!==Vn[Ge.format]&&(Ge.format=Ge.internalformat=Vn[Ge.channels]):tt&&xe&&J(Ge.channels===Na[Ge.format],"number of channels inconsistent with specified format")}}function Cn(Ge){Z.pixelStorei(Ul,Ge.flipY),Z.pixelStorei(yu,Ge.premultiplyAlpha),Z.pixelStorei(To,Ge.colorSpace),Z.pixelStorei(Zl,Ge.unpackAlignment)}function rn(){kr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Mn(Ge,sr){var rr=null;if(Mo(sr)?rr=sr:sr&&(J.type(sr,"object","invalid pixel data type"),ri(Ge,sr),"x"in sr&&(Ge.xOffset=sr.x|0),"y"in sr&&(Ge.yOffset=sr.y|0),Mo(sr.data)&&(rr=sr.data)),J(!Ge.compressed||rr instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),sr.copy){J(!rr,"can not specify copy and data field for the same texture");var Xn=Br.viewportWidth,ha=Br.viewportHeight;Ge.width=Ge.width||Xn-Ge.xOffset,Ge.height=Ge.height||ha-Ge.yOffset,Ge.needsCopy=!0,J(Ge.xOffset>=0&&Ge.xOffset<Xn&&Ge.yOffset>=0&&Ge.yOffset<ha&&Ge.width>0&&Ge.width<=Xn&&Ge.height>0&&Ge.height<=ha,"copy texture read out of bounds")}else if(!rr)Ge.width=Ge.width||1,Ge.height=Ge.height||1,Ge.channels=Ge.channels||4;else if(E(rr))Ge.channels=Ge.channels||4,Ge.data=rr,!("type"in sr)&&Ge.type===vu&&(Ge.type=ea(rr));else if(bs(rr))Ge.channels=Ge.channels||4,ju(Ge,rr),Ge.alignment=1,Ge.needsFree=!0;else if(yt(rr)){var Fe=rr.data;!Array.isArray(Fe)&&Ge.type===vu&&(Ge.type=ea(Fe));var xe=rr.shape,tt=rr.stride,Ut,fr,gt,mt,ot,Re;xe.length===3?(gt=xe[2],Re=tt[2]):(J(xe.length===2,"invalid ndarray pixel data, must be 2 or 3D"),gt=1,Re=1),Ut=xe[0],fr=xe[1],mt=tt[0],ot=tt[1],Ge.alignment=1,Ge.width=Ut,Ge.height=fr,Ge.channels=gt,Ge.format=Ge.internalformat=Vn[gt],Ge.needsFree=!0,al(Ge,Fe,mt,ot,Re,rr.offset)}else if(Gs(rr)||Is(rr)||_u(rr)||Jc(rr))Gs(rr)||Is(rr)||_u(rr)?Ge.element=rr:Ge.element=rr.canvas,Ge.width=Ge.element.width,Ge.height=Ge.element.height,Ge.channels=4;else if(rc(rr))Ge.element=rr,Ge.width=rr.width,Ge.height=rr.height,Ge.channels=4;else if(bc(rr))Ge.element=rr,Ge.width=rr.naturalWidth,Ge.height=rr.naturalHeight,Ge.channels=4;else if(Bo(rr))Ge.element=rr,Ge.width=rr.videoWidth,Ge.height=rr.videoHeight,Ge.channels=4;else if(Ml(rr)){var st=Ge.width||rr[0].length,ze=Ge.height||rr.length,Vt=Ge.channels;La(rr[0][0])?Vt=Vt||rr[0][0].length:Vt=Vt||1;for(var Qt=Qr.shape(rr),Ur=1,_n=0;_n<Qt.length;++_n)Ur*=Qt[_n];var on=cu(Ge,Ur);Qr.flatten(rr,Qt,"",on),Wo(Ge,on),Ge.alignment=1,Ge.width=st,Ge.height=ze,Ge.channels=Vt,Ge.format=Ge.internalformat=Vn[Vt],Ge.needsFree=!0}Ge.type===Bu?J(qe.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ge.type===wl&&J(qe.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function On(Ge,sr,rr){var Xn=Ge.element,ha=Ge.data,Fe=Ge.internalformat,xe=Ge.format,tt=Ge.type,Ut=Ge.width,fr=Ge.height;Cn(Ge),Xn?Z.texImage2D(sr,rr,xe,xe,tt,Xn):Ge.compressed?Z.compressedTexImage2D(sr,rr,Fe,Ut,fr,0,ha):Ge.needsCopy?(pr(),Z.copyTexImage2D(sr,rr,xe,Ge.xOffset,Ge.yOffset,Ut,fr,0)):Z.texImage2D(sr,rr,xe,Ut,fr,0,xe,tt,ha||null)}function Gi(Ge,sr,rr,Xn,ha){var Fe=Ge.element,xe=Ge.data,tt=Ge.internalformat,Ut=Ge.format,fr=Ge.type,gt=Ge.width,mt=Ge.height;Cn(Ge),Fe?Z.texSubImage2D(sr,ha,rr,Xn,Ut,fr,Fe):Ge.compressed?Z.compressedTexSubImage2D(sr,ha,rr,Xn,tt,gt,mt,xe):Ge.needsCopy?(pr(),Z.copyTexSubImage2D(sr,ha,rr,Xn,Ge.xOffset,Ge.yOffset,gt,mt)):Z.texSubImage2D(sr,ha,rr,Xn,gt,mt,Ut,fr,xe)}var Bi=[];function kn(){return Bi.pop()||new rn}function An(Ge){Ge.needsFree&&nr.freeType(Ge.data),rn.call(Ge),Bi.push(Ge)}function Ti(){kr.call(this),this.genMipmaps=!1,this.mipmapHint=Zu,this.mipmask=0,this.images=Array(16)}function Ui(Ge,sr,rr){var Xn=Ge.images[0]=kn();Ge.mipmask=1,Xn.width=Ge.width=sr,Xn.height=Ge.height=rr,Xn.channels=Ge.channels=4}function ma(Ge,sr){var rr=null;if(Mo(sr))rr=Ge.images[0]=kn(),Ar(rr,Ge),Mn(rr,sr),Ge.mipmask=1;else if(ri(Ge,sr),Array.isArray(sr.mipmap))for(var Xn=sr.mipmap,ha=0;ha<Xn.length;++ha)rr=Ge.images[ha]=kn(),Ar(rr,Ge),rr.width>>=ha,rr.height>>=ha,Mn(rr,Xn[ha]),Ge.mipmask|=1<<ha;else rr=Ge.images[0]=kn(),Ar(rr,Ge),Mn(rr,sr),Ge.mipmask=1;Ar(Ge,Ge.images[0]),Ge.compressed&&(Ge.internalformat===nl||Ge.internalformat===eu||Ge.internalformat===ql||Ge.internalformat===Fu)&&J(Ge.width%4==0&&Ge.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Zo(Ge,sr){for(var rr=Ge.images,Xn=0;Xn<rr.length;++Xn){if(!rr[Xn])return;On(rr[Xn],sr,Xn)}}var bo=[];function sa(){var Ge=bo.pop()||new Ti;kr.call(Ge),Ge.mipmask=0;for(var sr=0;sr<16;++sr)Ge.images[sr]=null;return Ge}function ps(Ge){for(var sr=Ge.images,rr=0;rr<sr.length;++rr)sr[rr]&&An(sr[rr]),sr[rr]=null;bo.push(Ge)}function fo(){this.minFilter=zl,this.magFilter=zl,this.wrapS=Nu,this.wrapT=Nu,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Zu}function Yo(Ge,sr){if("min"in sr){var rr=sr.min;J.parameter(rr,tn),Ge.minFilter=tn[rr],Po.indexOf(Ge.minFilter)>=0&&!("faces"in sr)&&(Ge.genMipmaps=!0)}if("mag"in sr){var Xn=sr.mag;J.parameter(Xn,en),Ge.magFilter=en[Xn]}var ha=Ge.wrapS,Fe=Ge.wrapT;if("wrap"in sr){var xe=sr.wrap;typeof xe=="string"?(J.parameter(xe,$r),ha=Fe=$r[xe]):Array.isArray(xe)&&(J.parameter(xe[0],$r),J.parameter(xe[1],$r),ha=$r[xe[0]],Fe=$r[xe[1]])}else{if("wrapS"in sr){var tt=sr.wrapS;J.parameter(tt,$r),ha=$r[tt]}if("wrapT"in sr){var Ut=sr.wrapT;J.parameter(Ut,$r),Fe=$r[Ut]}}if(Ge.wrapS=ha,Ge.wrapT=Fe,"anisotropic"in sr){var fr=sr.anisotropic;J(typeof fr=="number"&&fr>=1&&fr<=qe.maxAnisotropic,"aniso samples must be between 1 and "),Ge.anisotropic=sr.anisotropic}if("mipmap"in sr){var gt=!1;switch(typeof sr.mipmap){case"string":J.parameter(sr.mipmap,Vr,"invalid mipmap hint"),Ge.mipmapHint=Vr[sr.mipmap],Ge.genMipmaps=!0,gt=!0;break;case"boolean":gt=Ge.genMipmaps=sr.mipmap;break;case"object":J(Array.isArray(sr.mipmap),"invalid mipmap type"),Ge.genMipmaps=!1,gt=!0;break;default:J.raise("invalid mipmap type")}gt&&!("min"in sr)&&(Ge.minFilter=mu)}}function Uo(Ge,sr){Z.texParameteri(sr,qa,Ge.minFilter),Z.texParameteri(sr,zu,Ge.magFilter),Z.texParameteri(sr,Fs,Ge.wrapS),Z.texParameteri(sr,tc,Ge.wrapT),Ie.ext_texture_filter_anisotropic&&Z.texParameteri(sr,gc,Ge.anisotropic),Ge.genMipmaps&&(Z.hint(tu,Ge.mipmapHint),Z.generateMipmap(sr))}var Ls=0,zs={},ws=qe.maxTextureUnits,Ko=Array(ws).map(function(){return null});function wi(Ge){kr.call(this),this.mipmask=0,this.internalformat=qs,this.id=Ls++,this.refCount=1,this.target=Ge,this.texture=Z.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new fo,Ir.profile&&(this.stats={size:0})}function jo(Ge){Z.activeTexture(Pl),Z.bindTexture(Ge.target,Ge.texture)}function Oa(){var Ge=Ko[0];Ge?Z.bindTexture(Ge.target,Ge.texture):Z.bindTexture(xs,null)}function Lo(Ge){var sr=Ge.texture;J(sr,"must not double destroy texture");var rr=Ge.unit,Xn=Ge.target;rr>=0&&(Z.activeTexture(Pl+rr),Z.bindTexture(Xn,null),Ko[rr]=null),Z.deleteTexture(sr),Ge.texture=null,Ge.params=null,Ge.pixels=null,Ge.refCount=0,delete zs[Ge.id],lr.textureCount--}p(wi.prototype,{bind:function(){var Ge=this;Ge.bindCount+=1;var sr=Ge.unit;if(sr<0){for(var rr=0;rr<ws;++rr){var Xn=Ko[rr];if(Xn){if(Xn.bindCount>0)continue;Xn.unit=-1}Ko[rr]=Ge,sr=rr;break}sr>=ws&&J.raise("insufficient number of texture units"),Ir.profile&&lr.maxTextureUnits<sr+1&&(lr.maxTextureUnits=sr+1),Ge.unit=sr,Z.activeTexture(Pl+sr),Z.bindTexture(Ge.target,Ge.texture)}return sr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Lo(this)}});function ki(Ge,sr){var rr=new wi(xs);zs[rr.id]=rr,lr.textureCount++;function Xn(xe,tt){var Ut=rr.texInfo;fo.call(Ut);var fr=sa();return typeof xe=="number"?typeof tt=="number"?Ui(fr,xe|0,tt|0):Ui(fr,xe|0,xe|0):xe?(J.type(xe,"object","invalid arguments to regl.texture"),Yo(Ut,xe),ma(fr,xe)):Ui(fr,1,1),Ut.genMipmaps&&(fr.mipmask=(fr.width<<1)-1),rr.mipmask=fr.mipmask,Ar(rr,fr),J.texture2D(Ut,fr,qe),rr.internalformat=fr.internalformat,Xn.width=fr.width,Xn.height=fr.height,jo(rr),Zo(fr,xs),Uo(Ut,xs),Oa(),ps(fr),Ir.profile&&(rr.stats.size=Mu(rr.internalformat,rr.type,fr.width,fr.height,Ut.genMipmaps,!1)),Xn.format=Jr[rr.internalformat],Xn.type=Dn[rr.type],Xn.mag=Dr[Ut.magFilter],Xn.min=Pn[Ut.minFilter],Xn.wrapS=fn[Ut.wrapS],Xn.wrapT=fn[Ut.wrapT],Xn}function ha(xe,tt,Ut,fr){J(!!xe,"must specify image data");var gt=tt|0,mt=Ut|0,ot=fr|0,Re=kn();return Ar(Re,rr),Re.width=0,Re.height=0,Mn(Re,xe),Re.width=Re.width||(rr.width>>ot)-gt,Re.height=Re.height||(rr.height>>ot)-mt,J(rr.type===Re.type&&rr.format===Re.format&&rr.internalformat===Re.internalformat,"incompatible format for texture.subimage"),J(gt>=0&&mt>=0&&gt+Re.width<=rr.width&&mt+Re.height<=rr.height,"texture.subimage write out of bounds"),J(rr.mipmask&1<<ot,"missing mipmap data"),J(Re.data||Re.element||Re.needsCopy,"missing image data"),jo(rr),Gi(Re,xs,gt,mt,ot),Oa(),An(Re),Xn}function Fe(xe,tt){var Ut=xe|0,fr=tt|0||Ut;if(Ut===rr.width&&fr===rr.height)return Xn;Xn.width=rr.width=Ut,Xn.height=rr.height=fr,jo(rr);for(var gt=0;rr.mipmask>>gt;++gt){var mt=Ut>>gt,ot=fr>>gt;if(!mt||!ot)break;Z.texImage2D(xs,gt,rr.format,mt,ot,0,rr.format,rr.type,null)}return Oa(),Ir.profile&&(rr.stats.size=Mu(rr.internalformat,rr.type,Ut,fr,!1,!1)),Xn}return Xn(Ge,sr),Xn.subimage=ha,Xn.resize=Fe,Xn._reglType="texture2d",Xn._texture=rr,Ir.profile&&(Xn.stats=rr.stats),Xn.destroy=function(){rr.decRef()},Xn}function fa(Ge,sr,rr,Xn,ha,Fe){var xe=new wi(kl);zs[xe.id]=xe,lr.cubeCount++;var tt=new Array(6);function Ut(mt,ot,Re,st,ze,Vt){var Qt,Ur=xe.texInfo;for(fo.call(Ur),Qt=0;Qt<6;++Qt)tt[Qt]=sa();if(typeof mt=="number"||!mt){var _n=mt|0||1;for(Qt=0;Qt<6;++Qt)Ui(tt[Qt],_n,_n)}else if(typeof mt=="object")if(ot)ma(tt[0],mt),ma(tt[1],ot),ma(tt[2],Re),ma(tt[3],st),ma(tt[4],ze),ma(tt[5],Vt);else if(Yo(Ur,mt),ri(xe,mt),"faces"in mt){var on=mt.faces;for(J(Array.isArray(on)&&on.length===6,"cube faces must be a length 6 array"),Qt=0;Qt<6;++Qt)J(typeof on[Qt]=="object"&&!!on[Qt],"invalid input for cube map face"),Ar(tt[Qt],xe),ma(tt[Qt],on[Qt])}else for(Qt=0;Qt<6;++Qt)ma(tt[Qt],mt);else J.raise("invalid arguments to cube map");for(Ar(xe,tt[0]),J.optional(function(){qe.npotTextureCube||J(Js(xe.width)&&Js(xe.height),"your browser does not support non power or two texture dimensions")}),Ur.genMipmaps?xe.mipmask=(tt[0].width<<1)-1:xe.mipmask=tt[0].mipmask,J.textureCube(xe,Ur,tt,qe),xe.internalformat=tt[0].internalformat,Ut.width=tt[0].width,Ut.height=tt[0].height,jo(xe),Qt=0;Qt<6;++Qt)Zo(tt[Qt],Qs+Qt);for(Uo(Ur,kl),Oa(),Ir.profile&&(xe.stats.size=Mu(xe.internalformat,xe.type,Ut.width,Ut.height,Ur.genMipmaps,!0)),Ut.format=Jr[xe.internalformat],Ut.type=Dn[xe.type],Ut.mag=Dr[Ur.magFilter],Ut.min=Pn[Ur.minFilter],Ut.wrapS=fn[Ur.wrapS],Ut.wrapT=fn[Ur.wrapT],Qt=0;Qt<6;++Qt)ps(tt[Qt]);return Ut}function fr(mt,ot,Re,st,ze){J(!!ot,"must specify image data"),J(typeof mt=="number"&&mt===(mt|0)&&mt>=0&&mt<6,"invalid face");var Vt=Re|0,Qt=st|0,Ur=ze|0,_n=kn();return Ar(_n,xe),_n.width=0,_n.height=0,Mn(_n,ot),_n.width=_n.width||(xe.width>>Ur)-Vt,_n.height=_n.height||(xe.height>>Ur)-Qt,J(xe.type===_n.type&&xe.format===_n.format&&xe.internalformat===_n.internalformat,"incompatible format for texture.subimage"),J(Vt>=0&&Qt>=0&&Vt+_n.width<=xe.width&&Qt+_n.height<=xe.height,"texture.subimage write out of bounds"),J(xe.mipmask&1<<Ur,"missing mipmap data"),J(_n.data||_n.element||_n.needsCopy,"missing image data"),jo(xe),Gi(_n,Qs+mt,Vt,Qt,Ur),Oa(),An(_n),Ut}function gt(mt){var ot=mt|0;if(ot!==xe.width){Ut.width=xe.width=ot,Ut.height=xe.height=ot,jo(xe);for(var Re=0;Re<6;++Re)for(var st=0;xe.mipmask>>st;++st)Z.texImage2D(Qs+Re,st,xe.format,ot>>st,ot>>st,0,xe.format,xe.type,null);return Oa(),Ir.profile&&(xe.stats.size=Mu(xe.internalformat,xe.type,Ut.width,Ut.height,!1,!0)),Ut}}return Ut(Ge,sr,rr,Xn,ha,Fe),Ut.subimage=fr,Ut.resize=gt,Ut._reglType="textureCube",Ut._texture=xe,Ir.profile&&(Ut.stats=xe.stats),Ut.destroy=function(){xe.decRef()},Ut}function no(){for(var Ge=0;Ge<ws;++Ge)Z.activeTexture(Pl+Ge),Z.bindTexture(xs,null),Ko[Ge]=null;O(zs).forEach(Lo),lr.cubeCount=0,lr.textureCount=0}Ir.profile&&(lr.getTotalTextureSize=function(){var Ge=0;return Object.keys(zs).forEach(function(sr){Ge+=zs[sr].stats.size}),Ge});function So(){for(var Ge=0;Ge<ws;++Ge){var sr=Ko[Ge];sr&&(sr.bindCount=0,sr.unit=-1,Ko[Ge]=null)}O(zs).forEach(function(rr){rr.texture=Z.createTexture(),Z.bindTexture(rr.target,rr.texture);for(var Xn=0;Xn<32;++Xn)if((rr.mipmask&1<<Xn)!=0)if(rr.target===xs)Z.texImage2D(xs,Xn,rr.internalformat,rr.width>>Xn,rr.height>>Xn,0,rr.internalformat,rr.type,null);else for(var ha=0;ha<6;++ha)Z.texImage2D(Qs+ha,Xn,rr.internalformat,rr.width>>Xn,rr.height>>Xn,0,rr.internalformat,rr.type,null);Uo(rr.texInfo,rr.target)})}function dl(){for(var Ge=0;Ge<ws;++Ge){var sr=Ko[Ge];sr&&(sr.bindCount=0,sr.unit=-1,Ko[Ge]=null),Z.activeTexture(Pl+Ge),Z.bindTexture(xs,null),Z.bindTexture(kl,null)}}return{create2D:ki,createCube:fa,clear:no,getTexture:function(Ge){return null},restore:So,refresh:dl}}var co=36161,Il=32854,Gn=32855,Wn=36194,ol=33189,ls=36168,cs=34041,Io=35907,ru=34836,Sc=34842,nc=34843,Xi=[];Xi[Il]=2,Xi[Gn]=2,Xi[Wn]=2,Xi[ol]=2,Xi[ls]=1,Xi[cs]=4,Xi[Io]=4,Xi[ru]=16,Xi[Sc]=8,Xi[nc]=6;function ji(Z,Ie,qe){return Xi[Z]*Ie*qe}var Qc=function(Z,Ie,qe,pr,Br){var lr={rgba4:Il,rgb565:Wn,"rgb5 a1":Gn,depth:ol,stencil:ls,"depth stencil":cs};Ie.ext_srgb&&(lr.srgba=Io),Ie.ext_color_buffer_half_float&&(lr.rgba16f=Sc,lr.rgb16f=nc),Ie.webgl_color_buffer_float&&(lr.rgba32f=ru);var Ir=[];Object.keys(lr).forEach(function(Yr){var un=lr[Yr];Ir[un]=Yr});var Vr=0,$r={};function en(Yr){this.id=Vr++,this.refCount=1,this.renderbuffer=Yr,this.format=Il,this.width=0,this.height=0,Br.profile&&(this.stats={size:0})}en.prototype.decRef=function(){--this.refCount<=0&&tn(this)};function tn(Yr){var un=Yr.renderbuffer;J(un,"must not double destroy renderbuffer"),Z.bindRenderbuffer(co,null),Z.deleteRenderbuffer(un),Yr.renderbuffer=null,Yr.refCount=0,delete $r[Yr.id],pr.renderbufferCount--}function sn(Yr,un){var zt=new en(Z.createRenderbuffer());$r[zt.id]=zt,pr.renderbufferCount++;function gr(Dn,Dr){var Pn=0,fn=0,pi=Il;if(typeof Dn=="object"&&Dn){var kr=Dn;if("shape"in kr){var Ar=kr.shape;J(Array.isArray(Ar)&&Ar.length>=2,"invalid renderbuffer shape"),Pn=Ar[0]|0,fn=Ar[1]|0}else"radius"in kr&&(Pn=fn=kr.radius|0),"width"in kr&&(Pn=kr.width|0),"height"in kr&&(fn=kr.height|0);"format"in kr&&(J.parameter(kr.format,lr,"invalid renderbuffer format"),pi=lr[kr.format])}else typeof Dn=="number"?(Pn=Dn|0,typeof Dr=="number"?fn=Dr|0:fn=Pn):Dn?J.raise("invalid arguments to renderbuffer constructor"):Pn=fn=1;if(J(Pn>0&&fn>0&&Pn<=qe.maxRenderbufferSize&&fn<=qe.maxRenderbufferSize,"invalid renderbuffer size"),!(Pn===zt.width&&fn===zt.height&&pi===zt.format))return gr.width=zt.width=Pn,gr.height=zt.height=fn,zt.format=pi,Z.bindRenderbuffer(co,zt.renderbuffer),Z.renderbufferStorage(co,pi,Pn,fn),J(Z.getError()===0,"invalid render buffer format"),Br.profile&&(zt.stats.size=ji(zt.format,zt.width,zt.height)),gr.format=Ir[zt.format],gr}function Jr(Dn,Dr){var Pn=Dn|0,fn=Dr|0||Pn;return Pn===zt.width&&fn===zt.height||(J(Pn>0&&fn>0&&Pn<=qe.maxRenderbufferSize&&fn<=qe.maxRenderbufferSize,"invalid renderbuffer size"),gr.width=zt.width=Pn,gr.height=zt.height=fn,Z.bindRenderbuffer(co,zt.renderbuffer),Z.renderbufferStorage(co,zt.format,Pn,fn),J(Z.getError()===0,"invalid render buffer format"),Br.profile&&(zt.stats.size=ji(zt.format,zt.width,zt.height))),gr}return gr(Yr,un),gr.resize=Jr,gr._reglType="renderbuffer",gr._renderbuffer=zt,Br.profile&&(gr.stats=zt.stats),gr.destroy=function(){zt.decRef()},gr}Br.profile&&(pr.getTotalRenderbufferSize=function(){var Yr=0;return Object.keys($r).forEach(function(un){Yr+=$r[un].stats.size}),Yr});function bn(){O($r).forEach(function(Yr){Yr.renderbuffer=Z.createRenderbuffer(),Z.bindRenderbuffer(co,Yr.renderbuffer),Z.renderbufferStorage(co,Yr.format,Yr.width,Yr.height)}),Z.bindRenderbuffer(co,null)}return{create:sn,clear:function(){O($r).forEach(tn)},restore:bn}},Bs=36160,Ol=36161,Os=3553,Ya=34069,Hs=36064,Ss=36096,Vu=36128,sl=33306,Ll=36053,Ec=36054,ul=36055,Gu=36057,ll=36061,xu=36193,Hu=5121,Cc=5126,Iu=6407,Ns=6408,wc=6402,ic=[Iu,Ns],jl=[];jl[Ns]=4,jl[Iu]=3;var cl=[];cl[Hu]=1,cl[Cc]=4,cl[xu]=2;var i=32854,u=32855,o=36194,h=33189,g=36168,S=34041,T=35907,R=34836,G=34842,se=34843,Ee=[i,u,o,T,G,se,R],we={};we[Ll]="complete",we[Ec]="incomplete attachment",we[Gu]="incomplete dimensions",we[ul]="incomplete, missing attachment",we[ll]="unsupported";function Pe(Z,Ie,qe,pr,Br,lr){var Ir={cur:null,next:null,dirty:!1,setFBO:null},Vr=["rgba"],$r=["rgba4","rgb565","rgb5 a1"];Ie.ext_srgb&&$r.push("srgba"),Ie.ext_color_buffer_half_float&&$r.push("rgba16f","rgb16f"),Ie.webgl_color_buffer_float&&$r.push("rgba32f");var en=["uint8"];Ie.oes_texture_half_float&&en.push("half float","float16"),Ie.oes_texture_float&&en.push("float","float32");function tn(rn,Mn,On){this.target=rn,this.texture=Mn,this.renderbuffer=On;var Gi=0,Bi=0;Mn?(Gi=Mn.width,Bi=Mn.height):On&&(Gi=On.width,Bi=On.height),this.width=Gi,this.height=Bi}function sn(rn){rn&&(rn.texture&&rn.texture._texture.decRef(),rn.renderbuffer&&rn.renderbuffer._renderbuffer.decRef())}function bn(rn,Mn,On){if(!!rn)if(rn.texture){var Gi=rn.texture._texture,Bi=Math.max(1,Gi.width),kn=Math.max(1,Gi.height);J(Bi===Mn&&kn===On,"inconsistent width/height for supplied texture"),Gi.refCount+=1}else{var An=rn.renderbuffer._renderbuffer;J(An.width===Mn&&An.height===On,"inconsistent width/height for renderbuffer"),An.refCount+=1}}function Yr(rn,Mn){Mn&&(Mn.texture?Z.framebufferTexture2D(Bs,rn,Mn.target,Mn.texture._texture.texture,0):Z.framebufferRenderbuffer(Bs,rn,Ol,Mn.renderbuffer._renderbuffer.renderbuffer))}function un(rn){var Mn=Os,On=null,Gi=null,Bi=rn;typeof rn=="object"&&(Bi=rn.data,"target"in rn&&(Mn=rn.target|0)),J.type(Bi,"function","invalid attachment data");var kn=Bi._reglType;return kn==="texture2d"?(On=Bi,J(Mn===Os)):kn==="textureCube"?(On=Bi,J(Mn>=Ya&&Mn<Ya+6,"invalid cube map target")):kn==="renderbuffer"?(Gi=Bi,Mn=Ol):J.raise("invalid regl object for attachment"),new tn(Mn,On,Gi)}function zt(rn,Mn,On,Gi,Bi){if(On){var kn=pr.create2D({width:rn,height:Mn,format:Gi,type:Bi});return kn._texture.refCount=0,new tn(Os,kn,null)}else{var An=Br.create({width:rn,height:Mn,format:Gi});return An._renderbuffer.refCount=0,new tn(Ol,null,An)}}function gr(rn){return rn&&(rn.texture||rn.renderbuffer)}function Jr(rn,Mn,On){rn&&(rn.texture?rn.texture.resize(Mn,On):rn.renderbuffer&&rn.renderbuffer.resize(Mn,On),rn.width=Mn,rn.height=On)}var Dn=0,Dr={};function Pn(){this.id=Dn++,Dr[this.id]=this,this.framebuffer=Z.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function fn(rn){rn.colorAttachments.forEach(sn),sn(rn.depthAttachment),sn(rn.stencilAttachment),sn(rn.depthStencilAttachment)}function pi(rn){var Mn=rn.framebuffer;J(Mn,"must not double destroy framebuffer"),Z.deleteFramebuffer(Mn),rn.framebuffer=null,lr.framebufferCount--,delete Dr[rn.id]}function kr(rn){var Mn;Z.bindFramebuffer(Bs,rn.framebuffer);var On=rn.colorAttachments;for(Mn=0;Mn<On.length;++Mn)Yr(Hs+Mn,On[Mn]);for(Mn=On.length;Mn<qe.maxColorAttachments;++Mn)Z.framebufferTexture2D(Bs,Hs+Mn,Os,null,0);Z.framebufferTexture2D(Bs,sl,Os,null,0),Z.framebufferTexture2D(Bs,Ss,Os,null,0),Z.framebufferTexture2D(Bs,Vu,Os,null,0),Yr(Ss,rn.depthAttachment),Yr(Vu,rn.stencilAttachment),Yr(sl,rn.depthStencilAttachment);var Gi=Z.checkFramebufferStatus(Bs);!Z.isContextLost()&&Gi!==Ll&&J.raise("framebuffer configuration not supported, status = "+we[Gi]),Z.bindFramebuffer(Bs,Ir.next?Ir.next.framebuffer:null),Ir.cur=Ir.next,Z.getError()}function Ar(rn,Mn){var On=new Pn;lr.framebufferCount++;function Gi(kn,An){var Ti;J(Ir.next!==On,"can not update framebuffer which is currently in use");var Ui=0,ma=0,Zo=!0,bo=!0,sa=null,ps=!0,fo="rgba",Yo="uint8",Uo=1,Ls=null,zs=null,ws=null,Ko=!1;if(typeof kn=="number")Ui=kn|0,ma=An|0||Ui;else if(!kn)Ui=ma=1;else{J.type(kn,"object","invalid arguments for framebuffer");var wi=kn;if("shape"in wi){var jo=wi.shape;J(Array.isArray(jo)&&jo.length>=2,"invalid shape for framebuffer"),Ui=jo[0],ma=jo[1]}else"radius"in wi&&(Ui=ma=wi.radius),"width"in wi&&(Ui=wi.width),"height"in wi&&(ma=wi.height);("color"in wi||"colors"in wi)&&(sa=wi.color||wi.colors,Array.isArray(sa)&&J(sa.length===1||Ie.webgl_draw_buffers,"multiple render targets not supported")),sa||("colorCount"in wi&&(Uo=wi.colorCount|0,J(Uo>0,"invalid color buffer count")),"colorTexture"in wi&&(ps=!!wi.colorTexture,fo="rgba4"),"colorType"in wi&&(Yo=wi.colorType,ps?(J(Ie.oes_texture_float||!(Yo==="float"||Yo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),J(Ie.oes_texture_half_float||!(Yo==="half float"||Yo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Yo==="half float"||Yo==="float16"?(J(Ie.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),fo="rgba16f"):(Yo==="float"||Yo==="float32")&&(J(Ie.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),fo="rgba32f"),J.oneOf(Yo,en,"invalid color type")),"colorFormat"in wi&&(fo=wi.colorFormat,Vr.indexOf(fo)>=0?ps=!0:$r.indexOf(fo)>=0?ps=!1:J.optional(function(){ps?J.oneOf(wi.colorFormat,Vr,"invalid color format for texture"):J.oneOf(wi.colorFormat,$r,"invalid color format for renderbuffer")}))),("depthTexture"in wi||"depthStencilTexture"in wi)&&(Ko=!!(wi.depthTexture||wi.depthStencilTexture),J(!Ko||Ie.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in wi&&(typeof wi.depth=="boolean"?Zo=wi.depth:(Ls=wi.depth,bo=!1)),"stencil"in wi&&(typeof wi.stencil=="boolean"?bo=wi.stencil:(zs=wi.stencil,Zo=!1)),"depthStencil"in wi&&(typeof wi.depthStencil=="boolean"?Zo=bo=wi.depthStencil:(ws=wi.depthStencil,Zo=!1,bo=!1))}var Oa=null,Lo=null,ki=null,fa=null;if(Array.isArray(sa))Oa=sa.map(un);else if(sa)Oa=[un(sa)];else for(Oa=new Array(Uo),Ti=0;Ti<Uo;++Ti)Oa[Ti]=zt(Ui,ma,ps,fo,Yo);J(Ie.webgl_draw_buffers||Oa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),J(Oa.length<=qe.maxColorAttachments,"too many color attachments, not supported"),Ui=Ui||Oa[0].width,ma=ma||Oa[0].height,Ls?Lo=un(Ls):Zo&&!bo&&(Lo=zt(Ui,ma,Ko,"depth","uint32")),zs?ki=un(zs):bo&&!Zo&&(ki=zt(Ui,ma,!1,"stencil","uint8")),ws?fa=un(ws):!Ls&&!zs&&bo&&Zo&&(fa=zt(Ui,ma,Ko,"depth stencil","depth stencil")),J(!!Ls+!!zs+!!ws<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var no=null;for(Ti=0;Ti<Oa.length;++Ti)if(bn(Oa[Ti],Ui,ma),J(!Oa[Ti]||Oa[Ti].texture&&ic.indexOf(Oa[Ti].texture._texture.format)>=0||Oa[Ti].renderbuffer&&Ee.indexOf(Oa[Ti].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ti+" is invalid"),Oa[Ti]&&Oa[Ti].texture){var So=jl[Oa[Ti].texture._texture.format]*cl[Oa[Ti].texture._texture.type];no===null?no=So:J(no===So,"all color attachments much have the same number of bits per pixel.")}return bn(Lo,Ui,ma),J(!Lo||Lo.texture&&Lo.texture._texture.format===wc||Lo.renderbuffer&&Lo.renderbuffer._renderbuffer.format===h,"invalid depth attachment for framebuffer object"),bn(ki,Ui,ma),J(!ki||ki.renderbuffer&&ki.renderbuffer._renderbuffer.format===g,"invalid stencil attachment for framebuffer object"),bn(fa,Ui,ma),J(!fa||fa.texture&&fa.texture._texture.format===S||fa.renderbuffer&&fa.renderbuffer._renderbuffer.format===S,"invalid depth-stencil attachment for framebuffer object"),fn(On),On.width=Ui,On.height=ma,On.colorAttachments=Oa,On.depthAttachment=Lo,On.stencilAttachment=ki,On.depthStencilAttachment=fa,Gi.color=Oa.map(gr),Gi.depth=gr(Lo),Gi.stencil=gr(ki),Gi.depthStencil=gr(fa),Gi.width=On.width,Gi.height=On.height,kr(On),Gi}function Bi(kn,An){J(Ir.next!==On,"can not resize a framebuffer which is currently in use");var Ti=Math.max(kn|0,1),Ui=Math.max(An|0||Ti,1);if(Ti===On.width&&Ui===On.height)return Gi;for(var ma=On.colorAttachments,Zo=0;Zo<ma.length;++Zo)Jr(ma[Zo],Ti,Ui);return Jr(On.depthAttachment,Ti,Ui),Jr(On.stencilAttachment,Ti,Ui),Jr(On.depthStencilAttachment,Ti,Ui),On.width=Gi.width=Ti,On.height=Gi.height=Ui,kr(On),Gi}return Gi(rn,Mn),p(Gi,{resize:Bi,_reglType:"framebuffer",_framebuffer:On,destroy:function(){pi(On),fn(On)},use:function(kn){Ir.setFBO({framebuffer:Gi},kn)}})}function ri(rn){var Mn=Array(6);function On(Bi){var kn;J(Mn.indexOf(Ir.next)<0,"can not update framebuffer which is currently in use");var An={color:null},Ti=0,Ui=null,ma="rgba",Zo="uint8",bo=1;if(typeof Bi=="number")Ti=Bi|0;else if(!Bi)Ti=1;else{J.type(Bi,"object","invalid arguments for framebuffer");var sa=Bi;if("shape"in sa){var ps=sa.shape;J(Array.isArray(ps)&&ps.length>=2,"invalid shape for framebuffer"),J(ps[0]===ps[1],"cube framebuffer must be square"),Ti=ps[0]}else"radius"in sa&&(Ti=sa.radius|0),"width"in sa?(Ti=sa.width|0,"height"in sa&&J(sa.height===Ti,"must be square")):"height"in sa&&(Ti=sa.height|0);("color"in sa||"colors"in sa)&&(Ui=sa.color||sa.colors,Array.isArray(Ui)&&J(Ui.length===1||Ie.webgl_draw_buffers,"multiple render targets not supported")),Ui||("colorCount"in sa&&(bo=sa.colorCount|0,J(bo>0,"invalid color buffer count")),"colorType"in sa&&(J.oneOf(sa.colorType,en,"invalid color type"),Zo=sa.colorType),"colorFormat"in sa&&(ma=sa.colorFormat,J.oneOf(sa.colorFormat,Vr,"invalid color format for texture"))),"depth"in sa&&(An.depth=sa.depth),"stencil"in sa&&(An.stencil=sa.stencil),"depthStencil"in sa&&(An.depthStencil=sa.depthStencil)}var fo;if(Ui)if(Array.isArray(Ui))for(fo=[],kn=0;kn<Ui.length;++kn)fo[kn]=Ui[kn];else fo=[Ui];else{fo=Array(bo);var Yo={radius:Ti,format:ma,type:Zo};for(kn=0;kn<bo;++kn)fo[kn]=pr.createCube(Yo)}for(An.color=Array(fo.length),kn=0;kn<fo.length;++kn){var Uo=fo[kn];J(typeof Uo=="function"&&Uo._reglType==="textureCube","invalid cube map"),Ti=Ti||Uo.width,J(Uo.width===Ti&&Uo.height===Ti,"invalid cube map shape"),An.color[kn]={target:Ya,data:fo[kn]}}for(kn=0;kn<6;++kn){for(var Ls=0;Ls<fo.length;++Ls)An.color[Ls].target=Ya+kn;kn>0&&(An.depth=Mn[0].depth,An.stencil=Mn[0].stencil,An.depthStencil=Mn[0].depthStencil),Mn[kn]?Mn[kn](An):Mn[kn]=Ar(An)}return p(On,{width:Ti,height:Ti,color:fo})}function Gi(Bi){var kn,An=Bi|0;if(J(An>0&&An<=qe.maxCubeMapSize,"invalid radius for cube fbo"),An===On.width)return On;var Ti=On.color;for(kn=0;kn<Ti.length;++kn)Ti[kn].resize(An);for(kn=0;kn<6;++kn)Mn[kn].resize(An);return On.width=On.height=An,On}return On(rn),p(On,{faces:Mn,resize:Gi,_reglType:"framebufferCube",destroy:function(){Mn.forEach(function(Bi){Bi.destroy()})}})}function Cn(){Ir.cur=null,Ir.next=null,Ir.dirty=!0,O(Dr).forEach(function(rn){rn.framebuffer=Z.createFramebuffer(),kr(rn)})}return p(Ir,{getFramebuffer:function(rn){if(typeof rn=="function"&&rn._reglType==="framebuffer"){var Mn=rn._framebuffer;if(Mn instanceof Pn)return Mn}return null},create:Ar,createCube:ri,clear:function(){O(Dr).forEach(pi)},restore:Cn})}var Ye=5126,We=34962,ut=34963,Ue=["attributes","elements","offset","count","primitive","instances"];function at(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ye,this.offset=0,this.stride=0,this.divisor=0}function wt(Z,Ie,qe,pr,Br,lr,Ir){for(var Vr=qe.maxAttributes,$r=new Array(Vr),en=0;en<Vr;++en)$r[en]=new at;var tn=0,sn={},bn={Record:at,scope:{},state:$r,currentVAO:null,targetVAO:null,restore:un()?fn:function(){},createVAO:pi,getVAO:gr,destroyBuffer:Yr,setVAO:un()?Jr:Dn,clear:un()?Dr:function(){}};function Yr(kr){for(var Ar=0;Ar<$r.length;++Ar){var ri=$r[Ar];ri.buffer===kr&&(Z.disableVertexAttribArray(Ar),ri.buffer=null)}}function un(){return Ie.oes_vertex_array_object}function zt(){return Ie.angle_instanced_arrays}function gr(kr){return typeof kr=="function"&&kr._vao?kr._vao:null}function Jr(kr){if(kr!==bn.currentVAO){var Ar=un();kr?Ar.bindVertexArrayOES(kr.vao):Ar.bindVertexArrayOES(null),bn.currentVAO=kr}}function Dn(kr){if(kr!==bn.currentVAO){if(kr)kr.bindAttrs();else{for(var Ar=zt(),ri=0;ri<$r.length;++ri){var Cn=$r[ri];Cn.buffer?(Z.enableVertexAttribArray(ri),Cn.buffer.bind(),Z.vertexAttribPointer(ri,Cn.size,Cn.type,Cn.normalized,Cn.stride,Cn.offfset),Ar&&Cn.divisor&&Ar.vertexAttribDivisorANGLE(ri,Cn.divisor)):(Z.disableVertexAttribArray(ri),Z.vertexAttrib4f(ri,Cn.x,Cn.y,Cn.z,Cn.w))}Ir.elements?Z.bindBuffer(ut,Ir.elements.buffer.buffer):Z.bindBuffer(ut,null)}bn.currentVAO=kr}}function Dr(){O(sn).forEach(function(kr){kr.destroy()})}function Pn(){this.id=++tn,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var kr=un();kr?this.vao=kr.createVertexArrayOES():this.vao=null,sn[this.id]=this,this.buffers=[]}Pn.prototype.bindAttrs=function(){for(var kr=zt(),Ar=this.attributes,ri=0;ri<Ar.length;++ri){var Cn=Ar[ri];Cn.buffer?(Z.enableVertexAttribArray(ri),Z.bindBuffer(We,Cn.buffer.buffer),Z.vertexAttribPointer(ri,Cn.size,Cn.type,Cn.normalized,Cn.stride,Cn.offset),kr&&Cn.divisor&&kr.vertexAttribDivisorANGLE(ri,Cn.divisor)):(Z.disableVertexAttribArray(ri),Z.vertexAttrib4f(ri,Cn.x,Cn.y,Cn.z,Cn.w))}for(var rn=Ar.length;rn<Vr;++rn)Z.disableVertexAttribArray(rn);var Mn=lr.getElements(this.elements);Mn?Z.bindBuffer(ut,Mn.buffer.buffer):Z.bindBuffer(ut,null)},Pn.prototype.refresh=function(){var kr=un();kr&&(kr.bindVertexArrayOES(this.vao),this.bindAttrs(),bn.currentVAO=null,kr.bindVertexArrayOES(null))},Pn.prototype.destroy=function(){if(this.vao){var kr=un();this===bn.currentVAO&&(bn.currentVAO=null,kr.bindVertexArrayOES(null)),kr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),sn[this.id]&&(delete sn[this.id],pr.vaoCount-=1)};function fn(){var kr=un();kr&&O(sn).forEach(function(Ar){Ar.refresh()})}function pi(kr){var Ar=new Pn;pr.vaoCount+=1;function ri(Cn){var rn;if(Array.isArray(Cn))rn=Cn,Ar.elements&&Ar.ownsElements&&Ar.elements.destroy(),Ar.elements=null,Ar.ownsElements=!1,Ar.offset=0,Ar.count=0,Ar.instances=-1,Ar.primitive=4;else{if(J(typeof Cn=="object","invalid arguments for create vao"),J("attributes"in Cn,"must specify attributes for vao"),Cn.elements){var Mn=Cn.elements;Ar.ownsElements?typeof Mn=="function"&&Mn._reglType==="elements"?(Ar.elements.destroy(),Ar.ownsElements=!1):(Ar.elements(Mn),Ar.ownsElements=!1):lr.getElements(Cn.elements)?(Ar.elements=Cn.elements,Ar.ownsElements=!1):(Ar.elements=lr.create(Cn.elements),Ar.ownsElements=!0)}else Ar.elements=null,Ar.ownsElements=!1;rn=Cn.attributes,Ar.offset=0,Ar.count=-1,Ar.instances=-1,Ar.primitive=4,Ar.elements&&(Ar.count=Ar.elements._elements.vertCount,Ar.primitive=Ar.elements._elements.primType),"offset"in Cn&&(Ar.offset=Cn.offset|0),"count"in Cn&&(Ar.count=Cn.count|0),"instances"in Cn&&(Ar.instances=Cn.instances|0),"primitive"in Cn&&(J(Cn.primitive in Fr,"bad primitive type: "+Cn.primitive),Ar.primitive=Fr[Cn.primitive]),J.optional(()=>{for(var Zo=Object.keys(Cn),bo=0;bo<Zo.length;++bo)J(Ue.indexOf(Zo[bo])>=0,'invalid option for vao: "'+Zo[bo]+'" valid options are '+Ue)}),J(Array.isArray(rn),"attributes must be an array")}J(rn.length<Vr,"too many attributes"),J(rn.length>0,"must specify at least one attribute");var On={},Gi=Ar.attributes;Gi.length=rn.length;for(var Bi=0;Bi<rn.length;++Bi){var kn=rn[Bi],An=Gi[Bi]=new at,Ti=kn.data||kn;if(Array.isArray(Ti)||E(Ti)||yt(Ti)){var Ui;Ar.buffers[Bi]&&(Ui=Ar.buffers[Bi],E(Ti)&&Ui._buffer.byteLength>=Ti.byteLength?Ui.subdata(Ti):(Ui.destroy(),Ar.buffers[Bi]=null)),Ar.buffers[Bi]||(Ui=Ar.buffers[Bi]=Br.create(kn,We,!1,!0)),An.buffer=Br.getBuffer(Ui),An.size=An.buffer.dimension|0,An.normalized=!1,An.type=An.buffer.dtype,An.offset=0,An.stride=0,An.divisor=0,An.state=1,On[Bi]=1}else Br.getBuffer(kn)?(An.buffer=Br.getBuffer(kn),An.size=An.buffer.dimension|0,An.normalized=!1,An.type=An.buffer.dtype,An.offset=0,An.stride=0,An.divisor=0,An.state=1):Br.getBuffer(kn.buffer)?(An.buffer=Br.getBuffer(kn.buffer),An.size=(+kn.size||An.buffer.dimension)|0,An.normalized=!!kn.normalized||!1,"type"in kn?(J.parameter(kn.type,Ys,"invalid buffer type"),An.type=Ys[kn.type]):An.type=An.buffer.dtype,An.offset=(kn.offset||0)|0,An.stride=(kn.stride||0)|0,An.divisor=(kn.divisor||0)|0,An.state=1,J(An.size>=1&&An.size<=4,"size must be between 1 and 4"),J(An.offset>=0,"invalid offset"),J(An.stride>=0&&An.stride<=255,"stride must be between 0 and 255"),J(An.divisor>=0,"divisor must be positive"),J(!An.divisor||!!Ie.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in kn?(J(Bi>0,"first attribute must not be a constant"),An.x=+kn.x||0,An.y=+kn.y||0,An.z=+kn.z||0,An.w=+kn.w||0,An.state=2):J(!1,"invalid attribute spec for location "+Bi)}for(var ma=0;ma<Ar.buffers.length;++ma)!On[ma]&&Ar.buffers[ma]&&(Ar.buffers[ma].destroy(),Ar.buffers[ma]=null);return Ar.refresh(),ri}return ri.destroy=function(){for(var Cn=0;Cn<Ar.buffers.length;++Cn)Ar.buffers[Cn]&&Ar.buffers[Cn].destroy();Ar.buffers.length=0,Ar.ownsElements&&(Ar.elements.destroy(),Ar.elements=null,Ar.ownsElements=!1),Ar.destroy()},ri._vao=Ar,ri._reglType="vao",ri(kr)}return bn}var Xt=35632,_r=35633,dr=35718,Cr=35721;function Gr(Z,Ie,qe,pr){var Br={},lr={};function Ir(zt,gr,Jr,Dn){this.name=zt,this.id=gr,this.location=Jr,this.info=Dn}function Vr(zt,gr){for(var Jr=0;Jr<zt.length;++Jr)if(zt[Jr].id===gr.id){zt[Jr].location=gr.location;return}zt.push(gr)}function $r(zt,gr,Jr){var Dn=zt===Xt?Br:lr,Dr=Dn[gr];if(!Dr){var Pn=Ie.str(gr);Dr=Z.createShader(zt),Z.shaderSource(Dr,Pn),Z.compileShader(Dr),J.shaderError(Z,Dr,Pn,zt,Jr),Dn[gr]=Dr}return Dr}var en={},tn=[],sn=0;function bn(zt,gr){this.id=sn++,this.fragId=zt,this.vertId=gr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,pr.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Yr(zt,gr,Jr){var Dn,Dr,Pn=$r(Xt,zt.fragId),fn=$r(_r,zt.vertId),pi=zt.program=Z.createProgram();if(Z.attachShader(pi,Pn),Z.attachShader(pi,fn),Jr)for(Dn=0;Dn<Jr.length;++Dn){var kr=Jr[Dn];Z.bindAttribLocation(pi,kr[0],kr[1])}Z.linkProgram(pi),J.linkError(Z,pi,Ie.str(zt.fragId),Ie.str(zt.vertId),gr);var Ar=Z.getProgramParameter(pi,dr);pr.profile&&(zt.stats.uniformsCount=Ar);var ri=zt.uniforms;for(Dn=0;Dn<Ar;++Dn)if(Dr=Z.getActiveUniform(pi,Dn),Dr)if(Dr.size>1)for(var Cn=0;Cn<Dr.size;++Cn){var rn=Dr.name.replace("[0]","["+Cn+"]");Vr(ri,new Ir(rn,Ie.id(rn),Z.getUniformLocation(pi,rn),Dr))}else Vr(ri,new Ir(Dr.name,Ie.id(Dr.name),Z.getUniformLocation(pi,Dr.name),Dr));var Mn=Z.getProgramParameter(pi,Cr);pr.profile&&(zt.stats.attributesCount=Mn);var On=zt.attributes;for(Dn=0;Dn<Mn;++Dn)Dr=Z.getActiveAttrib(pi,Dn),Dr&&Vr(On,new Ir(Dr.name,Ie.id(Dr.name),Z.getAttribLocation(pi,Dr.name),Dr))}pr.profile&&(qe.getMaxUniformsCount=function(){var zt=0;return tn.forEach(function(gr){gr.stats.uniformsCount>zt&&(zt=gr.stats.uniformsCount)}),zt},qe.getMaxAttributesCount=function(){var zt=0;return tn.forEach(function(gr){gr.stats.attributesCount>zt&&(zt=gr.stats.attributesCount)}),zt});function un(){Br={},lr={};for(var zt=0;zt<tn.length;++zt)Yr(tn[zt],null,tn[zt].attributes.map(function(gr){return[gr.location,gr.name]}))}return{clear:function(){var zt=Z.deleteShader.bind(Z);O(Br).forEach(zt),Br={},O(lr).forEach(zt),lr={},tn.forEach(function(gr){Z.deleteProgram(gr.program)}),tn.length=0,en={},qe.shaderCount=0},program:function(zt,gr,Jr,Dn){J.command(zt>=0,"missing vertex shader",Jr),J.command(gr>=0,"missing fragment shader",Jr);var Dr=en[gr];Dr||(Dr=en[gr]={});var Pn=Dr[zt];if(Pn&&(Pn.refCount++,!Dn))return Pn;var fn=new bn(gr,zt);return qe.shaderCount++,Yr(fn,Jr,Dn),Pn||(Dr[zt]=fn),tn.push(fn),p(fn,{destroy:function(){if(fn.refCount--,fn.refCount<=0){Z.deleteProgram(fn.program);var pi=tn.indexOf(fn);tn.splice(pi,1),qe.shaderCount--}Dr[fn.vertId].refCount<=0&&(Z.deleteShader(lr[fn.vertId]),delete lr[fn.vertId],delete en[fn.fragId][fn.vertId]),Object.keys(en[fn.fragId]).length||(Z.deleteShader(Br[fn.fragId]),delete Br[fn.fragId],delete en[fn.fragId])}})},restore:un,shader:$r,frag:-1,vert:-1}}var pn=6408,an=5121,Zn=3333,ui=5126;function di(Z,Ie,qe,pr,Br,lr,Ir){function Vr(tn){var sn;Ie.next===null?(J(Br.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),sn=an):(J(Ie.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),sn=Ie.next.colorAttachments[0].texture._texture.type,J.optional(function(){lr.oes_texture_float?(J(sn===an||sn===ui,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),sn===ui&&J(Ir.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):J(sn===an,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var bn=0,Yr=0,un=pr.framebufferWidth,zt=pr.framebufferHeight,gr=null;E(tn)?gr=tn:tn&&(J.type(tn,"object","invalid arguments to regl.read()"),bn=tn.x|0,Yr=tn.y|0,J(bn>=0&&bn<pr.framebufferWidth,"invalid x offset for regl.read"),J(Yr>=0&&Yr<pr.framebufferHeight,"invalid y offset for regl.read"),un=(tn.width||pr.framebufferWidth-bn)|0,zt=(tn.height||pr.framebufferHeight-Yr)|0,gr=tn.data||null),gr&&(sn===an?J(gr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):sn===ui&&J(gr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),J(un>0&&un+bn<=pr.framebufferWidth,"invalid width for read pixels"),J(zt>0&&zt+Yr<=pr.framebufferHeight,"invalid height for read pixels"),qe();var Jr=un*zt*4;return gr||(sn===an?gr=new Uint8Array(Jr):sn===ui&&(gr=gr||new Float32Array(Jr))),J.isTypedArray(gr,"data buffer for regl.read() must be a typedarray"),J(gr.byteLength>=Jr,"data buffer for regl.read() too small"),Z.pixelStorei(Zn,4),Z.readPixels(bn,Yr,un,zt,pn,sn,gr),gr}function $r(tn){var sn;return Ie.setFBO({framebuffer:tn.framebuffer},function(){sn=Vr(tn)}),sn}function en(tn){return!tn||!("framebuffer"in tn)?Vr(tn):$r(tn)}return en}function dn(Z){return Array.prototype.slice.call(Z)}function ia(Z){return dn(Z).join("")}function Hn(){var Z=0,Ie=[],qe=[];function pr(sn){for(var bn=0;bn<qe.length;++bn)if(qe[bn]===sn)return Ie[bn];var Yr="g"+Z++;return Ie.push(Yr),qe.push(sn),Yr}function Br(){var sn=[];function bn(){sn.push.apply(sn,dn(arguments))}var Yr=[];function un(){var zt="v"+Z++;return Yr.push(zt),arguments.length>0&&(sn.push(zt,"="),sn.push.apply(sn,dn(arguments)),sn.push(";")),zt}return p(bn,{def:un,toString:function(){return ia([Yr.length>0?"var "+Yr.join(",")+";":"",ia(sn)])}})}function lr(){var sn=Br(),bn=Br(),Yr=sn.toString,un=bn.toString;function zt(gr,Jr){bn(gr,Jr,"=",sn.def(gr,Jr),";")}return p(function(){sn.apply(sn,dn(arguments))},{def:sn.def,entry:sn,exit:bn,save:zt,set:function(gr,Jr,Dn){zt(gr,Jr),sn(gr,Jr,"=",Dn,";")},toString:function(){return Yr()+un()}})}function Ir(){var sn=ia(arguments),bn=lr(),Yr=lr(),un=bn.toString,zt=Yr.toString;return p(bn,{then:function(){return bn.apply(bn,dn(arguments)),this},else:function(){return Yr.apply(Yr,dn(arguments)),this},toString:function(){var gr=zt();return gr&&(gr="else{"+gr+"}"),ia(["if(",sn,"){",un(),"}",gr])}})}var Vr=Br(),$r={};function en(sn,bn){var Yr=[];function un(){var Dr="a"+Yr.length;return Yr.push(Dr),Dr}bn=bn||0;for(var zt=0;zt<bn;++zt)un();var gr=lr(),Jr=gr.toString,Dn=$r[sn]=p(gr,{arg:un,toString:function(){return ia(["function(",Yr.join(),"){",Jr(),"}"])}});return Dn}function tn(){var sn=['"use strict";',Vr,"return {"];Object.keys($r).forEach(function(zt){sn.push('"',zt,'":',$r[zt].toString(),",")}),sn.push("}");var bn=ia(sn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Yr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",un=Yr?re.Function.apply(null,Ie.concat(bn)):Function.apply(null,Ie.concat(bn));return un.apply(null,qe)}return{global:Vr,link:pr,block:Br,proc:en,scope:lr,cond:Ir,compile:tn}}var bi="xyzw".split(""),Hi=5121,mi=1,Ci=2,Vi=0,X=1,Q=2,D=3,k=4,le=5,Ce=6,ft="dither",Rt="blend.enable",Tt="blend.color",cr="blend.equation",Kr="blend.func",Nn="depth.enable",ni="depth.func",li="depth.range",Li="depth.mask",Mi="colorMask",aa="cull.enable",xa="cull.face",Ca="frontFace",Va="lineWidth",Ga="polygonOffset.enable",to="polygonOffset.offset",ca="sample.alpha",da="sample.enable",va="sample.coverage",vo="stencil.enable",Fi="stencil.mask",Ia="stencil.func",Ka="stencil.opFront",Oo="stencil.opBack",ac="scissor.enable",bu="scissor.box",Es="viewport",Ou="profile",Wu="framebuffer",fl="vert",Vl="frag",oc="elements",Xu="primitive",fs="count",Rf="offset",df="instances",vf="vao",uh="Width",lh="Height",qc=Wu+uh,Ac=Wu+lh,up=Es+uh,Df=Es+lh,ch="drawingBuffer",Gl=ch+uh,ef=ch+lh,lp=[Kr,cr,Ia,Ka,Oo,va,Es,bu,to],tf=34962,fh=34963,cp=35632,fp=35633,Rh=3553,hp=34067,hh=2884,Dh=3042,rf=3024,pp=2960,rs=2929,kf=3089,ph=32823,Ff=32926,Bf=32928,Fc=5126,mf=35664,yf=35665,Tc=35666,gf=5124,nf=35667,Nf=35668,sc=35669,dh=35670,af=35671,zf=35672,of=35673,Bc=35674,fu=35675,uc=35676,_f=35678,xf=35680,Zf=4,sf=1028,hl=1029,kh=2304,Uf=2305,Fh=32775,vh=32776,Bh=519,lc=7680,Pc=0,Nh=1,jf=32774,bf=513,pl=36160,dp=36064,Hl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},mh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Wl={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},cc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},yh={frag:cp,vert:fp},Vf={cw:kh,ccw:Uf};function Sf(Z){return Array.isArray(Z)||E(Z)||yt(Z)}function gh(Z){return Z.sort(function(Ie,qe){return Ie===Es?-1:qe===Es?1:Ie<qe?-1:1})}function Cs(Z,Ie,qe,pr){this.thisDep=Z,this.contextDep=Ie,this.propDep=qe,this.append=pr}function Xo(Z){return Z&&!(Z.thisDep||Z.contextDep||Z.propDep)}function hs(Z){return new Cs(!1,!1,!1,Z)}function Su(Z,Ie){var qe=Z.type;if(qe===Vi){var pr=Z.data.length;return new Cs(!0,pr>=1,pr>=2,Ie)}else if(qe===k){var Br=Z.data;return new Cs(Br.thisDep,Br.contextDep,Br.propDep,Ie)}else{if(qe===le)return new Cs(!1,!1,!1,Ie);if(qe===Ce){for(var lr=!1,Ir=!1,Vr=!1,$r=0;$r<Z.data.length;++$r){var en=Z.data[$r];if(en.type===X)Vr=!0;else if(en.type===Q)Ir=!0;else if(en.type===D)lr=!0;else if(en.type===Vi){lr=!0;var tn=en.data;tn>=1&&(Ir=!0),tn>=2&&(Vr=!0)}else en.type===k&&(lr=lr||en.data.thisDep,Ir=Ir||en.data.contextDep,Vr=Vr||en.data.propDep)}return new Cs(lr,Ir,Vr,Ie)}else return new Cs(qe===D,qe===Q,qe===X,Ie)}}var _h=new Cs(!1,!1,!1,function(){});function vp(Z,Ie,qe,pr,Br,lr,Ir,Vr,$r,en,tn,sn,bn,Yr,un){var zt=en.Record,gr={add:32774,subtract:32778,"reverse subtract":32779};qe.ext_blend_minmax&&(gr.min=Fh,gr.max=vh);var Jr=qe.angle_instanced_arrays,Dn=qe.webgl_draw_buffers,Dr=qe.oes_vertex_array_object,Pn={dirty:!0,profile:un.profile},fn={},pi=[],kr={},Ar={};function ri(Fe){return Fe.replace(".","_")}function Cn(Fe,xe,tt){var Ut=ri(Fe);pi.push(Fe),fn[Ut]=Pn[Ut]=!!tt,kr[Ut]=xe}function rn(Fe,xe,tt){var Ut=ri(Fe);pi.push(Fe),Array.isArray(tt)?(Pn[Ut]=tt.slice(),fn[Ut]=tt.slice()):Pn[Ut]=fn[Ut]=tt,Ar[Ut]=xe}Cn(ft,rf),Cn(Rt,Dh),rn(Tt,"blendColor",[0,0,0,0]),rn(cr,"blendEquationSeparate",[jf,jf]),rn(Kr,"blendFuncSeparate",[Nh,Pc,Nh,Pc]),Cn(Nn,rs,!0),rn(ni,"depthFunc",bf),rn(li,"depthRange",[0,1]),rn(Li,"depthMask",!0),rn(Mi,Mi,[!0,!0,!0,!0]),Cn(aa,hh),rn(xa,"cullFace",hl),rn(Ca,Ca,Uf),rn(Va,Va,1),Cn(Ga,ph),rn(to,"polygonOffset",[0,0]),Cn(ca,Ff),Cn(da,Bf),rn(va,"sampleCoverage",[1,!1]),Cn(vo,pp),rn(Fi,"stencilMask",-1),rn(Ia,"stencilFunc",[Bh,0,-1]),rn(Ka,"stencilOpSeparate",[sf,lc,lc,lc]),rn(Oo,"stencilOpSeparate",[hl,lc,lc,lc]),Cn(ac,kf),rn(bu,"scissor",[0,0,Z.drawingBufferWidth,Z.drawingBufferHeight]),rn(Es,Es,[0,0,Z.drawingBufferWidth,Z.drawingBufferHeight]);var Mn={gl:Z,context:bn,strings:Ie,next:fn,current:Pn,draw:sn,elements:lr,buffer:Br,shader:tn,attributes:en.state,vao:en,uniforms:$r,framebuffer:Vr,extensions:qe,timer:Yr,isBufferArgs:Sf},On={primTypes:Fr,compareFuncs:Wl,blendFuncs:Hl,blendEquations:gr,stencilOps:cc,glTypes:Ys,orientationType:Vf};J.optional(function(){Mn.isArrayLike=La}),Dn&&(On.backBuffer=[hl],On.drawBuffer=pe(pr.maxDrawbuffers,function(Fe){return Fe===0?[0]:pe(Fe,function(xe){return dp+xe})}));var Gi=0;function Bi(){var Fe=Hn(),xe=Fe.link,tt=Fe.global;Fe.id=Gi++,Fe.batchId="0";var Ut=xe(Mn),fr=Fe.shared={props:"a0"};Object.keys(Mn).forEach(function(st){fr[st]=tt.def(Ut,".",st)}),J.optional(function(){Fe.CHECK=xe(J),Fe.commandStr=J.guessCommand(),Fe.command=xe(Fe.commandStr),Fe.assert=function(st,ze,Vt){st("if(!(",ze,"))",this.CHECK,".commandRaise(",xe(Vt),",",this.command,");")},On.invalidBlendCombinations=mh});var gt=Fe.next={},mt=Fe.current={};Object.keys(Ar).forEach(function(st){Array.isArray(Pn[st])&&(gt[st]=tt.def(fr.next,".",st),mt[st]=tt.def(fr.current,".",st))});var ot=Fe.constants={};Object.keys(On).forEach(function(st){ot[st]=tt.def(JSON.stringify(On[st]))}),Fe.invoke=function(st,ze){switch(ze.type){case Vi:var Vt=["this",fr.context,fr.props,Fe.batchId];return st.def(xe(ze.data),".call(",Vt.slice(0,Math.max(ze.data.length+1,4)),")");case X:return st.def(fr.props,ze.data);case Q:return st.def(fr.context,ze.data);case D:return st.def("this",ze.data);case k:return ze.data.append(Fe,st),ze.data.ref;case le:return ze.data.toString();case Ce:return ze.data.map(function(Qt){return Fe.invoke(st,Qt)})}},Fe.attribCache={};var Re={};return Fe.scopeAttrib=function(st){var ze=Ie.id(st);if(ze in Re)return Re[ze];var Vt=en.scope[ze];Vt||(Vt=en.scope[ze]=new zt);var Qt=Re[ze]=xe(Vt);return Qt},Fe}function kn(Fe){var xe=Fe.static,tt=Fe.dynamic,Ut;if(Ou in xe){var fr=!!xe[Ou];Ut=hs(function(mt,ot){return fr}),Ut.enable=fr}else if(Ou in tt){var gt=tt[Ou];Ut=Su(gt,function(mt,ot){return mt.invoke(ot,gt)})}return Ut}function An(Fe,xe){var tt=Fe.static,Ut=Fe.dynamic;if(Wu in tt){var fr=tt[Wu];return fr?(fr=Vr.getFramebuffer(fr),J.command(fr,"invalid framebuffer object"),hs(function(mt,ot){var Re=mt.link(fr),st=mt.shared;ot.set(st.framebuffer,".next",Re);var ze=st.context;return ot.set(ze,"."+qc,Re+".width"),ot.set(ze,"."+Ac,Re+".height"),Re})):hs(function(mt,ot){var Re=mt.shared;ot.set(Re.framebuffer,".next","null");var st=Re.context;return ot.set(st,"."+qc,st+"."+Gl),ot.set(st,"."+Ac,st+"."+ef),"null"})}else if(Wu in Ut){var gt=Ut[Wu];return Su(gt,function(mt,ot){var Re=mt.invoke(ot,gt),st=mt.shared,ze=st.framebuffer,Vt=ot.def(ze,".getFramebuffer(",Re,")");J.optional(function(){mt.assert(ot,"!"+Re+"||"+Vt,"invalid framebuffer object")}),ot.set(ze,".next",Vt);var Qt=st.context;return ot.set(Qt,"."+qc,Vt+"?"+Vt+".width:"+Qt+"."+Gl),ot.set(Qt,"."+Ac,Vt+"?"+Vt+".height:"+Qt+"."+ef),Vt})}else return null}function Ti(Fe,xe,tt){var Ut=Fe.static,fr=Fe.dynamic;function gt(Re){if(Re in Ut){var st=Ut[Re];J.commandType(st,"object","invalid "+Re,tt.commandStr);var ze=!0,Vt=st.x|0,Qt=st.y|0,Ur,_n;return"width"in st?(Ur=st.width|0,J.command(Ur>=0,"invalid "+Re,tt.commandStr)):ze=!1,"height"in st?(_n=st.height|0,J.command(_n>=0,"invalid "+Re,tt.commandStr)):ze=!1,new Cs(!ze&&xe&&xe.thisDep,!ze&&xe&&xe.contextDep,!ze&&xe&&xe.propDep,function(mn,ai){var Un=mn.shared.context,Yn=Ur;"width"in st||(Yn=ai.def(Un,".",qc,"-",Vt));var Qn=_n;return"height"in st||(Qn=ai.def(Un,".",Ac,"-",Qt)),[Vt,Qt,Yn,Qn]})}else if(Re in fr){var on=fr[Re],Rn=Su(on,function(mn,ai){var Un=mn.invoke(ai,on);J.optional(function(){mn.assert(ai,Un+"&&typeof "+Un+'==="object"',"invalid "+Re)});var Yn=mn.shared.context,Qn=ai.def(Un,".x|0"),qn=ai.def(Un,".y|0"),yi=ai.def('"width" in ',Un,"?",Un,".width|0:","(",Yn,".",qc,"-",Qn,")"),Za=ai.def('"height" in ',Un,"?",Un,".height|0:","(",Yn,".",Ac,"-",qn,")");return J.optional(function(){mn.assert(ai,yi+">=0&&"+Za+">=0","invalid "+Re)}),[Qn,qn,yi,Za]});return xe&&(Rn.thisDep=Rn.thisDep||xe.thisDep,Rn.contextDep=Rn.contextDep||xe.contextDep,Rn.propDep=Rn.propDep||xe.propDep),Rn}else return xe?new Cs(xe.thisDep,xe.contextDep,xe.propDep,function(mn,ai){var Un=mn.shared.context;return[0,0,ai.def(Un,".",qc),ai.def(Un,".",Ac)]}):null}var mt=gt(Es);if(mt){var ot=mt;mt=new Cs(mt.thisDep,mt.contextDep,mt.propDep,function(Re,st){var ze=ot.append(Re,st),Vt=Re.shared.context;return st.set(Vt,"."+up,ze[2]),st.set(Vt,"."+Df,ze[3]),ze})}return{viewport:mt,scissor_box:gt(bu)}}function Ui(Fe,xe){var tt=Fe.static,Ut=typeof tt[Vl]=="string"&&typeof tt[fl]=="string";if(Ut){if(Object.keys(xe.dynamic).length>0)return null;var fr=xe.static,gt=Object.keys(fr);if(gt.length>0&&typeof fr[gt[0]]=="number"){for(var mt=[],ot=0;ot<gt.length;++ot)J(typeof fr[gt[ot]]=="number","must specify all vertex attribute locations when using vaos"),mt.push([fr[gt[ot]]|0,gt[ot]]);return mt}}return null}function ma(Fe,xe,tt){var Ut=Fe.static,fr=Fe.dynamic;function gt(ze){if(ze in Ut){var Vt=Ie.id(Ut[ze]);J.optional(function(){tn.shader(yh[ze],Vt,J.guessCommand())});var Qt=hs(function(){return Vt});return Qt.id=Vt,Qt}else if(ze in fr){var Ur=fr[ze];return Su(Ur,function(_n,on){var Rn=_n.invoke(on,Ur),mn=on.def(_n.shared.strings,".id(",Rn,")");return J.optional(function(){on(_n.shared.shader,".shader(",yh[ze],",",mn,",",_n.command,");")}),mn})}return null}var mt=gt(Vl),ot=gt(fl),Re=null,st;return Xo(mt)&&Xo(ot)?(Re=tn.program(ot.id,mt.id,null,tt),st=hs(function(ze,Vt){return ze.link(Re)})):st=new Cs(mt&&mt.thisDep||ot&&ot.thisDep,mt&&mt.contextDep||ot&&ot.contextDep,mt&&mt.propDep||ot&&ot.propDep,function(ze,Vt){var Qt=ze.shared.shader,Ur;mt?Ur=mt.append(ze,Vt):Ur=Vt.def(Qt,".",Vl);var _n;ot?_n=ot.append(ze,Vt):_n=Vt.def(Qt,".",fl);var on=Qt+".program("+_n+","+Ur;return J.optional(function(){on+=","+ze.command}),Vt.def(on+")")}),{frag:mt,vert:ot,progVar:st,program:Re}}function Zo(Fe,xe){var tt=Fe.static,Ut=Fe.dynamic,fr={},gt=!1;function mt(){if(vf in tt){var ai=tt[vf];return ai!==null&&en.getVAO(ai)===null&&(ai=en.createVAO(ai)),gt=!0,fr.vao=ai,hs(function(Yn){var Qn=en.getVAO(ai);return Qn?Yn.link(Qn):"null"})}else if(vf in Ut){gt=!0;var Un=Ut[vf];return Su(Un,function(Yn,Qn){var qn=Yn.invoke(Qn,Un);return Qn.def(Yn.shared.vao+".getVAO("+qn+")")})}return null}var ot=mt(),Re=!1;function st(){if(oc in tt){var ai=tt[oc];if(fr.elements=ai,Sf(ai)){var Un=fr.elements=lr.create(ai,!0);ai=lr.getElements(Un),Re=!0}else ai&&(ai=lr.getElements(ai),Re=!0,J.command(ai,"invalid elements",xe.commandStr));var Yn=hs(function(qn,yi){if(ai){var Za=qn.link(ai);return qn.ELEMENTS=Za,Za}return qn.ELEMENTS=null,null});return Yn.value=ai,Yn}else if(oc in Ut){Re=!0;var Qn=Ut[oc];return Su(Qn,function(qn,yi){var Za=qn.shared,No=Za.isBufferArgs,Yl=Za.elements,Ha=qn.invoke(yi,Qn),ba=yi.def("null"),nu=yi.def(No,"(",Ha,")"),Rl=qn.cond(nu).then(ba,"=",Yl,".createStream(",Ha,");").else(ba,"=",Yl,".getElements(",Ha,");");return J.optional(function(){qn.assert(Rl.else,"!"+Ha+"||"+ba,"invalid elements")}),yi.entry(Rl),yi.exit(qn.cond(nu).then(Yl,".destroyStream(",ba,");")),qn.ELEMENTS=ba,ba})}else if(gt)return new Cs(ot.thisDep,ot.contextDep,ot.propDep,function(qn,yi){return yi.def(qn.shared.vao+".currentVAO?"+qn.shared.elements+".getElements("+qn.shared.vao+".currentVAO.elements):null")});return null}var ze=st();function Vt(){if(Xu in tt){var ai=tt[Xu];return fr.primitive=ai,J.commandParameter(ai,Fr,"invalid primitve",xe.commandStr),hs(function(Yn,Qn){return Fr[ai]})}else if(Xu in Ut){var Un=Ut[Xu];return Su(Un,function(Yn,Qn){var qn=Yn.constants.primTypes,yi=Yn.invoke(Qn,Un);return J.optional(function(){Yn.assert(Qn,yi+" in "+qn,"invalid primitive, must be one of "+Object.keys(Fr))}),Qn.def(qn,"[",yi,"]")})}else{if(Re)return Xo(ze)?ze.value?hs(function(Yn,Qn){return Qn.def(Yn.ELEMENTS,".primType")}):hs(function(){return Zf}):new Cs(ze.thisDep,ze.contextDep,ze.propDep,function(Yn,Qn){var qn=Yn.ELEMENTS;return Qn.def(qn,"?",qn,".primType:",Zf)});if(gt)return new Cs(ot.thisDep,ot.contextDep,ot.propDep,function(Yn,Qn){return Qn.def(Yn.shared.vao+".currentVAO?"+Yn.shared.vao+".currentVAO.primitive:"+Zf)})}return null}function Qt(ai,Un){if(ai in tt){var Yn=tt[ai]|0;return Un?fr.offset=Yn:fr.instances=Yn,J.command(!Un||Yn>=0,"invalid "+ai,xe.commandStr),hs(function(qn,yi){return Un&&(qn.OFFSET=Yn),Yn})}else if(ai in Ut){var Qn=Ut[ai];return Su(Qn,function(qn,yi){var Za=qn.invoke(yi,Qn);return Un&&(qn.OFFSET=Za,J.optional(function(){qn.assert(yi,Za+">=0","invalid "+ai)})),Za})}else if(Un){if(Re)return hs(function(qn,yi){return qn.OFFSET=0,0});if(gt)return new Cs(ot.thisDep,ot.contextDep,ot.propDep,function(qn,yi){return yi.def(qn.shared.vao+".currentVAO?"+qn.shared.vao+".currentVAO.offset:0")})}else if(gt)return new Cs(ot.thisDep,ot.contextDep,ot.propDep,function(qn,yi){return yi.def(qn.shared.vao+".currentVAO?"+qn.shared.vao+".currentVAO.instances:-1")});return null}var Ur=Qt(Rf,!0);function _n(){if(fs in tt){var ai=tt[fs]|0;return fr.count=ai,J.command(typeof ai=="number"&&ai>=0,"invalid vertex count",xe.commandStr),hs(function(){return ai})}else if(fs in Ut){var Un=Ut[fs];return Su(Un,function(yi,Za){var No=yi.invoke(Za,Un);return J.optional(function(){yi.assert(Za,"typeof "+No+'==="number"&&'+No+">=0&&"+No+"===("+No+"|0)","invalid vertex count")}),No})}else if(Re)if(Xo(ze)){if(ze)return Ur?new Cs(Ur.thisDep,Ur.contextDep,Ur.propDep,function(yi,Za){var No=Za.def(yi.ELEMENTS,".vertCount-",yi.OFFSET);return J.optional(function(){yi.assert(Za,No+">=0","invalid vertex offset/element buffer too small")}),No}):hs(function(yi,Za){return Za.def(yi.ELEMENTS,".vertCount")});var Yn=hs(function(){return-1});return J.optional(function(){Yn.MISSING=!0}),Yn}else{var Qn=new Cs(ze.thisDep||Ur.thisDep,ze.contextDep||Ur.contextDep,ze.propDep||Ur.propDep,function(yi,Za){var No=yi.ELEMENTS;return yi.OFFSET?Za.def(No,"?",No,".vertCount-",yi.OFFSET,":-1"):Za.def(No,"?",No,".vertCount:-1")});return J.optional(function(){Qn.DYNAMIC=!0}),Qn}else if(gt){var qn=new Cs(ot.thisDep,ot.contextDep,ot.propDep,function(yi,Za){return Za.def(yi.shared.vao,".currentVAO?",yi.shared.vao,".currentVAO.count:-1")});return qn}return null}var on=Vt(),Rn=_n(),mn=Qt(df,!1);return{elements:ze,primitive:on,count:Rn,instances:mn,offset:Ur,vao:ot,vaoActive:gt,elementsActive:Re,static:fr}}function bo(Fe,xe){var tt=Fe.static,Ut=Fe.dynamic,fr={};return pi.forEach(function(gt){var mt=ri(gt);function ot(Re,st){if(gt in tt){var ze=Re(tt[gt]);fr[mt]=hs(function(){return ze})}else if(gt in Ut){var Vt=Ut[gt];fr[mt]=Su(Vt,function(Qt,Ur){return st(Qt,Ur,Qt.invoke(Ur,Vt))})}}switch(gt){case aa:case Rt:case ft:case vo:case Nn:case ac:case Ga:case ca:case da:case Li:return ot(function(Re){return J.commandType(Re,"boolean",gt,xe.commandStr),Re},function(Re,st,ze){return J.optional(function(){Re.assert(st,"typeof "+ze+'==="boolean"',"invalid flag "+gt,Re.commandStr)}),ze});case ni:return ot(function(Re){return J.commandParameter(Re,Wl,"invalid "+gt,xe.commandStr),Wl[Re]},function(Re,st,ze){var Vt=Re.constants.compareFuncs;return J.optional(function(){Re.assert(st,ze+" in "+Vt,"invalid "+gt+", must be one of "+Object.keys(Wl))}),st.def(Vt,"[",ze,"]")});case li:return ot(function(Re){return J.command(La(Re)&&Re.length===2&&typeof Re[0]=="number"&&typeof Re[1]=="number"&&Re[0]<=Re[1],"depth range is 2d array",xe.commandStr),Re},function(Re,st,ze){J.optional(function(){Re.assert(st,Re.shared.isArrayLike+"("+ze+")&&"+ze+".length===2&&typeof "+ze+'[0]==="number"&&typeof '+ze+'[1]==="number"&&'+ze+"[0]<="+ze+"[1]","depth range must be a 2d array")});var Vt=st.def("+",ze,"[0]"),Qt=st.def("+",ze,"[1]");return[Vt,Qt]});case Kr:return ot(function(Re){J.commandType(Re,"object","blend.func",xe.commandStr);var st="srcRGB"in Re?Re.srcRGB:Re.src,ze="srcAlpha"in Re?Re.srcAlpha:Re.src,Vt="dstRGB"in Re?Re.dstRGB:Re.dst,Qt="dstAlpha"in Re?Re.dstAlpha:Re.dst;return J.commandParameter(st,Hl,mt+".srcRGB",xe.commandStr),J.commandParameter(ze,Hl,mt+".srcAlpha",xe.commandStr),J.commandParameter(Vt,Hl,mt+".dstRGB",xe.commandStr),J.commandParameter(Qt,Hl,mt+".dstAlpha",xe.commandStr),J.command(mh.indexOf(st+", "+Vt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+st+", "+Vt+")",xe.commandStr),[Hl[st],Hl[Vt],Hl[ze],Hl[Qt]]},function(Re,st,ze){var Vt=Re.constants.blendFuncs;J.optional(function(){Re.assert(st,ze+"&&typeof "+ze+'==="object"',"invalid blend func, must be an object")});function Qt(Un,Yn){var Qn=st.def('"',Un,Yn,'" in ',ze,"?",ze,".",Un,Yn,":",ze,".",Un);return J.optional(function(){Re.assert(st,Qn+" in "+Vt,"invalid "+gt+"."+Un+Yn+", must be one of "+Object.keys(Hl))}),Qn}var Ur=Qt("src","RGB"),_n=Qt("dst","RGB");J.optional(function(){var Un=Re.constants.invalidBlendCombinations;Re.assert(st,Un+".indexOf("+Ur+'+", "+'+_n+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var on=st.def(Vt,"[",Ur,"]"),Rn=st.def(Vt,"[",Qt("src","Alpha"),"]"),mn=st.def(Vt,"[",_n,"]"),ai=st.def(Vt,"[",Qt("dst","Alpha"),"]");return[on,mn,Rn,ai]});case cr:return ot(function(Re){if(typeof Re=="string")return J.commandParameter(Re,gr,"invalid "+gt,xe.commandStr),[gr[Re],gr[Re]];if(typeof Re=="object")return J.commandParameter(Re.rgb,gr,gt+".rgb",xe.commandStr),J.commandParameter(Re.alpha,gr,gt+".alpha",xe.commandStr),[gr[Re.rgb],gr[Re.alpha]];J.commandRaise("invalid blend.equation",xe.commandStr)},function(Re,st,ze){var Vt=Re.constants.blendEquations,Qt=st.def(),Ur=st.def(),_n=Re.cond("typeof ",ze,'==="string"');return J.optional(function(){function on(Rn,mn,ai){Re.assert(Rn,ai+" in "+Vt,"invalid "+mn+", must be one of "+Object.keys(gr))}on(_n.then,gt,ze),Re.assert(_n.else,ze+"&&typeof "+ze+'==="object"',"invalid "+gt),on(_n.else,gt+".rgb",ze+".rgb"),on(_n.else,gt+".alpha",ze+".alpha")}),_n.then(Qt,"=",Ur,"=",Vt,"[",ze,"];"),_n.else(Qt,"=",Vt,"[",ze,".rgb];",Ur,"=",Vt,"[",ze,".alpha];"),st(_n),[Qt,Ur]});case Tt:return ot(function(Re){return J.command(La(Re)&&Re.length===4,"blend.color must be a 4d array",xe.commandStr),pe(4,function(st){return+Re[st]})},function(Re,st,ze){return J.optional(function(){Re.assert(st,Re.shared.isArrayLike+"("+ze+")&&"+ze+".length===4","blend.color must be a 4d array")}),pe(4,function(Vt){return st.def("+",ze,"[",Vt,"]")})});case Fi:return ot(function(Re){return J.commandType(Re,"number",mt,xe.commandStr),Re|0},function(Re,st,ze){return J.optional(function(){Re.assert(st,"typeof "+ze+'==="number"',"invalid stencil.mask")}),st.def(ze,"|0")});case Ia:return ot(function(Re){J.commandType(Re,"object",mt,xe.commandStr);var st=Re.cmp||"keep",ze=Re.ref||0,Vt="mask"in Re?Re.mask:-1;return J.commandParameter(st,Wl,gt+".cmp",xe.commandStr),J.commandType(ze,"number",gt+".ref",xe.commandStr),J.commandType(Vt,"number",gt+".mask",xe.commandStr),[Wl[st],ze,Vt]},function(Re,st,ze){var Vt=Re.constants.compareFuncs;J.optional(function(){function on(){Re.assert(st,Array.prototype.join.call(arguments,""),"invalid stencil.func")}on(ze+"&&typeof ",ze,'==="object"'),on('!("cmp" in ',ze,")||(",ze,".cmp in ",Vt,")")});var Qt=st.def('"cmp" in ',ze,"?",Vt,"[",ze,".cmp]",":",lc),Ur=st.def(ze,".ref|0"),_n=st.def('"mask" in ',ze,"?",ze,".mask|0:-1");return[Qt,Ur,_n]});case Ka:case Oo:return ot(function(Re){J.commandType(Re,"object",mt,xe.commandStr);var st=Re.fail||"keep",ze=Re.zfail||"keep",Vt=Re.zpass||"keep";return J.commandParameter(st,cc,gt+".fail",xe.commandStr),J.commandParameter(ze,cc,gt+".zfail",xe.commandStr),J.commandParameter(Vt,cc,gt+".zpass",xe.commandStr),[gt===Oo?hl:sf,cc[st],cc[ze],cc[Vt]]},function(Re,st,ze){var Vt=Re.constants.stencilOps;J.optional(function(){Re.assert(st,ze+"&&typeof "+ze+'==="object"',"invalid "+gt)});function Qt(Ur){return J.optional(function(){Re.assert(st,'!("'+Ur+'" in '+ze+")||("+ze+"."+Ur+" in "+Vt+")","invalid "+gt+"."+Ur+", must be one of "+Object.keys(cc))}),st.def('"',Ur,'" in ',ze,"?",Vt,"[",ze,".",Ur,"]:",lc)}return[gt===Oo?hl:sf,Qt("fail"),Qt("zfail"),Qt("zpass")]});case to:return ot(function(Re){J.commandType(Re,"object",mt,xe.commandStr);var st=Re.factor|0,ze=Re.units|0;return J.commandType(st,"number",mt+".factor",xe.commandStr),J.commandType(ze,"number",mt+".units",xe.commandStr),[st,ze]},function(Re,st,ze){J.optional(function(){Re.assert(st,ze+"&&typeof "+ze+'==="object"',"invalid "+gt)});var Vt=st.def(ze,".factor|0"),Qt=st.def(ze,".units|0");return[Vt,Qt]});case xa:return ot(function(Re){var st=0;return Re==="front"?st=sf:Re==="back"&&(st=hl),J.command(!!st,mt,xe.commandStr),st},function(Re,st,ze){return J.optional(function(){Re.assert(st,ze+'==="front"||'+ze+'==="back"',"invalid cull.face")}),st.def(ze,'==="front"?',sf,":",hl)});case Va:return ot(function(Re){return J.command(typeof Re=="number"&&Re>=pr.lineWidthDims[0]&&Re<=pr.lineWidthDims[1],"invalid line width, must be a positive number between "+pr.lineWidthDims[0]+" and "+pr.lineWidthDims[1],xe.commandStr),Re},function(Re,st,ze){return J.optional(function(){Re.assert(st,"typeof "+ze+'==="number"&&'+ze+">="+pr.lineWidthDims[0]+"&&"+ze+"<="+pr.lineWidthDims[1],"invalid line width")}),ze});case Ca:return ot(function(Re){return J.commandParameter(Re,Vf,mt,xe.commandStr),Vf[Re]},function(Re,st,ze){return J.optional(function(){Re.assert(st,ze+'==="cw"||'+ze+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),st.def(ze+'==="cw"?'+kh+":"+Uf)});case Mi:return ot(function(Re){return J.command(La(Re)&&Re.length===4,"color.mask must be length 4 array",xe.commandStr),Re.map(function(st){return!!st})},function(Re,st,ze){return J.optional(function(){Re.assert(st,Re.shared.isArrayLike+"("+ze+")&&"+ze+".length===4","invalid color.mask")}),pe(4,function(Vt){return"!!"+ze+"["+Vt+"]"})});case va:return ot(function(Re){J.command(typeof Re=="object"&&Re,mt,xe.commandStr);var st="value"in Re?Re.value:1,ze=!!Re.invert;return J.command(typeof st=="number"&&st>=0&&st<=1,"sample.coverage.value must be a number between 0 and 1",xe.commandStr),[st,ze]},function(Re,st,ze){J.optional(function(){Re.assert(st,ze+"&&typeof "+ze+'==="object"',"invalid sample.coverage")});var Vt=st.def('"value" in ',ze,"?+",ze,".value:1"),Qt=st.def("!!",ze,".invert");return[Vt,Qt]})}}),fr}function sa(Fe,xe){var tt=Fe.static,Ut=Fe.dynamic,fr={};return Object.keys(tt).forEach(function(gt){var mt=tt[gt],ot;if(typeof mt=="number"||typeof mt=="boolean")ot=hs(function(){return mt});else if(typeof mt=="function"){var Re=mt._reglType;Re==="texture2d"||Re==="textureCube"?ot=hs(function(st){return st.link(mt)}):Re==="framebuffer"||Re==="framebufferCube"?(J.command(mt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+gt+'"',xe.commandStr),ot=hs(function(st){return st.link(mt.color[0])})):J.commandRaise('invalid data for uniform "'+gt+'"',xe.commandStr)}else La(mt)?ot=hs(function(st){var ze=st.global.def("[",pe(mt.length,function(Vt){return J.command(typeof mt[Vt]=="number"||typeof mt[Vt]=="boolean","invalid uniform "+gt,st.commandStr),mt[Vt]}),"]");return ze}):J.commandRaise('invalid or missing data for uniform "'+gt+'"',xe.commandStr);ot.value=mt,fr[gt]=ot}),Object.keys(Ut).forEach(function(gt){var mt=Ut[gt];fr[gt]=Su(mt,function(ot,Re){return ot.invoke(Re,mt)})}),fr}function ps(Fe,xe){var tt=Fe.static,Ut=Fe.dynamic,fr={};return Object.keys(tt).forEach(function(gt){var mt=tt[gt],ot=Ie.id(gt),Re=new zt;if(Sf(mt))Re.state=mi,Re.buffer=Br.getBuffer(Br.create(mt,tf,!1,!0)),Re.type=0;else{var st=Br.getBuffer(mt);if(st)Re.state=mi,Re.buffer=st,Re.type=0;else if(J.command(typeof mt=="object"&&mt,"invalid data for attribute "+gt,xe.commandStr),"constant"in mt){var ze=mt.constant;Re.buffer="null",Re.state=Ci,typeof ze=="number"?Re.x=ze:(J.command(La(ze)&&ze.length>0&&ze.length<=4,"invalid constant for attribute "+gt,xe.commandStr),bi.forEach(function(mn,ai){ai<ze.length&&(Re[mn]=ze[ai])}))}else{Sf(mt.buffer)?st=Br.getBuffer(Br.create(mt.buffer,tf,!1,!0)):st=Br.getBuffer(mt.buffer),J.command(!!st,'missing buffer for attribute "'+gt+'"',xe.commandStr);var Vt=mt.offset|0;J.command(Vt>=0,'invalid offset for attribute "'+gt+'"',xe.commandStr);var Qt=mt.stride|0;J.command(Qt>=0&&Qt<256,'invalid stride for attribute "'+gt+'", must be integer betweeen [0, 255]',xe.commandStr);var Ur=mt.size|0;J.command(!("size"in mt)||Ur>0&&Ur<=4,'invalid size for attribute "'+gt+'", must be 1,2,3,4',xe.commandStr);var _n=!!mt.normalized,on=0;"type"in mt&&(J.commandParameter(mt.type,Ys,"invalid type for attribute "+gt,xe.commandStr),on=Ys[mt.type]);var Rn=mt.divisor|0;J.optional(function(){"divisor"in mt&&(J.command(Rn===0||Jr,'cannot specify divisor for attribute "'+gt+'", instancing not supported',xe.commandStr),J.command(Rn>=0,'invalid divisor for attribute "'+gt+'"',xe.commandStr));var mn=xe.commandStr,ai=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(mt).forEach(function(Un){J.command(ai.indexOf(Un)>=0,'unknown parameter "'+Un+'" for attribute pointer "'+gt+'" (valid parameters are '+ai+")",mn)})}),Re.buffer=st,Re.state=mi,Re.size=Ur,Re.normalized=_n,Re.type=on||st.dtype,Re.offset=Vt,Re.stride=Qt,Re.divisor=Rn}}fr[gt]=hs(function(mn,ai){var Un=mn.attribCache;if(ot in Un)return Un[ot];var Yn={isStream:!1};return Object.keys(Re).forEach(function(Qn){Yn[Qn]=Re[Qn]}),Re.buffer&&(Yn.buffer=mn.link(Re.buffer),Yn.type=Yn.type||Yn.buffer+".dtype"),Un[ot]=Yn,Yn})}),Object.keys(Ut).forEach(function(gt){var mt=Ut[gt];function ot(Re,st){var ze=Re.invoke(st,mt),Vt=Re.shared,Qt=Re.constants,Ur=Vt.isBufferArgs,_n=Vt.buffer;J.optional(function(){Re.assert(st,ze+"&&(typeof "+ze+'==="object"||typeof '+ze+'==="function")&&('+Ur+"("+ze+")||"+_n+".getBuffer("+ze+")||"+_n+".getBuffer("+ze+".buffer)||"+Ur+"("+ze+'.buffer)||("constant" in '+ze+"&&(typeof "+ze+'.constant==="number"||'+Vt.isArrayLike+"("+ze+".constant))))",'invalid dynamic attribute "'+gt+'"')});var on={isStream:st.def(!1)},Rn=new zt;Rn.state=mi,Object.keys(Rn).forEach(function(Yn){on[Yn]=st.def(""+Rn[Yn])});var mn=on.buffer,ai=on.type;st("if(",Ur,"(",ze,")){",on.isStream,"=true;",mn,"=",_n,".createStream(",tf,",",ze,");",ai,"=",mn,".dtype;","}else{",mn,"=",_n,".getBuffer(",ze,");","if(",mn,"){",ai,"=",mn,".dtype;",'}else if("constant" in ',ze,"){",on.state,"=",Ci,";","if(typeof "+ze+'.constant === "number"){',on[bi[0]],"=",ze,".constant;",bi.slice(1).map(function(Yn){return on[Yn]}).join("="),"=0;","}else{",bi.map(function(Yn,Qn){return on[Yn]+"="+ze+".constant.length>"+Qn+"?"+ze+".constant["+Qn+"]:0;"}).join(""),"}}else{","if(",Ur,"(",ze,".buffer)){",mn,"=",_n,".createStream(",tf,",",ze,".buffer);","}else{",mn,"=",_n,".getBuffer(",ze,".buffer);","}",ai,'="type" in ',ze,"?",Qt.glTypes,"[",ze,".type]:",mn,".dtype;",on.normalized,"=!!",ze,".normalized;");function Un(Yn){st(on[Yn],"=",ze,".",Yn,"|0;")}return Un("size"),Un("offset"),Un("stride"),Un("divisor"),st("}}"),st.exit("if(",on.isStream,"){",_n,".destroyStream(",mn,");","}"),on}fr[gt]=Su(mt,ot)}),fr}function fo(Fe){var xe=Fe.static,tt=Fe.dynamic,Ut={};return Object.keys(xe).forEach(function(fr){var gt=xe[fr];Ut[fr]=hs(function(mt,ot){return typeof gt=="number"||typeof gt=="boolean"?""+gt:mt.link(gt)})}),Object.keys(tt).forEach(function(fr){var gt=tt[fr];Ut[fr]=Su(gt,function(mt,ot){return mt.invoke(ot,gt)})}),Ut}function Yo(Fe,xe,tt,Ut,fr){var gt=Fe.static,mt=Fe.dynamic;J.optional(function(){var Un=[Wu,fl,Vl,oc,Xu,Rf,fs,df,Ou,vf].concat(pi);function Yn(Qn){Object.keys(Qn).forEach(function(qn){J.command(Un.indexOf(qn)>=0,'unknown parameter "'+qn+'"',fr.commandStr)})}Yn(gt),Yn(mt)});var ot=Ui(Fe,xe),Re=An(Fe,fr),st=Ti(Fe,Re,fr),ze=Zo(Fe,fr),Vt=bo(Fe,fr),Qt=ma(Fe,fr,ot);function Ur(Un){var Yn=st[Un];Yn&&(Vt[Un]=Yn)}Ur(Es),Ur(ri(bu));var _n=Object.keys(Vt).length>0,on={framebuffer:Re,draw:ze,shader:Qt,state:Vt,dirty:_n,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(on.profile=kn(Fe,fr),on.uniforms=sa(tt,fr),on.drawVAO=on.scopeVAO=ze.vao,!on.drawVAO&&Qt.program&&!ot&&qe.angle_instanced_arrays&&ze.static.elements){var Rn=!0,mn=Qt.program.attributes.map(function(Un){var Yn=xe.static[Un];return Rn=Rn&&!!Yn,Yn});if(Rn&&mn.length>0){var ai=en.getVAO(en.createVAO({attributes:mn,elements:ze.static.elements}));on.drawVAO=new Cs(null,null,null,function(Un,Yn){return Un.link(ai)}),on.useVAO=!0}}return ot?on.useVAO=!0:on.attributes=ps(xe,fr),on.context=fo(Ut,fr),on}function Uo(Fe,xe,tt){var Ut=Fe.shared,fr=Ut.context,gt=Fe.scope();Object.keys(tt).forEach(function(mt){xe.save(fr,"."+mt);var ot=tt[mt],Re=ot.append(Fe,xe);Array.isArray(Re)?gt(fr,".",mt,"=[",Re.join(),"];"):gt(fr,".",mt,"=",Re,";")}),xe(gt)}function Ls(Fe,xe,tt,Ut){var fr=Fe.shared,gt=fr.gl,mt=fr.framebuffer,ot;Dn&&(ot=xe.def(fr.extensions,".webgl_draw_buffers"));var Re=Fe.constants,st=Re.drawBuffer,ze=Re.backBuffer,Vt;tt?Vt=tt.append(Fe,xe):Vt=xe.def(mt,".next"),Ut||xe("if(",Vt,"!==",mt,".cur){"),xe("if(",Vt,"){",gt,".bindFramebuffer(",pl,",",Vt,".framebuffer);"),Dn&&xe(ot,".drawBuffersWEBGL(",st,"[",Vt,".colorAttachments.length]);"),xe("}else{",gt,".bindFramebuffer(",pl,",null);"),Dn&&xe(ot,".drawBuffersWEBGL(",ze,");"),xe("}",mt,".cur=",Vt,";"),Ut||xe("}")}function zs(Fe,xe,tt){var Ut=Fe.shared,fr=Ut.gl,gt=Fe.current,mt=Fe.next,ot=Ut.current,Re=Ut.next,st=Fe.cond(ot,".dirty");pi.forEach(function(ze){var Vt=ri(ze);if(!(Vt in tt.state)){var Qt,Ur;if(Vt in mt){Qt=mt[Vt],Ur=gt[Vt];var _n=pe(Pn[Vt].length,function(Rn){return st.def(Qt,"[",Rn,"]")});st(Fe.cond(_n.map(function(Rn,mn){return Rn+"!=="+Ur+"["+mn+"]"}).join("||")).then(fr,".",Ar[Vt],"(",_n,");",_n.map(function(Rn,mn){return Ur+"["+mn+"]="+Rn}).join(";"),";"))}else{Qt=st.def(Re,".",Vt);var on=Fe.cond(Qt,"!==",ot,".",Vt);st(on),Vt in kr?on(Fe.cond(Qt).then(fr,".enable(",kr[Vt],");").else(fr,".disable(",kr[Vt],");"),ot,".",Vt,"=",Qt,";"):on(fr,".",Ar[Vt],"(",Qt,");",ot,".",Vt,"=",Qt,";")}}}),Object.keys(tt.state).length===0&&st(ot,".dirty=false;"),xe(st)}function ws(Fe,xe,tt,Ut){var fr=Fe.shared,gt=Fe.current,mt=fr.current,ot=fr.gl;gh(Object.keys(tt)).forEach(function(Re){var st=tt[Re];if(!(Ut&&!Ut(st))){var ze=st.append(Fe,xe);if(kr[Re]){var Vt=kr[Re];Xo(st)?ze?xe(ot,".enable(",Vt,");"):xe(ot,".disable(",Vt,");"):xe(Fe.cond(ze).then(ot,".enable(",Vt,");").else(ot,".disable(",Vt,");")),xe(mt,".",Re,"=",ze,";")}else if(La(ze)){var Qt=gt[Re];xe(ot,".",Ar[Re],"(",ze,");",ze.map(function(Ur,_n){return Qt+"["+_n+"]="+Ur}).join(";"),";")}else xe(ot,".",Ar[Re],"(",ze,");",mt,".",Re,"=",ze,";")}})}function Ko(Fe,xe){Jr&&(Fe.instancing=xe.def(Fe.shared.extensions,".angle_instanced_arrays"))}function wi(Fe,xe,tt,Ut,fr){var gt=Fe.shared,mt=Fe.stats,ot=gt.current,Re=gt.timer,st=tt.profile;function ze(){var Un=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return Un||typeof performance=="undefined"?"Date.now()":"performance.now()"}var Vt,Qt;function Ur(Un){Vt=xe.def(),Un(Vt,"=",ze(),";"),typeof fr=="string"?Un(mt,".count+=",fr,";"):Un(mt,".count++;"),Yr&&(Ut?(Qt=xe.def(),Un(Qt,"=",Re,".getNumPendingQueries();")):Un(Re,".beginQuery(",mt,");"))}function _n(Un){Un(mt,".cpuTime+=",ze(),"-",Vt,";"),Yr&&(Ut?Un(Re,".pushScopeStats(",Qt,",",Re,".getNumPendingQueries(),",mt,");"):Un(Re,".endQuery();"))}function on(Un){var Yn=xe.def(ot,".profile");xe(ot,".profile=",Un,";"),xe.exit(ot,".profile=",Yn,";")}var Rn;if(st){if(Xo(st)){st.enable?(Ur(xe),_n(xe.exit),on("true")):on("false");return}Rn=st.append(Fe,xe),on(Rn)}else Rn=xe.def(ot,".profile");var mn=Fe.block();Ur(mn),xe("if(",Rn,"){",mn,"}");var ai=Fe.block();_n(ai),xe.exit("if(",Rn,"){",ai,"}")}function jo(Fe,xe,tt,Ut,fr){var gt=Fe.shared;function mt(Re){switch(Re){case mf:case nf:case af:return 2;case yf:case Nf:case zf:return 3;case Tc:case sc:case of:return 4;default:return 1}}function ot(Re,st,ze){var Vt=gt.gl,Qt=xe.def(Re,".location"),Ur=xe.def(gt.attributes,"[",Qt,"]"),_n=ze.state,on=ze.buffer,Rn=[ze.x,ze.y,ze.z,ze.w],mn=["buffer","normalized","offset","stride"];function ai(){xe("if(!",Ur,".buffer){",Vt,".enableVertexAttribArray(",Qt,");}");var Yn=ze.type,Qn;if(ze.size?Qn=xe.def(ze.size,"||",st):Qn=st,xe("if(",Ur,".type!==",Yn,"||",Ur,".size!==",Qn,"||",mn.map(function(yi){return Ur+"."+yi+"!=="+ze[yi]}).join("||"),"){",Vt,".bindBuffer(",tf,",",on,".buffer);",Vt,".vertexAttribPointer(",[Qt,Qn,Yn,ze.normalized,ze.stride,ze.offset],");",Ur,".type=",Yn,";",Ur,".size=",Qn,";",mn.map(function(yi){return Ur+"."+yi+"="+ze[yi]+";"}).join(""),"}"),Jr){var qn=ze.divisor;xe("if(",Ur,".divisor!==",qn,"){",Fe.instancing,".vertexAttribDivisorANGLE(",[Qt,qn],");",Ur,".divisor=",qn,";}")}}function Un(){xe("if(",Ur,".buffer){",Vt,".disableVertexAttribArray(",Qt,");",Ur,".buffer=null;","}if(",bi.map(function(Yn,Qn){return Ur+"."+Yn+"!=="+Rn[Qn]}).join("||"),"){",Vt,".vertexAttrib4f(",Qt,",",Rn,");",bi.map(function(Yn,Qn){return Ur+"."+Yn+"="+Rn[Qn]+";"}).join(""),"}")}_n===mi?ai():_n===Ci?Un():(xe("if(",_n,"===",mi,"){"),ai(),xe("}else{"),Un(),xe("}"))}Ut.forEach(function(Re){var st=Re.name,ze=tt.attributes[st],Vt;if(ze){if(!fr(ze))return;Vt=ze.append(Fe,xe)}else{if(!fr(_h))return;var Qt=Fe.scopeAttrib(st);J.optional(function(){Fe.assert(xe,Qt+".state","missing attribute "+st)}),Vt={},Object.keys(new zt).forEach(function(Ur){Vt[Ur]=xe.def(Qt,".",Ur)})}ot(Fe.link(Re),mt(Re.info.type),Vt)})}function Oa(Fe,xe,tt,Ut,fr,gt){for(var mt=Fe.shared,ot=mt.gl,Re,st=0;st<Ut.length;++st){var ze=Ut[st],Vt=ze.name,Qt=ze.info.type,Ur=tt.uniforms[Vt],_n=Fe.link(ze),on=_n+".location",Rn;if(Ur){if(!fr(Ur))continue;if(Xo(Ur)){var mn=Ur.value;if(J.command(mn!==null&&typeof mn!="undefined",'missing uniform "'+Vt+'"',Fe.commandStr),Qt===_f||Qt===xf){J.command(typeof mn=="function"&&(Qt===_f&&(mn._reglType==="texture2d"||mn._reglType==="framebuffer")||Qt===xf&&(mn._reglType==="textureCube"||mn._reglType==="framebufferCube")),"invalid texture for uniform "+Vt,Fe.commandStr);var ai=Fe.link(mn._texture||mn.color[0]._texture);xe(ot,".uniform1i(",on,",",ai+".bind());"),xe.exit(ai,".unbind();")}else if(Qt===Bc||Qt===fu||Qt===uc){J.optional(function(){J.command(La(mn),"invalid matrix for uniform "+Vt,Fe.commandStr),J.command(Qt===Bc&&mn.length===4||Qt===fu&&mn.length===9||Qt===uc&&mn.length===16,"invalid length for matrix uniform "+Vt,Fe.commandStr)});var Un=Fe.global.def("new Float32Array(["+Array.prototype.slice.call(mn)+"])"),Yn=2;Qt===fu?Yn=3:Qt===uc&&(Yn=4),xe(ot,".uniformMatrix",Yn,"fv(",on,",false,",Un,");")}else{switch(Qt){case Fc:J.commandType(mn,"number","uniform "+Vt,Fe.commandStr),Re="1f";break;case mf:J.command(La(mn)&&mn.length===2,"uniform "+Vt,Fe.commandStr),Re="2f";break;case yf:J.command(La(mn)&&mn.length===3,"uniform "+Vt,Fe.commandStr),Re="3f";break;case Tc:J.command(La(mn)&&mn.length===4,"uniform "+Vt,Fe.commandStr),Re="4f";break;case dh:J.commandType(mn,"boolean","uniform "+Vt,Fe.commandStr),Re="1i";break;case gf:J.commandType(mn,"number","uniform "+Vt,Fe.commandStr),Re="1i";break;case af:J.command(La(mn)&&mn.length===2,"uniform "+Vt,Fe.commandStr),Re="2i";break;case nf:J.command(La(mn)&&mn.length===2,"uniform "+Vt,Fe.commandStr),Re="2i";break;case zf:J.command(La(mn)&&mn.length===3,"uniform "+Vt,Fe.commandStr),Re="3i";break;case Nf:J.command(La(mn)&&mn.length===3,"uniform "+Vt,Fe.commandStr),Re="3i";break;case of:J.command(La(mn)&&mn.length===4,"uniform "+Vt,Fe.commandStr),Re="4i";break;case sc:J.command(La(mn)&&mn.length===4,"uniform "+Vt,Fe.commandStr),Re="4i";break}xe(ot,".uniform",Re,"(",on,",",La(mn)?Array.prototype.slice.call(mn):mn,");")}continue}else Rn=Ur.append(Fe,xe)}else{if(!fr(_h))continue;Rn=xe.def(mt.uniforms,"[",Ie.id(Vt),"]")}Qt===_f?(J(!Array.isArray(Rn),"must specify a scalar prop for textures"),xe("if(",Rn,"&&",Rn,'._reglType==="framebuffer"){',Rn,"=",Rn,".color[0];","}")):Qt===xf&&(J(!Array.isArray(Rn),"must specify a scalar prop for cube maps"),xe("if(",Rn,"&&",Rn,'._reglType==="framebufferCube"){',Rn,"=",Rn,".color[0];","}")),J.optional(function(){function nu(Ku,Gf){Fe.assert(xe,Ku,'bad data or missing for uniform "'+Vt+'".  '+Gf)}function Rl(Ku){J(!Array.isArray(Rn),"must not specify an array type for uniform"),nu("typeof "+Rn+'==="'+Ku+'"',"invalid type, expected "+Ku)}function Yu(Ku,Gf){Array.isArray(Rn)?J(Rn.length===Ku,"must have length "+Ku):nu(mt.isArrayLike+"("+Rn+")&&"+Rn+".length==="+Ku,"invalid vector, should have length "+Ku,Fe.commandStr)}function bh(Ku){J(!Array.isArray(Rn),"must not specify a value type"),nu("typeof "+Rn+'==="function"&&'+Rn+'._reglType==="texture'+(Ku===Rh?"2d":"Cube")+'"',"invalid texture type",Fe.commandStr)}switch(Qt){case gf:Rl("number");break;case nf:Yu(2,"number");break;case Nf:Yu(3,"number");break;case sc:Yu(4,"number");break;case Fc:Rl("number");break;case mf:Yu(2,"number");break;case yf:Yu(3,"number");break;case Tc:Yu(4,"number");break;case dh:Rl("boolean");break;case af:Yu(2,"boolean");break;case zf:Yu(3,"boolean");break;case of:Yu(4,"boolean");break;case Bc:Yu(4,"number");break;case fu:Yu(9,"number");break;case uc:Yu(16,"number");break;case _f:bh(Rh);break;case xf:bh(hp);break}});var Qn=1;switch(Qt){case _f:case xf:var qn=xe.def(Rn,"._texture");xe(ot,".uniform1i(",on,",",qn,".bind());"),xe.exit(qn,".unbind();");continue;case gf:case dh:Re="1i";break;case nf:case af:Re="2i",Qn=2;break;case Nf:case zf:Re="3i",Qn=3;break;case sc:case of:Re="4i",Qn=4;break;case Fc:Re="1f";break;case mf:Re="2f",Qn=2;break;case yf:Re="3f",Qn=3;break;case Tc:Re="4f",Qn=4;break;case Bc:Re="Matrix2fv";break;case fu:Re="Matrix3fv";break;case uc:Re="Matrix4fv";break}if(Re.charAt(0)==="M"){xe(ot,".uniform",Re,"(",on,",");var yi=Math.pow(Qt-Bc+2,2),Za=Fe.global.def("new Float32Array(",yi,")");Array.isArray(Rn)?xe("false,(",pe(yi,function(nu){return Za+"["+nu+"]="+Rn[nu]}),",",Za,")"):xe("false,(Array.isArray(",Rn,")||",Rn," instanceof Float32Array)?",Rn,":(",pe(yi,function(nu){return Za+"["+nu+"]="+Rn+"["+nu+"]"}),",",Za,")"),xe(");")}else if(Qn>1){for(var No=[],Yl=[],Ha=0;Ha<Qn;++Ha)Array.isArray(Rn)?Yl.push(Rn[Ha]):Yl.push(xe.def(Rn+"["+Ha+"]")),gt&&No.push(xe.def());gt&&xe("if(!",Fe.batchId,"||",No.map(function(nu,Rl){return nu+"!=="+Yl[Rl]}).join("||"),"){",No.map(function(nu,Rl){return nu+"="+Yl[Rl]+";"}).join("")),xe(ot,".uniform",Re,"(",on,",",Yl.join(","),");"),gt&&xe("}")}else{if(J(!Array.isArray(Rn),"uniform value must not be an array"),gt){var ba=xe.def();xe("if(!",Fe.batchId,"||",ba,"!==",Rn,"){",ba,"=",Rn,";")}xe(ot,".uniform",Re,"(",on,",",Rn,");"),gt&&xe("}")}}}function Lo(Fe,xe,tt,Ut){var fr=Fe.shared,gt=fr.gl,mt=fr.draw,ot=Ut.draw;function Re(){var Qn=ot.elements,qn,yi=xe;return Qn?((Qn.contextDep&&Ut.contextDynamic||Qn.propDep)&&(yi=tt),qn=Qn.append(Fe,yi),ot.elementsActive&&yi("if("+qn+")"+gt+".bindBuffer("+fh+","+qn+".buffer.buffer);")):(qn=yi.def(),yi(qn,"=",mt,".",oc,";","if(",qn,"){",gt,".bindBuffer(",fh,",",qn,".buffer.buffer);}","else if(",fr.vao,".currentVAO){",qn,"=",Fe.shared.elements+".getElements("+fr.vao,".currentVAO.elements);",Dr?"":"if("+qn+")"+gt+".bindBuffer("+fh+","+qn+".buffer.buffer);","}")),qn}function st(){var Qn=ot.count,qn,yi=xe;return Qn?((Qn.contextDep&&Ut.contextDynamic||Qn.propDep)&&(yi=tt),qn=Qn.append(Fe,yi),J.optional(function(){Qn.MISSING&&Fe.assert(xe,"false","missing vertex count"),Qn.DYNAMIC&&Fe.assert(yi,qn+">=0","missing vertex count")})):(qn=yi.def(mt,".",fs),J.optional(function(){Fe.assert(yi,qn+">=0","missing vertex count")})),qn}var ze=Re();function Vt(Qn){var qn=ot[Qn];return qn?qn.contextDep&&Ut.contextDynamic||qn.propDep?qn.append(Fe,tt):qn.append(Fe,xe):xe.def(mt,".",Qn)}var Qt=Vt(Xu),Ur=Vt(Rf),_n=st();if(typeof _n=="number"){if(_n===0)return}else tt("if(",_n,"){"),tt.exit("}");var on,Rn;Jr&&(on=Vt(df),Rn=Fe.instancing);var mn=ze+".type",ai=ot.elements&&Xo(ot.elements)&&!ot.vaoActive;function Un(){function Qn(){tt(Rn,".drawElementsInstancedANGLE(",[Qt,_n,mn,Ur+"<<(("+mn+"-"+Hi+")>>1)",on],");")}function qn(){tt(Rn,".drawArraysInstancedANGLE(",[Qt,Ur,_n,on],");")}ze&&ze!=="null"?ai?Qn():(tt("if(",ze,"){"),Qn(),tt("}else{"),qn(),tt("}")):qn()}function Yn(){function Qn(){tt(gt+".drawElements("+[Qt,_n,mn,Ur+"<<(("+mn+"-"+Hi+")>>1)"]+");")}function qn(){tt(gt+".drawArrays("+[Qt,Ur,_n]+");")}ze&&ze!=="null"?ai?Qn():(tt("if(",ze,"){"),Qn(),tt("}else{"),qn(),tt("}")):qn()}Jr&&(typeof on!="number"||on>=0)?typeof on=="string"?(tt("if(",on,">0){"),Un(),tt("}else if(",on,"<0){"),Yn(),tt("}")):Un():Yn()}function ki(Fe,xe,tt,Ut,fr){var gt=Bi(),mt=gt.proc("body",fr);return J.optional(function(){gt.commandStr=xe.commandStr,gt.command=gt.link(xe.commandStr)}),Jr&&(gt.instancing=mt.def(gt.shared.extensions,".angle_instanced_arrays")),Fe(gt,mt,tt,Ut),gt.compile().body}function fa(Fe,xe,tt,Ut){Ko(Fe,xe),tt.useVAO?tt.drawVAO?xe(Fe.shared.vao,".setVAO(",tt.drawVAO.append(Fe,xe),");"):xe(Fe.shared.vao,".setVAO(",Fe.shared.vao,".targetVAO);"):(xe(Fe.shared.vao,".setVAO(null);"),jo(Fe,xe,tt,Ut.attributes,function(){return!0})),Oa(Fe,xe,tt,Ut.uniforms,function(){return!0},!1),Lo(Fe,xe,xe,tt)}function no(Fe,xe){var tt=Fe.proc("draw",1);Ko(Fe,tt),Uo(Fe,tt,xe.context),Ls(Fe,tt,xe.framebuffer),zs(Fe,tt,xe),ws(Fe,tt,xe.state),wi(Fe,tt,xe,!1,!0);var Ut=xe.shader.progVar.append(Fe,tt);if(tt(Fe.shared.gl,".useProgram(",Ut,".program);"),xe.shader.program)fa(Fe,tt,xe,xe.shader.program);else{tt(Fe.shared.vao,".setVAO(null);");var fr=Fe.global.def("{}"),gt=tt.def(Ut,".id"),mt=tt.def(fr,"[",gt,"]");tt(Fe.cond(mt).then(mt,".call(this,a0);").else(mt,"=",fr,"[",gt,"]=",Fe.link(function(ot){return ki(fa,Fe,xe,ot,1)}),"(",Ut,");",mt,".call(this,a0);"))}Object.keys(xe.state).length>0&&tt(Fe.shared.current,".dirty=true;"),Fe.shared.vao&&tt(Fe.shared.vao,".setVAO(null);")}function So(Fe,xe,tt,Ut){Fe.batchId="a1",Ko(Fe,xe);function fr(){return!0}jo(Fe,xe,tt,Ut.attributes,fr),Oa(Fe,xe,tt,Ut.uniforms,fr,!1),Lo(Fe,xe,xe,tt)}function dl(Fe,xe,tt,Ut){Ko(Fe,xe);var fr=tt.contextDep,gt=xe.def(),mt="a0",ot="a1",Re=xe.def();Fe.shared.props=Re,Fe.batchId=gt;var st=Fe.scope(),ze=Fe.scope();xe(st.entry,"for(",gt,"=0;",gt,"<",ot,";++",gt,"){",Re,"=",mt,"[",gt,"];",ze,"}",st.exit);function Vt(mn){return mn.contextDep&&fr||mn.propDep}function Qt(mn){return!Vt(mn)}if(tt.needsContext&&Uo(Fe,ze,tt.context),tt.needsFramebuffer&&Ls(Fe,ze,tt.framebuffer),ws(Fe,ze,tt.state,Vt),tt.profile&&Vt(tt.profile)&&wi(Fe,ze,tt,!1,!0),Ut)tt.useVAO?tt.drawVAO?Vt(tt.drawVAO)?ze(Fe.shared.vao,".setVAO(",tt.drawVAO.append(Fe,ze),");"):st(Fe.shared.vao,".setVAO(",tt.drawVAO.append(Fe,st),");"):st(Fe.shared.vao,".setVAO(",Fe.shared.vao,".targetVAO);"):(st(Fe.shared.vao,".setVAO(null);"),jo(Fe,st,tt,Ut.attributes,Qt),jo(Fe,ze,tt,Ut.attributes,Vt)),Oa(Fe,st,tt,Ut.uniforms,Qt,!1),Oa(Fe,ze,tt,Ut.uniforms,Vt,!0),Lo(Fe,st,ze,tt);else{var Ur=Fe.global.def("{}"),_n=tt.shader.progVar.append(Fe,ze),on=ze.def(_n,".id"),Rn=ze.def(Ur,"[",on,"]");ze(Fe.shared.gl,".useProgram(",_n,".program);","if(!",Rn,"){",Rn,"=",Ur,"[",on,"]=",Fe.link(function(mn){return ki(So,Fe,tt,mn,2)}),"(",_n,");}",Rn,".call(this,a0[",gt,"],",gt,");")}}function Ge(Fe,xe){var tt=Fe.proc("batch",2);Fe.batchId="0",Ko(Fe,tt);var Ut=!1,fr=!0;Object.keys(xe.context).forEach(function(Ur){Ut=Ut||xe.context[Ur].propDep}),Ut||(Uo(Fe,tt,xe.context),fr=!1);var gt=xe.framebuffer,mt=!1;gt?(gt.propDep?Ut=mt=!0:gt.contextDep&&Ut&&(mt=!0),mt||Ls(Fe,tt,gt)):Ls(Fe,tt,null),xe.state.viewport&&xe.state.viewport.propDep&&(Ut=!0);function ot(Ur){return Ur.contextDep&&Ut||Ur.propDep}zs(Fe,tt,xe),ws(Fe,tt,xe.state,function(Ur){return!ot(Ur)}),(!xe.profile||!ot(xe.profile))&&wi(Fe,tt,xe,!1,"a1"),xe.contextDep=Ut,xe.needsContext=fr,xe.needsFramebuffer=mt;var Re=xe.shader.progVar;if(Re.contextDep&&Ut||Re.propDep)dl(Fe,tt,xe,null);else{var st=Re.append(Fe,tt);if(tt(Fe.shared.gl,".useProgram(",st,".program);"),xe.shader.program)dl(Fe,tt,xe,xe.shader.program);else{tt(Fe.shared.vao,".setVAO(null);");var ze=Fe.global.def("{}"),Vt=tt.def(st,".id"),Qt=tt.def(ze,"[",Vt,"]");tt(Fe.cond(Qt).then(Qt,".call(this,a0,a1);").else(Qt,"=",ze,"[",Vt,"]=",Fe.link(function(Ur){return ki(dl,Fe,xe,Ur,2)}),"(",st,");",Qt,".call(this,a0,a1);"))}}Object.keys(xe.state).length>0&&tt(Fe.shared.current,".dirty=true;"),Fe.shared.vao&&tt(Fe.shared.vao,".setVAO(null);")}function sr(Fe,xe){var tt=Fe.proc("scope",3);Fe.batchId="a2";var Ut=Fe.shared,fr=Ut.current;Uo(Fe,tt,xe.context),xe.framebuffer&&xe.framebuffer.append(Fe,tt),gh(Object.keys(xe.state)).forEach(function(mt){var ot=xe.state[mt],Re=ot.append(Fe,tt);La(Re)?Re.forEach(function(st,ze){tt.set(Fe.next[mt],"["+ze+"]",st)}):tt.set(Ut.next,"."+mt,Re)}),wi(Fe,tt,xe,!0,!0),[oc,Rf,fs,df,Xu].forEach(function(mt){var ot=xe.draw[mt];!ot||tt.set(Ut.draw,"."+mt,""+ot.append(Fe,tt))}),Object.keys(xe.uniforms).forEach(function(mt){var ot=xe.uniforms[mt].append(Fe,tt);Array.isArray(ot)&&(ot="["+ot.join()+"]"),tt.set(Ut.uniforms,"["+Ie.id(mt)+"]",ot)}),Object.keys(xe.attributes).forEach(function(mt){var ot=xe.attributes[mt].append(Fe,tt),Re=Fe.scopeAttrib(mt);Object.keys(new zt).forEach(function(st){tt.set(Re,"."+st,ot[st])})}),xe.scopeVAO&&tt.set(Ut.vao,".targetVAO",xe.scopeVAO.append(Fe,tt));function gt(mt){var ot=xe.shader[mt];ot&&tt.set(Ut.shader,"."+mt,ot.append(Fe,tt))}gt(fl),gt(Vl),Object.keys(xe.state).length>0&&(tt(fr,".dirty=true;"),tt.exit(fr,".dirty=true;")),tt("a1(",Fe.shared.context,",a0,",Fe.batchId,");")}function rr(Fe){if(!(typeof Fe!="object"||La(Fe))){for(var xe=Object.keys(Fe),tt=0;tt<xe.length;++tt)if(Xr.isDynamic(Fe[xe[tt]]))return!0;return!1}}function Xn(Fe,xe,tt){var Ut=xe.static[tt];if(!Ut||!rr(Ut))return;var fr=Fe.global,gt=Object.keys(Ut),mt=!1,ot=!1,Re=!1,st=Fe.global.def("{}");gt.forEach(function(Vt){var Qt=Ut[Vt];if(Xr.isDynamic(Qt)){typeof Qt=="function"&&(Qt=Ut[Vt]=Xr.unbox(Qt));var Ur=Su(Qt,null);mt=mt||Ur.thisDep,Re=Re||Ur.propDep,ot=ot||Ur.contextDep}else{switch(fr(st,".",Vt,"="),typeof Qt){case"number":fr(Qt);break;case"string":fr('"',Qt,'"');break;case"object":Array.isArray(Qt)&&fr("[",Qt.join(),"]");break;default:fr(Fe.link(Qt));break}fr(";")}});function ze(Vt,Qt){gt.forEach(function(Ur){var _n=Ut[Ur];if(!!Xr.isDynamic(_n)){var on=Vt.invoke(Qt,_n);Qt(st,".",Ur,"=",on,";")}})}xe.dynamic[tt]=new Xr.DynamicVariable(k,{thisDep:mt,contextDep:ot,propDep:Re,ref:st,append:ze}),delete xe.static[tt]}function ha(Fe,xe,tt,Ut,fr){var gt=Bi();gt.stats=gt.link(fr),Object.keys(xe.static).forEach(function(ot){Xn(gt,xe,ot)}),lp.forEach(function(ot){Xn(gt,Fe,ot)});var mt=Yo(Fe,xe,tt,Ut,gt);return no(gt,mt),sr(gt,mt),Ge(gt,mt),p(gt.compile(),{destroy:function(){mt.shader.program.destroy()}})}return{next:fn,current:Pn,procs:function(){var Fe=Bi(),xe=Fe.proc("poll"),tt=Fe.proc("refresh"),Ut=Fe.block();xe(Ut),tt(Ut);var fr=Fe.shared,gt=fr.gl,mt=fr.next,ot=fr.current;Ut(ot,".dirty=false;"),Ls(Fe,xe),Ls(Fe,tt,null,!0);var Re;Jr&&(Re=Fe.link(Jr)),qe.oes_vertex_array_object&&tt(Fe.link(qe.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var st=0;st<pr.maxAttributes;++st){var ze=tt.def(fr.attributes,"[",st,"]"),Vt=Fe.cond(ze,".buffer");Vt.then(gt,".enableVertexAttribArray(",st,");",gt,".bindBuffer(",tf,",",ze,".buffer.buffer);",gt,".vertexAttribPointer(",st,",",ze,".size,",ze,".type,",ze,".normalized,",ze,".stride,",ze,".offset);").else(gt,".disableVertexAttribArray(",st,");",gt,".vertexAttrib4f(",st,",",ze,".x,",ze,".y,",ze,".z,",ze,".w);",ze,".buffer=null;"),tt(Vt),Jr&&tt(Re,".vertexAttribDivisorANGLE(",st,",",ze,".divisor);")}return tt(Fe.shared.vao,".currentVAO=null;",Fe.shared.vao,".setVAO(",Fe.shared.vao,".targetVAO);"),Object.keys(kr).forEach(function(Qt){var Ur=kr[Qt],_n=Ut.def(mt,".",Qt),on=Fe.block();on("if(",_n,"){",gt,".enable(",Ur,")}else{",gt,".disable(",Ur,")}",ot,".",Qt,"=",_n,";"),tt(on),xe("if(",_n,"!==",ot,".",Qt,"){",on,"}")}),Object.keys(Ar).forEach(function(Qt){var Ur=Ar[Qt],_n=Pn[Qt],on,Rn,mn=Fe.block();if(mn(gt,".",Ur,"("),La(_n)){var ai=_n.length;on=Fe.global.def(mt,".",Qt),Rn=Fe.global.def(ot,".",Qt),mn(pe(ai,function(Un){return on+"["+Un+"]"}),");",pe(ai,function(Un){return Rn+"["+Un+"]="+on+"["+Un+"];"}).join("")),xe("if(",pe(ai,function(Un){return on+"["+Un+"]!=="+Rn+"["+Un+"]"}).join("||"),"){",mn,"}")}else on=Ut.def(mt,".",Qt),Rn=Ut.def(ot,".",Qt),mn(on,");",ot,".",Qt,"=",on,";"),xe("if(",on,"!==",Rn,"){",mn,"}");tt(mn)}),Fe.compile()}(),compile:ha}}function zh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var mp=34918,yp=34919,Zh=35007,Uh=function(Z,Ie){if(!Ie.ext_disjoint_timer_query)return null;var qe=[];function pr(){return qe.pop()||Ie.ext_disjoint_timer_query.createQueryEXT()}function Br(Jr){qe.push(Jr)}var lr=[];function Ir(Jr){var Dn=pr();Ie.ext_disjoint_timer_query.beginQueryEXT(Zh,Dn),lr.push(Dn),Yr(lr.length-1,lr.length,Jr)}function Vr(){Ie.ext_disjoint_timer_query.endQueryEXT(Zh)}function $r(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var en=[];function tn(){return en.pop()||new $r}function sn(Jr){en.push(Jr)}var bn=[];function Yr(Jr,Dn,Dr){var Pn=tn();Pn.startQueryIndex=Jr,Pn.endQueryIndex=Dn,Pn.sum=0,Pn.stats=Dr,bn.push(Pn)}var un=[],zt=[];function gr(){var Jr,Dn,Dr=lr.length;if(Dr!==0){zt.length=Math.max(zt.length,Dr+1),un.length=Math.max(un.length,Dr+1),un[0]=0,zt[0]=0;var Pn=0;for(Jr=0,Dn=0;Dn<lr.length;++Dn){var fn=lr[Dn];Ie.ext_disjoint_timer_query.getQueryObjectEXT(fn,yp)?(Pn+=Ie.ext_disjoint_timer_query.getQueryObjectEXT(fn,mp),Br(fn)):lr[Jr++]=fn,un[Dn+1]=Pn,zt[Dn+1]=Jr}for(lr.length=Jr,Jr=0,Dn=0;Dn<bn.length;++Dn){var pi=bn[Dn],kr=pi.startQueryIndex,Ar=pi.endQueryIndex;pi.sum+=un[Ar]-un[kr];var ri=zt[kr],Cn=zt[Ar];Cn===ri?(pi.stats.gpuTime+=pi.sum/1e6,sn(pi)):(pi.startQueryIndex=ri,pi.endQueryIndex=Cn,bn[Jr++]=pi)}bn.length=Jr}}return{beginQuery:Ir,endQuery:Vr,pushScopeStats:Yr,update:gr,getNumPendingQueries:function(){return lr.length},clear:function(){qe.push.apply(qe,lr);for(var Jr=0;Jr<qe.length;Jr++)Ie.ext_disjoint_timer_query.deleteQueryEXT(qe[Jr]);lr.length=0,qe.length=0},restore:function(){lr.length=0,qe.length=0}}},gp=16384,_p=256,Ef=1024,jh=34962,xh="webglcontextlost",Cf="webglcontextrestored",ro=1,Vh=2,Xl=3;function Nc(Z,Ie){for(var qe=0;qe<Z.length;++qe)if(Z[qe]===Ie)return qe;return-1}function Gh(Z){var Ie=B(Z);if(!Ie)return null;var qe=Ie.gl,pr=qe.getContextAttributes(),Br=qe.isContextLost(),lr=ee(qe,Ie);if(!lr)return null;var Ir=St(),Vr=zh(),$r=lr.extensions,en=Uh(qe,$r),tn=Or(),sn=qe.drawingBufferWidth,bn=qe.drawingBufferHeight,Yr={tick:0,time:0,viewportWidth:sn,viewportHeight:bn,framebufferWidth:sn,framebufferHeight:bn,drawingBufferWidth:sn,drawingBufferHeight:bn,pixelRatio:Ie.pixelRatio},un={},zt={elements:null,primitive:4,count:-1,offset:0,instances:-1},gr=ke(qe,$r),Jr=z(qe,Vr,Ie,Pn),Dn=$s(qe,$r,Jr,Vr),Dr=wt(qe,$r,gr,Vr,Jr,Dn,zt);function Pn(ki){return Dr.destroyBuffer(ki)}var fn=Gr(qe,Ir,Vr,Ie),pi=xi(qe,$r,gr,function(){ri.procs.poll()},Yr,Vr,Ie),kr=Qc(qe,$r,gr,Vr,Ie),Ar=Pe(qe,$r,gr,pi,kr,Vr),ri=vp(qe,Ir,$r,gr,Jr,Dn,pi,Ar,un,Dr,fn,zt,Yr,en,Ie),Cn=di(qe,Ar,ri.procs.poll,Yr,pr,$r,gr),rn=ri.next,Mn=qe.canvas,On=[],Gi=[],Bi=[],kn=[Ie.onDestroy],An=null;function Ti(){if(On.length===0){en&&en.update(),An=null;return}An=yn.next(Ti),Ko();for(var ki=On.length-1;ki>=0;--ki){var fa=On[ki];fa&&fa(Yr,null,0)}qe.flush(),en&&en.update()}function Ui(){!An&&On.length>0&&(An=yn.next(Ti))}function ma(){An&&(yn.cancel(Ti),An=null)}function Zo(ki){ki.preventDefault(),Br=!0,ma(),Gi.forEach(function(fa){fa()})}function bo(ki){qe.getError(),Br=!1,lr.restore(),fn.restore(),Jr.restore(),pi.restore(),kr.restore(),Ar.restore(),Dr.restore(),en&&en.restore(),ri.procs.refresh(),Ui(),Bi.forEach(function(fa){fa()})}var sa=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!sa&&Mn&&(Mn.addEventListener(xh,Zo,!1),Mn.addEventListener(Cf,bo,!1));function ps(){On.length=0,ma(),!sa&&Mn&&(Mn.removeEventListener(xh,Zo),Mn.removeEventListener(Cf,bo)),fn.clear(),Ar.clear(),kr.clear(),Dr.clear(),pi.clear(),Dn.clear(),Jr.clear(),en&&en.clear(),kn.forEach(function(ki){ki()})}function fo(ki){J(!!ki,"invalid args to regl({...})"),J.type(ki,"object","invalid args to regl({...})");function fa(gt){var mt=p({},gt);delete mt.uniforms,delete mt.attributes,delete mt.context,delete mt.vao,"stencil"in mt&&mt.stencil.op&&(mt.stencil.opBack=mt.stencil.opFront=mt.stencil.op,delete mt.stencil.op);function ot(Re){if(Re in mt){var st=mt[Re];delete mt[Re],Object.keys(st).forEach(function(ze){mt[Re+"."+ze]=st[ze]})}}return ot("blend"),ot("depth"),ot("cull"),ot("stencil"),ot("polygonOffset"),ot("scissor"),ot("sample"),"vao"in gt&&(mt.vao=gt.vao),mt}function no(gt,mt){var ot={},Re={};return Object.keys(gt).forEach(function(st){var ze=gt[st];if(Xr.isDynamic(ze)){Re[st]=Xr.unbox(ze,st);return}else if(mt&&Array.isArray(ze)){for(var Vt=0;Vt<ze.length;++Vt)if(Xr.isDynamic(ze[Vt])){Re[st]=Xr.unbox(ze,st);return}}ot[st]=ze}),{dynamic:Re,static:ot}}var So=no(ki.context||{},!0),dl=no(ki.uniforms||{},!0),Ge=no(ki.attributes||{},!1),sr=no(fa(ki),!1),rr={gpuTime:0,cpuTime:0,count:0},Xn=ri.compile(sr,Ge,dl,So,rr),ha=Xn.draw,Fe=Xn.batch,xe=Xn.scope,tt=[];function Ut(gt){for(;tt.length<gt;)tt.push(null);return tt}function fr(gt,mt){var ot;if(Br&&J.raise("context lost"),typeof gt=="function")return xe.call(this,null,gt,0);if(typeof mt=="function")if(typeof gt=="number")for(ot=0;ot<gt;++ot)xe.call(this,null,mt,ot);else if(Array.isArray(gt))for(ot=0;ot<gt.length;++ot)xe.call(this,gt[ot],mt,ot);else return xe.call(this,gt,mt,0);else if(typeof gt=="number"){if(gt>0)return Fe.call(this,Ut(gt|0),gt|0)}else if(Array.isArray(gt)){if(gt.length)return Fe.call(this,gt,gt.length)}else return ha.call(this,gt)}return p(fr,{stats:rr,destroy:function(){Xn.destroy()}})}var Yo=Ar.setFBO=fo({framebuffer:Xr.define.call(null,ro,"framebuffer")});function Uo(ki,fa){var no=0;ri.procs.poll();var So=fa.color;So&&(qe.clearColor(+So[0]||0,+So[1]||0,+So[2]||0,+So[3]||0),no|=gp),"depth"in fa&&(qe.clearDepth(+fa.depth),no|=_p),"stencil"in fa&&(qe.clearStencil(fa.stencil|0),no|=Ef),J(!!no,"called regl.clear with no buffer specified"),qe.clear(no)}function Ls(ki){if(J(typeof ki=="object"&&ki,"regl.clear() takes an object as input"),"framebuffer"in ki)if(ki.framebuffer&&ki.framebuffer_reglType==="framebufferCube")for(var fa=0;fa<6;++fa)Yo(p({framebuffer:ki.framebuffer.faces[fa]},ki),Uo);else Yo(ki,Uo);else Uo(null,ki)}function zs(ki){J.type(ki,"function","regl.frame() callback must be a function"),On.push(ki);function fa(){var no=Nc(On,ki);J(no>=0,"cannot cancel a frame twice");function So(){var dl=Nc(On,So);On[dl]=On[On.length-1],On.length-=1,On.length<=0&&ma()}On[no]=So}return Ui(),{cancel:fa}}function ws(){var ki=rn.viewport,fa=rn.scissor_box;ki[0]=ki[1]=fa[0]=fa[1]=0,Yr.viewportWidth=Yr.framebufferWidth=Yr.drawingBufferWidth=ki[2]=fa[2]=qe.drawingBufferWidth,Yr.viewportHeight=Yr.framebufferHeight=Yr.drawingBufferHeight=ki[3]=fa[3]=qe.drawingBufferHeight}function Ko(){Yr.tick+=1,Yr.time=jo(),ws(),ri.procs.poll()}function wi(){pi.refresh(),ws(),ri.procs.refresh(),en&&en.update()}function jo(){return(Or()-tn)/1e3}wi();function Oa(ki,fa){J.type(fa,"function","listener callback must be a function");var no;switch(ki){case"frame":return zs(fa);case"lost":no=Gi;break;case"restore":no=Bi;break;case"destroy":no=kn;break;default:J.raise("invalid event, must be one of frame,lost,restore,destroy")}return no.push(fa),{cancel:function(){for(var So=0;So<no.length;++So)if(no[So]===fa){no[So]=no[no.length-1],no.pop();return}}}}var Lo=p(fo,{clear:Ls,prop:Xr.define.bind(null,ro),context:Xr.define.bind(null,Vh),this:Xr.define.bind(null,Xl),draw:fo({}),buffer:function(ki){return Jr.create(ki,jh,!1,!1)},elements:function(ki){return Dn.create(ki,!1)},texture:pi.create2D,cube:pi.createCube,renderbuffer:kr.create,framebuffer:Ar.create,framebufferCube:Ar.createCube,vao:Dr.createVAO,attributes:pr,frame:zs,on:Oa,limits:gr,hasExtension:function(ki){return gr.extensions.indexOf(ki.toLowerCase())>=0},read:Cn,destroy:ps,_gl:qe,_refresh:wi,poll:function(){Ko(),en&&en.update()},now:jo,stats:Vr});return Ie.onDone(null,Lo),Lo}return Gh})},34130:function(Rr){var N=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function b(re){return re.match(N)||[]}Rr.exports=b},14318:function(Rr){function N(b,re,E){return b===b&&(E!==void 0&&(b=b<=E?b:E),re!==void 0&&(b=b>=re?b:re)),b}Rr.exports=N},61856:function(Rr){function N(b){return function(re){return b==null?void 0:b[re]}}Rr.exports=N},97815:function(Rr,N,b){var re=b(4324),E=b(55015),p=b(80935),me=b(44140);function te(ue){return function(ae){ae=me(ae);var Ne=E(ae)?p(ae):void 0,K=Ne?Ne[0]:ae.charAt(0),Qe=Ne?re(Ne,1).join(""):ae.slice(1);return K[ue]()+Qe}}Rr.exports=te},74749:function(Rr,N,b){var re=b(99861),E=b(31876),p=b(61503),me="['\u2019]",te=RegExp(me,"g");function ue(ae){return function(Ne){return re(p(E(Ne).replace(te,"")),ae,"")}}Rr.exports=ue},70668:function(Rr,N,b){var re=b(61856),E={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},p=re(E);Rr.exports=p},62840:function(Rr){var N=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function b(re){return N.test(re)}Rr.exports=b},97681:function(Rr){var N="\\ud800-\\udfff",b="\\u0300-\\u036f",re="\\ufe20-\\ufe2f",E="\\u20d0-\\u20ff",p=b+re+E,me="\\u2700-\\u27bf",te="a-z\\xdf-\\xf6\\xf8-\\xff",ue="\\xac\\xb1\\xd7\\xf7",ae="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ne="\\u2000-\\u206f",K=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Qe="A-Z\\xc0-\\xd6\\xd8-\\xde",xt="\\ufe0e\\ufe0f",Ht=ue+ae+Ne+K,$t="['\u2019]",Jt="["+Ht+"]",Ft="["+p+"]",Gt="\\d+",At="["+me+"]",Et="["+te+"]",bt="[^"+N+Ht+Gt+me+te+Qe+"]",er="\\ud83c[\\udffb-\\udfff]",q="(?:"+Ft+"|"+er+")",Bt="[^"+N+"]",et="(?:\\ud83c[\\udde6-\\uddff]){2}",je="[\\ud800-\\udbff][\\udc00-\\udfff]",nt="["+Qe+"]",De="\\u200d",It="(?:"+Et+"|"+bt+")",hr="(?:"+nt+"|"+bt+")",tr="(?:"+$t+"(?:d|ll|m|re|s|t|ve))?",j="(?:"+$t+"(?:D|LL|M|RE|S|T|VE))?",ie=q+"?",Me="["+xt+"]?",ye="(?:"+De+"(?:"+[Bt,et,je].join("|")+")"+Me+ie+")*",it="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",lt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Lt=Me+ie+ye,Pt="(?:"+[At,et,je].join("|")+")"+Lt,Lr=RegExp([nt+"?"+Et+"+"+tr+"(?="+[Jt,nt,"$"].join("|")+")",hr+"+"+j+"(?="+[Jt,nt+It,"$"].join("|")+")",nt+"?"+It+"+"+tr,nt+"+"+j,lt,it,Gt,Pt].join("|"),"g");function cn(qr){return qr.match(Lr)||[]}Rr.exports=cn},34301:function(Rr,N,b){var re=b(30225),E=b(74749),p=E(function(me,te,ue){return te=te.toLowerCase(),me+(ue?re(te):te)});Rr.exports=p},30225:function(Rr,N,b){var re=b(44140),E=b(53592);function p(me){return E(re(me).toLowerCase())}Rr.exports=p},61400:function(Rr,N,b){var re=b(14318),E=b(20168);function p(me,te,ue){return ue===void 0&&(ue=te,te=void 0),ue!==void 0&&(ue=E(ue),ue=ue===ue?ue:0),te!==void 0&&(te=E(te),te=te===te?te:0),re(E(me),te,ue)}Rr.exports=p},31876:function(Rr,N,b){var re=b(70668),E=b(44140),p=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,me="\\u0300-\\u036f",te="\\ufe20-\\ufe2f",ue="\\u20d0-\\u20ff",ae=me+te+ue,Ne="["+ae+"]",K=RegExp(Ne,"g");function Qe(xt){return xt=E(xt),xt&&xt.replace(p,re).replace(K,"")}Rr.exports=Qe},93544:function(Rr){function N(b){return b==null}Rr.exports=N},68868:function(Rr,N,b){var re=b(86756),E=b(93913),p="[object Number]";function me(te){return typeof te=="number"||E(te)&&re(te)==p}Rr.exports=me},24602:function(Rr,N,b){var re=b(50097),E=b(63323),p=E(function(me,te,ue,ae){re(me,te,ue,ae)});Rr.exports=p},21691:function(Rr,N,b){var re=b(29098);function E(p){return p&&p.length?re(p):[]}Rr.exports=E},53592:function(Rr,N,b){var re=b(97815),E=re("toUpperCase");Rr.exports=E},61503:function(Rr,N,b){var re=b(34130),E=b(62840),p=b(44140),me=b(97681);function te(ue,ae,Ne){return ue=p(ue),ae=Ne?void 0:ae,ae===void 0?E(ue)?me(ue):re(ue):ue.match(ae)||[]}Rr.exports=te},84105:function(Rr){(function(N,b){Rr.exports=b()})(this,function(){"use strict";var N,b,re;function E(p,me){if(!N)N=me;else if(!b)b=me;else{var te="var sharedChunk = {}; ("+N+")(sharedChunk); ("+b+")(sharedChunk);",ue={};N(ue),re=me(ue),typeof window!="undefined"&&(re.workerUrl=window.URL.createObjectURL(new Blob([te],{type:"text/javascript"})))}}return E(["exports"],function(p){"use strict";function me(e,t){return e(t={exports:{}},t.exports),t.exports}var te=ue;function ue(e,t,r,f){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(f-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=f,this.p2x=r,this.p2y=f}ue.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},ue.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},ue.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},ue.prototype.solveCurveX=function(e,t){var r,f,v,y,x;for(t===void 0&&(t=1e-6),v=e,x=0;x<8;x++){if(y=this.sampleCurveX(v)-e,Math.abs(y)<t)return v;var P=this.sampleCurveDerivativeX(v);if(Math.abs(P)<1e-6)break;v-=y/P}if((v=e)<(r=0))return r;if(v>(f=1))return f;for(;r<f;){if(y=this.sampleCurveX(v),Math.abs(y-e)<t)return v;e>y?r=v:f=v,v=.5*(f-r)+r}return v},ue.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var ae=Ne;function Ne(e,t){this.x=e,this.y=t}Ne.prototype={clone:function(){return new Ne(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),f=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=f,this},_rotateAround:function(e,t){var r=Math.cos(e),f=Math.sin(e),v=t.y+f*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-f*(this.y-t.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ne.convert=function(e){return e instanceof Ne?e:Array.isArray(e)?new Ne(e[0],e[1]):e};var K=typeof self!="undefined"?self:{},Qe=Math.pow(2,53)-1;function xt(e,t,r,f){var v=new te(e,t,r,f);return function(y){return v.solve(y)}}var Ht=xt(.25,.1,.25,1);function $t(e,t,r){return Math.min(r,Math.max(t,e))}function Jt(e,t,r){var f=r-t,v=((e-t)%f+f)%f+t;return v===t?r:v}function Ft(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var y=v[f];for(var x in y)e[x]=y[x]}return e}var Gt=1;function At(){return Gt++}function Et(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function bt(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function er(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function q(e,t){return e.indexOf(t,e.length-t.length)!==-1}function Bt(e,t,r){var f={};for(var v in e)f[v]=t.call(r||this,e[v],v,e);return f}function et(e,t,r){var f={};for(var v in e)t.call(r||this,e[v],v,e)&&(f[v]=e[v]);return f}function je(e){return Array.isArray(e)?e.map(je):typeof e=="object"&&e?Bt(e,je):e}var nt={};function De(e){nt[e]||(typeof console!="undefined"&&console.warn(e),nt[e]=!0)}function It(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function hr(e){for(var t=0,r=0,f=e.length,v=f-1,y=void 0,x=void 0;r<f;v=r++)t+=((x=e[v]).x-(y=e[r]).x)*(y.y+x.y);return t}function tr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function j(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(f,v,y,x){var P=y||x;return t[v]=!P||P.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var ie=null;function Me(e){if(ie==null){var t=e.navigator?e.navigator.userAgent:null;ie=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ie}function ye(e){try{var t=K[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var it,lt,Lt,Pt,Lr=K.performance&&K.performance.now?K.performance.now.bind(K.performance):Date.now.bind(Date),cn=K.requestAnimationFrame||K.mozRequestAnimationFrame||K.webkitRequestAnimationFrame||K.msRequestAnimationFrame,qr=K.cancelAnimationFrame||K.mozCancelAnimationFrame||K.webkitCancelAnimationFrame||K.msCancelAnimationFrame,fi={now:Lr,frame:function(e){var t=cn(e);return{cancel:function(){return qr(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=K.document.createElement("canvas"),f=r.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,f.drawImage(e,0,0,e.width,e.height),f.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return it||(it=K.document.createElement("a")),it.href=e,it.href},hardwareConcurrency:K.navigator&&K.navigator.hardwareConcurrency||4,get devicePixelRatio(){return K.devicePixelRatio},get prefersReducedMotion(){return!!K.matchMedia&&(lt==null&&(lt=K.matchMedia("(prefers-reduced-motion: reduce)")),lt.matches)}},Yt={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},he={supported:!1,testSupport:function(e){!Te&&Pt&&(Ze?Oe(e):Lt=e)}},Te=!1,Ze=!1;function Oe(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Pt),e.isContextLost())return;he.supported=!0}catch(r){}e.deleteTexture(t),Te=!0}K.document&&((Pt=K.document.createElement("img")).onload=function(){Lt&&Oe(Lt),Lt=null,Ze=!0},Pt.onerror=function(){Te=!0,Lt=null},Pt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ot="01",ar=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function ur(e){return e.indexOf("mapbox:")===0}ar.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ot,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},ar.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},ar.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},ar.prototype.normalizeStyleURL=function(e,t){if(!ur(e))return e;var r=C(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},ar.prototype.normalizeGlyphsURL=function(e,t){if(!ur(e))return e;var r=C(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},ar.prototype.normalizeSourceURL=function(e,t){if(!ur(e))return e;var r=C(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},ar.prototype.normalizeSpriteURL=function(e,t,r,f){var v=C(e);return ur(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||f)):(v.path+=""+t+r,V(v))},ar.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!ur(e))return e;var r=C(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(fi.devicePixelRatio>=2||t===512?"@2x":"")+(he.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var f=this._customAccessToken||function(v){for(var y=0,x=v;y<x.length;y+=1){var P=x[y].match(/^access_token=(.*)$/);if(P)return P[1]}return null}(r.params)||Yt.ACCESS_TOKEN;return Yt.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,f)},ar.prototype.canonicalizeTileURL=function(e,t){var r=C(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var f="mapbox://tiles/";f+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(y){return!y.match(/^access_token=/)})),v.length&&(f+="?"+v.join("&")),f},ar.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&ur(t),f=[],v=0,y=e.tiles||[];v<y.length;v+=1){var x=y[v];or(x)?f.push(this.canonicalizeTileURL(x,r)):f.push(x)}return f},ar.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=C(Yt.API_URL);if(e.protocol=f.protocol,e.authority=f.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(f.path!=="/"&&(e.path=""+f.path+e.path),!Yt.REQUIRE_ACCESS_TOKEN)return V(e);if(!(t=t||Yt.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(y){return y.indexOf("access_token")===-1}),e.params.push("access_token="+t),V(e)};var Pr=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function or(e){return Pr.test(e)}var nn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function C(e){var t=e.match(nn);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function V(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function Ve(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(K.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var $e=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};$e.prototype.getStorageKey=function(e){var t,r=Ve(Yt.ACCESS_TOKEN);return t=r&&r.u?K.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(f,v){return String.fromCharCode(Number("0x"+v))})):Yt.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},$e.prototype.fetchEventData=function(){var e=ye("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var f=K.localStorage.getItem(t);f&&(this.eventData=JSON.parse(f));var v=K.localStorage.getItem(r);v&&(this.anonId=v)}catch(y){De("Unable to read from LocalStorage")}},$e.prototype.saveEventData=function(){var e=ye("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{K.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&K.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(f){De("Unable to write to LocalStorage")}},$e.prototype.processRequests=function(e){},$e.prototype.postEvent=function(e,t,r,f){var v=this;if(Yt.EVENTS_URL){var y=C(Yt.EVENTS_URL);y.params.push("access_token="+(f||Yt.ACCESS_TOKEN||""));var x={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Ot,userId:this.anonId},P=t?Ft(x,t):x,F={url:V(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=zr(F,function(U){v.pendingRequest=null,r(U),v.saveEventData(),v.processRequests(f)})}},$e.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var ct,Ct,J=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,f,v,y){this.skuToken=v,(Yt.EVENTS_URL&&y||Yt.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(x){return ur(x)||or(x)}))&&this.queueRequest({id:f,timestamp:Date.now()},y)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),y=v.id,x=v.timestamp;y&&this.success[y]||(this.anonId||this.fetchEventData(),bt(this.anonId)||(this.anonId=Et()),this.postEvent(x,{skuToken:this.skuToken},function(P){P||y&&(f.success[y]=!0)},r))}},t}($e),Wt=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,f){Yt.EVENTS_URL&&Yt.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return ur(v)||or(v)})&&this.queueRequest(Date.now(),f)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=Ve(Yt.ACCESS_TOKEN),y=v?v.u:Yt.ACCESS_TOKEN,x=y!==this.eventData.tokenU;bt(this.anonId)||(this.anonId=Et(),x=!0);var P=this.queue.shift();if(this.eventData.lastSuccess){var F=new Date(this.eventData.lastSuccess),U=new Date(P),W=(P-this.eventData.lastSuccess)/864e5;x=x||W>=1||W<-1||F.getDate()!==U.getDate()}else x=!0;if(!x)return this.processRequests();this.postEvent(P,{"enabled.telemetry":!1},function(ne){ne||(f.eventData.lastSuccess=P,f.eventData.tokenU=y)},r)}},t}($e)),Tr=Wt.postTurnstileEvent.bind(Wt),Mr=new J,Ke=Mr.postMapLoadEvent.bind(Mr),ht=500,Mt=50;function Nt(){K.caches&&!ct&&(ct=K.caches.open("mapbox-tiles"))}function br(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var Sr,Je=1/0;function Hr(){return Sr==null&&(Sr=K.OffscreenCanvas&&new K.OffscreenCanvas(1,1).getContext("2d")&&typeof K.createImageBitmap=="function"),Sr}var Xr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Xr);var yn=function(e){function t(r,f,v){f===401&&or(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=f,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),vr=tr()?function(){return self.worker&&self.worker.referrer}:function(){return(K.location.protocol==="blob:"?K.parent:K).location.href},Or,St,Kn=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(vr())&&!/^\w+:/.test(r))){if(K.fetch&&K.Request&&K.AbortController&&K.Request.prototype.hasOwnProperty("signal"))return function(f,v){var y,x=new K.AbortController,P=new K.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:vr(),signal:x.signal}),F=!1,U=!1,W=(y=P.url).indexOf("sku=")>0&&or(y);f.type==="json"&&P.headers.set("Accept","application/json");var ne=function(be,He,Xe){if(!U){if(be&&be.message!=="SecurityError"&&De(be),He&&Xe)return de(He);var _t=Date.now();K.fetch(P).then(function(rt){if(rt.ok){var Dt=W?rt.clone():null;return de(rt,Dt,_t)}return v(new yn(rt.statusText,rt.status,f.url))}).catch(function(rt){rt.code!==20&&v(new Error(rt.message))})}},de=function(be,He,Xe){(f.type==="arrayBuffer"?be.arrayBuffer():f.type==="json"?be.json():be.text()).then(function(_t){U||(He&&Xe&&function(rt,Dt,qt){if(Nt(),ct){var mr={status:Dt.status,statusText:Dt.statusText,headers:new K.Headers};Dt.headers.forEach(function(Nr,ln){return mr.headers.set(ln,Nr)});var xr=j(Dt.headers.get("Cache-Control")||"");xr["no-store"]||(xr["max-age"]&&mr.headers.set("Expires",new Date(qt+1e3*xr["max-age"]).toUTCString()),new Date(mr.headers.get("Expires")).getTime()-qt<42e4||function(Nr,ln){if(Ct===void 0)try{new Response(new ReadableStream),Ct=!0}catch(wn){Ct=!1}Ct?ln(Nr.body):Nr.blob().then(ln)}(Dt,function(Nr){var ln=new K.Response(Nr,mr);Nt(),ct&&ct.then(function(wn){return wn.put(br(rt.url),ln)}).catch(function(wn){return De(wn.message)})}))}}(P,He,Xe),F=!0,v(null,_t,be.headers.get("Cache-Control"),be.headers.get("Expires")))}).catch(function(_t){U||v(new Error(_t.message))})};return W?function(be,He){if(Nt(),!ct)return He(null);var Xe=br(be.url);ct.then(function(_t){_t.match(Xe).then(function(rt){var Dt=function(qt){if(!qt)return!1;var mr=new Date(qt.headers.get("Expires")||0),xr=j(qt.headers.get("Cache-Control")||"");return mr>Date.now()&&!xr["no-cache"]}(rt);_t.delete(Xe),Dt&&_t.put(Xe,rt.clone()),He(null,rt,Dt)}).catch(He)}).catch(He)}(P,ne):ne(null,null),{cancel:function(){U=!0,F||x.abort()}}}(e,t);if(tr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(f,v){var y=new K.XMLHttpRequest;for(var x in y.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(y.responseType="arraybuffer"),f.headers)y.setRequestHeader(x,f.headers[x]);return f.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=f.credentials==="include",y.onerror=function(){v(new Error(y.statusText))},y.onload=function(){if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){var P=y.response;if(f.type==="json")try{P=JSON.parse(y.response)}catch(F){return v(F)}v(null,P,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else v(new yn(y.statusText,y.status,f.url))},y.send(f.body),{cancel:function(){return y.abort()}}}(e,t)},Ln=function(e,t){return Kn(Ft(e,{type:"arrayBuffer"}),t)},zr=function(e,t){return Kn(Ft(e,{method:"POST"}),t)},Y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Or=[],St=0;var ce=function(e,t){if(he.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),St>=Yt.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return Or.push(r),r}St++;var f=!1,v=function(){if(!f)for(f=!0,St--;Or.length&&St<Yt.MAX_PARALLEL_IMAGE_REQUESTS;){var x=Or.shift();x.cancelled||(x.cancel=ce(x.requestParameters,x.callback).cancel)}},y=Ln(e,function(x,P,F,U){v(),x?t(x):P&&(Hr()?function(W,ne){var de=new K.Blob([new Uint8Array(W)],{type:"image/png"});K.createImageBitmap(de).then(function(be){ne(null,be)}).catch(function(be){ne(new Error("Could not load image because of "+be.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(P,t):function(W,ne,de,be){var He=new K.Image,Xe=K.URL;He.onload=function(){ne(null,He),Xe.revokeObjectURL(He.src),He.onload=null,K.requestAnimationFrame(function(){He.src=Y})},He.onerror=function(){return ne(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var _t=new K.Blob([new Uint8Array(W)],{type:"image/png"});He.cacheControl=de,He.expires=be,He.src=W.byteLength?Xe.createObjectURL(_t):Y}(P,t,F,U))});return{cancel:function(){y.cancel(),v()}}};function ve(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function B(e,t,r){if(r&&r[e]){var f=r[e].indexOf(t);f!==-1&&r[e].splice(f,1)}}var ee=function(e,t){t===void 0&&(t={}),Ft(this,t),this.type=e},pe=function(e){function t(r,f){f===void 0&&(f={}),e.call(this,"error",Ft({error:r},f))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ee),Ae=function(){};Ae.prototype.on=function(e,t){return this._listeners=this._listeners||{},ve(e,t,this._listeners),this},Ae.prototype.off=function(e,t){return B(e,t,this._listeners),B(e,t,this._oneTimeListeners),this},Ae.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},ve(e,t,this._oneTimeListeners),this},Ae.prototype.fire=function(e,t){typeof e=="string"&&(e=new ee(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var f=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];f<v.length;f+=1)v[f].call(this,e);for(var y=0,x=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];y<x.length;y+=1){var P=x[y];B(r,P,this._oneTimeListeners),P.call(this,e)}var F=this._eventedParent;F&&(Ft(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),F.fire(e))}else e instanceof pe&&console.error(e.error);return this},Ae.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Ae.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var oe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},_e=function(e,t,r,f){this.message=(e?e+": ":"")+r,f&&(this.identifier=f),t!=null&&t.__line__&&(this.line=t.__line__)};function dt(e){var t=e.value;return t?[new _e(e.key,t,"constants have been deprecated as of v8")]:[]}function Er(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var y=v[f];for(var x in y)e[x]=y[x]}return e}function Kt(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function ir(e){if(Array.isArray(e))return e.map(ir);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=ir(e[r]);return t}return Kt(e)}var Zr=function(e){function t(r,f){e.call(this,f),this.message=f,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),Bn=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,f=t;r<f.length;r+=1){var v=f[r];this.bindings[v[0]]=v[1]}};Bn.prototype.concat=function(e){return new Bn(this,e)},Bn.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},Bn.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var Fn={kind:"null"},nr={kind:"number"},In={kind:"string"},vn={kind:"boolean"},xn={kind:"color"},zi={kind:"object"},Tn={kind:"value"},Di={kind:"collator"},ra={kind:"formatted"},hi={kind:"resolvedImage"};function na(e,t){return{kind:"array",itemType:e,N:t}}function Yi(e){if(e.kind==="array"){var t=Yi(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var Ii=[Fn,nr,In,vn,xn,ra,zi,na(Tn),hi];function ya(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ya(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,f=Ii;r<f.length;r+=1)if(!ya(f[r],t))return null}}return"Expected "+Yi(e)+" but found "+Yi(t)+" instead."}function Fa(e,t){return t.some(function(r){return r.kind===e.kind})}function Ki(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var Zi=me(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(P){return(P=Math.round(P))<0?0:P>255?255:P}function v(P){return f(P[P.length-1]==="%"?parseFloat(P)/100*255:parseInt(P))}function y(P){return(F=P[P.length-1]==="%"?parseFloat(P)/100:parseFloat(P))<0?0:F>1?1:F;var F}function x(P,F,U){return U<0?U+=1:U>1&&(U-=1),6*U<1?P+(F-P)*U*6:2*U<1?F:3*U<2?P+(F-P)*(2/3-U)*6:P}try{t.parseCSSColor=function(P){var F,U=P.replace(/ /g,"").toLowerCase();if(U in r)return r[U].slice();if(U[0]==="#")return U.length===4?(F=parseInt(U.substr(1),16))>=0&&F<=4095?[(3840&F)>>4|(3840&F)>>8,240&F|(240&F)>>4,15&F|(15&F)<<4,1]:null:U.length===7&&(F=parseInt(U.substr(1),16))>=0&&F<=16777215?[(16711680&F)>>16,(65280&F)>>8,255&F,1]:null;var W=U.indexOf("("),ne=U.indexOf(")");if(W!==-1&&ne+1===U.length){var de=U.substr(0,W),be=U.substr(W+1,ne-(W+1)).split(","),He=1;switch(de){case"rgba":if(be.length!==4)return null;He=y(be.pop());case"rgb":return be.length!==3?null:[v(be[0]),v(be[1]),v(be[2]),He];case"hsla":if(be.length!==4)return null;He=y(be.pop());case"hsl":if(be.length!==3)return null;var Xe=(parseFloat(be[0])%360+360)%360/360,_t=y(be[1]),rt=y(be[2]),Dt=rt<=.5?rt*(_t+1):rt+_t-rt*_t,qt=2*rt-Dt;return[f(255*x(qt,Dt,Xe+1/3)),f(255*x(qt,Dt,Xe)),f(255*x(qt,Dt,Xe-1/3)),He];default:return null}}return null}}catch(P){}}).parseCSSColor,$i=function(e,t,r,f){f===void 0&&(f=1),this.r=e,this.g=t,this.b=r,this.a=f};$i.parse=function(e){if(e){if(e instanceof $i)return e;if(typeof e=="string"){var t=Zi(e);if(t)return new $i(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},$i.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],f=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+f+")"},$i.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},$i.black=new $i(0,0,0,1),$i.white=new $i(1,1,1,1),$i.transparent=new $i(0,0,0,0),$i.red=new $i(1,0,0,1);var so=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};so.prototype.compare=function(e,t){return this.collator.compare(e,t)},so.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Jo=function(e,t,r,f,v){this.text=e,this.image=t,this.scale=r,this.fontStack=f,this.textColor=v},za=function(e){this.sections=e};za.fromString=function(e){return new za([new Jo(e,null,null,null,null)])},za.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},za.factory=function(e){return e instanceof za?e:za.fromString(e)},za.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},za.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];if(f.image)e.push(["image",f.image.name]);else{e.push(f.text);var v={};f.fontStack&&(v["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(v["font-scale"]=f.scale),f.textColor&&(v["text-color"]=["rgba"].concat(f.textColor.toArray())),e.push(v)}}return e};var qi=function(e){this.name=e.name,this.available=e.available};function ou(e,t,r,f){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:"Invalid rgba value ["+[e,t,r,f].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof f=="number"?[e,t,r,f]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Cu(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof $i||e instanceof so||e instanceof za||e instanceof qi)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!Cu(r[t]))return!1;return!0}if(typeof e=="object"){for(var f in e)if(!Cu(e[f]))return!1;return!0}return!1}function Ji(e){if(e===null)return Fn;if(typeof e=="string")return In;if(typeof e=="boolean")return vn;if(typeof e=="number")return nr;if(e instanceof $i)return xn;if(e instanceof so)return Di;if(e instanceof za)return ra;if(e instanceof qi)return hi;if(Array.isArray(e)){for(var t,r=e.length,f=0,v=e;f<v.length;f+=1){var y=Ji(v[f]);if(t){if(t===y)continue;t=Tn;break}t=y}return na(t||Tn,r)}return zi}function xo(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof $i||e instanceof za||e instanceof qi?e.toString():JSON.stringify(e)}qi.prototype.toString=function(){return this.name},qi.fromString=function(e){return e?new qi({name:e,available:!1}):null},qi.prototype.serialize=function(){return["image",this.name]};var Qi=function(e,t){this.type=e,this.value=t};Qi.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!Cu(e[1]))return t.error("invalid value");var r=e[1],f=Ji(r),v=t.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new Qi(f,r)},Qi.prototype.evaluate=function(){return this.value},Qi.prototype.eachChild=function(){},Qi.prototype.outputDefined=function(){return!0},Qi.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof $i?["rgba"].concat(this.value.toArray()):this.value instanceof za?this.value.serialize():this.value};var Ja=function(e){this.name="ExpressionEvaluationError",this.message=e};Ja.prototype.toJSON=function(){return this.message};var Qo={string:In,number:nr,boolean:vn,object:zi},Ea=function(e,t){this.type=e,this.args=t};Ea.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,f=1,v=e[0];if(v==="array"){var y,x;if(e.length>2){var P=e[1];if(typeof P!="string"||!(P in Qo)||P==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);y=Qo[P],f++}else y=Tn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);x=e[2],f++}r=na(y,x)}else r=Qo[v];for(var F=[];f<e.length;f++){var U=t.parse(e[f],f,Tn);if(!U)return null;F.push(U)}return new Ea(r,F)},Ea.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!ya(this.type,Ji(r)))return r;if(t===this.args.length-1)throw new Ja("Expected value to be of type "+Yi(this.type)+", but found "+Yi(Ji(r))+" instead.")}return null},Ea.prototype.eachChild=function(e){this.args.forEach(e)},Ea.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Ea.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var f=e.N;(typeof f=="number"||this.args.length>1)&&t.push(f)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var Do=function(e){this.type=ra,this.sections=e};Do.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var f=[],v=!1,y=1;y<=e.length-1;++y){var x=e[y];if(v&&typeof x=="object"&&!Array.isArray(x)){v=!1;var P=null;if(x["font-scale"]&&!(P=t.parse(x["font-scale"],1,nr)))return null;var F=null;if(x["text-font"]&&!(F=t.parse(x["text-font"],1,na(In))))return null;var U=null;if(x["text-color"]&&!(U=t.parse(x["text-color"],1,xn)))return null;var W=f[f.length-1];W.scale=P,W.font=F,W.textColor=U}else{var ne=t.parse(e[y],1,Tn);if(!ne)return null;var de=ne.type.kind;if(de!=="string"&&de!=="value"&&de!=="null"&&de!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:ne,scale:null,font:null,textColor:null})}}return new Do(f)},Do.prototype.evaluate=function(e){return new za(this.sections.map(function(t){var r=t.content.evaluate(e);return Ji(r)===hi?new Jo("",r,null,null,null):new Jo(xo(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},Do.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e(f.content),f.scale&&e(f.scale),f.font&&e(f.font),f.textColor&&e(f.textColor)}},Do.prototype.outputDefined=function(){return!1},Do.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e.push(f.content.serialize());var v={};f.scale&&(v["font-scale"]=f.scale.serialize()),f.font&&(v["text-font"]=f.font.serialize()),f.textColor&&(v["text-color"]=f.textColor.serialize()),e.push(v)}return e};var ko=function(e){this.type=hi,this.input=e};ko.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,In);return r?new ko(r):t.error("No image name provided.")},ko.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=qi.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},ko.prototype.eachChild=function(e){e(this.input)},ko.prototype.outputDefined=function(){return!1},ko.prototype.serialize=function(){return["image",this.input.serialize()]};var ks={"to-boolean":vn,"to-color":xn,"to-number":nr,"to-string":In},yo=function(e,t){this.type=e,this.args=t};yo.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var f=ks[r],v=[],y=1;y<e.length;y++){var x=t.parse(e[y],y,Tn);if(!x)return null;v.push(x)}return new yo(f,v)},yo.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,f=0,v=this.args;f<v.length;f+=1){if(r=null,(t=v[f].evaluate(e))instanceof $i)return t;if(typeof t=="string"){var y=e.parseColor(t);if(y)return y}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":ou(t[0],t[1],t[2],t[3])))return new $i(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Ja(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var x=null,P=0,F=this.args;P<F.length;P+=1){if((x=F[P].evaluate(e))===null)return 0;var U=Number(x);if(!isNaN(U))return U}throw new Ja("Could not convert "+JSON.stringify(x)+" to number.")}return this.type.kind==="formatted"?za.fromString(xo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?qi.fromString(xo(this.args[0].evaluate(e))):xo(this.args[0].evaluate(e))},yo.prototype.eachChild=function(e){this.args.forEach(e)},yo.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},yo.prototype.serialize=function(){if(this.type.kind==="formatted")return new Do([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ko(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var Go=["Unknown","Point","LineString","Polygon"],Ba=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Ba.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Ba.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Go[this.feature.type]:this.feature.type:null},Ba.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Ba.prototype.canonicalID=function(){return this.canonical},Ba.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Ba.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=$i.parse(e)),t};var ho=function(e,t,r,f){this.name=e,this.type=t,this._evaluate=r,this.args=f};ho.prototype.evaluate=function(e){return this._evaluate(e,this.args)},ho.prototype.eachChild=function(e){this.args.forEach(e)},ho.prototype.outputDefined=function(){return!1},ho.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},ho.parse=function(e,t){var r,f=e[0],v=ho.definitions[f];if(!v)return t.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0);for(var y=Array.isArray(v)?v[0]:v.type,x=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,P=x.filter(function(ci){var $n=ci[0];return!Array.isArray($n)||$n.length===e.length-1}),F=null,U=0,W=P;U<W.length;U+=1){var ne=W[U],de=ne[0],be=ne[1];F=new Zs(t.registry,t.path,null,t.scope);for(var He=[],Xe=!1,_t=1;_t<e.length;_t++){var rt=e[_t],Dt=Array.isArray(de)?de[_t-1]:de.type,qt=F.parse(rt,1+He.length,Dt);if(!qt){Xe=!0;break}He.push(qt)}if(!Xe)if(Array.isArray(de)&&de.length!==He.length)F.error("Expected "+de.length+" arguments, but found "+He.length+" instead.");else{for(var mr=0;mr<He.length;mr++){var xr=Array.isArray(de)?de[mr]:de.type,Nr=He[mr];F.concat(mr+1).checkSubtype(xr,Nr.type)}if(F.errors.length===0)return new ho(f,y,be,He)}}if(P.length===1)(r=t.errors).push.apply(r,F.errors);else{for(var ln=(P.length?P:x).map(function(ci){var $n;return $n=ci[0],Array.isArray($n)?"("+$n.map(Yi).join(", ")+")":"("+Yi($n.type)+"...)"}).join(" | "),wn=[],ei=1;ei<e.length;ei++){var jn=t.parse(e[ei],1+wn.length);if(!jn)return null;wn.push(Yi(jn.type))}t.error("Expected arguments of type "+ln+", but found ("+wn.join(", ")+") instead.")}return null},ho.register=function(e,t){for(var r in ho.definitions=t,t)e[r]=ho};var as=function(e,t,r){this.type=Di,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function Fo(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Se(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function ke(e,t){var r=(180+e[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(f*v*8192)]}function yt(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function O(e,t){for(var r,f,v,y,x,P,F,U=!1,W=0,ne=t.length;W<ne;W++)for(var de=t[W],be=0,He=de.length;be<He-1;be++){if((y=(r=e)[0]-(f=de[be])[0])*(F=r[1]-(v=de[be+1])[1])-(P=r[0]-v[0])*(x=r[1]-f[1])==0&&y*P<=0&&x*F<=0)return!1;yt(e,de[be],de[be+1])&&(U=!U)}return U}function Qr(e,t){for(var r=0;r<t.length;r++)if(O(e,t[r]))return!0;return!1}function oi(e,t,r,f){var v=f[0]-r[0],y=f[1]-r[1],x=(e[0]-r[0])*y-v*(e[1]-r[1]),P=(t[0]-r[0])*y-v*(t[1]-r[1]);return x>0&&P<0||x<0&&P>0}function Ai(e,t,r){for(var f=0,v=r;f<v.length;f+=1)for(var y=v[f],x=0;x<y.length-1;++x)if((ne=[(W=y[x+1])[0]-(U=y[x])[0],W[1]-U[1]])[0]*(de=[(F=t)[0]-(P=e)[0],F[1]-P[1]])[1]-ne[1]*de[0]!=0&&oi(P,F,U,W)&&oi(U,W,P,F))return!0;var P,F,U,W,ne,de;return!1}function po(e,t){for(var r=0;r<e.length;++r)if(!O(e[r],t))return!1;for(var f=0;f<e.length-1;++f)if(Ai(e[f],e[f+1],t))return!1;return!0}function Qa(e,t){for(var r=0;r<t.length;r++)if(po(e,t[r]))return!0;return!1}function Wa(e,t,r){for(var f=[],v=0;v<e.length;v++){for(var y=[],x=0;x<e[v].length;x++){var P=ke(e[v][x],r);Fo(t,P),y.push(P)}f.push(y)}return f}function os(e,t,r){for(var f=[],v=0;v<e.length;v++){var y=Wa(e[v],t,r);f.push(y)}return f}function su(e,t,r,f){if(e[0]<r[0]||e[0]>r[2]){var v=.5*f,y=e[0]-r[0]>v?-f:r[0]-e[0]>v?f:0;y===0&&(y=e[0]-r[2]>v?-f:r[2]-e[0]>v?f:0),e[0]+=y}Fo(t,e)}function wu(e,t,r,f){for(var v=8192*Math.pow(2,f.z),y=[8192*f.x,8192*f.y],x=[],P=0,F=e;P<F.length;P+=1)for(var U=0,W=F[P];U<W.length;U+=1){var ne=W[U],de=[ne.x+y[0],ne.y+y[1]];su(de,t,r,v),x.push(de)}return x}function Qu(e,t,r,f){for(var v,y=8192*Math.pow(2,f.z),x=[8192*f.x,8192*f.y],P=[],F=0,U=e;F<U.length;F+=1){for(var W=[],ne=0,de=U[F];ne<de.length;ne+=1){var be=de[ne],He=[be.x+x[0],be.y+x[1]];Fo(t,He),W.push(He)}P.push(W)}if(t[2]-t[0]<=y/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var Xe=0,_t=P;Xe<_t.length;Xe+=1)for(var rt=0,Dt=_t[Xe];rt<Dt.length;rt+=1)su(Dt[rt],t,r,y)}return P}as.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var f=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,vn);if(!f)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,vn);if(!v)return null;var y=null;return r.locale&&!(y=t.parse(r.locale,1,In))?null:new as(f,v,y)},as.prototype.evaluate=function(e){return new so(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},as.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},as.prototype.outputDefined=function(){return!1},as.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var qo=function(e,t){this.type=vn,this.geojson=e,this.geometries=t};function es(e){if(e instanceof ho&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof qo)return!1;var t=!0;return e.eachChild(function(r){t&&!es(r)&&(t=!1)}),t}function ss(e){if(e instanceof ho&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!ss(r)&&(t=!1)}),t}function As(e,t){if(e instanceof ho&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(f){r&&!As(f,t)&&(r=!1)}),r}qo.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(Cu(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var f=0;f<r.features.length;++f){var v=r.features[f].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new qo(r,r.features[f].geometry)}else if(r.type==="Feature"){var y=r.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new qo(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new qo(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},qo.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],y=t.canonicalID();if(r.type==="Polygon"){var x=Wa(r.coordinates,v,y),P=wu(t.geometry(),f,v,y);if(!Se(f,v))return!1;for(var F=0,U=P;F<U.length;F+=1)if(!O(U[F],x))return!1}if(r.type==="MultiPolygon"){var W=os(r.coordinates,v,y),ne=wu(t.geometry(),f,v,y);if(!Se(f,v))return!1;for(var de=0,be=ne;de<be.length;de+=1)if(!Qr(be[de],W))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],y=t.canonicalID();if(r.type==="Polygon"){var x=Wa(r.coordinates,v,y),P=Qu(t.geometry(),f,v,y);if(!Se(f,v))return!1;for(var F=0,U=P;F<U.length;F+=1)if(!po(U[F],x))return!1}if(r.type==="MultiPolygon"){var W=os(r.coordinates,v,y),ne=Qu(t.geometry(),f,v,y);if(!Se(f,v))return!1;for(var de=0,be=ne;de<be.length;de+=1)if(!Qa(be[de],W))return!1}return!0}(e,this.geometries)}return!1},qo.prototype.eachChild=function(){},qo.prototype.outputDefined=function(){return!0},qo.prototype.serialize=function(){return["within",this.geojson]};var us=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};us.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new us(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},us.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},us.prototype.eachChild=function(){},us.prototype.outputDefined=function(){return!1},us.prototype.serialize=function(){return["var",this.name]};var Zs=function(e,t,r,f,v){t===void 0&&(t=[]),f===void 0&&(f=new Bn),v===void 0&&(v=[]),this.registry=e,this.path=t,this.key=t.map(function(y){return"["+y+"]"}).join(""),this.scope=f,this.errors=v,this.expectedType=r};function Ys(e,t){for(var r,f=e.length-1,v=0,y=f,x=0;v<=y;)if((r=e[x=Math.floor((v+y)/2)])<=t){if(x===f||t<e[x+1])return x;v=x+1}else{if(!(r>t))throw new Ja("Input is not a number.");y=x-1}return 0}Zs.prototype.parse=function(e,t,r,f,v){return v===void 0&&(v={}),t?this.concat(t,r,f)._parse(e,v):this._parse(e,v)},Zs.prototype._parse=function(e,t){function r(U,W,ne){return ne==="assert"?new Ea(W,[U]):ne==="coerce"?new yo(W,[U]):U}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var f=e[0];if(typeof f!="string")return this.error("Expression name must be a string, but found "+typeof f+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[f];if(v){var y=v.parse(e,this);if(!y)return null;if(this.expectedType){var x=this.expectedType,P=y.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||P.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(x,P))return null}else y=r(y,x,t.typeAnnotation||"coerce");else y=r(y,x,t.typeAnnotation||"assert")}if(!(y instanceof Qi)&&y.type.kind!=="resolvedImage"&&function U(W){if(W instanceof us)return U(W.boundExpression);if(W instanceof ho&&W.name==="error"||W instanceof as||W instanceof qo)return!1;var ne=W instanceof yo||W instanceof Ea,de=!0;return W.eachChild(function(be){de=ne?de&&U(be):de&&be instanceof Qi}),!!de&&es(W)&&As(W,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(y)){var F=new Ba;try{y=new Qi(y.type,y.evaluate(F))}catch(U){return this.error(U.message),null}}return y}return this.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},Zs.prototype.concat=function(e,t,r){var f=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new Zs(this.registry,f,t||null,v,this.errors)},Zs.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var f=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new Zr(f,e))},Zs.prototype.checkSubtype=function(e,t){var r=ya(e,t);return r&&this.error(r),r};var Ts=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var f=0,v=r;f<v.length;f+=1){var y=v[f],x=y[1];this.labels.push(y[0]),this.outputs.push(x)}};function Aa(e,t,r){return e*(1-r)+t*r}Ts.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,nr);if(!r)return null;var f=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var y=1;y<e.length;y+=2){var x=y===1?-1/0:e[y],P=e[y+1],F=y,U=y+1;if(typeof x!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(f.length&&f[f.length-1][0]>=x)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);var W=t.parse(P,U,v);if(!W)return null;v=v||W.type,f.push([x,W])}return new Ts(v,r,f)},Ts.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;return f>=t[v-1]?r[v-1].evaluate(e):r[Ys(t,f)].evaluate(e)},Ts.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},Ts.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Ts.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var wo=Object.freeze({__proto__:null,number:Aa,color:function(e,t,r){return new $i(Aa(e.r,t.r,r),Aa(e.g,t.g,r),Aa(e.b,t.b,r),Aa(e.a,t.a,r))},array:function(e,t,r){return e.map(function(f,v){return Aa(f,t[v],r)})}}),ml=6/29*3*(6/29),yl=Math.PI/180,qu=180/Math.PI;function Jl(e){return e>.008856451679035631?Math.pow(e,1/3):e/ml+4/29}function gl(e){return e>6/29?e*e*e:ml*(e-4/29)}function Lu(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Us(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function _l(e){var t=Us(e.r),r=Us(e.g),f=Us(e.b),v=Jl((.4124564*t+.3575761*r+.1804375*f)/.95047),y=Jl((.2126729*t+.7151522*r+.072175*f)/1);return{l:116*y-16,a:500*(v-y),b:200*(y-Jl((.0193339*t+.119192*r+.9503041*f)/1.08883)),alpha:e.a}}function m(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,f=isNaN(e.b)?t:t-e.b/200;return t=1*gl(t),r=.95047*gl(r),f=1.08883*gl(f),new $i(Lu(3.2404542*r-1.5371385*t-.4985314*f),Lu(-.969266*r+1.8760108*t+.041556*f),Lu(.0556434*r-.2040259*t+1.0572252*f),e.alpha)}function w(e,t,r){var f=t-e;return e+r*(f>180||f<-180?f-360*Math.round(f/360):f)}var z={forward:_l,reverse:m,interpolate:function(e,t,r){return{l:Aa(e.l,t.l,r),a:Aa(e.a,t.a,r),b:Aa(e.b,t.b,r),alpha:Aa(e.alpha,t.alpha,r)}}},I={forward:function(e){var t=_l(e),r=t.l,f=t.a,v=t.b,y=Math.atan2(v,f)*qu;return{h:y<0?y+360:y,c:Math.sqrt(f*f+v*v),l:r,alpha:e.a}},reverse:function(e){var t=e.h*yl,r=e.c;return m({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:w(e.h,t.h,r),c:Aa(e.c,t.c,r),l:Aa(e.l,t.l,r),alpha:Aa(e.alpha,t.alpha,r)}}},fe=Object.freeze({__proto__:null,lab:z,hcl:I}),Le=function(e,t,r,f,v){this.type=e,this.operator=t,this.interpolation=r,this.input=f,this.labels=[],this.outputs=[];for(var y=0,x=v;y<x.length;y+=1){var P=x[y],F=P[1];this.labels.push(P[0]),this.outputs.push(F)}};function pt(e,t,r,f){var v=f-r,y=e-r;return v===0?0:t===1?y/v:(Math.pow(t,y)-1)/(Math.pow(t,v)-1)}Le.interpolationFactor=function(e,t,r,f){var v=0;if(e.name==="exponential")v=pt(t,e.base,r,f);else if(e.name==="linear")v=pt(t,1,r,f);else if(e.name==="cubic-bezier"){var y=e.controlPoints;v=new te(y[0],y[1],y[2],y[3]).solve(pt(t,1,r,f))}return v},Le.parse=function(e,t){var r=e[0],f=e[1],v=e[2],y=e.slice(3);if(!Array.isArray(f)||f.length===0)return t.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){var x=f[1];if(typeof x!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:x}}else{if(f[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(f[0]),1,0);var P=f.slice(1);if(P.length!==4||P.some(function(_t){return typeof _t!="number"||_t<0||_t>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:P}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,nr)))return null;var F=[],U=null;r==="interpolate-hcl"||r==="interpolate-lab"?U=xn:t.expectedType&&t.expectedType.kind!=="value"&&(U=t.expectedType);for(var W=0;W<y.length;W+=2){var ne=y[W],de=y[W+1],be=W+3,He=W+4;if(typeof ne!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',be);if(F.length&&F[F.length-1][0]>=ne)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',be);var Xe=t.parse(de,He,U);if(!Xe)return null;U=U||Xe.type,F.push([ne,Xe])}return U.kind==="number"||U.kind==="color"||U.kind==="array"&&U.itemType.kind==="number"&&typeof U.N=="number"?new Le(U,r,f,v,F):t.error("Type "+Yi(U)+" is not interpolatable.")},Le.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;if(f>=t[v-1])return r[v-1].evaluate(e);var y=Ys(t,f),x=Le.interpolationFactor(this.interpolation,f,t[y],t[y+1]),P=r[y].evaluate(e),F=r[y+1].evaluate(e);return this.operator==="interpolate"?wo[this.type.kind.toLowerCase()](P,F,x):this.operator==="interpolate-hcl"?I.reverse(I.interpolate(I.forward(P),I.forward(F),x)):z.reverse(z.interpolate(z.forward(P),z.forward(F),x))},Le.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},Le.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Le.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var Zt=function(e,t){this.type=e,this.args=t};Zt.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,f=t.expectedType;f&&f.kind!=="value"&&(r=f);for(var v=[],y=0,x=e.slice(1);y<x.length;y+=1){var P=t.parse(x[y],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!P)return null;r=r||P.type,v.push(P)}var F=f&&v.some(function(U){return ya(f,U.type)});return new Zt(F?Tn:r,v)},Zt.prototype.evaluate=function(e){for(var t,r=null,f=0,v=0,y=this.args;v<y.length&&(f++,(r=y[v].evaluate(e))&&r instanceof qi&&!r.available&&(t||(t=r.name),r=null,f===this.args.length&&(r=t)),r===null);v+=1);return r},Zt.prototype.eachChild=function(e){this.args.forEach(e)},Zt.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Zt.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var jt=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};jt.prototype.evaluate=function(e){return this.result.evaluate(e)},jt.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},jt.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],f=1;f<e.length-1;f+=2){var v=e[f];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",f);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);var y=t.parse(e[f+1],f+1);if(!y)return null;r.push([v,y])}var x=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return x?new jt(r,x):null},jt.prototype.outputDefined=function(){return this.result.outputDefined()},jt.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var f=r[t];e.push(f[0],f[1].serialize())}return e.push(this.result.serialize()),e};var Fr=function(e,t,r){this.type=e,this.index=t,this.input=r};Fr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,nr),f=t.parse(e[2],2,na(t.expectedType||Tn));return r&&f?new Fr(f.type.itemType,r,f):null},Fr.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Ja("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new Ja("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new Ja("Array index must be an integer, but found "+t+" instead.");return r[t]},Fr.prototype.eachChild=function(e){e(this.index),e(this.input)},Fr.prototype.outputDefined=function(){return!1},Fr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Wr=function(e,t){this.type=vn,this.needle=e,this.haystack=t};Wr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,Tn),f=t.parse(e[2],2,Tn);return r&&f?Fa(r.type,[vn,In,nr,Fn,Tn])?new Wr(r,f):t.error("Expected first argument to be of type boolean, string, number or null, but found "+Yi(r.type)+" instead"):null},Wr.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!Ki(t,["boolean","string","number","null"]))throw new Ja("Expected first argument to be of type boolean, string, number or null, but found "+Yi(Ji(t))+" instead.");if(!Ki(r,["string","array"]))throw new Ja("Expected second argument to be of type array or string, but found "+Yi(Ji(r))+" instead.");return r.indexOf(t)>=0},Wr.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},Wr.prototype.outputDefined=function(){return!0},Wr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var hn=function(e,t,r){this.type=nr,this.needle=e,this.haystack=t,this.fromIndex=r};hn.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,Tn),f=t.parse(e[2],2,Tn);if(!r||!f)return null;if(!Fa(r.type,[vn,In,nr,Fn,Tn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+Yi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,nr);return v?new hn(r,f,v):null}return new hn(r,f)},hn.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Ki(t,["boolean","string","number","null"]))throw new Ja("Expected first argument to be of type boolean, string, number or null, but found "+Yi(Ji(t))+" instead.");if(!Ki(r,["string","array"]))throw new Ja("Expected second argument to be of type array or string, but found "+Yi(Ji(r))+" instead.");if(this.fromIndex){var f=this.fromIndex.evaluate(e);return r.indexOf(t,f)}return r.indexOf(t)},hn.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},hn.prototype.outputDefined=function(){return!1},hn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Oi=function(e,t,r,f,v,y){this.inputType=e,this.type=t,this.input=r,this.cases=f,this.outputs=v,this.otherwise=y};Oi.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,f;t.expectedType&&t.expectedType.kind!=="value"&&(f=t.expectedType);for(var v={},y=[],x=2;x<e.length-1;x+=2){var P=e[x],F=e[x+1];Array.isArray(P)||(P=[P]);var U=t.concat(x);if(P.length===0)return U.error("Expected at least one branch label.");for(var W=0,ne=P;W<ne.length;W+=1){var de=ne[W];if(typeof de!="number"&&typeof de!="string")return U.error("Branch labels must be numbers or strings.");if(typeof de=="number"&&Math.abs(de)>Number.MAX_SAFE_INTEGER)return U.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof de=="number"&&Math.floor(de)!==de)return U.error("Numeric branch labels must be integer values.");if(r){if(U.checkSubtype(r,Ji(de)))return null}else r=Ji(de);if(v[String(de)]!==void 0)return U.error("Branch labels must be unique.");v[String(de)]=y.length}var be=t.parse(F,x,f);if(!be)return null;f=f||be.type,y.push(be)}var He=t.parse(e[1],1,Tn);if(!He)return null;var Xe=t.parse(e[e.length-1],e.length-1,f);return Xe?He.type.kind!=="value"&&t.concat(1).checkSubtype(r,He.type)?null:new Oi(r,f,He,v,y,Xe):null},Oi.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(Ji(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},Oi.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},Oi.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},Oi.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],f={},v=0,y=Object.keys(this.cases).sort();v<y.length;v+=1){var x=y[v];(ne=f[this.cases[x]])===void 0?(f[this.cases[x]]=r.length,r.push([this.cases[x],[x]])):r[ne][1].push(x)}for(var P=function(be){return e.inputType.kind==="number"?Number(be):be},F=0,U=r;F<U.length;F+=1){var W=U[F],ne=W[0],de=W[1];t.push(de.length===1?P(de[0]):de.map(P)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var Ei=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};Ei.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var f=[],v=1;v<e.length-1;v+=2){var y=t.parse(e[v],v,vn);if(!y)return null;var x=t.parse(e[v+1],v+1,r);if(!x)return null;f.push([y,x]),r=r||x.type}var P=t.parse(e[e.length-1],e.length-1,r);return P?new Ei(r,f,P):null},Ei.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];if(f[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},Ei.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];e(f[0]),e(v)}e(this.otherwise)},Ei.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},Ei.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var pa=function(e,t,r,f){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=f};function Ma(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ga(e,t,r,f){return f.compare(t,r)===0}function _i(e,t,r){var f=e!=="=="&&e!=="!=";return function(){function v(y,x,P){this.type=vn,this.lhs=y,this.rhs=x,this.collator=P,this.hasUntypedArgument=y.type.kind==="value"||x.type.kind==="value"}return v.parse=function(y,x){if(y.length!==3&&y.length!==4)return x.error("Expected two or three arguments.");var P=y[0],F=x.parse(y[1],1,Tn);if(!F)return null;if(!Ma(P,F.type))return x.concat(1).error('"'+P+`" comparisons are not supported for type '`+Yi(F.type)+"'.");var U=x.parse(y[2],2,Tn);if(!U)return null;if(!Ma(P,U.type))return x.concat(2).error('"'+P+`" comparisons are not supported for type '`+Yi(U.type)+"'.");if(F.type.kind!==U.type.kind&&F.type.kind!=="value"&&U.type.kind!=="value")return x.error("Cannot compare types '"+Yi(F.type)+"' and '"+Yi(U.type)+"'.");f&&(F.type.kind==="value"&&U.type.kind!=="value"?F=new Ea(U.type,[F]):F.type.kind!=="value"&&U.type.kind==="value"&&(U=new Ea(F.type,[U])));var W=null;if(y.length===4){if(F.type.kind!=="string"&&U.type.kind!=="string"&&F.type.kind!=="value"&&U.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(!(W=x.parse(y[3],3,Di)))return null}return new v(F,U,W)},v.prototype.evaluate=function(y){var x=this.lhs.evaluate(y),P=this.rhs.evaluate(y);if(f&&this.hasUntypedArgument){var F=Ji(x),U=Ji(P);if(F.kind!==U.kind||F.kind!=="string"&&F.kind!=="number")throw new Ja('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+F.kind+", "+U.kind+") instead.")}if(this.collator&&!f&&this.hasUntypedArgument){var W=Ji(x),ne=Ji(P);if(W.kind!=="string"||ne.kind!=="string")return t(y,x,P)}return this.collator?r(y,x,P,this.collator.evaluate(y)):t(y,x,P)},v.prototype.eachChild=function(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var y=[e];return this.eachChild(function(x){y.push(x.serialize())}),y},v}()}pa.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,Tn),f=t.parse(e[2],2,nr);if(!r||!f)return null;if(!Fa(r.type,[na(Tn),In,Tn]))return t.error("Expected first argument to be of type array or string, but found "+Yi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,nr);return v?new pa(r.type,r,f,v):null}return new pa(r.type,r,f)},pa.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Ki(t,["string","array"]))throw new Ja("Expected first argument to be of type array or string, but found "+Yi(Ji(t))+" instead.");if(this.endIndex){var f=this.endIndex.evaluate(e);return t.slice(r,f)}return t.slice(r)},pa.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},pa.prototype.outputDefined=function(){return!1},pa.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var go=_i("==",function(e,t,r){return t===r},ga),Ao=_i("!=",function(e,t,r){return t!==r},function(e,t,r,f){return!ga(0,t,r,f)}),Ks=_i("<",function(e,t,r){return t<r},function(e,t,r,f){return f.compare(t,r)<0}),uu=_i(">",function(e,t,r){return t>r},function(e,t,r,f){return f.compare(t,r)>0}),$s=_i("<=",function(e,t,r){return t<=r},function(e,t,r,f){return f.compare(t,r)<=0}),Ru=_i(">=",function(e,t,r){return t>=r},function(e,t,r,f){return f.compare(t,r)>=0}),Ho=function(e,t,r,f,v){this.type=In,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=f,this.maxFractionDigits=v};Ho.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,nr);if(!r)return null;var f=e[2];if(typeof f!="object"||Array.isArray(f))return t.error("NumberFormat options argument must be an object.");var v=null;if(f.locale&&!(v=t.parse(f.locale,1,In)))return null;var y=null;if(f.currency&&!(y=t.parse(f.currency,1,In)))return null;var x=null;if(f["min-fraction-digits"]&&!(x=t.parse(f["min-fraction-digits"],1,nr)))return null;var P=null;return f["max-fraction-digits"]&&!(P=t.parse(f["max-fraction-digits"],1,nr))?null:new Ho(r,v,y,x,P)},Ho.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Ho.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Ho.prototype.outputDefined=function(){return!1},Ho.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var _s=function(e){this.type=nr,this.input=e};_s.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+Yi(r.type)+" instead."):new _s(r):null},_s.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Ja("Expected value to be of type string or array, but found "+Yi(Ji(t))+" instead.")},_s.prototype.eachChild=function(e){e(this.input)},_s.prototype.outputDefined=function(){return!1},_s.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var uo={"==":go,"!=":Ao,">":uu,"<":Ks,">=":Ru,"<=":$s,array:Ea,at:Fr,boolean:Ea,case:Ei,coalesce:Zt,collator:as,format:Do,image:ko,in:Wr,"index-of":hn,interpolate:Le,"interpolate-hcl":Le,"interpolate-lab":Le,length:_s,let:jt,literal:Qi,match:Oi,number:Ea,"number-format":Ho,object:Ea,slice:pa,step:Ts,string:Ea,"to-boolean":yo,"to-color":yo,"to-number":yo,"to-string":yo,var:us,within:qo};function La(e,t){var r=t[0],f=t[1],v=t[2],y=t[3];r=r.evaluate(e),f=f.evaluate(e),v=v.evaluate(e);var x=y?y.evaluate(e):1,P=ou(r,f,v,x);if(P)throw new Ja(P);return new $i(r/255*x,f/255*x,v/255*x,x)}function Js(e,t){return e in t}function xl(e,t){var r=t[e];return r===void 0?null:r}function xs(e){return{type:e}}function kl(e){return{result:"success",value:e}}function Qs(e){return{result:"error",value:e}}function qs(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function mc(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Du(e){return!!e.expression&&e.expression.interpolated}function Ra(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function bl(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Kc(e){return e}function ku(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function Sl(e,t,r,f,v){return ku(typeof r===v?f[r]:void 0,e.default,t.default)}function $c(e,t,r){if(Ra(r)!=="number")return ku(e.default,t.default);var f=e.stops.length;if(f===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[f-1][0])return e.stops[f-1][1];var v=Ys(e.stops.map(function(y){return y[0]}),r);return e.stops[v][1]}function el(e,t,r){var f=e.base!==void 0?e.base:1;if(Ra(r)!=="number")return ku(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var y=Ys(e.stops.map(function(ne){return ne[0]}),r),x=function(ne,de,be,He){var Xe=He-be,_t=ne-be;return Xe===0?0:de===1?_t/Xe:(Math.pow(de,_t)-1)/(Math.pow(de,Xe)-1)}(r,f,e.stops[y][0],e.stops[y+1][0]),P=e.stops[y][1],F=e.stops[y+1][1],U=wo[t.type]||Kc;if(e.colorSpace&&e.colorSpace!=="rgb"){var W=fe[e.colorSpace];U=function(ne,de){return W.reverse(W.interpolate(W.forward(ne),W.forward(de),x))}}return typeof P.evaluate=="function"?{evaluate:function(){for(var ne=[],de=arguments.length;de--;)ne[de]=arguments[de];var be=P.evaluate.apply(void 0,ne),He=F.evaluate.apply(void 0,ne);if(be!==void 0&&He!==void 0)return U(be,He,x)}}:U(P,F,x)}function Ql(e,t,r){return t.type==="color"?r=$i.parse(r):t.type==="formatted"?r=za.fromString(r.toString()):t.type==="resolvedImage"?r=qi.fromString(r.toString()):Ra(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),ku(r,e.default,t.default)}ho.register(uo,{error:[{kind:"error"},[In],function(e,t){throw new Ja(t[0].evaluate(e))}],typeof:[In,[Tn],function(e,t){return Yi(Ji(t[0].evaluate(e)))}],"to-rgba":[na(nr,4),[xn],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[xn,[nr,nr,nr],La],rgba:[xn,[nr,nr,nr,nr],La],has:{type:vn,overloads:[[[In],function(e,t){return Js(t[0].evaluate(e),e.properties())}],[[In,zi],function(e,t){var r=t[1];return Js(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:Tn,overloads:[[[In],function(e,t){return xl(t[0].evaluate(e),e.properties())}],[[In,zi],function(e,t){var r=t[1];return xl(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[Tn,[In],function(e,t){return xl(t[0].evaluate(e),e.featureState||{})}],properties:[zi,[],function(e){return e.properties()}],"geometry-type":[In,[],function(e){return e.geometryType()}],id:[Tn,[],function(e){return e.id()}],zoom:[nr,[],function(e){return e.globals.zoom}],"heatmap-density":[nr,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[nr,[],function(e){return e.globals.lineProgress||0}],accumulated:[Tn,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[nr,xs(nr),function(e,t){for(var r=0,f=0,v=t;f<v.length;f+=1)r+=v[f].evaluate(e);return r}],"*":[nr,xs(nr),function(e,t){for(var r=1,f=0,v=t;f<v.length;f+=1)r*=v[f].evaluate(e);return r}],"-":{type:nr,overloads:[[[nr,nr],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[nr],function(e,t){return-t[0].evaluate(e)}]]},"/":[nr,[nr,nr],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[nr,[nr,nr],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[nr,[],function(){return Math.LN2}],pi:[nr,[],function(){return Math.PI}],e:[nr,[],function(){return Math.E}],"^":[nr,[nr,nr],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[nr,[nr],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[nr,[nr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[nr,[nr],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[nr,[nr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[nr,[nr],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[nr,[nr],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[nr,[nr],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[nr,[nr],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[nr,[nr],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[nr,[nr],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[nr,xs(nr),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[nr,xs(nr),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[nr,[nr],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[nr,[nr],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[nr,[nr],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[nr,[nr],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[vn,[In,Tn],function(e,t){var r=t[0],f=t[1];return e.properties()[r.value]===f.value}],"filter-id-==":[vn,[Tn],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[vn,[In],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[vn,[In,Tn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v<y}],"filter-id-<":[vn,[Tn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<v}],"filter->":[vn,[In,Tn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v>y}],"filter-id->":[vn,[Tn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>v}],"filter-<=":[vn,[In,Tn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v<=y}],"filter-id-<=":[vn,[Tn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<=v}],"filter->=":[vn,[In,Tn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v>=y}],"filter-id->=":[vn,[Tn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>=v}],"filter-has":[vn,[Tn],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[vn,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[vn,[na(In)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[vn,[na(Tn)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[vn,[In,na(Tn)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[vn,[In,na(Tn)],function(e,t){var r=t[0],f=t[1];return function(v,y,x,P){for(;x<=P;){var F=x+P>>1;if(y[F]===v)return!0;y[F]>v?P=F-1:x=F+1}return!1}(e.properties()[r.value],f.value,0,f.value.length-1)}],all:{type:vn,overloads:[[[vn,vn],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[xs(vn),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(!f[r].evaluate(e))return!1;return!0}]]},any:{type:vn,overloads:[[[vn,vn],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[xs(vn),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(f[r].evaluate(e))return!0;return!1}]]},"!":[vn,[vn],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[vn,[In],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[In,[In],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[In,[In],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[In,xs(Tn),function(e,t){return t.map(function(r){return xo(r.evaluate(e))}).join("")}],"resolved-locale":[In,[Di],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var Au=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Ba,this._defaultValue=t?function(r){return r.type==="color"&&bl(r.default)?new $i(0,0,0,0):r.type==="color"?$i.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function tl(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in uo}function El(e,t){var r=new Zs(uo,[],t?function(v){var y={color:xn,string:In,number:nr,enum:In,boolean:vn,formatted:ra,resolvedImage:hi};return v.type==="array"?na(y[v.value]||Tn,v.length):y[v.type]}(t):void 0),f=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?kl(new Au(f,t)):Qs(r.errors)}Au.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,y){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)},Au.prototype.evaluate=function(e,t,r,f,v,y){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=y||null;try{var x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Ja("Expected value to be one of "+Object.keys(this._enumValues).map(function(P){return JSON.stringify(P)}).join(", ")+", but found "+JSON.stringify(x)+" instead.");return x}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console!="undefined"&&console.warn(P.message)),this._defaultValue}};var Cl=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!ss(t.expression)};Cl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,y){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,y)},Cl.prototype.evaluate=function(e,t,r,f,v,y){return this._styleExpression.evaluate(e,t,r,f,v,y)};var rl=function(e,t,r,f){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!ss(t.expression),this.interpolationType=f};function wl(e,t){if((e=El(e,t)).result==="error")return e;var r=e.value.expression,f=es(r);if(!f&&!qs(t))return Qs([new Zr("","data expressions not supported")]);var v=As(r,["zoom"]);if(!v&&!mc(t))return Qs([new Zr("","zoom expressions not supported")]);var y=function x(P){var F=null;if(P instanceof jt)F=x(P.result);else if(P instanceof Zt)for(var U=0,W=P.args;U<W.length&&!(F=x(W[U]));U+=1);else(P instanceof Ts||P instanceof Le)&&P.input instanceof ho&&P.input.name==="zoom"&&(F=P);return F instanceof Zr||P.eachChild(function(ne){var de=x(ne);de instanceof Zr?F=de:!F&&de?F=new Zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):F&&de&&F!==de&&(F=new Zr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),F}(r);return y||v?y instanceof Zr?Qs([y]):y instanceof Le&&!Du(t)?Qs([new Zr("",'"interpolate" expressions cannot be used with this property')]):kl(y?new rl(f?"camera":"composite",e.value,y.labels,y instanceof Le?y.interpolation:void 0):new Cl(f?"constant":"source",e.value)):Qs([new Zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}rl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,y){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,y)},rl.prototype.evaluate=function(e,t,r,f,v,y){return this._styleExpression.evaluate(e,t,r,f,v,y)},rl.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?Le.interpolationFactor(this.interpolationType,e,t,r):0};var nl=function(e,t){this._parameters=e,this._specification=t,Er(this,function r(f,v){var y,x,P,F=v.type==="color",U=f.stops&&typeof f.stops[0][0]=="object",W=U||!(U||f.property!==void 0),ne=f.type||(Du(v)?"exponential":"interval");if(F&&((f=Er({},f)).stops&&(f.stops=f.stops.map(function(jn){return[jn[0],$i.parse(jn[1])]})),f.default=$i.parse(f.default?f.default:v.default)),f.colorSpace&&f.colorSpace!=="rgb"&&!fe[f.colorSpace])throw new Error("Unknown color space: "+f.colorSpace);if(ne==="exponential")y=el;else if(ne==="interval")y=$c;else if(ne==="categorical"){y=Sl,x=Object.create(null);for(var de=0,be=f.stops;de<be.length;de+=1){var He=be[de];x[He[0]]=He[1]}P=typeof f.stops[0][0]}else{if(ne!=="identity")throw new Error('Unknown function type "'+ne+'"');y=Ql}if(U){for(var Xe={},_t=[],rt=0;rt<f.stops.length;rt++){var Dt=f.stops[rt],qt=Dt[0].zoom;Xe[qt]===void 0&&(Xe[qt]={zoom:qt,type:f.type,property:f.property,default:f.default,stops:[]},_t.push(qt)),Xe[qt].stops.push([Dt[0].value,Dt[1]])}for(var mr=[],xr=0,Nr=_t;xr<Nr.length;xr+=1){var ln=Nr[xr];mr.push([Xe[ln].zoom,r(Xe[ln],v)])}var wn={name:"linear"};return{kind:"composite",interpolationType:wn,interpolationFactor:Le.interpolationFactor.bind(void 0,wn),zoomStops:mr.map(function(jn){return jn[0]}),evaluate:function(jn,ci){var $n=jn.zoom;return el({stops:mr,base:f.base},v,$n).evaluate($n,ci)}}}if(W){var ei=ne==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:ei,interpolationFactor:Le.interpolationFactor.bind(void 0,ei),zoomStops:f.stops.map(function(jn){return jn[0]}),evaluate:function(jn){return y(f,v,jn.zoom,x,P)}}}return{kind:"source",evaluate:function(jn,ci){var $n=ci&&ci.properties?ci.properties[f.property]:void 0;return $n===void 0?ku(f.default,v.default):y(f,v,$n,x,P)}}}(this._parameters,this._specification))};function eu(e){var t=e.key,r=e.value,f=e.valueSpec||{},v=e.objectElementValidators||{},y=e.style,x=e.styleSpec,P=[],F=Ra(r);if(F!=="object")return[new _e(t,r,"object expected, "+F+" found")];for(var U in r){var W=U.split(".")[0],ne=f[W]||f["*"],de=void 0;if(v[W])de=v[W];else if(f[W])de=la;else if(v["*"])de=v["*"];else{if(!f["*"]){P.push(new _e(t,r[U],'unknown property "'+U+'"'));continue}de=la}P=P.concat(de({key:(t&&t+".")+U,value:r[U],valueSpec:ne,style:y,styleSpec:x,object:r,objectKey:U},r))}for(var be in f)v[be]||f[be].required&&f[be].default===void 0&&r[be]===void 0&&P.push(new _e(t,r,'missing required property "'+be+'"'));return P}function ql(e){var t=e.value,r=e.valueSpec,f=e.style,v=e.styleSpec,y=e.key,x=e.arrayElementValidator||la;if(Ra(t)!=="array")return[new _e(y,t,"array expected, "+Ra(t)+" found")];if(r.length&&t.length!==r.length)return[new _e(y,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new _e(y,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var P={type:r.value,values:r.values};v.$version<7&&(P.function=r.function),Ra(r.value)==="object"&&(P=r.value);for(var F=[],U=0;U<t.length;U++)F=F.concat(x({array:t,arrayIndex:U,value:t[U],valueSpec:P,style:f,styleSpec:v,key:y+"["+U+"]"}));return F}function Fu(e){var t=e.key,r=e.value,f=e.valueSpec,v=Ra(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new _e(t,r,"number expected, "+v+" found")]:"minimum"in f&&r<f.minimum?[new _e(t,r,r+" is less than the minimum value "+f.minimum)]:"maximum"in f&&r>f.maximum?[new _e(t,r,r+" is greater than the maximum value "+f.maximum)]:[]}function Dc(e){var t,r,f,v=e.valueSpec,y=Kt(e.value.type),x={},P=y!=="categorical"&&e.value.property===void 0,F=!P,U=Ra(e.value.stops)==="array"&&Ra(e.value.stops[0])==="array"&&Ra(e.value.stops[0][0])==="object",W=eu({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(be){if(y==="identity")return[new _e(be.key,be.value,'identity function may not have a "stops" property')];var He=[],Xe=be.value;return He=He.concat(ql({key:be.key,value:Xe,valueSpec:be.valueSpec,style:be.style,styleSpec:be.styleSpec,arrayElementValidator:ne})),Ra(Xe)==="array"&&Xe.length===0&&He.push(new _e(be.key,Xe,"array must have at least one stop")),He},default:function(be){return la({key:be.key,value:be.value,valueSpec:v,style:be.style,styleSpec:be.styleSpec})}}});return y==="identity"&&P&&W.push(new _e(e.key,e.value,'missing required property "property"')),y==="identity"||e.value.stops||W.push(new _e(e.key,e.value,'missing required property "stops"')),y==="exponential"&&e.valueSpec.expression&&!Du(e.valueSpec)&&W.push(new _e(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(F&&!qs(e.valueSpec)?W.push(new _e(e.key,e.value,"property functions not supported")):P&&!mc(e.valueSpec)&&W.push(new _e(e.key,e.value,"zoom functions not supported"))),y!=="categorical"&&!U||e.value.property!==void 0||W.push(new _e(e.key,e.value,'"property" property is required')),W;function ne(be){var He=[],Xe=be.value,_t=be.key;if(Ra(Xe)!=="array")return[new _e(_t,Xe,"array expected, "+Ra(Xe)+" found")];if(Xe.length!==2)return[new _e(_t,Xe,"array length 2 expected, length "+Xe.length+" found")];if(U){if(Ra(Xe[0])!=="object")return[new _e(_t,Xe,"object expected, "+Ra(Xe[0])+" found")];if(Xe[0].zoom===void 0)return[new _e(_t,Xe,"object stop key must have zoom")];if(Xe[0].value===void 0)return[new _e(_t,Xe,"object stop key must have value")];if(f&&f>Kt(Xe[0].zoom))return[new _e(_t,Xe[0].zoom,"stop zoom values must appear in ascending order")];Kt(Xe[0].zoom)!==f&&(f=Kt(Xe[0].zoom),r=void 0,x={}),He=He.concat(eu({key:_t+"[0]",value:Xe[0],valueSpec:{zoom:{}},style:be.style,styleSpec:be.styleSpec,objectElementValidators:{zoom:Fu,value:de}}))}else He=He.concat(de({key:_t+"[0]",value:Xe[0],valueSpec:{},style:be.style,styleSpec:be.styleSpec},Xe));return tl(ir(Xe[1]))?He.concat([new _e(_t+"[1]",Xe[1],"expressions are not allowed in function stops.")]):He.concat(la({key:_t+"[1]",value:Xe[1],valueSpec:v,style:be.style,styleSpec:be.styleSpec}))}function de(be,He){var Xe=Ra(be.value),_t=Kt(be.value),rt=be.value!==null?be.value:He;if(t){if(Xe!==t)return[new _e(be.key,rt,Xe+" stop domain type must match previous stop domain type "+t)]}else t=Xe;if(Xe!=="number"&&Xe!=="string"&&Xe!=="boolean")return[new _e(be.key,rt,"stop domain value must be a number, string, or boolean")];if(Xe!=="number"&&y!=="categorical"){var Dt="number expected, "+Xe+" found";return qs(v)&&y===void 0&&(Dt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _e(be.key,rt,Dt)]}return y!=="categorical"||Xe!=="number"||isFinite(_t)&&Math.floor(_t)===_t?y!=="categorical"&&Xe==="number"&&r!==void 0&&_t<r?[new _e(be.key,rt,"stop domain values must appear in ascending order")]:(r=_t,y==="categorical"&&_t in x?[new _e(be.key,rt,"stop domain values must be unique")]:(x[_t]=!0,[])):[new _e(be.key,rt,"integer expected, found "+_t)]}}function il(e){var t=(e.expressionContext==="property"?wl:El)(ir(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(f){return new _e(""+e.key+f.key,e.value,f.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new _e(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!ss(r))return[new _e(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!ss(r))return[new _e(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!As(r,["zoom","feature-state"]))return[new _e(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!es(r))return[new _e(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Al(e){var t=e.key,r=e.value,f=e.valueSpec,v=[];return Array.isArray(f.values)?f.values.indexOf(Kt(r))===-1&&v.push(new _e(t,r,"expected one of ["+f.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(f.values).indexOf(Kt(r))===-1&&v.push(new _e(t,r,"expected one of ["+Object.keys(f.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function Fl(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var f=r[t];if(!Fl(f)&&typeof f!="boolean")return!1}return!0;default:return!0}}nl.deserialize=function(e){return new nl(e._parameters,e._specification)},nl.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var yc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Bl(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};Fl(e)||(e=ec(e));var t=El(e,yc);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,f,v){return t.value.evaluate(r,f,{},v)},needGeometry:function r(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(var v=1;v<f.length;v++)if(r(f[v]))return!0;return!1}(e)}}function kc(e,t){return e<t?-1:e>t?1:0}function ec(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?vu(e[1],e[2],"=="):r==="!="?Bu(vu(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?vu(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(ec))):r==="all"?["all"].concat(e.slice(1).map(ec)):r==="none"?["all"].concat(e.slice(1).map(ec).map(Bu)):r==="in"?Xa(e[1],e.slice(2)):r==="!in"?Bu(Xa(e[1],e.slice(2))):r==="has"?lo(e[1]):r==="!has"?Bu(lo(e[1])):r!=="within"||e}function vu(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function Xa(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(kc)]]:["filter-in-small",e,["literal",t]]}}function lo(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Bu(e){return["!",e]}function Fs(e){return Fl(ir(e.value))?il(Er({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var f=r.value,v=r.key;if(Ra(f)!=="array")return[new _e(v,f,"array expected, "+Ra(f)+" found")];var y,x=r.styleSpec,P=[];if(f.length<1)return[new _e(v,f,"filter array must have at least 1 element")];switch(P=P.concat(Al({key:v+"[0]",value:f[0],valueSpec:x.filter_operator,style:r.style,styleSpec:r.styleSpec})),Kt(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&Kt(f[1])==="$type"&&P.push(new _e(v,f,'"$type" cannot be use with operator "'+f[0]+'"'));case"==":case"!=":f.length!==3&&P.push(new _e(v,f,'filter array for operator "'+f[0]+'" must have 3 elements'));case"in":case"!in":f.length>=2&&(y=Ra(f[1]))!=="string"&&P.push(new _e(v+"[1]",f[1],"string expected, "+y+" found"));for(var F=2;F<f.length;F++)y=Ra(f[F]),Kt(f[1])==="$type"?P=P.concat(Al({key:v+"["+F+"]",value:f[F],valueSpec:x.geometry_type,style:r.style,styleSpec:r.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&P.push(new _e(v+"["+F+"]",f[F],"string, number, or boolean expected, "+y+" found"));break;case"any":case"all":case"none":for(var U=1;U<f.length;U++)P=P.concat(t({key:v+"["+U+"]",value:f[U],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":y=Ra(f[1]),f.length!==2?P.push(new _e(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):y!=="string"&&P.push(new _e(v+"[1]",f[1],"string expected, "+y+" found"));break;case"within":y=Ra(f[1]),f.length!==2?P.push(new _e(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):y!=="object"&&P.push(new _e(v+"[1]",f[1],"object expected, "+y+" found"))}return P}(e)}function tc(e,t){var r=e.key,f=e.style,v=e.styleSpec,y=e.value,x=e.objectKey,P=v[t+"_"+e.layerType];if(!P)return[];var F=x.match(/^(.*)-transition$/);if(t==="paint"&&F&&P[F[1]]&&P[F[1]].transition)return la({key:r,value:y,valueSpec:v.transition,style:f,styleSpec:v});var U,W=e.valueSpec||P[x];if(!W)return[new _e(r,y,'unknown property "'+x+'"')];if(Ra(y)==="string"&&qs(W)&&!W.tokens&&(U=/^{([^}]+)}$/.exec(y)))return[new _e(r,y,'"'+x+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(U[1])+" }`.")];var ne=[];return e.layerType==="symbol"&&(x==="text-field"&&f&&!f.glyphs&&ne.push(new _e(r,y,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&bl(ir(y))&&Kt(y.type)==="identity"&&ne.push(new _e(r,y,'"text-font" does not support identity functions'))),ne.concat(la({key:e.key,value:y,valueSpec:W,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:x}))}function Nl(e){return tc(e,"paint")}function Nu(e){return tc(e,"layout")}function Tl(e){var t=[],r=e.value,f=e.key,v=e.style,y=e.styleSpec;r.type||r.ref||t.push(new _e(f,r,'either "type" or "ref" is required'));var x,P=Kt(r.type),F=Kt(r.ref);if(r.id)for(var U=Kt(r.id),W=0;W<e.arrayIndex;W++){var ne=v.layers[W];Kt(ne.id)===U&&t.push(new _e(f,r.id,'duplicate layer id "'+r.id+'", previously used at line '+ne.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(He){He in r&&t.push(new _e(f,r[He],'"'+He+'" is prohibited for ref layers'))}),v.layers.forEach(function(He){Kt(He.id)===F&&(x=He)}),x?x.ref?t.push(new _e(f,r.ref,"ref cannot reference another ref layer")):P=Kt(x.type):t.push(new _e(f,r.ref,'ref layer "'+F+'" not found'));else if(P!=="background")if(r.source){var de=v.sources&&v.sources[r.source],be=de&&Kt(de.type);de?be==="vector"&&P==="raster"?t.push(new _e(f,r.source,'layer "'+r.id+'" requires a raster source')):be==="raster"&&P!=="raster"?t.push(new _e(f,r.source,'layer "'+r.id+'" requires a vector source')):be!=="vector"||r["source-layer"]?be==="raster-dem"&&P!=="hillshade"?t.push(new _e(f,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!r.paint||!r.paint["line-gradient"]||be==="geojson"&&de.lineMetrics||t.push(new _e(f,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new _e(f,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new _e(f,r.source,'source "'+r.source+'" not found'))}else t.push(new _e(f,r,'missing required property "source"'));return t=t.concat(eu({key:f,value:r,valueSpec:y.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return la({key:f+".type",value:r.type,valueSpec:y.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:Fs,layout:function(He){return eu({layer:r,key:He.key,value:He.value,style:He.style,styleSpec:He.styleSpec,objectElementValidators:{"*":function(Xe){return Nu(Er({layerType:P},Xe))}}})},paint:function(He){return eu({layer:r,key:He.key,value:He.value,style:He.style,styleSpec:He.styleSpec,objectElementValidators:{"*":function(Xe){return Nl(Er({layerType:P},Xe))}}})}}}))}function zu(e){var t=e.value,r=e.key,f=Ra(t);return f!=="string"?[new _e(r,t,"string expected, "+f+" found")]:[]}var qa={promoteId:function(e){var t=e.key,r=e.value;if(Ra(r)==="string")return zu({key:t,value:r});var f=[];for(var v in r)f.push.apply(f,zu({key:t+"."+v,value:r[v]}));return f}};function zl(e){var t=e.value,r=e.key,f=e.styleSpec,v=e.style;if(!t.type)return[new _e(r,t,'"type" is required')];var y,x=Kt(t.type);switch(x){case"vector":case"raster":case"raster-dem":return eu({key:r,value:t,valueSpec:f["source_"+x.replace("-","_")],style:e.style,styleSpec:f,objectElementValidators:qa});case"geojson":if(y=eu({key:r,value:t,valueSpec:f.source_geojson,style:v,styleSpec:f,objectElementValidators:qa}),t.cluster)for(var P in t.clusterProperties){var F=t.clusterProperties[P],U=F[0],W=typeof U=="string"?[U,["accumulated"],["get",P]]:U;y.push.apply(y,il({key:r+"."+P+".map",value:F[1],expressionContext:"cluster-map"})),y.push.apply(y,il({key:r+"."+P+".reduce",value:W,expressionContext:"cluster-reduce"}))}return y;case"video":return eu({key:r,value:t,valueSpec:f.source_video,style:v,styleSpec:f});case"image":return eu({key:r,value:t,valueSpec:f.source_image,style:v,styleSpec:f});case"canvas":return[new _e(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Al({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:f})}}function js(e){var t=e.value,r=e.styleSpec,f=r.light,v=e.style,y=[],x=Ra(t);if(t===void 0)return y;if(x!=="object")return y.concat([new _e("light",t,"object expected, "+x+" found")]);for(var P in t){var F=P.match(/^(.*)-transition$/);y=y.concat(F&&f[F[1]]&&f[F[1]].transition?la({key:P,value:t[P],valueSpec:r.transition,style:v,styleSpec:r}):f[P]?la({key:P,value:t[P],valueSpec:f[P],style:v,styleSpec:r}):[new _e(P,t[P],'unknown property "'+P+'"')])}return y}var mu={"*":function(){return[]},array:ql,boolean:function(e){var t=e.value,r=e.key,f=Ra(t);return f!=="boolean"?[new _e(r,t,"boolean expected, "+f+" found")]:[]},number:Fu,color:function(e){var t=e.key,r=e.value,f=Ra(r);return f!=="string"?[new _e(t,r,"color expected, "+f+" found")]:Zi(r)===null?[new _e(t,r,'color expected, "'+r+'" found')]:[]},constants:dt,enum:Al,filter:Fs,function:Dc,layer:Tl,object:eu,source:zl,light:js,string:zu,formatted:function(e){return zu(e).length===0?[]:il(e)},resolvedImage:function(e){return zu(e).length===0?[]:il(e)}};function la(e){var t=e.value,r=e.valueSpec,f=e.styleSpec;return r.expression&&bl(Kt(t))?Dc(e):r.expression&&tl(ir(t))?il(e):r.type&&mu[r.type]?mu[r.type](e):eu(Er({},e,{valueSpec:r.type?f[r.type]:r}))}function Pi(e){var t=e.value,r=e.key,f=zu(e);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new _e(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new _e(r,t,'"glyphs" url must include a "{range}" token'))),f}function Ps(e,t){t===void 0&&(t=oe);var r=[];return r=r.concat(la({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Pi,"*":function(){return[]}}})),e.constants&&(r=r.concat(dt({key:"constants",value:e.constants,style:e,styleSpec:t}))),tu(r)}function tu(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function Zu(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return tu(e.apply(this,t))}}Ps.source=Zu(zl),Ps.light=Zu(js),Ps.layer=Zu(Tl),Ps.filter=Zu(Fs),Ps.paintProperty=Zu(Nl),Ps.layoutProperty=Zu(Nu);var ts=Ps,pf=ts.light,gc=ts.paintProperty,Zl=ts.layoutProperty;function Ul(e,t){var r=!1;if(t&&t.length)for(var f=0,v=t;f<v.length;f+=1)e.fire(new pe(new Error(v[f].message))),r=!0;return r}var yu=To;function To(e,t,r){var f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var y=0;y<this.d*this.d;y++){var x=v[3+y],P=v[3+y+1];f.push(x===P?null:v.subarray(x,P))}var F=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],F),this.bboxes=v.subarray(F),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var U=0;U<this.d*this.d;U++)f.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var W=r/t*e;this.min=-W,this.max=e+W}To.prototype.insert=function(e,t,r,f,v){this._forEachCell(t,r,f,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(f),this.bboxes.push(v)},To.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},To.prototype._insertCell=function(e,t,r,f,v,y){this.cells[v].push(y)},To.prototype.query=function(e,t,r,f,v){var y=this.min,x=this.max;if(e<=y&&t<=y&&x<=r&&x<=f&&!v)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(e,t,r,f,this._queryCell,P,{},v),P},To.prototype._queryCell=function(e,t,r,f,v,y,x,P){var F=this.cells[v];if(F!==null)for(var U=this.keys,W=this.bboxes,ne=0;ne<F.length;ne++){var de=F[ne];if(x[de]===void 0){var be=4*de;(P?P(W[be+0],W[be+1],W[be+2],W[be+3]):e<=W[be+2]&&t<=W[be+3]&&r>=W[be+0]&&f>=W[be+1])?(x[de]=!0,y.push(U[de])):x[de]=!1}}},To.prototype._forEachCell=function(e,t,r,f,v,y,x,P){for(var F=this._convertToCellCoord(e),U=this._convertToCellCoord(t),W=this._convertToCellCoord(r),ne=this._convertToCellCoord(f),de=F;de<=W;de++)for(var be=U;be<=ne;be++){var He=this.d*be+de;if((!P||P(this._convertFromCellCoord(de),this._convertFromCellCoord(be),this._convertFromCellCoord(de+1),this._convertFromCellCoord(be+1)))&&v.call(this,e,t,r,f,He,y,x,P))return}},To.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},To.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},To.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,f=0;f<this.cells.length;f++)r+=this.cells[f].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var y=t,x=0;x<e.length;x++){var P=e[x];v[3+x]=y,v.set(P,y),y+=P.length}return v[3+e.length]=y,v.set(this.keys,y),v[3+e.length+1]=y+=this.keys.length,v.set(this.bboxes,y),y+=this.bboxes.length,v.buffer};var Tu=K.ImageData,Pl=K.ImageBitmap,Po={};function Vn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Po[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var Na in Vn("Object",Object),yu.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},yu.deserialize=function(e){return new yu(e.buffer)},Vn("Grid",yu),Vn("Color",$i),Vn("Error",Error),Vn("ResolvedImage",qi),Vn("StylePropertyFunction",nl),Vn("StyleExpression",Au,{omit:["_evaluator"]}),Vn("ZoomDependentExpression",rl),Vn("ZoomConstantExpression",Cl),Vn("CompoundExpression",ho,{omit:["_evaluate"]}),uo)uo[Na]._classRegistryKey||Vn("Expression_"+Na,uo[Na]);function gu(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function Uu(e){return Pl&&e instanceof Pl}function eo(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(gu(e)||Uu(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof Tu)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var f=[],v=0,y=e;v<y.length;v+=1)f.push(eo(y[v],t));return f}if(typeof e=="object"){var x=e.constructor,P=x._classRegistryKey;if(!P)throw new Error("can't serialize object of unregistered class");var F=x.serialize?x.serialize(e,t):{};if(!x.serialize){for(var U in e)if(e.hasOwnProperty(U)&&!(Po[P].omit.indexOf(U)>=0)){var W=e[U];F[U]=Po[P].shallow.indexOf(U)>=0?W:eo(W,t)}e instanceof Error&&(F.message=e.message)}if(F.$name)throw new Error("$name property is reserved for worker serialization logic.");return P!=="Object"&&(F.$name=P),F}throw new Error("can't serialize object of type "+typeof e)}function Ms(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||gu(e)||Uu(e)||ArrayBuffer.isView(e)||e instanceof Tu)return e;if(Array.isArray(e))return e.map(Ms);if(typeof e=="object"){var t=e.$name||"Object",r=Po[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var f=Object.create(r.prototype),v=0,y=Object.keys(e);v<y.length;v+=1){var x=y[v];if(x!=="$name"){var P=e[x];f[x]=Po[t].shallow.indexOf(x)>=0?P:Ms(P)}}return f}throw new Error("can't deserialize object of type "+typeof e)}var _c=function(){this.first=!0};_c.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var En={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Pu(e){for(var t=0,r=e;t<r.length;t+=1)if(xc(r[t].charCodeAt(0)))return!0;return!1}function xc(e){return!(e!==746&&e!==747&&(e<4352||!(En["Bopomofo Extended"](e)||En.Bopomofo(e)||En["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||En["CJK Compatibility Ideographs"](e)||En["CJK Compatibility"](e)||En["CJK Radicals Supplement"](e)||En["CJK Strokes"](e)||!(!En["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||En["CJK Unified Ideographs Extension A"](e)||En["CJK Unified Ideographs"](e)||En["Enclosed CJK Letters and Months"](e)||En["Hangul Compatibility Jamo"](e)||En["Hangul Jamo Extended-A"](e)||En["Hangul Jamo Extended-B"](e)||En["Hangul Jamo"](e)||En["Hangul Syllables"](e)||En.Hiragana(e)||En["Ideographic Description Characters"](e)||En.Kanbun(e)||En["Kangxi Radicals"](e)||En["Katakana Phonetic Extensions"](e)||En.Katakana(e)&&e!==12540||!(!En["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!En["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||En["Unified Canadian Aboriginal Syllabics"](e)||En["Unified Canadian Aboriginal Syllabics Extended"](e)||En["Vertical Forms"](e)||En["Yijing Hexagram Symbols"](e)||En["Yi Syllables"](e)||En["Yi Radicals"](e))))}function lu(e){return!(xc(e)||function(t){return!!(En["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||En["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||En["Letterlike Symbols"](t)||En["Number Forms"](t)||En["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||En["Control Pictures"](t)&&t!==9251||En["Optical Character Recognition"](t)||En["Enclosed Alphanumerics"](t)||En["Geometric Shapes"](t)||En["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||En["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||En["CJK Symbols and Punctuation"](t)||En.Katakana(t)||En["Private Use Area"](t)||En["CJK Compatibility Forms"](t)||En["Small Form Variants"](t)||En["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function ja(e){return e>=1424&&e<=2303||En["Arabic Presentation Forms-A"](e)||En["Arabic Presentation Forms-B"](e)}function bs(e,t){return!(!t&&ja(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||En.Khmer(e))}function Ml(e){for(var t=0,r=e;t<r.length;t+=1)if(ja(r[t].charCodeAt(0)))return!0;return!1}var Vs=null,Is="unavailable",_u=null,Jc=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Is="error"),Vs&&Vs(e)};function rc(){bc.fire(new ee("pluginStateChange",{pluginStatus:Is,pluginURL:_u}))}var bc=new Ae,Bo=function(){return Is},Gs=function(){if(Is!=="deferred"||!_u)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Is="loading",rc(),_u&&Ln({url:_u},function(e){e?Jc(e):(Is="loaded",rc())})},Mo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Is==="loaded"||Mo.applyArabicShaping!=null},isLoading:function(){return Is==="loading"},setState:function(e){Is=e.pluginStatus,_u=e.pluginURL},isParsed:function(){return Mo.applyArabicShaping!=null&&Mo.processBidirectionalText!=null&&Mo.processStyledBidirectionalText!=null},getPluginURL:function(){return _u}},ea=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new _c,this.transition={})};ea.prototype.isSupportedScript=function(e){return function(t,r){for(var f=0,v=t;f<v.length;f+=1)if(!bs(v[f].charCodeAt(0),r))return!1;return!0}(e,Mo.isLoaded())},ea.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ea.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var ju=function(e,t){this.property=e,this.value=t,this.expression=function(r,f){if(bl(r))return new nl(r,f);if(tl(r)){var v=wl(r,f);if(v.result==="error")throw new Error(v.value.map(function(x){return x.key+": "+x.message}).join(", "));return v.value}var y=r;return typeof r=="string"&&f.type==="color"&&(y=$i.parse(r)),{kind:"constant",evaluate:function(){return y}}}(t===void 0?e.specification.default:t,e.specification)};ju.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},ju.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var cu=function(e){this.property=e,this.value=new ju(e,void 0)};cu.prototype.transitioned=function(e,t){return new al(this.property,this.value,t,Ft({},e.transition,this.transition),e.now)},cu.prototype.untransitioned=function(){return new al(this.property,this.value,null,{},0)};var Wo=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};Wo.prototype.getValue=function(e){return je(this._values[e].value.value)},Wo.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new cu(this._values[e].property)),this._values[e].value=new ju(this._values[e].property,t===null?void 0:je(t))},Wo.prototype.getTransition=function(e){return je(this._values[e].transition)},Wo.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new cu(this._values[e].property)),this._values[e].transition=je(t)||void 0},Wo.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v);var y=this.getTransition(f);y!==void 0&&(e[f+"-transition"]=y)}return e},Wo.prototype.transitioned=function(e,t){for(var r=new Mu(this._properties),f=0,v=Object.keys(this._values);f<v.length;f+=1){var y=v[f];r._values[y]=this._values[y].transitioned(e,t._values[y])}return r},Wo.prototype.untransitioned=function(){for(var e=new Mu(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t];e._values[f]=this._values[f].untransitioned()}return e};var al=function(e,t,r,f,v){this.property=e,this.value=t,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=r)};al.prototype.possiblyEvaluate=function(e,t,r){var f=e.now||0,v=this.value.possiblyEvaluate(e,t,r),y=this.prior;if(y){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return y.possiblyEvaluate(e,t,r);var x=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,t,r),v,function(P){if(P<=0)return 0;if(P>=1)return 1;var F=P*P,U=F*P;return 4*(P<.5?U:3*(P-F)+U-.75)}(x))}return v};var Mu=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};Mu.prototype.possiblyEvaluate=function(e,t,r){for(var f=new Il(this._properties),v=0,y=Object.keys(this._values);v<y.length;v+=1){var x=y[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f},Mu.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var xi=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};xi.prototype.getValue=function(e){return je(this._values[e].value)},xi.prototype.setValue=function(e,t){this._values[e]=new ju(this._values[e].property,t===null?void 0:je(t))},xi.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v)}return e},xi.prototype.possiblyEvaluate=function(e,t,r){for(var f=new Il(this._properties),v=0,y=Object.keys(this._values);v<y.length;v+=1){var x=y[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f};var co=function(e,t,r){this.property=e,this.value=t,this.parameters=r};co.prototype.isConstant=function(){return this.value.kind==="constant"},co.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},co.prototype.evaluate=function(e,t,r,f){return this.property.evaluate(this.value,this.parameters,e,t,r,f)};var Il=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};Il.prototype.get=function(e){return this._values[e]};var Gn=function(e){this.specification=e};Gn.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},Gn.prototype.interpolate=function(e,t,r){var f=wo[this.specification.type];return f?f(e,t,r):e};var Wn=function(e,t){this.specification=e,this.overrides=t};Wn.prototype.possiblyEvaluate=function(e,t,r,f){return new co(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,f)}:e.expression,t)},Wn.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new co(this,{kind:"constant",value:void 0},e.parameters);var f=wo[this.specification.type];return f?new co(this,{kind:"constant",value:f(e.value.value,t.value.value,r)},e.parameters):e},Wn.prototype.evaluate=function(e,t,r,f,v,y){return e.kind==="constant"?e.value:e.evaluate(t,r,f,v,y)};var ol=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f,v,y){if(r.value===void 0)return new co(this,{kind:"constant",value:void 0},f);if(r.expression.kind==="constant"){var x=r.expression.evaluate(f,null,{},v,y),P=r.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,F=this._calculate(P,P,P,f);return new co(this,{kind:"constant",value:F},f)}if(r.expression.kind==="camera"){var U=this._calculate(r.expression.evaluate({zoom:f.zoom-1}),r.expression.evaluate({zoom:f.zoom}),r.expression.evaluate({zoom:f.zoom+1}),f);return new co(this,{kind:"constant",value:U},f)}return new co(this,r.expression,f)},t.prototype.evaluate=function(r,f,v,y,x,P){if(r.kind==="source"){var F=r.evaluate(f,v,y,x,P);return this._calculate(F,F,F,f)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(f.zoom)-1},v,y),r.evaluate({zoom:Math.floor(f.zoom)},v,y),r.evaluate({zoom:Math.floor(f.zoom)+1},v,y),f):r.value},t.prototype._calculate=function(r,f,v,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:r,to:f}:{from:v,to:f}},t.prototype.interpolate=function(r){return r},t}(Wn),ls=function(e){this.specification=e};ls.prototype.possiblyEvaluate=function(e,t,r,f){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,f);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new ea(Math.floor(t.zoom-1),t)),e.expression.evaluate(new ea(Math.floor(t.zoom),t)),e.expression.evaluate(new ea(Math.floor(t.zoom+1),t)),t)}},ls.prototype._calculate=function(e,t,r,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},ls.prototype.interpolate=function(e){return e};var cs=function(e){this.specification=e};cs.prototype.possiblyEvaluate=function(e,t,r,f){return!!e.expression.evaluate(t,null,{},r,f)},cs.prototype.interpolate=function(){return!1};var Io=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var f=this.defaultPropertyValues[t]=new ju(r,void 0),v=this.defaultTransitionablePropertyValues[t]=new cu(r);this.defaultTransitioningPropertyValues[t]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=f.possiblyEvaluate({})}};Vn("DataDrivenProperty",Wn),Vn("DataConstantProperty",Gn),Vn("CrossFadedDataDrivenProperty",ol),Vn("CrossFadedProperty",ls),Vn("ColorRampProperty",cs);var ru=function(e){function t(r,f){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),f.layout&&(this._unevaluatedLayout=new xi(f.layout)),f.paint)){for(var v in this._transitionablePaint=new Wo(f.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var y in r.layout)this.setLayoutProperty(y,r.layout[y],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Il(f.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,f,v){v===void 0&&(v={}),f!=null&&this._validate(Zl,"layers."+this.id+".layout."+r,r,f,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,f):this.visibility=f)},t.prototype.getPaintProperty=function(r){return q(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,f,v){if(v===void 0&&(v={}),f!=null&&this._validate(gc,"layers."+this.id+".paint."+r,r,f,v))return!1;if(q(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),f||void 0),!1;var y=this._transitionablePaint._values[r],x=y.property.specification["property-type"]==="cross-faded-data-driven",P=y.value.isDataDriven(),F=y.value;this._transitionablePaint.setValue(r,f),this._handleSpecialPaintPropertyUpdate(r);var U=this._transitionablePaint._values[r].value;return U.isDataDriven()||P||x||this._handleOverridablePaintPropertyUpdate(r,F,U)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,f){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,f)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),et(r,function(f,v){return!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length)})},t.prototype._validate=function(r,f,v,y,x){return x===void 0&&(x={}),(!x||x.validate!==!1)&&Ul(this,r.call(ts,{key:f,layerType:this.type,objectKey:v,value:y,styleSpec:oe,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var f=this.paint.get(r);if(f instanceof co&&qs(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1},t}(Ae),Sc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},nc=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Xi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function ji(e,t){t===void 0&&(t=1);var r=0,f=0;return{members:e.map(function(v){var y=Sc[v.type].BYTES_PER_ELEMENT,x=r=Qc(r,Math.max(t,y)),P=v.components||1;return f=Math.max(f,y),r+=y*P,{name:v.name,type:v.type,components:P,offset:x}}),size:Qc(r,Math.max(f,t)),alignment:t}}function Qc(e,t){return Math.ceil(e/t)*t}Xi.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},Xi.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},Xi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Xi.prototype.clear=function(){this.length=0},Xi.prototype.resize=function(e){this.reserve(e),this.length=e},Xi.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},Xi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Bs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var y=2*r;return this.int16[y+0]=f,this.int16[y+1]=v,r},t}(Xi);Bs.prototype.bytesPerElement=4,Vn("StructArrayLayout2i4",Bs);var Ol=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,y)},t.prototype.emplace=function(r,f,v,y,x){var P=4*r;return this.int16[P+0]=f,this.int16[P+1]=v,this.int16[P+2]=y,this.int16[P+3]=x,r},t}(Xi);Ol.prototype.bytesPerElement=8,Vn("StructArrayLayout4i8",Ol);var Os=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,P){var F=this.length;return this.resize(F+1),this.emplace(F,r,f,v,y,x,P)},t.prototype.emplace=function(r,f,v,y,x,P,F){var U=6*r;return this.int16[U+0]=f,this.int16[U+1]=v,this.int16[U+2]=y,this.int16[U+3]=x,this.int16[U+4]=P,this.int16[U+5]=F,r},t}(Xi);Os.prototype.bytesPerElement=12,Vn("StructArrayLayout2i4i12",Os);var Ya=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,P){var F=this.length;return this.resize(F+1),this.emplace(F,r,f,v,y,x,P)},t.prototype.emplace=function(r,f,v,y,x,P,F){var U=4*r,W=8*r;return this.int16[U+0]=f,this.int16[U+1]=v,this.uint8[W+4]=y,this.uint8[W+5]=x,this.uint8[W+6]=P,this.uint8[W+7]=F,r},t}(Xi);Ya.prototype.bytesPerElement=8,Vn("StructArrayLayout2i4ub8",Ya);var Hs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var y=2*r;return this.float32[y+0]=f,this.float32[y+1]=v,r},t}(Xi);Hs.prototype.bytesPerElement=8,Vn("StructArrayLayout2f8",Hs);var Ss=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,P,F,U,W,ne){var de=this.length;return this.resize(de+1),this.emplace(de,r,f,v,y,x,P,F,U,W,ne)},t.prototype.emplace=function(r,f,v,y,x,P,F,U,W,ne,de){var be=10*r;return this.uint16[be+0]=f,this.uint16[be+1]=v,this.uint16[be+2]=y,this.uint16[be+3]=x,this.uint16[be+4]=P,this.uint16[be+5]=F,this.uint16[be+6]=U,this.uint16[be+7]=W,this.uint16[be+8]=ne,this.uint16[be+9]=de,r},t}(Xi);Ss.prototype.bytesPerElement=20,Vn("StructArrayLayout10ui20",Ss);var Vu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,P,F,U,W,ne,de,be){var He=this.length;return this.resize(He+1),this.emplace(He,r,f,v,y,x,P,F,U,W,ne,de,be)},t.prototype.emplace=function(r,f,v,y,x,P,F,U,W,ne,de,be,He){var Xe=12*r;return this.int16[Xe+0]=f,this.int16[Xe+1]=v,this.int16[Xe+2]=y,this.int16[Xe+3]=x,this.uint16[Xe+4]=P,this.uint16[Xe+5]=F,this.uint16[Xe+6]=U,this.uint16[Xe+7]=W,this.int16[Xe+8]=ne,this.int16[Xe+9]=de,this.int16[Xe+10]=be,this.int16[Xe+11]=He,r},t}(Xi);Vu.prototype.bytesPerElement=24,Vn("StructArrayLayout4i4ui4i24",Vu);var sl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var x=3*r;return this.float32[x+0]=f,this.float32[x+1]=v,this.float32[x+2]=y,r},t}(Xi);sl.prototype.bytesPerElement=12,Vn("StructArrayLayout3f12",sl);var Ll=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint32[1*r+0]=f,r},t}(Xi);Ll.prototype.bytesPerElement=4,Vn("StructArrayLayout1ul4",Ll);var Ec=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,P,F,U,W){var ne=this.length;return this.resize(ne+1),this.emplace(ne,r,f,v,y,x,P,F,U,W)},t.prototype.emplace=function(r,f,v,y,x,P,F,U,W,ne){var de=10*r,be=5*r;return this.int16[de+0]=f,this.int16[de+1]=v,this.int16[de+2]=y,this.int16[de+3]=x,this.int16[de+4]=P,this.int16[de+5]=F,this.uint32[be+3]=U,this.uint16[de+8]=W,this.uint16[de+9]=ne,r},t}(Xi);Ec.prototype.bytesPerElement=20,Vn("StructArrayLayout6i1ul2ui20",Ec);var ul=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,P){var F=this.length;return this.resize(F+1),this.emplace(F,r,f,v,y,x,P)},t.prototype.emplace=function(r,f,v,y,x,P,F){var U=6*r;return this.int16[U+0]=f,this.int16[U+1]=v,this.int16[U+2]=y,this.int16[U+3]=x,this.int16[U+4]=P,this.int16[U+5]=F,r},t}(Xi);ul.prototype.bytesPerElement=12,Vn("StructArrayLayout2i2i2i12",ul);var Gu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x){var P=this.length;return this.resize(P+1),this.emplace(P,r,f,v,y,x)},t.prototype.emplace=function(r,f,v,y,x,P){var F=4*r,U=8*r;return this.float32[F+0]=f,this.float32[F+1]=v,this.float32[F+2]=y,this.int16[U+6]=x,this.int16[U+7]=P,r},t}(Xi);Gu.prototype.bytesPerElement=16,Vn("StructArrayLayout2f1f2i16",Gu);var ll=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,y)},t.prototype.emplace=function(r,f,v,y,x){var P=12*r,F=3*r;return this.uint8[P+0]=f,this.uint8[P+1]=v,this.float32[F+1]=y,this.float32[F+2]=x,r},t}(Xi);ll.prototype.bytesPerElement=12,Vn("StructArrayLayout2ub2f12",ll);var xu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var x=3*r;return this.uint16[x+0]=f,this.uint16[x+1]=v,this.uint16[x+2]=y,r},t}(Xi);xu.prototype.bytesPerElement=6,Vn("StructArrayLayout3ui6",xu);var Hu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,P,F,U,W,ne,de,be,He,Xe,_t,rt,Dt){var qt=this.length;return this.resize(qt+1),this.emplace(qt,r,f,v,y,x,P,F,U,W,ne,de,be,He,Xe,_t,rt,Dt)},t.prototype.emplace=function(r,f,v,y,x,P,F,U,W,ne,de,be,He,Xe,_t,rt,Dt,qt){var mr=24*r,xr=12*r,Nr=48*r;return this.int16[mr+0]=f,this.int16[mr+1]=v,this.uint16[mr+2]=y,this.uint16[mr+3]=x,this.uint32[xr+2]=P,this.uint32[xr+3]=F,this.uint32[xr+4]=U,this.uint16[mr+10]=W,this.uint16[mr+11]=ne,this.uint16[mr+12]=de,this.float32[xr+7]=be,this.float32[xr+8]=He,this.uint8[Nr+36]=Xe,this.uint8[Nr+37]=_t,this.uint8[Nr+38]=rt,this.uint32[xr+10]=Dt,this.int16[mr+22]=qt,r},t}(Xi);Hu.prototype.bytesPerElement=48,Vn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Hu);var Cc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,P,F,U,W,ne,de,be,He,Xe,_t,rt,Dt,qt,mr,xr,Nr,ln,wn,ei,jn,ci,$n,oa){var Ri=this.length;return this.resize(Ri+1),this.emplace(Ri,r,f,v,y,x,P,F,U,W,ne,de,be,He,Xe,_t,rt,Dt,qt,mr,xr,Nr,ln,wn,ei,jn,ci,$n,oa)},t.prototype.emplace=function(r,f,v,y,x,P,F,U,W,ne,de,be,He,Xe,_t,rt,Dt,qt,mr,xr,Nr,ln,wn,ei,jn,ci,$n,oa,Ri){var si=34*r,ua=17*r;return this.int16[si+0]=f,this.int16[si+1]=v,this.int16[si+2]=y,this.int16[si+3]=x,this.int16[si+4]=P,this.int16[si+5]=F,this.int16[si+6]=U,this.int16[si+7]=W,this.uint16[si+8]=ne,this.uint16[si+9]=de,this.uint16[si+10]=be,this.uint16[si+11]=He,this.uint16[si+12]=Xe,this.uint16[si+13]=_t,this.uint16[si+14]=rt,this.uint16[si+15]=Dt,this.uint16[si+16]=qt,this.uint16[si+17]=mr,this.uint16[si+18]=xr,this.uint16[si+19]=Nr,this.uint16[si+20]=ln,this.uint16[si+21]=wn,this.uint16[si+22]=ei,this.uint32[ua+12]=jn,this.float32[ua+13]=ci,this.float32[ua+14]=$n,this.float32[ua+15]=oa,this.float32[ua+16]=Ri,r},t}(Xi);Cc.prototype.bytesPerElement=68,Vn("StructArrayLayout8i15ui1ul4f68",Cc);var Iu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.float32[1*r+0]=f,r},t}(Xi);Iu.prototype.bytesPerElement=4,Vn("StructArrayLayout1f4",Iu);var Ns=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var x=3*r;return this.int16[x+0]=f,this.int16[x+1]=v,this.int16[x+2]=y,r},t}(Xi);Ns.prototype.bytesPerElement=6,Vn("StructArrayLayout3i6",Ns);var wc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var x=4*r;return this.uint32[2*r+0]=f,this.uint16[x+2]=v,this.uint16[x+3]=y,r},t}(Xi);wc.prototype.bytesPerElement=8,Vn("StructArrayLayout1ul2ui8",wc);var ic=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var y=2*r;return this.uint16[y+0]=f,this.uint16[y+1]=v,r},t}(Xi);ic.prototype.bytesPerElement=4,Vn("StructArrayLayout2ui4",ic);var jl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint16[1*r+0]=f,r},t}(Xi);jl.prototype.bytesPerElement=2,Vn("StructArrayLayout1ui2",jl);var cl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,y)},t.prototype.emplace=function(r,f,v,y,x){var P=4*r;return this.float32[P+0]=f,this.float32[P+1]=v,this.float32[P+2]=y,this.float32[P+3]=x,r},t}(Xi);cl.prototype.bytesPerElement=16,Vn("StructArrayLayout4f16",cl);var i=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new ae(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(nc);i.prototype.size=20;var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new i(this,r)},t}(Ec);Vn("CollisionBoxArray",u);var o=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(f){this._structArray.uint8[this._pos1+37]=f},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(f){this._structArray.uint8[this._pos1+38]=f},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+10]=f},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(nc);o.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new o(this,r)},t}(Hu);Vn("PlacedSymbolArray",h);var g=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+12]=f},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(nc);g.prototype.size=68;var S=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new g(this,r)},t}(Cc);Vn("SymbolInstanceArray",S);var T=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(Iu);Vn("GlyphOffsetArray",T);var R=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(Ns);Vn("SymbolLineVertexArray",R);var G=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(nc);G.prototype.size=8;var se=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new G(this,r)},t}(wc);Vn("FeatureIndexArray",se);var Ee=ji([{name:"a_pos",components:2,type:"Int16"}],4).members,we=function(e){e===void 0&&(e=[]),this.segments=e};function Pe(e,t){return 256*(e=$t(Math.floor(e),0,255))+$t(Math.floor(t),0,255)}we.prototype.prepareSegment=function(e,t,r,f){var v=this.segments[this.segments.length-1];return e>we.MAX_VERTEX_ARRAY_LENGTH&&De("Max vertices per segment is "+we.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>we.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v},we.prototype.get=function(){return this.segments},we.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var f in r.vaos)r.vaos[f].destroy()}},we.simpleSegment=function(e,t,r,f){return new we([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:f,vaos:{},sortKey:0}])},we.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Vn("SegmentVector",we);var Ye=ji([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),We=me(function(e){e.exports=function(t,r){var f,v,y,x,P,F,U,W;for(v=t.length-(f=3&t.length),y=r,P=3432918353,F=461845907,W=0;W<v;)U=255&t.charCodeAt(W)|(255&t.charCodeAt(++W))<<8|(255&t.charCodeAt(++W))<<16|(255&t.charCodeAt(++W))<<24,++W,y=27492+(65535&(x=5*(65535&(y=(y^=U=(65535&(U=(U=(65535&U)*P+(((U>>>16)*P&65535)<<16)&4294967295)<<15|U>>>17))*F+(((U>>>16)*F&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(U=0,f){case 3:U^=(255&t.charCodeAt(W+2))<<16;case 2:U^=(255&t.charCodeAt(W+1))<<8;case 1:y^=U=(65535&(U=(U=(65535&(U^=255&t.charCodeAt(W)))*P+(((U>>>16)*P&65535)<<16)&4294967295)<<15|U>>>17))*F+(((U>>>16)*F&65535)<<16)&4294967295}return y^=t.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}}),ut=me(function(e){e.exports=function(t,r){for(var f,v=t.length,y=r^v,x=0;v>=4;)f=1540483477*(65535&(f=255&t.charCodeAt(x)|(255&t.charCodeAt(++x))<<8|(255&t.charCodeAt(++x))<<16|(255&t.charCodeAt(++x))<<24))+((1540483477*(f>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++x;switch(v){case 3:y^=(255&t.charCodeAt(x+2))<<16;case 2:y^=(255&t.charCodeAt(x+1))<<8;case 1:y=1540483477*(65535&(y^=255&t.charCodeAt(x)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}}),Ue=We,at=ut;Ue.murmur3=We,Ue.murmur2=at;var wt=function(){this.ids=[],this.positions=[],this.indexed=!1};wt.prototype.add=function(e,t,r,f){this.ids.push(_r(e)),this.positions.push(t,r,f)},wt.prototype.getPositions=function(e){for(var t=_r(e),r=0,f=this.ids.length-1;r<f;){var v=r+f>>1;this.ids[v]>=t?f=v:r=v+1}for(var y=[];this.ids[r]===t;)y.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return y},wt.serialize=function(e,t){var r=new Float64Array(e.ids),f=new Uint32Array(e.positions);return function v(y,x,P,F){for(;P<F;){for(var U=y[P+F>>1],W=P-1,ne=F+1;;){do W++;while(y[W]<U);do ne--;while(y[ne]>U);if(W>=ne)break;dr(y,W,ne),dr(x,3*W,3*ne),dr(x,3*W+1,3*ne+1),dr(x,3*W+2,3*ne+2)}ne-P<F-ne?(v(y,x,P,ne),P=ne+1):(v(y,x,ne+1,F),F=ne)}}(r,f,0,r.length-1),t&&t.push(r.buffer,f.buffer),{ids:r,positions:f}},wt.deserialize=function(e){var t=new wt;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var Xt=Math.pow(2,53)-1;function _r(e){var t=+e;return!isNaN(t)&&t<=Xt?t:Ue(String(e))}function dr(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}Vn("FeaturePositionMap",wt);var Cr=function(e,t){this.gl=e.gl,this.location=t},Gr=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(Cr),pn=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(Cr),an=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(Cr),Zn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(Cr),ui=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(Cr),di=function(e){function t(r,f){e.call(this,r,f),this.current=$i.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(Cr),dn=new Float32Array(16),ia=function(e){function t(r,f){e.call(this,r,f),this.current=dn}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var f=1;f<16;f++)if(r[f]!==this.current[f]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(Cr);function Hn(e){return[Pe(255*e.r,255*e.g),Pe(255*e.b,255*e.a)]}var bi=function(e,t,r){this.value=e,this.uniformNames=t.map(function(f){return"u_"+f}),this.type=r};bi.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},bi.prototype.getBinding=function(e,t,r){return this.type==="color"?new di(e,t):new pn(e,t)};var Hi=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Hi.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},Hi.prototype.setUniform=function(e,t,r,f){var v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},Hi.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new ui(e,t):new pn(e,t)};var mi=function(e,t,r,f){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(v){return{name:"a_"+v,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new f};mi.prototype.populatePaintArray=function(e,t,r,f,v){var y=this.paintVertexArray.length,x=this.expression.evaluate(new ea(0),t,{},f,[],v);this.paintVertexArray.resize(e),this._setPaintValue(y,e,x)},mi.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:0},r,f);this._setPaintValue(e,t,v)},mi.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var f=Hn(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,f[0],f[1]);else{for(var y=e;y<t;y++)this.paintVertexArray.emplace(y,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},mi.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},mi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Ci=function(e,t,r,f,v,y){this.expression=e,this.uniformNames=t.map(function(x){return"u_"+x+"_t"}),this.type=r,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=t.map(function(x){return{name:"a_"+x,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new y};Ci.prototype.populatePaintArray=function(e,t,r,f,v){var y=this.expression.evaluate(new ea(this.zoom),t,{},f,[],v),x=this.expression.evaluate(new ea(this.zoom+1),t,{},f,[],v),P=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(P,e,y,x)},Ci.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:this.zoom},r,f),y=this.expression.evaluate({zoom:this.zoom+1},r,f);this._setPaintValue(e,t,v,y)},Ci.prototype._setPaintValue=function(e,t,r,f){if(this.type==="color")for(var v=Hn(r),y=Hn(f),x=e;x<t;x++)this.paintVertexArray.emplace(x,v[0],v[1],y[0],y[1]);else{for(var P=e;P<t;P++)this.paintVertexArray.emplace(P,r,f);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(f))}},Ci.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ci.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Ci.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,f=$t(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(f)},Ci.prototype.getBinding=function(e,t,r){return new pn(e,t)};var Vi=function(e,t,r,f,v,y){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=f,this.layerId=y,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v};Vi.prototype.populatePaintArray=function(e,t,r){var f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,t.patterns&&t.patterns[this.layerId],r)},Vi.prototype.updatePaintArray=function(e,t,r,f,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},Vi.prototype._setPaintValues=function(e,t,r,f){if(f&&r){var v=f[r.min],y=f[r.mid],x=f[r.max];if(v&&y&&x)for(var P=e;P<t;P++)this.zoomInPaintVertexArray.emplace(P,y.tl[0],y.tl[1],y.br[0],y.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],y.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,y.tl[0],y.tl[1],y.br[0],y.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],y.pixelRatio,x.pixelRatio)}},Vi.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ye.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ye.members,this.expression.isStateDependent))},Vi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var X=function(e,t,r){this.binders={},this._buffers=[];var f=[];for(var v in e.paint._values)if(r(v)){var y=e.paint.get(v);if(y instanceof co&&qs(y.property.specification)){var x=D(v,e.type),P=y.value,F=y.property.specification.type,U=y.property.useIntegerZoom,W=y.property.specification["property-type"],ne=W==="cross-faded"||W==="cross-faded-data-driven";if(P.kind==="constant")this.binders[v]=ne?new Hi(P.value,x):new bi(P.value,x,F),f.push("/u_"+v);else if(P.kind==="source"||ne){var de=k(v,F,"source");this.binders[v]=ne?new Vi(P,F,U,t,de,e.id):new mi(P,x,F,de),f.push("/a_"+v)}else{var be=k(v,F,"composite");this.binders[v]=new Ci(P,x,F,U,t,be),f.push("/z_"+v)}}}this.cacheKey=f.sort().join("")};X.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof mi||t instanceof Ci?t.maxValue:0},X.prototype.populatePaintArrays=function(e,t,r,f,v){for(var y in this.binders){var x=this.binders[y];(x instanceof mi||x instanceof Ci||x instanceof Vi)&&x.populatePaintArray(e,t,r,f,v)}},X.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var f=this.binders[r];f instanceof Hi&&f.setConstantPatternPositions(e,t)}},X.prototype.updatePaintArrays=function(e,t,r,f,v){var y=!1;for(var x in e)for(var P=0,F=t.getPositions(x);P<F.length;P+=1){var U=F[P],W=r.feature(U.index);for(var ne in this.binders){var de=this.binders[ne];if((de instanceof mi||de instanceof Ci||de instanceof Vi)&&de.expression.isStateDependent===!0){var be=f.paint.get(ne);de.expression=be.value,de.updatePaintArray(U.start,U.end,W,e[x],v),y=!0}}}return y},X.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof bi||r instanceof Hi)&&e.push.apply(e,r.uniformNames.map(function(f){return"#define HAS_UNIFORM_"+f}))}return e},X.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof mi||r instanceof Ci)for(var f=0;f<r.paintVertexAttributes.length;f++)e.push(r.paintVertexAttributes[f].name);else if(r instanceof Vi)for(var v=0;v<Ye.members.length;v++)e.push(Ye.members[v].name)}return e},X.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof bi||r instanceof Hi||r instanceof Ci)for(var f=0,v=r.uniformNames;f<v.length;f+=1)e.push(v[f])}return e},X.prototype.getPaintVertexBuffers=function(){return this._buffers},X.prototype.getUniforms=function(e,t){var r=[];for(var f in this.binders){var v=this.binders[f];if(v instanceof bi||v instanceof Hi||v instanceof Ci)for(var y=0,x=v.uniformNames;y<x.length;y+=1){var P=x[y];if(t[P]){var F=v.getBinding(e,t[P],P);r.push({name:P,property:f,binding:F})}}}return r},X.prototype.setUniforms=function(e,t,r,f){for(var v=0,y=t;v<y.length;v+=1){var x=y[v],P=x.name,F=x.property;this.binders[F].setUniform(x.binding,f,r.get(F),P)}},X.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof Vi){var f=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(r instanceof mi||r instanceof Ci)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},X.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof mi||r instanceof Ci||r instanceof Vi)&&r.upload(e)}this.updatePaintBuffers()},X.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof mi||t instanceof Ci||t instanceof Vi)&&t.destroy()}};var Q=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var f=0,v=e;f<v.length;f+=1){var y=v[f];this.programConfigurations[y.id]=new X(y,t,r)}this.needsUpload=!1,this._featureMap=new wt,this._bufferOffset=0};function D(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function k(e,t,r){var f={color:{source:Hs,composite:cl},number:{source:Iu,composite:Hs}},v=function(y){return{"line-pattern":{source:Ss,composite:Ss},"fill-pattern":{source:Ss,composite:Ss},"fill-extrusion-pattern":{source:Ss,composite:Ss}}[y]}(e);return v&&v[r]||f[t][r]}Q.prototype.populatePaintArrays=function(e,t,r,f,v,y){for(var x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,t,f,v,y);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},Q.prototype.updatePaintArrays=function(e,t,r,f){for(var v=0,y=r;v<y.length;v+=1){var x=y[v];this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,t,x,f)||this.needsUpload}},Q.prototype.get=function(e){return this.programConfigurations[e]},Q.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},Q.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Vn("ConstantBinder",bi),Vn("CrossFadedConstantBinder",Hi),Vn("SourceExpressionBinder",mi),Vn("CrossFadedCompositeBinder",Vi),Vn("CompositeExpressionBinder",Ci),Vn("ProgramConfiguration",X,{omit:["_buffers"]}),Vn("ProgramConfigurationSet",Q);var le=Math.pow(2,14)-1,Ce=-le-1;function ft(e){for(var t=8192/e.extent,r=e.loadGeometry(),f=0;f<r.length;f++)for(var v=r[f],y=0;y<v.length;y++){var x=v[y],P=Math.round(x.x*t),F=Math.round(x.y*t);x.x=$t(P,Ce,le),x.y=$t(F,Ce,le),(P<x.x||P>x.x+1||F<x.y||F>x.y+1)&&De("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function Rt(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?ft(e):[]}}function Tt(e,t,r,f,v){e.emplaceBack(2*t+(f+1)/2,2*r+(v+1)/2)}var cr=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Bs,this.indexArray=new xu,this.segments=new we,this.programConfigurations=new Q(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Kr(e,t){for(var r=0;r<e.length;r++)if(Va(t,e[r]))return!0;for(var f=0;f<t.length;f++)if(Va(e,t[f]))return!0;return!!Li(e,t)}function Nn(e,t,r){return!!Va(e,t)||!!aa(t,e,r)}function ni(e,t){if(e.length===1)return Ca(t,e[0]);for(var r=0;r<t.length;r++)for(var f=t[r],v=0;v<f.length;v++)if(Va(e,f[v]))return!0;for(var y=0;y<e.length;y++)if(Ca(t,e[y]))return!0;for(var x=0;x<t.length;x++)if(Li(e,t[x]))return!0;return!1}function li(e,t,r){if(e.length>1){if(Li(e,t))return!0;for(var f=0;f<t.length;f++)if(aa(t[f],e,r))return!0}for(var v=0;v<e.length;v++)if(aa(e[v],t,r))return!0;return!1}function Li(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var f=e[r],v=e[r+1],y=0;y<t.length-1;y++)if(Mi(f,v,t[y],t[y+1]))return!0;return!1}function Mi(e,t,r,f){return It(e,r,f)!==It(t,r,f)&&It(e,t,r)!==It(e,t,f)}function aa(e,t,r){var f=r*r;if(t.length===1)return e.distSqr(t[0])<f;for(var v=1;v<t.length;v++)if(xa(e,t[v-1],t[v])<f)return!0;return!1}function xa(e,t,r){var f=t.distSqr(r);if(f===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/f;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function Ca(e,t){for(var r,f,v,y=!1,x=0;x<e.length;x++)for(var P=0,F=(r=e[x]).length-1;P<r.length;F=P++)(f=r[P]).y>t.y!=(v=r[F]).y>t.y&&t.x<(v.x-f.x)*(t.y-f.y)/(v.y-f.y)+f.x&&(y=!y);return y}function Va(e,t){for(var r=!1,f=0,v=e.length-1;f<e.length;v=f++){var y=e[f],x=e[v];y.y>t.y!=x.y>t.y&&t.x<(x.x-y.x)*(t.y-y.y)/(x.y-y.y)+y.x&&(r=!r)}return r}function Ga(e,t,r){var f=r[0],v=r[2];if(e.x<f.x&&t.x<f.x||e.x>v.x&&t.x>v.x||e.y<f.y&&t.y<f.y||e.y>v.y&&t.y>v.y)return!1;var y=It(e,t,r[0]);return y!==It(e,t,r[1])||y!==It(e,t,r[2])||y!==It(e,t,r[3])}function to(e,t,r){var f=t.paint.get(e).value;return f.kind==="constant"?f.value:r.programConfigurations.get(t.id).getMaxValue(e)}function ca(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function da(e,t,r,f,v){if(!t[0]&&!t[1])return e;var y=ae.convert(t)._mult(v);r==="viewport"&&y._rotate(-f);for(var x=[],P=0;P<e.length;P++)x.push(e[P].sub(y));return x}cr.prototype.populate=function(e,t,r){var f=this.layers[0],v=[],y=null;f.type==="circle"&&(y=f.layout.get("circle-sort-key"));for(var x=0,P=e;x<P.length;x+=1){var F=P[x],U=F.feature,W=F.id,ne=F.index,de=F.sourceLayerIndex,be=this.layers[0]._featureFilter.needGeometry,He=Rt(U,be);if(this.layers[0]._featureFilter.filter(new ea(this.zoom),He,r)){var Xe=y?y.evaluate(He,{},r):void 0,_t={id:W,properties:U.properties,type:U.type,sourceLayerIndex:de,index:ne,geometry:be?He.geometry:ft(U),patterns:{},sortKey:Xe};v.push(_t)}}y&&v.sort(function(wn,ei){return wn.sortKey-ei.sortKey});for(var rt=0,Dt=v;rt<Dt.length;rt+=1){var qt=Dt[rt],mr=qt.geometry,xr=qt.index,Nr=qt.sourceLayerIndex,ln=e[xr].feature;this.addFeature(qt,mr,xr,r),t.featureIndex.insert(ln,mr,xr,Nr,this.index)}},cr.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},cr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},cr.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},cr.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ee),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},cr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},cr.prototype.addFeature=function(e,t,r,f){for(var v=0,y=t;v<y.length;v+=1)for(var x=0,P=y[v];x<P.length;x+=1){var F=P[x],U=F.x,W=F.y;if(!(U<0||U>=8192||W<0||W>=8192)){var ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),de=ne.vertexLength;Tt(this.layoutVertexArray,U,W,-1,-1),Tt(this.layoutVertexArray,U,W,1,-1),Tt(this.layoutVertexArray,U,W,1,1),Tt(this.layoutVertexArray,U,W,-1,1),this.indexArray.emplaceBack(de,de+1,de+2),this.indexArray.emplaceBack(de,de+3,de+2),ne.vertexLength+=4,ne.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},f)},Vn("CircleBucket",cr,{omit:["layers"]});var va=new Io({"circle-sort-key":new Wn(oe.layout_circle["circle-sort-key"])}),vo={paint:new Io({"circle-radius":new Wn(oe.paint_circle["circle-radius"]),"circle-color":new Wn(oe.paint_circle["circle-color"]),"circle-blur":new Wn(oe.paint_circle["circle-blur"]),"circle-opacity":new Wn(oe.paint_circle["circle-opacity"]),"circle-translate":new Gn(oe.paint_circle["circle-translate"]),"circle-translate-anchor":new Gn(oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Gn(oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Gn(oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wn(oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wn(oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wn(oe.paint_circle["circle-stroke-opacity"])}),layout:va},Fi=typeof Float32Array!="undefined"?Float32Array:Array;function Ia(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ka(e,t,r){var f=t[0],v=t[1],y=t[2],x=t[3],P=t[4],F=t[5],U=t[6],W=t[7],ne=t[8],de=t[9],be=t[10],He=t[11],Xe=t[12],_t=t[13],rt=t[14],Dt=t[15],qt=r[0],mr=r[1],xr=r[2],Nr=r[3];return e[0]=qt*f+mr*P+xr*ne+Nr*Xe,e[1]=qt*v+mr*F+xr*de+Nr*_t,e[2]=qt*y+mr*U+xr*be+Nr*rt,e[3]=qt*x+mr*W+xr*He+Nr*Dt,e[4]=(qt=r[4])*f+(mr=r[5])*P+(xr=r[6])*ne+(Nr=r[7])*Xe,e[5]=qt*v+mr*F+xr*de+Nr*_t,e[6]=qt*y+mr*U+xr*be+Nr*rt,e[7]=qt*x+mr*W+xr*He+Nr*Dt,e[8]=(qt=r[8])*f+(mr=r[9])*P+(xr=r[10])*ne+(Nr=r[11])*Xe,e[9]=qt*v+mr*F+xr*de+Nr*_t,e[10]=qt*y+mr*U+xr*be+Nr*rt,e[11]=qt*x+mr*W+xr*He+Nr*Dt,e[12]=(qt=r[12])*f+(mr=r[13])*P+(xr=r[14])*ne+(Nr=r[15])*Xe,e[13]=qt*v+mr*F+xr*de+Nr*_t,e[14]=qt*y+mr*U+xr*be+Nr*rt,e[15]=qt*x+mr*W+xr*He+Nr*Dt,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var Oo,ac=Ka;function bu(e,t,r){var f=t[0],v=t[1],y=t[2],x=t[3];return e[0]=r[0]*f+r[4]*v+r[8]*y+r[12]*x,e[1]=r[1]*f+r[5]*v+r[9]*y+r[13]*x,e[2]=r[2]*f+r[6]*v+r[10]*y+r[14]*x,e[3]=r[3]*f+r[7]*v+r[11]*y+r[15]*x,e}Oo=new Fi(3),Fi!=Float32Array&&(Oo[0]=0,Oo[1]=0,Oo[2]=0),function(){var e=new Fi(4);Fi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var Es=(function(){var e=new Fi(2);Fi!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,vo)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new cr(r)},t.prototype.queryRadius=function(r){var f=r;return to("circle-radius",this,f)+to("circle-stroke-width",this,f)+ca(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,y,x,P,F,U){for(var W=da(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),P.angle,F),ne=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),de=this.paint.get("circle-pitch-alignment")==="map",be=de?W:function(ln,wn){return ln.map(function(ei){return Ou(ei,wn)})}(W,U),He=de?ne*F:ne,Xe=0,_t=y;Xe<_t.length;Xe+=1)for(var rt=0,Dt=_t[Xe];rt<Dt.length;rt+=1){var qt=Dt[rt],mr=de?qt:Ou(qt,U),xr=He,Nr=bu([],[qt.x,qt.y,0,1],U);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?xr*=Nr[3]/P.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(xr*=P.cameraToCenterDistance/Nr[3]),Nn(be,mr,xr))return!0}return!1},t}(ru));function Ou(e,t){var r=bu([],[e.x,e.y,0,1],t);return new ae(r[0]/r[3],r[1]/r[3])}var Wu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(cr);function fl(e,t,r,f){var v=t.width,y=t.height;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==v*y*r)throw new RangeError("mismatched image size")}else f=new Uint8Array(v*y*r);return e.width=v,e.height=y,e.data=f,e}function Vl(e,t,r){var f=t.width,v=t.height;if(f!==e.width||v!==e.height){var y=fl({},{width:f,height:v},r);oc(e,y,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,f),height:Math.min(e.height,v)},r),e.width=f,e.height=v,e.data=y.data}}function oc(e,t,r,f,v,y){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||f.x>t.width-v.width||f.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var x=e.data,P=t.data,F=0;F<v.height;F++)for(var U=((r.y+F)*e.width+r.x)*y,W=((f.y+F)*t.width+f.x)*y,ne=0;ne<v.width*y;ne++)P[W+ne]=x[U+ne];return t}Vn("HeatmapBucket",Wu,{omit:["layers"]});var Xu=function(e,t){fl(this,e,1,t)};Xu.prototype.resize=function(e){Vl(this,e,1)},Xu.prototype.clone=function(){return new Xu({width:this.width,height:this.height},new Uint8Array(this.data))},Xu.copy=function(e,t,r,f,v){oc(e,t,r,f,v,1)};var fs=function(e,t){fl(this,e,4,t)};fs.prototype.resize=function(e){Vl(this,e,4)},fs.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},fs.prototype.clone=function(){return new fs({width:this.width,height:this.height},new Uint8Array(this.data))},fs.copy=function(e,t,r,f,v){oc(e,t,r,f,v,4)},Vn("AlphaImage",Xu),Vn("RGBAImage",fs);var Rf={paint:new Io({"heatmap-radius":new Wn(oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wn(oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Gn(oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new cs(oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Gn(oe.paint_heatmap["heatmap-opacity"])})};function df(e){var t={},r=e.resolution||256,f=e.clips?e.clips.length:1,v=e.image||new fs({width:r,height:f}),y=function(He,Xe,_t){t[e.evaluationKey]=_t;var rt=e.expression.evaluate(t);v.data[He+Xe+0]=Math.floor(255*rt.r/rt.a),v.data[He+Xe+1]=Math.floor(255*rt.g/rt.a),v.data[He+Xe+2]=Math.floor(255*rt.b/rt.a),v.data[He+Xe+3]=Math.floor(255*rt.a)};if(e.clips)for(var x=0,P=0;x<f;++x,P+=4*r)for(var F=0,U=0;F<r;F++,U+=4){var W=F/(r-1),ne=e.clips[x];y(P,U,ne.start*(1-W)+ne.end*W)}else for(var de=0,be=0;de<r;de++,be+=4)y(0,be,de/(r-1));return v}var vf=function(e){function t(r){e.call(this,r,Rf),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Wu(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=df({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(ru),uh={paint:new Io({"hillshade-illumination-direction":new Gn(oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Gn(oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Gn(oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Gn(oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Gn(oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Gn(oe.paint_hillshade["hillshade-accent-color"])})},lh=function(e){function t(r){e.call(this,r,uh)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(ru),qc=ji([{name:"a_pos",components:2,type:"Int16"}],4).members,Ac=Df,up=Df;function Df(e,t,r){r=r||2;var f,v,y,x,P,F,U,W=t&&t.length,ne=W?t[0]*r:e.length,de=ch(e,0,ne,r,!0),be=[];if(!de||de.next===de.prev)return be;if(W&&(de=function(Xe,_t,rt,Dt){var qt,mr,xr,Nr=[];for(qt=0,mr=_t.length;qt<mr;qt++)(xr=ch(Xe,_t[qt]*Dt,qt<mr-1?_t[qt+1]*Dt:Xe.length,Dt,!1))===xr.next&&(xr.steiner=!0),Nr.push(Dh(xr));for(Nr.sort(fp),qt=0;qt<Nr.length;qt++)Rh(Nr[qt],rt),rt=Gl(rt,rt.next);return rt}(e,t,de,r)),e.length>80*r){f=y=e[0],v=x=e[1];for(var He=r;He<ne;He+=r)(P=e[He])<f&&(f=P),(F=e[He+1])<v&&(v=F),P>y&&(y=P),F>x&&(x=F);U=(U=Math.max(y-f,x-v))!==0?1/U:0}return ef(de,be,r,f,v,U),be}function ch(e,t,r,f,v){var y,x;if(v===nf(e,t,r,f)>0)for(y=t;y<r;y+=f)x=yf(y,e[y],e[y+1],x);else for(y=r-f;y>=t;y-=f)x=yf(y,e[y],e[y+1],x);return x&&kf(x,x.next)&&(Tc(x),x=x.next),x}function Gl(e,t){if(!e)return e;t||(t=e);var r,f=e;do if(r=!1,f.steiner||!kf(f,f.next)&&rs(f.prev,f,f.next)!==0)f=f.next;else{if(Tc(f),(f=t=f.prev)===f.next)break;r=!0}while(r||f!==t);return t}function ef(e,t,r,f,v,y,x){if(e){!x&&y&&function(W,ne,de,be){var He=W;do He.z===null&&(He.z=hh(He.x,He.y,ne,de,be)),He.prevZ=He.prev,He.nextZ=He.next,He=He.next;while(He!==W);He.prevZ.nextZ=null,He.prevZ=null,function(Xe){var _t,rt,Dt,qt,mr,xr,Nr,ln,wn=1;do{for(rt=Xe,Xe=null,mr=null,xr=0;rt;){for(xr++,Dt=rt,Nr=0,_t=0;_t<wn&&(Nr++,Dt=Dt.nextZ);_t++);for(ln=wn;Nr>0||ln>0&&Dt;)Nr!==0&&(ln===0||!Dt||rt.z<=Dt.z)?(qt=rt,rt=rt.nextZ,Nr--):(qt=Dt,Dt=Dt.nextZ,ln--),mr?mr.nextZ=qt:Xe=qt,qt.prevZ=mr,mr=qt;rt=Dt}mr.nextZ=null,wn*=2}while(xr>1)}(He)}(e,f,v,y);for(var P,F,U=e;e.prev!==e.next;)if(P=e.prev,F=e.next,y?tf(e,f,v,y):lp(e))t.push(P.i/r),t.push(e.i/r),t.push(F.i/r),Tc(e),e=F.next,U=F.next;else if((e=F)===U){x?x===1?ef(e=fh(Gl(e),t,r),t,r,f,v,y,2):x===2&&cp(e,t,r,f,v,y):ef(Gl(e),t,r,f,v,y,1);break}}}function lp(e){var t=e.prev,r=e,f=e.next;if(rs(t,r,f)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(rf(t.x,t.y,r.x,r.y,f.x,f.y,v.x,v.y)&&rs(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function tf(e,t,r,f){var v=e.prev,y=e,x=e.next;if(rs(v,y,x)>=0)return!1;for(var P=v.x>y.x?v.x>x.x?v.x:x.x:y.x>x.x?y.x:x.x,F=v.y>y.y?v.y>x.y?v.y:x.y:y.y>x.y?y.y:x.y,U=hh(v.x<y.x?v.x<x.x?v.x:x.x:y.x<x.x?y.x:x.x,v.y<y.y?v.y<x.y?v.y:x.y:y.y<x.y?y.y:x.y,t,r,f),W=hh(P,F,t,r,f),ne=e.prevZ,de=e.nextZ;ne&&ne.z>=U&&de&&de.z<=W;){if(ne!==e.prev&&ne!==e.next&&rf(v.x,v.y,y.x,y.y,x.x,x.y,ne.x,ne.y)&&rs(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,de!==e.prev&&de!==e.next&&rf(v.x,v.y,y.x,y.y,x.x,x.y,de.x,de.y)&&rs(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ne&&ne.z>=U;){if(ne!==e.prev&&ne!==e.next&&rf(v.x,v.y,y.x,y.y,x.x,x.y,ne.x,ne.y)&&rs(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;de&&de.z<=W;){if(de!==e.prev&&de!==e.next&&rf(v.x,v.y,y.x,y.y,x.x,x.y,de.x,de.y)&&rs(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function fh(e,t,r){var f=e;do{var v=f.prev,y=f.next.next;!kf(v,y)&&ph(v,f,f.next,y)&&Fc(v,y)&&Fc(y,v)&&(t.push(v.i/r),t.push(f.i/r),t.push(y.i/r),Tc(f),Tc(f.next),f=e=y),f=f.next}while(f!==e);return Gl(f)}function cp(e,t,r,f,v,y){var x=e;do{for(var P=x.next.next;P!==x.prev;){if(x.i!==P.i&&pp(x,P)){var F=mf(x,P);return x=Gl(x,x.next),F=Gl(F,F.next),ef(x,t,r,f,v,y),void ef(F,t,r,f,v,y)}P=P.next}x=x.next}while(x!==e)}function fp(e,t){return e.x-t.x}function Rh(e,t){if(t=function(f,v){var y,x=v,P=f.x,F=f.y,U=-1/0;do{if(F<=x.y&&F>=x.next.y&&x.next.y!==x.y){var W=x.x+(F-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(W<=P&&W>U){if(U=W,W===P){if(F===x.y)return x;if(F===x.next.y)return x.next}y=x.x<x.next.x?x:x.next}}x=x.next}while(x!==v);if(!y)return null;if(P===U)return y;var ne,de=y,be=y.x,He=y.y,Xe=1/0;x=y;do P>=x.x&&x.x>=be&&P!==x.x&&rf(F<He?P:U,F,be,He,F<He?U:P,F,x.x,x.y)&&(ne=Math.abs(F-x.y)/(P-x.x),Fc(x,f)&&(ne<Xe||ne===Xe&&(x.x>y.x||x.x===y.x&&hp(y,x)))&&(y=x,Xe=ne)),x=x.next;while(x!==de);return y}(e,t)){var r=mf(t,e);Gl(t,t.next),Gl(r,r.next)}}function hp(e,t){return rs(e.prev,e,t.prev)<0&&rs(t.next,e,e.next)<0}function hh(e,t,r,f,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-f)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Dh(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function rf(e,t,r,f,v,y,x,P){return(v-x)*(t-P)-(e-x)*(y-P)>=0&&(e-x)*(f-P)-(r-x)*(t-P)>=0&&(r-x)*(y-P)-(v-x)*(f-P)>=0}function pp(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,f){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==f.i&&v.next.i!==f.i&&ph(v,v.next,r,f))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(Fc(e,t)&&Fc(t,e)&&function(r,f){var v=r,y=!1,x=(r.x+f.x)/2,P=(r.y+f.y)/2;do v.y>P!=v.next.y>P&&v.next.y!==v.y&&x<(v.next.x-v.x)*(P-v.y)/(v.next.y-v.y)+v.x&&(y=!y),v=v.next;while(v!==r);return y}(e,t)&&(rs(e.prev,e,t.prev)||rs(e,t.prev,t))||kf(e,t)&&rs(e.prev,e,e.next)>0&&rs(t.prev,t,t.next)>0)}function rs(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function kf(e,t){return e.x===t.x&&e.y===t.y}function ph(e,t,r,f){var v=Bf(rs(e,t,r)),y=Bf(rs(e,t,f)),x=Bf(rs(r,f,e)),P=Bf(rs(r,f,t));return v!==y&&x!==P||!(v!==0||!Ff(e,r,t))||!(y!==0||!Ff(e,f,t))||!(x!==0||!Ff(r,e,f))||!(P!==0||!Ff(r,t,f))}function Ff(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Bf(e){return e>0?1:e<0?-1:0}function Fc(e,t){return rs(e.prev,e,e.next)<0?rs(e,t,e.next)>=0&&rs(e,e.prev,t)>=0:rs(e,t,e.prev)<0||rs(e,e.next,t)<0}function mf(e,t){var r=new gf(e.i,e.x,e.y),f=new gf(t.i,t.x,t.y),v=e.next,y=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,f.next=r,r.prev=f,y.next=f,f.prev=y,f}function yf(e,t,r,f){var v=new gf(e,t,r);return f?(v.next=f.next,v.prev=f,f.next.prev=v,f.next=v):(v.prev=v,v.next=v),v}function Tc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function gf(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function nf(e,t,r,f){for(var v=0,y=t,x=r-f;y<r;y+=f)v+=(e[x]-e[y])*(e[y+1]+e[x+1]),x=y;return v}function Nf(e,t,r,f,v){(function y(x,P,F,U,W){for(;U>F;){if(U-F>600){var ne=U-F+1,de=P-F+1,be=Math.log(ne),He=.5*Math.exp(2*be/3),Xe=.5*Math.sqrt(be*He*(ne-He)/ne)*(de-ne/2<0?-1:1);y(x,P,Math.max(F,Math.floor(P-de*He/ne+Xe)),Math.min(U,Math.floor(P+(ne-de)*He/ne+Xe)),W)}var _t=x[P],rt=F,Dt=U;for(sc(x,F,P),W(x[U],_t)>0&&sc(x,F,U);rt<Dt;){for(sc(x,rt,Dt),rt++,Dt--;W(x[rt],_t)<0;)rt++;for(;W(x[Dt],_t)>0;)Dt--}W(x[F],_t)===0?sc(x,F,Dt):sc(x,++Dt,U),Dt<=P&&(F=Dt+1),P<=Dt&&(U=Dt-1)}})(e,t,r||0,f||e.length-1,v||dh)}function sc(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}function dh(e,t){return e<t?-1:e>t?1:0}function af(e,t){var r=e.length;if(r<=1)return[e];for(var f,v,y=[],x=0;x<r;x++){var P=hr(e[x]);P!==0&&(e[x].area=Math.abs(P),v===void 0&&(v=P<0),v===P<0?(f&&y.push(f),f=[e[x]]):f.push(e[x]))}if(f&&y.push(f),t>1)for(var F=0;F<y.length;F++)y[F].length<=t||(Nf(y[F],t,1,y[F].length-1,zf),y[F]=y[F].slice(0,t));return y}function zf(e,t){return t.area-e.area}function of(e,t,r){for(var f=r.patternDependencies,v=!1,y=0,x=t;y<x.length;y+=1){var P=x[y].paint.get(e+"-pattern");P.isConstant()||(v=!0);var F=P.constantOr(null);F&&(v=!0,f[F.to]=!0,f[F.from]=!0)}return v}function Bc(e,t,r,f,v){for(var y=v.patternDependencies,x=0,P=t;x<P.length;x+=1){var F=P[x],U=F.paint.get(e+"-pattern").value;if(U.kind!=="constant"){var W=U.evaluate({zoom:f-1},r,{},v.availableImages),ne=U.evaluate({zoom:f},r,{},v.availableImages),de=U.evaluate({zoom:f+1},r,{},v.availableImages);ne=ne&&ne.name?ne.name:ne,de=de&&de.name?de.name:de,y[W=W&&W.name?W.name:W]=!0,y[ne]=!0,y[de]=!0,r.patterns[F.id]={min:W,mid:ne,max:de}}}return r}Df.deviation=function(e,t,r,f){var v=t&&t.length,y=Math.abs(nf(e,0,v?t[0]*r:e.length,r));if(v)for(var x=0,P=t.length;x<P;x++)y-=Math.abs(nf(e,t[x]*r,x<P-1?t[x+1]*r:e.length,r));var F=0;for(x=0;x<f.length;x+=3){var U=f[x]*r,W=f[x+1]*r,ne=f[x+2]*r;F+=Math.abs((e[U]-e[ne])*(e[W+1]-e[U+1])-(e[U]-e[W])*(e[ne+1]-e[U+1]))}return y===0&&F===0?0:Math.abs((F-y)/y)},Df.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},f=0,v=0;v<e.length;v++){for(var y=0;y<e[v].length;y++)for(var x=0;x<t;x++)r.vertices.push(e[v][y][x]);v>0&&r.holes.push(f+=e[v-1].length)}return r},Ac.default=up;var fu=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Bs,this.indexArray=new xu,this.indexArray2=new ic,this.programConfigurations=new Q(e.layers,e.zoom),this.segments=new we,this.segments2=new we,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};fu.prototype.populate=function(e,t,r){this.hasPattern=of("fill",this.layers,t);for(var f=this.layers[0].layout.get("fill-sort-key"),v=[],y=0,x=e;y<x.length;y+=1){var P=x[y],F=P.feature,U=P.id,W=P.index,ne=P.sourceLayerIndex,de=this.layers[0]._featureFilter.needGeometry,be=Rt(F,de);if(this.layers[0]._featureFilter.filter(new ea(this.zoom),be,r)){var He=f?f.evaluate(be,{},r,t.availableImages):void 0,Xe={id:U,properties:F.properties,type:F.type,sourceLayerIndex:ne,index:W,geometry:de?be.geometry:ft(F),patterns:{},sortKey:He};v.push(Xe)}}f&&v.sort(function(ln,wn){return ln.sortKey-wn.sortKey});for(var _t=0,rt=v;_t<rt.length;_t+=1){var Dt=rt[_t],qt=Dt.geometry,mr=Dt.index,xr=Dt.sourceLayerIndex;if(this.hasPattern){var Nr=Bc("fill",this.layers,Dt,this.zoom,t);this.patternFeatures.push(Nr)}else this.addFeature(Dt,qt,mr,r,{});t.featureIndex.insert(e[mr].feature,qt,mr,xr,this.index)}},fu.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},fu.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var y=v[f];this.addFeature(y,y.geometry,y.index,t,r)}},fu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},fu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},fu.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qc),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},fu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},fu.prototype.addFeature=function(e,t,r,f,v){for(var y=0,x=af(t,500);y<x.length;y+=1){for(var P=x[y],F=0,U=0,W=P;U<W.length;U+=1)F+=W[U].length;for(var ne=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray),de=ne.vertexLength,be=[],He=[],Xe=0,_t=P;Xe<_t.length;Xe+=1){var rt=_t[Xe];if(rt.length!==0){rt!==P[0]&&He.push(be.length/2);var Dt=this.segments2.prepareSegment(rt.length,this.layoutVertexArray,this.indexArray2),qt=Dt.vertexLength;this.layoutVertexArray.emplaceBack(rt[0].x,rt[0].y),this.indexArray2.emplaceBack(qt+rt.length-1,qt),be.push(rt[0].x),be.push(rt[0].y);for(var mr=1;mr<rt.length;mr++)this.layoutVertexArray.emplaceBack(rt[mr].x,rt[mr].y),this.indexArray2.emplaceBack(qt+mr-1,qt+mr),be.push(rt[mr].x),be.push(rt[mr].y);Dt.vertexLength+=rt.length,Dt.primitiveLength+=rt.length}}for(var xr=Ac(be,He),Nr=0;Nr<xr.length;Nr+=3)this.indexArray.emplaceBack(de+xr[Nr],de+xr[Nr+1],de+xr[Nr+2]);ne.vertexLength+=F,ne.primitiveLength+=xr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Vn("FillBucket",fu,{omit:["layers","patternFeatures"]});var uc=new Io({"fill-sort-key":new Wn(oe.layout_fill["fill-sort-key"])}),_f={paint:new Io({"fill-antialias":new Gn(oe.paint_fill["fill-antialias"]),"fill-opacity":new Wn(oe.paint_fill["fill-opacity"]),"fill-color":new Wn(oe.paint_fill["fill-color"]),"fill-outline-color":new Wn(oe.paint_fill["fill-outline-color"]),"fill-translate":new Gn(oe.paint_fill["fill-translate"]),"fill-translate-anchor":new Gn(oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new ol(oe.paint_fill["fill-pattern"])}),layout:uc},xf=function(e){function t(r){e.call(this,r,_f)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new fu(r)},t.prototype.queryRadius=function(){return ca(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,y,x,P,F){return ni(da(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),P.angle,F),y)},t.prototype.isTileClipped=function(){return!0},t}(ru),Zf=ji([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,sf=hl;function hl(e,t,r,f,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=f,this._values=v,e.readFields(kh,this,t)}function kh(e,t,r){e==1?t.id=r.readVarint():e==2?function(f,v){for(var y=f.readVarint()+f.pos;f.pos<y;){var x=v._keys[f.readVarint()],P=v._values[f.readVarint()];v.properties[x]=P}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function Uf(e){for(var t,r,f=0,v=0,y=e.length,x=y-1;v<y;x=v++)f+=((r=e[x]).x-(t=e[v]).x)*(t.y+r.y);return f}hl.types=["Unknown","Point","LineString","Polygon"],hl.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,f=1,v=0,y=0,x=0,P=[];e.pos<r;){if(v<=0){var F=e.readVarint();f=7&F,v=F>>3}if(v--,f===1||f===2)y+=e.readSVarint(),x+=e.readSVarint(),f===1&&(t&&P.push(t),t=[]),t.push(new ae(y,x));else{if(f!==7)throw new Error("unknown command "+f);t&&t.push(t[0].clone())}}return t&&P.push(t),P},hl.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,f=0,v=0,y=0,x=1/0,P=-1/0,F=1/0,U=-1/0;e.pos<t;){if(f<=0){var W=e.readVarint();r=7&W,f=W>>3}if(f--,r===1||r===2)(v+=e.readSVarint())<x&&(x=v),v>P&&(P=v),(y+=e.readSVarint())<F&&(F=y),y>U&&(U=y);else if(r!==7)throw new Error("unknown command "+r)}return[x,F,P,U]},hl.prototype.toGeoJSON=function(e,t,r){var f,v,y=this.extent*Math.pow(2,r),x=this.extent*e,P=this.extent*t,F=this.loadGeometry(),U=hl.types[this.type];function W(be){for(var He=0;He<be.length;He++){var Xe=be[He];be[He]=[360*(Xe.x+x)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(Xe.y+P)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var ne=[];for(f=0;f<F.length;f++)ne[f]=F[f][0];W(F=ne);break;case 2:for(f=0;f<F.length;f++)W(F[f]);break;case 3:for(F=function(be){var He=be.length;if(He<=1)return[be];for(var Xe,_t,rt=[],Dt=0;Dt<He;Dt++){var qt=Uf(be[Dt]);qt!==0&&(_t===void 0&&(_t=qt<0),_t===qt<0?(Xe&&rt.push(Xe),Xe=[be[Dt]]):Xe.push(be[Dt]))}return Xe&&rt.push(Xe),rt}(F),f=0;f<F.length;f++)for(v=0;v<F[f].length;v++)W(F[f][v])}F.length===1?F=F[0]:U="Multi"+U;var de={type:"Feature",geometry:{type:U,coordinates:F},properties:this.properties};return"id"in this&&(de.id=this.id),de};var Fh=vh;function vh(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Bh,this,t),this.length=this._features.length}function Bh(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(f){for(var v=null,y=f.readVarint()+f.pos;f.pos<y;){var x=f.readVarint()>>3;v=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return v}(r))}function lc(e,t,r){if(e===3){var f=new Fh(r,r.readVarint()+r.pos);f.length&&(t[f.name]=f)}}vh.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new sf(this._pbf,t,this.extent,this._keys,this._values)};var Pc={VectorTile:function(e,t){this.layers=e.readFields(lc,{},t)},VectorTileFeature:sf,VectorTileLayer:Fh},Nh=Pc.VectorTileFeature.types,jf=Math.pow(2,13);function bf(e,t,r,f,v,y,x,P){e.emplaceBack(t,r,2*Math.floor(f*jf)+x,v*jf*2,y*jf*2,Math.round(P))}var pl=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Os,this.indexArray=new xu,this.programConfigurations=new Q(e.layers,e.zoom),this.segments=new we,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function dp(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}pl.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=of("fill-extrusion",this.layers,t);for(var f=0,v=e;f<v.length;f+=1){var y=v[f],x=y.feature,P=y.id,F=y.index,U=y.sourceLayerIndex,W=this.layers[0]._featureFilter.needGeometry,ne=Rt(x,W);if(this.layers[0]._featureFilter.filter(new ea(this.zoom),ne,r)){var de={id:P,sourceLayerIndex:U,index:F,geometry:W?ne.geometry:ft(x),properties:x.properties,type:x.type,patterns:{}};this.hasPattern?this.features.push(Bc("fill-extrusion",this.layers,de,this.zoom,t)):this.addFeature(de,de.geometry,F,r,{}),t.featureIndex.insert(x,de.geometry,F,U,this.index,!0)}}},pl.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.features;f<v.length;f+=1){var y=v[f];this.addFeature(y,y.geometry,y.index,t,r)}},pl.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},pl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},pl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},pl.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},pl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},pl.prototype.addFeature=function(e,t,r,f,v){for(var y=0,x=af(t,500);y<x.length;y+=1){for(var P=x[y],F=0,U=0,W=P;U<W.length;U+=1)F+=W[U].length;for(var ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),de=0,be=P;de<be.length;de+=1){var He=be[de];if(He.length!==0&&!((ua=He).every(function(Wi){return Wi.x<0})||ua.every(function(Wi){return Wi.x>8192})||ua.every(function(Wi){return Wi.y<0})||ua.every(function(Wi){return Wi.y>8192})))for(var Xe=0,_t=0;_t<He.length;_t++){var rt=He[_t];if(_t>=1){var Dt=He[_t-1];if(!dp(rt,Dt)){ne.vertexLength+4>we.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var qt=rt.sub(Dt)._perp()._unit(),mr=Dt.dist(rt);Xe+mr>32768&&(Xe=0),bf(this.layoutVertexArray,rt.x,rt.y,qt.x,qt.y,0,0,Xe),bf(this.layoutVertexArray,rt.x,rt.y,qt.x,qt.y,0,1,Xe),bf(this.layoutVertexArray,Dt.x,Dt.y,qt.x,qt.y,0,0,Xe+=mr),bf(this.layoutVertexArray,Dt.x,Dt.y,qt.x,qt.y,0,1,Xe);var xr=ne.vertexLength;this.indexArray.emplaceBack(xr,xr+2,xr+1),this.indexArray.emplaceBack(xr+1,xr+2,xr+3),ne.vertexLength+=4,ne.primitiveLength+=2}}}}if(ne.vertexLength+F>we.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray)),Nh[e.type]==="Polygon"){for(var Nr=[],ln=[],wn=ne.vertexLength,ei=0,jn=P;ei<jn.length;ei+=1){var ci=jn[ei];if(ci.length!==0){ci!==P[0]&&ln.push(Nr.length/2);for(var $n=0;$n<ci.length;$n++){var oa=ci[$n];bf(this.layoutVertexArray,oa.x,oa.y,0,0,1,1,0),Nr.push(oa.x),Nr.push(oa.y)}}}for(var Ri=Ac(Nr,ln),si=0;si<Ri.length;si+=3)this.indexArray.emplaceBack(wn+Ri[si],wn+Ri[si+2],wn+Ri[si+1]);ne.primitiveLength+=Ri.length/3,ne.vertexLength+=F}}var ua;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Vn("FillExtrusionBucket",pl,{omit:["layers","features"]});var Hl={paint:new Io({"fill-extrusion-opacity":new Gn(oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wn(oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Gn(oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Gn(oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ol(oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wn(oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wn(oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Gn(oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},mh=function(e){function t(r){e.call(this,r,Hl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new pl(r)},t.prototype.queryRadius=function(){return ca(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,f,v,y,x,P,F,U){var W=da(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),P.angle,F),ne=this.paint.get("fill-extrusion-height").evaluate(f,v),de=this.paint.get("fill-extrusion-base").evaluate(f,v),be=function(Xe,_t,rt,Dt){for(var qt=[],mr=0,xr=Xe;mr<xr.length;mr+=1){var Nr=xr[mr],ln=[Nr.x,Nr.y,0,1];bu(ln,ln,_t),qt.push(new ae(ln[0]/ln[3],ln[1]/ln[3]))}return qt}(W,U),He=function(Xe,_t,rt,Dt){for(var qt=[],mr=[],xr=Dt[8]*_t,Nr=Dt[9]*_t,ln=Dt[10]*_t,wn=Dt[11]*_t,ei=Dt[8]*rt,jn=Dt[9]*rt,ci=Dt[10]*rt,$n=Dt[11]*rt,oa=0,Ri=Xe;oa<Ri.length;oa+=1){for(var si=[],ua=[],Wi=0,wa=Ri[oa];Wi<wa.length;Wi+=1){var vi=wa[Wi],Da=vi.x,$a=vi.y,zo=Dt[0]*Da+Dt[4]*$a+Dt[12],Eo=Dt[1]*Da+Dt[5]*$a+Dt[13],Ro=Dt[2]*Da+Dt[6]*$a+Dt[14],$o=Dt[3]*Da+Dt[7]*$a+Dt[15],Vo=Ro+ln,Ds=$o+wn,hu=zo+ei,Ws=Eo+jn,Eu=Ro+ci,vs=$o+$n,Xs=new ae((zo+xr)/Ds,(Eo+Nr)/Ds);Xs.z=Vo/Ds,si.push(Xs);var Sa=new ae(hu/vs,Ws/vs);Sa.z=Eu/vs,ua.push(Sa)}qt.push(si),mr.push(ua)}return[qt,mr]}(y,de,ne,U);return function(Xe,_t,rt){var Dt=1/0;ni(rt,_t)&&(Dt=cc(rt,_t[0]));for(var qt=0;qt<_t.length;qt++)for(var mr=_t[qt],xr=Xe[qt],Nr=0;Nr<mr.length-1;Nr++){var ln=mr[Nr],wn=[ln,mr[Nr+1],xr[Nr+1],xr[Nr],ln];Kr(rt,wn)&&(Dt=Math.min(Dt,cc(rt,wn)))}return Dt!==1/0&&Dt}(He[0],He[1],be)},t}(ru);function Wl(e,t){return e.x*t.x+e.y*t.y}function cc(e,t){if(e.length===1){for(var r,f=0,v=t[f++];!r||v.equals(r);)if(!(r=t[f++]))return 1/0;for(;f<t.length;f++){var y=t[f],x=e[0],P=r.sub(v),F=y.sub(v),U=x.sub(v),W=Wl(P,P),ne=Wl(P,F),de=Wl(F,F),be=Wl(U,P),He=Wl(U,F),Xe=W*de-ne*ne,_t=(de*be-ne*He)/Xe,rt=(W*He-ne*be)/Xe,Dt=v.z*(1-_t-rt)+r.z*_t+y.z*rt;if(isFinite(Dt))return Dt}return 1/0}for(var qt=1/0,mr=0,xr=t;mr<xr.length;mr+=1)qt=Math.min(qt,xr[mr].z);return qt}var yh=ji([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Vf=ji([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Sf=Pc.VectorTileFeature.types,gh=Math.cos(Math.PI/180*37.5),Cs=Math.pow(2,14)/.5,Xo=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new Ya,this.layoutVertexArray2=new Hs,this.indexArray=new xu,this.programConfigurations=new Q(e.layers,e.zoom),this.segments=new we,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};Xo.prototype.populate=function(e,t,r){this.hasPattern=of("line",this.layers,t);for(var f=this.layers[0].layout.get("line-sort-key"),v=[],y=0,x=e;y<x.length;y+=1){var P=x[y],F=P.feature,U=P.id,W=P.index,ne=P.sourceLayerIndex,de=this.layers[0]._featureFilter.needGeometry,be=Rt(F,de);if(this.layers[0]._featureFilter.filter(new ea(this.zoom),be,r)){var He=f?f.evaluate(be,{},r):void 0,Xe={id:U,properties:F.properties,type:F.type,sourceLayerIndex:ne,index:W,geometry:de?be.geometry:ft(F),patterns:{},sortKey:He};v.push(Xe)}}f&&v.sort(function(ln,wn){return ln.sortKey-wn.sortKey});for(var _t=0,rt=v;_t<rt.length;_t+=1){var Dt=rt[_t],qt=Dt.geometry,mr=Dt.index,xr=Dt.sourceLayerIndex;if(this.hasPattern){var Nr=Bc("line",this.layers,Dt,this.zoom,t);this.patternFeatures.push(Nr)}else this.addFeature(Dt,qt,mr,r,{});t.featureIndex.insert(e[mr].feature,qt,mr,xr,this.index)}},Xo.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Xo.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var y=v[f];this.addFeature(y,y.geometry,y.index,t,r)}},Xo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Xo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Xo.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Vf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Xo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Xo.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},Xo.prototype.addFeature=function(e,t,r,f,v){var y=this.layers[0].layout,x=y.get("line-join").evaluate(e,{}),P=y.get("line-cap"),F=y.get("line-miter-limit"),U=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var W=0,ne=t;W<ne.length;W+=1)this.addLine(ne[W],e,x,P,F,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Xo.prototype.addLine=function(e,t,r,f,v,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var x=0;x<e.length-1;x++)this.totalDistance+=e[x].dist(e[x+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var P=Sf[t.type]==="Polygon",F=e.length;F>=2&&e[F-1].equals(e[F-2]);)F--;for(var U=0;U<F-1&&e[U].equals(e[U+1]);)U++;if(!(F<(P?3:2))){r==="bevel"&&(v=1.05);var W,ne=this.overscaling<=16?122880/(512*this.overscaling):0,de=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray),be=void 0,He=void 0,Xe=void 0,_t=void 0;this.e1=this.e2=-1,P&&(_t=e[U].sub(W=e[F-2])._unit()._perp());for(var rt=U;rt<F;rt++)if(!(He=rt===F-1?P?e[U+1]:void 0:e[rt+1])||!e[rt].equals(He)){_t&&(Xe=_t),W&&(be=W),W=e[rt],_t=He?He.sub(W)._unit()._perp():Xe;var Dt=(Xe=Xe||_t).add(_t);Dt.x===0&&Dt.y===0||Dt._unit();var qt=Xe.x*_t.x+Xe.y*_t.y,mr=Dt.x*_t.x+Dt.y*_t.y,xr=mr!==0?1/mr:1/0,Nr=2*Math.sqrt(2-2*mr),ln=mr<gh&&be&&He,wn=Xe.x*_t.y-Xe.y*_t.x>0;if(ln&&rt>U){var ei=W.dist(be);if(ei>2*ne){var jn=W.sub(W.sub(be)._mult(ne/ei)._round());this.updateDistance(be,jn),this.addCurrentVertex(jn,Xe,0,0,de),be=jn}}var ci=be&&He,$n=ci?r:P?"butt":f;if(ci&&$n==="round"&&(xr<y?$n="miter":xr<=2&&($n="fakeround")),$n==="miter"&&xr>v&&($n="bevel"),$n==="bevel"&&(xr>2&&($n="flipbevel"),xr<v&&($n="miter")),be&&this.updateDistance(be,W),$n==="miter")Dt._mult(xr),this.addCurrentVertex(W,Dt,0,0,de);else if($n==="flipbevel"){if(xr>100)Dt=_t.mult(-1);else{var oa=xr*Xe.add(_t).mag()/Xe.sub(_t).mag();Dt._perp()._mult(oa*(wn?-1:1))}this.addCurrentVertex(W,Dt,0,0,de),this.addCurrentVertex(W,Dt.mult(-1),0,0,de)}else if($n==="bevel"||$n==="fakeround"){var Ri=-Math.sqrt(xr*xr-1),si=wn?Ri:0,ua=wn?0:Ri;if(be&&this.addCurrentVertex(W,Xe,si,ua,de),$n==="fakeround")for(var Wi=Math.round(180*Nr/Math.PI/20),wa=1;wa<Wi;wa++){var vi=wa/Wi;if(vi!==.5){var Da=vi-.5;vi+=vi*Da*(vi-1)*((1.0904+qt*(qt*(3.55645-1.43519*qt)-3.2452))*Da*Da+(.848013+qt*(.215638*qt-1.06021)))}var $a=_t.sub(Xe)._mult(vi)._add(Xe)._unit()._mult(wn?-1:1);this.addHalfVertex(W,$a.x,$a.y,!1,wn,0,de)}He&&this.addCurrentVertex(W,_t,-si,-ua,de)}else if($n==="butt")this.addCurrentVertex(W,Dt,0,0,de);else if($n==="square"){var zo=be?1:-1;this.addCurrentVertex(W,Dt,zo,zo,de)}else $n==="round"&&(be&&(this.addCurrentVertex(W,Xe,0,0,de),this.addCurrentVertex(W,Xe,1,1,de,!0)),He&&(this.addCurrentVertex(W,_t,-1,-1,de,!0),this.addCurrentVertex(W,_t,0,0,de)));if(ln&&rt<F-1){var Eo=W.dist(He);if(Eo>2*ne){var Ro=W.add(He.sub(W)._mult(ne/Eo)._round());this.updateDistance(W,Ro),this.addCurrentVertex(Ro,_t,0,0,de),W=Ro}}}}},Xo.prototype.addCurrentVertex=function(e,t,r,f,v,y){y===void 0&&(y=!1);var x=t.y*f-t.x,P=-t.y-t.x*f;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,y,!1,r,v),this.addHalfVertex(e,x,P,y,!0,-f,v),this.distance>Cs/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,f,v,y))},Xo.prototype.addHalfVertex=function(e,t,r,f,v,y,x){var P=.5*(this.lineClips?this.scaledDistance*(Cs-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(f?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(y===0?0:y<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var F=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),x.primitiveLength++),v?this.e2=F:this.e1=F},Xo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Xo.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Vn("LineBucket",Xo,{omit:["layers","patternFeatures"]});var hs=new Io({"line-cap":new Gn(oe.layout_line["line-cap"]),"line-join":new Wn(oe.layout_line["line-join"]),"line-miter-limit":new Gn(oe.layout_line["line-miter-limit"]),"line-round-limit":new Gn(oe.layout_line["line-round-limit"]),"line-sort-key":new Wn(oe.layout_line["line-sort-key"])}),Su={paint:new Io({"line-opacity":new Wn(oe.paint_line["line-opacity"]),"line-color":new Wn(oe.paint_line["line-color"]),"line-translate":new Gn(oe.paint_line["line-translate"]),"line-translate-anchor":new Gn(oe.paint_line["line-translate-anchor"]),"line-width":new Wn(oe.paint_line["line-width"]),"line-gap-width":new Wn(oe.paint_line["line-gap-width"]),"line-offset":new Wn(oe.paint_line["line-offset"]),"line-blur":new Wn(oe.paint_line["line-blur"]),"line-dasharray":new ls(oe.paint_line["line-dasharray"]),"line-pattern":new ol(oe.paint_line["line-pattern"]),"line-gradient":new cs(oe.paint_line["line-gradient"])}),layout:hs},_h=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f){return f=new ea(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),e.prototype.possiblyEvaluate.call(this,r,f)},t.prototype.evaluate=function(r,f,v,y){return f=Ft({},f,{zoom:Math.floor(f.zoom)}),e.prototype.evaluate.call(this,r,f,v,y)},t}(Wn))(Su.paint.properties["line-width"].specification);_h.useIntegerZoom=!0;var vp=function(e){function t(r){e.call(this,r,Su),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ts,this.gradientVersion=(this.gradientVersion+1)%Qe)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f),this.paint._values["line-floorwidth"]=_h.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new Xo(r)},t.prototype.queryRadius=function(r){var f=r,v=zh(to("line-width",this,f),to("line-gap-width",this,f)),y=to("line-offset",this,f);return v/2+Math.abs(y)+ca(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,y,x,P,F){var U=da(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),P.angle,F),W=F/2*zh(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),ne=this.paint.get("line-offset").evaluate(f,v);return ne&&(y=function(de,be){for(var He=[],Xe=new ae(0,0),_t=0;_t<de.length;_t++){for(var rt=de[_t],Dt=[],qt=0;qt<rt.length;qt++){var mr=rt[qt],xr=rt[qt+1],Nr=qt===0?Xe:mr.sub(rt[qt-1])._unit()._perp(),ln=qt===rt.length-1?Xe:xr.sub(mr)._unit()._perp(),wn=Nr._add(ln)._unit();wn._mult(1/(wn.x*ln.x+wn.y*ln.y)),Dt.push(wn._mult(be)._add(mr))}He.push(Dt)}return He}(y,ne*F)),function(de,be,He){for(var Xe=0;Xe<be.length;Xe++){var _t=be[Xe];if(de.length>=3){for(var rt=0;rt<_t.length;rt++)if(Va(de,_t[rt]))return!0}if(li(de,_t,He))return!0}return!1}(U,y,W)},t.prototype.isTileClipped=function(){return!0},t}(ru);function zh(e,t){return t>0?t+2*e:e}var mp=ji([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yp=ji([{name:"a_projected_pos",components:3,type:"Float32"}],4),Zh=(ji([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),ji([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Uh=(ji([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),ji([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),gp=ji([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function _p(e,t,r){return e.sections.forEach(function(f){f.text=function(v,y,x){var P=y.layout.get("text-transform").evaluate(x,{});return P==="uppercase"?v=v.toLocaleUpperCase():P==="lowercase"&&(v=v.toLocaleLowerCase()),Mo.applyArabicShaping&&(v=Mo.applyArabicShaping(v)),v}(f.text,t,r)}),e}ji([{name:"triangle",components:3,type:"Uint16"}]),ji([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ji([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ji([{type:"Float32",name:"offsetX"}]),ji([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ef={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},jh=function(e,t,r,f,v){var y,x,P=8*v-f-1,F=(1<<P)-1,U=F>>1,W=-7,ne=r?v-1:0,de=r?-1:1,be=e[t+ne];for(ne+=de,y=be&(1<<-W)-1,be>>=-W,W+=P;W>0;y=256*y+e[t+ne],ne+=de,W-=8);for(x=y&(1<<-W)-1,y>>=-W,W+=f;W>0;x=256*x+e[t+ne],ne+=de,W-=8);if(y===0)y=1-U;else{if(y===F)return x?NaN:1/0*(be?-1:1);x+=Math.pow(2,f),y-=U}return(be?-1:1)*x*Math.pow(2,y-f)},xh=function(e,t,r,f,v,y){var x,P,F,U=8*y-v-1,W=(1<<U)-1,ne=W>>1,de=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,be=f?0:y-1,He=f?1:-1,Xe=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(P=isNaN(t)?1:0,x=W):(x=Math.floor(Math.log(t)/Math.LN2),t*(F=Math.pow(2,-x))<1&&(x--,F*=2),(t+=x+ne>=1?de/F:de*Math.pow(2,1-ne))*F>=2&&(x++,F/=2),x+ne>=W?(P=0,x=W):x+ne>=1?(P=(t*F-1)*Math.pow(2,v),x+=ne):(P=t*Math.pow(2,ne-1)*Math.pow(2,v),x=0));v>=8;e[r+be]=255&P,be+=He,P/=256,v-=8);for(x=x<<v|P,U+=v;U>0;e[r+be]=255&x,be+=He,x/=256,U-=8);e[r+be-He]|=128*Xe},Cf=ro;function ro(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}ro.Varint=0,ro.Fixed64=1,ro.Bytes=2,ro.Fixed32=5;var Vh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Xl(e){return e.type===ro.Bytes?e.readVarint()+e.pos:e.pos+1}function Nc(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Gh(e,t,r){var f=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(f);for(var v=r.pos-1;v>=e;v--)r.buf[v+f]=r.buf[v]}function Z(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Ie(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function qe(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function pr(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function Br(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function lr(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Ir(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Vr(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function $r(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function en(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function tn(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function sn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function bn(e,t,r){e===1&&r.readMessage(Yr,t)}function Yr(e,t,r){if(e===3){var f=r.readMessage(un,{}),v=f.width,y=f.height,x=f.left,P=f.top,F=f.advance;t.push({id:f.id,bitmap:new Xu({width:v+6,height:y+6},f.bitmap),metrics:{width:v,height:y,left:x,top:P,advance:F}})}}function un(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function zt(e){for(var t=0,r=0,f=0,v=e;f<v.length;f+=1){var y=v[f];t+=y.w*y.h,r=Math.max(r,y.w)}e.sort(function(Xe,_t){return _t.h-Xe.h});for(var x=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],P=0,F=0,U=0,W=e;U<W.length;U+=1)for(var ne=W[U],de=x.length-1;de>=0;de--){var be=x[de];if(!(ne.w>be.w||ne.h>be.h)){if(ne.x=be.x,ne.y=be.y,F=Math.max(F,ne.y+ne.h),P=Math.max(P,ne.x+ne.w),ne.w===be.w&&ne.h===be.h){var He=x.pop();de<x.length&&(x[de]=He)}else ne.h===be.h?(be.x+=ne.w,be.w-=ne.w):ne.w===be.w?(be.y+=ne.h,be.h-=ne.h):(x.push({x:be.x+ne.w,y:be.y,w:be.w-ne.w,h:ne.h}),be.y+=ne.h,be.h-=ne.h);break}}return{w:P,h:F,fill:t/(P*F)||0}}ro.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var f=this.readVarint(),v=f>>3,y=this.pos;this.type=7&f,e(v,t,this),this.pos===y&&this.skip(f)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=en(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=sn(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=en(this.buf,this.pos)+4294967296*en(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=en(this.buf,this.pos)+4294967296*sn(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=jh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=jh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,f=this.buf;return t=127&(r=f[this.pos++]),r<128?t:(t|=(127&(r=f[this.pos++]))<<7,r<128?t:(t|=(127&(r=f[this.pos++]))<<14,r<128?t:(t|=(127&(r=f[this.pos++]))<<21,r<128?t:function(v,y,x){var P,F,U=x.buf;if(P=(112&(F=U[x.pos++]))>>4,F<128||(P|=(127&(F=U[x.pos++]))<<3,F<128)||(P|=(127&(F=U[x.pos++]))<<10,F<128)||(P|=(127&(F=U[x.pos++]))<<17,F<128)||(P|=(127&(F=U[x.pos++]))<<24,F<128)||(P|=(1&(F=U[x.pos++]))<<31,F<128))return Nc(v,P,y);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=f[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Vh?function(r,f,v){return Vh.decode(r.subarray(f,v))}(this.buf,t,e):function(r,f,v){for(var y="",x=f;x<v;){var P,F,U,W=r[x],ne=null,de=W>239?4:W>223?3:W>191?2:1;if(x+de>v)break;de===1?W<128&&(ne=W):de===2?(192&(P=r[x+1]))==128&&(ne=(31&W)<<6|63&P)<=127&&(ne=null):de===3?(F=r[x+2],(192&(P=r[x+1]))==128&&(192&F)==128&&((ne=(15&W)<<12|(63&P)<<6|63&F)<=2047||ne>=55296&&ne<=57343)&&(ne=null)):de===4&&(F=r[x+2],U=r[x+3],(192&(P=r[x+1]))==128&&(192&F)==128&&(192&U)==128&&((ne=(15&W)<<18|(63&P)<<12|(63&F)<<6|63&U)<=65535||ne>=1114112)&&(ne=null)),ne===null?(ne=65533,de=1):ne>65535&&(ne-=65536,y+=String.fromCharCode(ne>>>10&1023|55296),ne=56320|1023&ne),y+=String.fromCharCode(ne),x+=de}return y}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==ro.Bytes)return e.push(this.readVarint(t));var r=Xl(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==ro.Bytes)return e.push(this.readSVarint());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==ro.Bytes)return e.push(this.readBoolean());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==ro.Bytes)return e.push(this.readFloat());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==ro.Bytes)return e.push(this.readDouble());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==ro.Bytes)return e.push(this.readFixed32());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==ro.Bytes)return e.push(this.readSFixed32());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==ro.Bytes)return e.push(this.readFixed64());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==ro.Bytes)return e.push(this.readSFixed64());var t=Xl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===ro.Varint)for(;this.buf[this.pos++]>127;);else if(t===ro.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ro.Fixed32)this.pos+=4;else{if(t!==ro.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),tn(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),tn(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),tn(this.buf,-1&e,this.pos),tn(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),tn(this.buf,-1&e,this.pos),tn(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var f,v;if(t>=0?(f=t%4294967296|0,v=t/4294967296|0):(v=~(-t/4294967296),4294967295^(f=~(-t%4294967296))?f=f+1|0:(f=0,v=v+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(y,x,P){P.buf[P.pos++]=127&y|128,y>>>=7,P.buf[P.pos++]=127&y|128,y>>>=7,P.buf[P.pos++]=127&y|128,y>>>=7,P.buf[P.pos++]=127&y|128,P.buf[P.pos]=127&(y>>>=7)}(f,0,r),function(y,x){var P=(7&y)<<4;x.buf[x.pos++]|=P|((y>>>=3)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y)))))}(v,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(f,v,y){for(var x,P,F=0;F<v.length;F++){if((x=v.charCodeAt(F))>55295&&x<57344){if(!P){x>56319||F+1===v.length?(f[y++]=239,f[y++]=191,f[y++]=189):P=x;continue}if(x<56320){f[y++]=239,f[y++]=191,f[y++]=189,P=x;continue}x=P-55296<<10|x-56320|65536,P=null}else P&&(f[y++]=239,f[y++]=191,f[y++]=189,P=null);x<128?f[y++]=x:(x<2048?f[y++]=x>>6|192:(x<65536?f[y++]=x>>12|224:(f[y++]=x>>18|240,f[y++]=x>>12&63|128),f[y++]=x>>6&63|128),f[y++]=63&x|128)}return y}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&Gh(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),xh(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),xh(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var f=this.pos-r;f>=128&&Gh(r,f,this),this.pos=r-1,this.writeVarint(f),this.pos+=f},writeMessage:function(e,t,r){this.writeTag(e,ro.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Z,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Ie,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Br,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,qe,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,pr,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,lr,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Ir,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Vr,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,$r,t)},writeBytesField:function(e,t){this.writeTag(e,ro.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,ro.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,ro.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,ro.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,ro.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,ro.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,ro.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,ro.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,ro.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,ro.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var gr=function(e,t){var r=t.pixelRatio,f=t.version,v=t.stretchX,y=t.stretchY,x=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=v,this.stretchY=y,this.content=x,this.version=f},Jr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Jr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Jr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Jr.tlbr.get=function(){return this.tl.concat(this.br)},Jr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(gr.prototype,Jr);var Dn=function(e,t){var r={},f={};this.haveRenderCallbacks=[];var v=[];this.addImages(e,r,v),this.addImages(t,f,v);var y=zt(v),x=new fs({width:y.w||1,height:y.h||1});for(var P in e){var F=e[P],U=r[P].paddedRect;fs.copy(F.data,x,{x:0,y:0},{x:U.x+1,y:U.y+1},F.data)}for(var W in t){var ne=t[W],de=f[W].paddedRect,be=de.x+1,He=de.y+1,Xe=ne.data.width,_t=ne.data.height;fs.copy(ne.data,x,{x:0,y:0},{x:be,y:He},ne.data),fs.copy(ne.data,x,{x:0,y:_t-1},{x:be,y:He-1},{width:Xe,height:1}),fs.copy(ne.data,x,{x:0,y:0},{x:be,y:He+_t},{width:Xe,height:1}),fs.copy(ne.data,x,{x:Xe-1,y:0},{x:be-1,y:He},{width:1,height:_t}),fs.copy(ne.data,x,{x:0,y:0},{x:be+Xe,y:He},{width:1,height:_t})}this.image=x,this.iconPositions=r,this.patternPositions=f};Dn.prototype.addImages=function(e,t,r){for(var f in e){var v=e[f],y={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(y),t[f]=new gr(y,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}},Dn.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},Dn.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var f=e.tl;r.update(t.data,void 0,{x:f[0],y:f[1]})}},Vn("ImagePosition",gr),Vn("ImageAtlas",Dn);var Dr={horizontal:1,vertical:2,horizontalOnly:3},Pn=function(){this.scale=1,this.fontStack="",this.imageName=null};Pn.forText=function(e,t){var r=new Pn;return r.scale=e||1,r.fontStack=t,r},Pn.forImage=function(e){var t=new Pn;return t.imageName=e,t};var fn=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function pi(e,t,r,f,v,y,x,P,F,U,W,ne,de,be,He,Xe){var _t,rt=fn.fromFeature(e,v);ne===Dr.vertical&&rt.verticalizePunctuation();var Dt=Mo.processBidirectionalText,qt=Mo.processStyledBidirectionalText;if(Dt&&rt.sections.length===1){_t=[];for(var mr=0,xr=Dt(rt.toString(),On(rt,U,y,t,f,be,He));mr<xr.length;mr+=1){var Nr=xr[mr],ln=new fn;ln.text=Nr,ln.sections=rt.sections;for(var wn=0;wn<Nr.length;wn++)ln.sectionIndex.push(0);_t.push(ln)}}else if(qt){_t=[];for(var ei=0,jn=qt(rt.text,rt.sectionIndex,On(rt,U,y,t,f,be,He));ei<jn.length;ei+=1){var ci=jn[ei],$n=new fn;$n.text=ci[0],$n.sectionIndex=ci[1],$n.sections=rt.sections,_t.push($n)}}else _t=function(si,ua){for(var Wi=[],wa=si.text,vi=0,Da=0,$a=ua;Da<$a.length;Da+=1){var zo=$a[Da];Wi.push(si.substring(vi,zo)),vi=zo}return vi<wa.length&&Wi.push(si.substring(vi,wa.length)),Wi}(rt,On(rt,U,y,t,f,be,He));var oa=[],Ri={positionedLines:oa,text:rt.toString(),top:W[1],bottom:W[1],left:W[0],right:W[0],writingMode:ne,iconsInText:!1,verticalizable:!1};return function(si,ua,Wi,wa,vi,Da,$a,zo,Eo,Ro,$o,Vo){for(var Ds=0,hu=-17,Ws=0,Eu=0,vs=zo==="right"?1:zo==="left"?0:.5,Xs=0,Sa=0,mo=vi;Sa<mo.length;Sa+=1){var io=mo[Sa];io.trim();var Ta=io.getMaxScale(),iu=24*(Ta-1),pu={positionedGlyphs:[],lineOffset:0};si.positionedLines[Xs]=pu;var _o=pu.positionedGlyphs,ms=0;if(io.length()){for(var du=0;du<io.length();du++){var ka=io.getSection(du),Mc=io.getSectionIndex(du),Dl=io.getCharCode(du),fc=0,ns=null,jc=null,$u=null,Yf=24,Kf=!(Eo===Dr.horizontal||!$o&&!xc(Dl)||$o&&(kr[Dl]||(cf=Dl,En.Arabic(cf)||En["Arabic Supplement"](cf)||En["Arabic Extended-A"](cf)||En["Arabic Presentation Forms-A"](cf)||En["Arabic Presentation Forms-B"](cf))));if(ka.imageName){var Kl=wa[ka.imageName];if(!Kl)continue;$u=ka.imageName,si.iconsInText=si.iconsInText||!0,jc=Kl.paddedRect;var Ic=Kl.displaySize;ka.scale=24*ka.scale/Vo,fc=iu+(24-Ic[1]*ka.scale),Yf=(ns={width:Ic[0],height:Ic[1],left:1,top:-3,advance:Kf?Ic[1]:Ic[0]}).advance;var Vc=Kf?Ic[0]*ka.scale-24*Ta:Ic[1]*ka.scale-24*Ta;Vc>0&&Vc>ms&&(ms=Vc)}else{var Xh=Wi[ka.fontStack],$f=Xh&&Xh[Dl];if($f&&$f.rect)jc=$f.rect,ns=$f.metrics;else{var Oc=ua[ka.fontStack],Yh=Oc&&Oc[Dl];if(!Yh)continue;ns=Yh.metrics}fc=24*(Ta-ka.scale)}Kf?(si.verticalizable=!0,_o.push({glyph:Dl,imageName:$u,x:Ds,y:hu+fc,vertical:Kf,scale:ka.scale,fontStack:ka.fontStack,sectionIndex:Mc,metrics:ns,rect:jc}),Ds+=Yf*ka.scale+Ro):(_o.push({glyph:Dl,imageName:$u,x:Ds,y:hu+fc,vertical:Kf,scale:ka.scale,fontStack:ka.fontStack,sectionIndex:Mc,metrics:ns,rect:jc}),Ds+=ns.advance*ka.scale+Ro)}_o.length!==0&&(Ws=Math.max(Ds-Ro,Ws),Bi(_o,0,_o.length-1,vs,ms)),Ds=0;var Kh=Da*Ta+ms;pu.lineOffset=Math.max(ms,iu),hu+=Kh,Eu=Math.max(Kh,Eu),++Xs}else hu+=Da,++Xs}var cf,$h=hu- -17,Sh=Gi($a),Af=Sh.horizontalAlign,Eh=Sh.verticalAlign;(function(Sp,Ep,Jf,Qf,Cp,Tf,Gc,Jh,qf){var ff,hf=(Ep-Jf)*Cp;ff=Tf!==Gc?-Jh*Qf- -17:(-Qf*qf+.5)*Gc;for(var eh=0,th=Sp;eh<th.length;eh+=1)for(var ys=0,Ch=th[eh].positionedGlyphs;ys<Ch.length;ys+=1){var rh=Ch[ys];rh.x+=hf,rh.y+=ff}})(si.positionedLines,vs,Af,Eh,Ws,Eu,Da,$h,vi.length),si.top+=-Eh*$h,si.bottom=si.top+$h,si.left+=-Af*Ws,si.right=si.left+Ws}(Ri,t,r,f,_t,x,P,F,ne,U,de,Xe),!function(si){for(var ua=0,Wi=si;ua<Wi.length;ua+=1)if(Wi[ua].positionedGlyphs.length!==0)return!1;return!0}(oa)&&Ri}fn.fromFeature=function(e,t){for(var r=new fn,f=0;f<e.sections.length;f++){var v=e.sections[f];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},fn.prototype.length=function(){return this.text.length},fn.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},fn.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},fn.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},fn.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var f=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=f&&lu(f)&&!Ef[e[r+1]]||v&&lu(v)&&!Ef[e[r-1]]||!Ef[e[r]]?e[r]:Ef[e[r]]}return t}(this.text)},fn.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&kr[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,f=this.text.length-1;f>=0&&f>=e&&kr[this.text.charCodeAt(f)];f--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},fn.prototype.substring=function(e,t){var r=new fn;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},fn.prototype.toString=function(){return this.text},fn.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},fn.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(Pn.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,f=0;f<e.text.length;++f)this.sectionIndex.push(r)},fn.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(Pn.forImage(t)),this.sectionIndex.push(this.sections.length-1)):De("Reached maximum number of images 6401")}else De("Can't add FormattedSection with an empty image.")},fn.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var kr={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ar={};function ri(e,t,r,f,v,y){if(t.imageName){var x=f[t.imageName];return x?x.displaySize[0]*t.scale*24/y+v:0}var P=r[t.fontStack],F=P&&P[e];return F?F.metrics.advance*t.scale+v:0}function Cn(e,t,r,f){var v=Math.pow(e-t,2);return f?e<t?v/2:2*v:v+Math.abs(r)*r}function rn(e,t,r){var f=0;return e===10&&(f-=1e4),r&&(f+=150),e!==40&&e!==65288||(f+=50),t!==41&&t!==65289||(f+=50),f}function Mn(e,t,r,f,v,y){for(var x=null,P=Cn(t,r,v,y),F=0,U=f;F<U.length;F+=1){var W=U[F],ne=Cn(t-W.x,r,v,y)+W.badness;ne<=P&&(x=W,P=ne)}return{index:e,x:t,priorBreak:x,badness:P}}function On(e,t,r,f,v,y,x){if(y!=="point")return[];if(!e)return[];for(var P,F=[],U=function(_t,rt,Dt,qt,mr,xr){for(var Nr=0,ln=0;ln<_t.length();ln++){var wn=_t.getSection(ln);Nr+=ri(_t.getCharCode(ln),wn,qt,mr,rt,xr)}return Nr/Math.max(1,Math.ceil(Nr/Dt))}(e,t,r,f,v,x),W=e.text.indexOf("\u200B")>=0,ne=0,de=0;de<e.length();de++){var be=e.getSection(de),He=e.getCharCode(de);if(kr[He]||(ne+=ri(He,be,f,v,t,x)),de<e.length()-1){var Xe=!((P=He)<11904||!(En["Bopomofo Extended"](P)||En.Bopomofo(P)||En["CJK Compatibility Forms"](P)||En["CJK Compatibility Ideographs"](P)||En["CJK Compatibility"](P)||En["CJK Radicals Supplement"](P)||En["CJK Strokes"](P)||En["CJK Symbols and Punctuation"](P)||En["CJK Unified Ideographs Extension A"](P)||En["CJK Unified Ideographs"](P)||En["Enclosed CJK Letters and Months"](P)||En["Halfwidth and Fullwidth Forms"](P)||En.Hiragana(P)||En["Ideographic Description Characters"](P)||En["Kangxi Radicals"](P)||En["Katakana Phonetic Extensions"](P)||En.Katakana(P)||En["Vertical Forms"](P)||En["Yi Radicals"](P)||En["Yi Syllables"](P)));(Ar[He]||Xe||be.imageName)&&F.push(Mn(de+1,ne,U,F,rn(He,e.getCharCode(de+1),Xe&&W),!1))}}return function _t(rt){return rt?_t(rt.priorBreak).concat(rt.index):[]}(Mn(e.length(),ne,U,F,0,!0))}function Gi(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Bi(e,t,r,f,v){if(f||v)for(var y=e[r],x=(e[r].x+y.metrics.advance*y.scale)*f,P=t;P<=r;P++)e[P].x-=x,e[P].y+=v}function kn(e,t,r,f,v,y){var x,P=e.image;if(P.content){var F=P.content,U=P.pixelRatio||1;x=[F[0]/U,F[1]/U,P.displaySize[0]-F[2]/U,P.displaySize[1]-F[3]/U]}var W,ne,de,be,He=t.left*y,Xe=t.right*y;r==="width"||r==="both"?(be=v[0]+He-f[3],ne=v[0]+Xe+f[1]):ne=(be=v[0]+(He+Xe-P.displaySize[0])/2)+P.displaySize[0];var _t=t.top*y,rt=t.bottom*y;return r==="height"||r==="both"?(W=v[1]+_t-f[0],de=v[1]+rt+f[2]):de=(W=v[1]+(_t+rt-P.displaySize[1])/2)+P.displaySize[1],{image:P,top:W,right:ne,bottom:de,left:be,collisionPadding:x}}Ar[10]=!0,Ar[32]=!0,Ar[38]=!0,Ar[40]=!0,Ar[41]=!0,Ar[43]=!0,Ar[45]=!0,Ar[47]=!0,Ar[173]=!0,Ar[183]=!0,Ar[8203]=!0,Ar[8208]=!0,Ar[8211]=!0,Ar[8231]=!0;var An=function(e){function t(r,f,v,y){e.call(this,r,f),this.angle=v,y!==void 0&&(this.segment=y)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(ae);function Ti(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ea(e+1))};if(r.kind==="source")return{kind:"source"};for(var f=r.zoomStops,v=r.interpolationType,y=0;y<f.length&&f[y]<=e;)y++;for(var x=y=Math.max(0,y-1);x<f.length&&f[x]<e+1;)x++;x=Math.min(f.length-1,x);var P=f[y],F=f[x];return r.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:F,interpolationType:v}:{kind:"camera",minZoom:P,maxZoom:F,minSize:r.evaluate(new ea(P)),maxSize:r.evaluate(new ea(F)),interpolationType:v}}function Ui(e,t,r){var f=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?Aa(v/128,r.upperSize/128,t.uSizeT):f}function ma(e,t){var r=0,f=0;if(e.kind==="constant")f=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,y=v?$t(Le.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?f=Aa(e.minSize,e.maxSize,y):r=y}return{uSizeT:r,uSize:f}}Vn("Anchor",An);var Zo=Object.freeze({__proto__:null,getSizeData:Ti,evaluateSizeForFeature:Ui,evaluateSizeForZoom:ma,SIZE_PACK_FACTOR:128});function bo(e,t,r,f,v){if(t.segment===void 0)return!0;for(var y=t,x=t.segment+1,P=0;P>-r/2;){if(--x<0)return!1;P-=e[x].dist(y),y=e[x]}P+=e[x].dist(e[x+1]),x++;for(var F=[],U=0;P<r/2;){var W=e[x],ne=e[x+1];if(!ne)return!1;var de=e[x-1].angleTo(W)-W.angleTo(ne);for(de=Math.abs((de+3*Math.PI)%(2*Math.PI)-Math.PI),F.push({distance:P,angleDelta:de}),U+=de;P-F[0].distance>f;)U-=F.shift().angleDelta;if(U>v)return!1;x++,P+=W.dist(ne)}return!0}function sa(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function ps(e,t,r){return e?.6*t*r:0}function fo(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Yo(e,t,r,f,v,y){for(var x=ps(r,v,y),P=fo(r,f)*y,F=0,U=sa(e)/2,W=0;W<e.length-1;W++){var ne=e[W],de=e[W+1],be=ne.dist(de);if(F+be>U){var He=(U-F)/be,Xe=Aa(ne.x,de.x,He),_t=Aa(ne.y,de.y,He),rt=new An(Xe,_t,de.angleTo(ne),W);return rt._round(),!x||bo(e,rt,P,x,t)?rt:void 0}F+=be}}function Uo(e,t,r,f,v,y,x,P,F){var U=ps(f,y,x),W=fo(f,v),ne=W*x,de=e[0].x===0||e[0].x===F||e[0].y===0||e[0].y===F;return t-ne<t/4&&(t=ne+t/4),function be(He,Xe,_t,rt,Dt,qt,mr,xr,Nr){for(var ln=qt/2,wn=sa(He),ei=0,jn=Xe-_t,ci=[],$n=0;$n<He.length-1;$n++){for(var oa=He[$n],Ri=He[$n+1],si=oa.dist(Ri),ua=Ri.angleTo(oa);jn+_t<ei+si;){var Wi=((jn+=_t)-ei)/si,wa=Aa(oa.x,Ri.x,Wi),vi=Aa(oa.y,Ri.y,Wi);if(wa>=0&&wa<Nr&&vi>=0&&vi<Nr&&jn-ln>=0&&jn+ln<=wn){var Da=new An(wa,vi,ua,$n);Da._round(),rt&&!bo(He,Da,qt,rt,Dt)||ci.push(Da)}}ei+=si}return xr||ci.length||mr||(ci=be(He,ei/2,_t,rt,Dt,qt,mr,!0,Nr)),ci}(e,de?t/2*P%t:(W/2+2*y)*x*P%t,t,U,r,ne,de,!1,F)}function Ls(e,t,r,f,v){for(var y=[],x=0;x<e.length;x++)for(var P=e[x],F=void 0,U=0;U<P.length-1;U++){var W=P[U],ne=P[U+1];W.x<t&&ne.x<t||(W.x<t?W=new ae(t,W.y+(t-W.x)/(ne.x-W.x)*(ne.y-W.y))._round():ne.x<t&&(ne=new ae(t,W.y+(t-W.x)/(ne.x-W.x)*(ne.y-W.y))._round()),W.y<r&&ne.y<r||(W.y<r?W=new ae(W.x+(r-W.y)/(ne.y-W.y)*(ne.x-W.x),r)._round():ne.y<r&&(ne=new ae(W.x+(r-W.y)/(ne.y-W.y)*(ne.x-W.x),r)._round()),W.x>=f&&ne.x>=f||(W.x>=f?W=new ae(f,W.y+(f-W.x)/(ne.x-W.x)*(ne.y-W.y))._round():ne.x>=f&&(ne=new ae(f,W.y+(f-W.x)/(ne.x-W.x)*(ne.y-W.y))._round()),W.y>=v&&ne.y>=v||(W.y>=v?W=new ae(W.x+(v-W.y)/(ne.y-W.y)*(ne.x-W.x),v)._round():ne.y>=v&&(ne=new ae(W.x+(v-W.y)/(ne.y-W.y)*(ne.x-W.x),v)._round()),F&&W.equals(F[F.length-1])||y.push(F=[W]),F.push(ne)))))}return y}function zs(e,t,r,f){var v=[],y=e.image,x=y.pixelRatio,P=y.paddedRect.w-2,F=y.paddedRect.h-2,U=e.right-e.left,W=e.bottom-e.top,ne=y.stretchX||[[0,P]],de=y.stretchY||[[0,F]],be=function(wa,vi){return wa+vi[1]-vi[0]},He=ne.reduce(be,0),Xe=de.reduce(be,0),_t=P-He,rt=F-Xe,Dt=0,qt=He,mr=0,xr=Xe,Nr=0,ln=_t,wn=0,ei=rt;if(y.content&&f){var jn=y.content;Dt=ws(ne,0,jn[0]),mr=ws(de,0,jn[1]),qt=ws(ne,jn[0],jn[2]),xr=ws(de,jn[1],jn[3]),Nr=jn[0]-Dt,wn=jn[1]-mr,ln=jn[2]-jn[0]-qt,ei=jn[3]-jn[1]-xr}var ci=function(wa,vi,Da,$a){var zo=wi(wa.stretch-Dt,qt,U,e.left),Eo=jo(wa.fixed-Nr,ln,wa.stretch,He),Ro=wi(vi.stretch-mr,xr,W,e.top),$o=jo(vi.fixed-wn,ei,vi.stretch,Xe),Vo=wi(Da.stretch-Dt,qt,U,e.left),Ds=jo(Da.fixed-Nr,ln,Da.stretch,He),hu=wi($a.stretch-mr,xr,W,e.top),Ws=jo($a.fixed-wn,ei,$a.stretch,Xe),Eu=new ae(zo,Ro),vs=new ae(Vo,Ro),Xs=new ae(Vo,hu),Sa=new ae(zo,hu),mo=new ae(Eo/x,$o/x),io=new ae(Ds/x,Ws/x),Ta=t*Math.PI/180;if(Ta){var iu=Math.sin(Ta),pu=Math.cos(Ta),_o=[pu,-iu,iu,pu];Eu._matMult(_o),vs._matMult(_o),Sa._matMult(_o),Xs._matMult(_o)}var ms=wa.stretch+wa.fixed,du=vi.stretch+vi.fixed;return{tl:Eu,tr:vs,bl:Sa,br:Xs,tex:{x:y.paddedRect.x+1+ms,y:y.paddedRect.y+1+du,w:Da.stretch+Da.fixed-ms,h:$a.stretch+$a.fixed-du},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:mo,pixelOffsetBR:io,minFontScaleX:ln/x/U,minFontScaleY:ei/x/W,isSDF:r}};if(f&&(y.stretchX||y.stretchY))for(var $n=Ko(ne,_t,He),oa=Ko(de,rt,Xe),Ri=0;Ri<$n.length-1;Ri++)for(var si=$n[Ri],ua=$n[Ri+1],Wi=0;Wi<oa.length-1;Wi++)v.push(ci(si,oa[Wi],ua,oa[Wi+1]));else v.push(ci({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:F+1}));return v}function ws(e,t,r){for(var f=0,v=0,y=e;v<y.length;v+=1){var x=y[v];f+=Math.max(t,Math.min(r,x[1]))-Math.max(t,Math.min(r,x[0]))}return f}function Ko(e,t,r){for(var f=[{fixed:-1,stretch:0}],v=0,y=e;v<y.length;v+=1){var x=y[v],P=x[0],F=x[1],U=f[f.length-1];f.push({fixed:P-U.stretch,stretch:U.stretch}),f.push({fixed:P-U.stretch,stretch:U.stretch+(F-P)})}return f.push({fixed:t+1,stretch:r}),f}function wi(e,t,r,f){return e/t*r+f}function jo(e,t,r,f){return e-t*r/f}var Oa=function(e,t,r,f,v,y,x,P,F,U){if(this.boxStartIndex=e.length,F){var W=y.top,ne=y.bottom,de=y.collisionPadding;de&&(W-=de[1],ne+=de[3]);var be=ne-W;be>0&&(be=Math.max(10,be),this.circleDiameter=be)}else{var He=y.top*x-P,Xe=y.bottom*x+P,_t=y.left*x-P,rt=y.right*x+P,Dt=y.collisionPadding;if(Dt&&(_t-=Dt[0]*x,He-=Dt[1]*x,rt+=Dt[2]*x,Xe+=Dt[3]*x),U){var qt=new ae(_t,He),mr=new ae(rt,He),xr=new ae(_t,Xe),Nr=new ae(rt,Xe),ln=U*Math.PI/180;qt._rotate(ln),mr._rotate(ln),xr._rotate(ln),Nr._rotate(ln),_t=Math.min(qt.x,mr.x,xr.x,Nr.x),rt=Math.max(qt.x,mr.x,xr.x,Nr.x),He=Math.min(qt.y,mr.y,xr.y,Nr.y),Xe=Math.max(qt.y,mr.y,xr.y,Nr.y)}e.emplaceBack(t.x,t.y,_t,He,rt,Xe,r,f,v)}this.boxEndIndex=e.length},Lo=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=ki),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function ki(e,t){return e<t?-1:e>t?1:0}function fa(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var f=1/0,v=1/0,y=-1/0,x=-1/0,P=e[0],F=0;F<P.length;F++){var U=P[F];(!F||U.x<f)&&(f=U.x),(!F||U.y<v)&&(v=U.y),(!F||U.x>y)&&(y=U.x),(!F||U.y>x)&&(x=U.y)}var W=Math.min(y-f,x-v),ne=W/2,de=new Lo([],no);if(W===0)return new ae(f,v);for(var be=f;be<y;be+=W)for(var He=v;He<x;He+=W)de.push(new So(be+ne,He+ne,ne,e));for(var Xe=function(Dt){for(var qt=0,mr=0,xr=0,Nr=Dt[0],ln=0,wn=Nr.length,ei=wn-1;ln<wn;ei=ln++){var jn=Nr[ln],ci=Nr[ei],$n=jn.x*ci.y-ci.x*jn.y;mr+=(jn.x+ci.x)*$n,xr+=(jn.y+ci.y)*$n,qt+=3*$n}return new So(mr/qt,xr/qt,0,Dt)}(e),_t=de.length;de.length;){var rt=de.pop();(rt.d>Xe.d||!Xe.d)&&(Xe=rt,r&&console.log("found best %d after %d probes",Math.round(1e4*rt.d)/1e4,_t)),rt.max-Xe.d<=t||(de.push(new So(rt.p.x-(ne=rt.h/2),rt.p.y-ne,ne,e)),de.push(new So(rt.p.x+ne,rt.p.y-ne,ne,e)),de.push(new So(rt.p.x-ne,rt.p.y+ne,ne,e)),de.push(new So(rt.p.x+ne,rt.p.y+ne,ne,e)),_t+=4)}return r&&(console.log("num probes: "+_t),console.log("best distance: "+Xe.d)),Xe.p}function no(e,t){return t.max-e.max}function So(e,t,r,f){this.p=new ae(e,t),this.h=r,this.d=function(v,y){for(var x=!1,P=1/0,F=0;F<y.length;F++)for(var U=y[F],W=0,ne=U.length,de=ne-1;W<ne;de=W++){var be=U[W],He=U[de];be.y>v.y!=He.y>v.y&&v.x<(He.x-be.x)*(v.y-be.y)/(He.y-be.y)+be.x&&(x=!x),P=Math.min(P,xa(v,be,He))}return(x?1:-1)*Math.sqrt(P)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}Lo.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},Lo.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},Lo.prototype.peek=function(){return this.data[0]},Lo.prototype._up=function(e){for(var t=this.data,r=this.compare,f=t[e];e>0;){var v=e-1>>1,y=t[v];if(r(f,y)>=0)break;t[e]=y,e=v}t[e]=f},Lo.prototype._down=function(e){for(var t=this.data,r=this.compare,f=this.length>>1,v=t[e];e<f;){var y=1+(e<<1),x=t[y],P=y+1;if(P<this.length&&r(t[P],x)<0&&(y=P,x=t[P]),r(x,v)>=0)break;t[e]=x,e=y}t[e]=v};var dl=Number.POSITIVE_INFINITY;function Ge(e,t){return t[1]!==dl?function(r,f,v){var y=0,x=0;switch(f=Math.abs(f),v=Math.abs(v),r){case"top-right":case"top-left":case"top":x=v-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-v}switch(r){case"top-right":case"bottom-right":case"right":y=-f;break;case"top-left":case"bottom-left":case"left":y=f}return[y,x]}(e,t[0],t[1]):function(r,f){var v=0,y=0;f<0&&(f=0);var x=f/Math.sqrt(2);switch(r){case"top-right":case"top-left":y=x-7;break;case"bottom-right":case"bottom-left":y=7-x;break;case"bottom":y=7-f;break;case"top":y=f-7}switch(r){case"top-right":case"bottom-right":v=-x;break;case"top-left":case"bottom-left":v=x;break;case"left":v=f;break;case"right":v=-f}return[v,y]}(e,t[0])}function sr(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function rr(e,t,r,f,v,y,x,P,F,U,W,ne,de,be,He){var Xe=function(mr,xr,Nr,ln,wn,ei,jn,ci){for(var $n=ln.layout.get("text-rotate").evaluate(ei,{})*Math.PI/180,oa=[],Ri=0,si=xr.positionedLines;Ri<si.length;Ri+=1)for(var ua=si[Ri],Wi=0,wa=ua.positionedGlyphs;Wi<wa.length;Wi+=1){var vi=wa[Wi];if(vi.rect){var Da=vi.rect||{},$a=4,zo=!0,Eo=1,Ro=0,$o=(wn||ci)&&vi.vertical,Vo=vi.metrics.advance*vi.scale/2;if(ci&&xr.verticalizable&&(Ro=ua.lineOffset/2-(vi.imageName?-(24-vi.metrics.width*vi.scale)/2:24*(vi.scale-1))),vi.imageName){var Ds=jn[vi.imageName];zo=Ds.sdf,$a=1/(Eo=Ds.pixelRatio)}var hu=wn?[vi.x+Vo,vi.y]:[0,0],Ws=wn?[0,0]:[vi.x+Vo+Nr[0],vi.y+Nr[1]-Ro],Eu=[0,0];$o&&(Eu=Ws,Ws=[0,0]);var vs=(vi.metrics.left-$a)*vi.scale-Vo+Ws[0],Xs=(-vi.metrics.top-$a)*vi.scale+Ws[1],Sa=vs+Da.w*vi.scale/Eo,mo=Xs+Da.h*vi.scale/Eo,io=new ae(vs,Xs),Ta=new ae(Sa,Xs),iu=new ae(vs,mo),pu=new ae(Sa,mo);if($o){var _o=new ae(-Vo,Vo- -17),ms=-Math.PI/2,du=12-Vo,ka=new ae(22-du,-(vi.imageName?du:0)),Mc=new(Function.prototype.bind.apply(ae,[null].concat(Eu)));io._rotateAround(ms,_o)._add(ka)._add(Mc),Ta._rotateAround(ms,_o)._add(ka)._add(Mc),iu._rotateAround(ms,_o)._add(ka)._add(Mc),pu._rotateAround(ms,_o)._add(ka)._add(Mc)}if($n){var Dl=Math.sin($n),fc=Math.cos($n),ns=[fc,-Dl,Dl,fc];io._matMult(ns),Ta._matMult(ns),iu._matMult(ns),pu._matMult(ns)}var jc=new ae(0,0),$u=new ae(0,0);oa.push({tl:io,tr:Ta,bl:iu,br:pu,tex:Da,writingMode:xr.writingMode,glyphOffset:hu,sectionIndex:vi.sectionIndex,isSDF:zo,pixelOffsetTL:jc,pixelOffsetBR:$u,minFontScaleX:0,minFontScaleY:0})}}return oa}(0,r,P,v,y,x,f,e.allowVerticalPlacement),_t=e.textSizeData,rt=null;_t.kind==="source"?(rt=[128*v.layout.get("text-size").evaluate(x,{})])[0]>32640&&De(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):_t.kind==="composite"&&((rt=[128*be.compositeTextSizes[0].evaluate(x,{},He),128*be.compositeTextSizes[1].evaluate(x,{},He)])[0]>32640||rt[1]>32640)&&De(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,Xe,rt,P,y,x,U,t,F.lineStartIndex,F.lineLength,de,He);for(var Dt=0,qt=W;Dt<qt.length;Dt+=1)ne[qt[Dt]]=e.text.placedSymbolArray.length-1;return 4*Xe.length}function Xn(e){for(var t in e)return e[t];return null}function ha(e,t,r,f){var v=e.compareText;if(t in v){for(var y=v[t],x=y.length-1;x>=0;x--)if(f.dist(y[x])<r)return!0}else v[t]=[];return v[t].push(f),!1}var Fe=Pc.VectorTileFeature.types,xe=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tt(e,t,r,f,v,y,x,P,F,U,W,ne,de){var be=P?Math.min(32640,Math.round(P[0])):0,He=P?Math.min(32640,Math.round(P[1])):0;e.emplaceBack(t,r,Math.round(32*f),Math.round(32*v),y,x,(be<<1)+(F?1:0),He,16*U,16*W,256*ne,256*de)}function Ut(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function fr(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(Ml(r[t].text))return!0;return!1}var gt=function(e){this.layoutVertexArray=new Vu,this.indexArray=new xu,this.programConfigurations=e,this.segments=new we,this.dynamicLayoutVertexArray=new sl,this.opacityVertexArray=new Ll,this.placedSymbolArray=new h};gt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},gt.prototype.upload=function(e,t,r,f){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,yp.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,xe,!0),this.opacityVertexBuffer.itemSize=1),(r||f)&&this.programConfigurations.upload(e))},gt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Vn("SymbolBuffers",gt);var mt=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new we,this.collisionVertexArray=new ll};mt.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Zh.members,!0)},mt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Vn("CollisionBuffers",mt);var ot=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(y){return y.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ia([]),this.placementViewportMatrix=Ia([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ti(this.zoom,t["text-size"]),this.iconSizeData=Ti(this.zoom,t["icon-size"]);var r=this.layers[0].layout,f=r.get("symbol-sort-key"),v=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(y){return Dr[y]})),this.stateDependentLayerIds=this.layers.filter(function(y){return y.isStateDependent()}).map(function(y){return y.id}),this.sourceID=e.sourceID};ot.prototype.createArrays=function(){this.text=new gt(new Q(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new gt(new Q(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new T,this.lineVertexArray=new R,this.symbolInstances=new S},ot.prototype.calculateGlyphDependencies=function(e,t,r,f,v){for(var y=0;y<e.length;y++)if(t[e.charCodeAt(y)]=!0,(r||f)&&v){var x=Ef[e.charAt(y)];x&&(t[x.charCodeAt(0)]=!0)}},ot.prototype.populate=function(e,t,r){var f=this.layers[0],v=f.layout,y=v.get("text-font"),x=v.get("text-field"),P=v.get("icon-image"),F=(x.value.kind!=="constant"||x.value.value instanceof za&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),U=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,W=v.get("symbol-sort-key");if(this.features=[],F||U){for(var ne=t.iconDependencies,de=t.glyphDependencies,be=t.availableImages,He=new ea(this.zoom),Xe=0,_t=e;Xe<_t.length;Xe+=1){var rt=_t[Xe],Dt=rt.feature,qt=rt.id,mr=rt.index,xr=rt.sourceLayerIndex,Nr=f._featureFilter.needGeometry,ln=Rt(Dt,Nr);if(f._featureFilter.filter(He,ln,r)){Nr||(ln.geometry=ft(Dt));var wn=void 0;if(F){var ei=f.getValueAndResolveTokens("text-field",ln,r,be),jn=za.factory(ei);fr(jn)&&(this.hasRTLText=!0),(!this.hasRTLText||Bo()==="unavailable"||this.hasRTLText&&Mo.isParsed())&&(wn=_p(jn,f,ln))}var ci=void 0;if(U){var $n=f.getValueAndResolveTokens("icon-image",ln,r,be);ci=$n instanceof qi?$n:qi.fromString($n)}if(wn||ci){var oa=this.sortFeaturesByKey?W.evaluate(ln,{},r):void 0;if(this.features.push({id:qt,text:wn,icon:ci,index:mr,sourceLayerIndex:xr,geometry:ln.geometry,properties:Dt.properties,type:Fe[Dt.type],sortKey:oa}),ci&&(ne[ci.name]=!0),wn){var Ri=y.evaluate(ln,{},r).join(","),si=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Dr.vertical)>=0;for(var ua=0,Wi=wn.sections;ua<Wi.length;ua+=1){var wa=Wi[ua];if(wa.image)ne[wa.image.name]=!0;else{var vi=Pu(wn.toString()),Da=wa.fontStack||Ri,$a=de[Da]=de[Da]||{};this.calculateGlyphDependencies(wa.text,$a,si,this.allowVerticalPlacement,vi)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function(zo){var Eo={},Ro={},$o=[],Vo=0;function Ds(_o){$o.push(zo[_o]),Vo++}function hu(_o,ms,du){var ka=Ro[_o];return delete Ro[_o],Ro[ms]=ka,$o[ka].geometry[0].pop(),$o[ka].geometry[0]=$o[ka].geometry[0].concat(du[0]),ka}function Ws(_o,ms,du){var ka=Eo[ms];return delete Eo[ms],Eo[_o]=ka,$o[ka].geometry[0].shift(),$o[ka].geometry[0]=du[0].concat($o[ka].geometry[0]),ka}function Eu(_o,ms,du){var ka=du?ms[0][ms[0].length-1]:ms[0][0];return _o+":"+ka.x+":"+ka.y}for(var vs=0;vs<zo.length;vs++){var Xs=zo[vs],Sa=Xs.geometry,mo=Xs.text?Xs.text.toString():null;if(mo){var io=Eu(mo,Sa),Ta=Eu(mo,Sa,!0);if(io in Ro&&Ta in Eo&&Ro[io]!==Eo[Ta]){var iu=Ws(io,Ta,Sa),pu=hu(io,Ta,$o[iu].geometry);delete Eo[io],delete Ro[Ta],Ro[Eu(mo,$o[pu].geometry,!0)]=pu,$o[iu].geometry=null}else io in Ro?hu(io,Ta,Sa):Ta in Eo?Ws(io,Ta,Sa):(Ds(vs),Eo[io]=Vo-1,Ro[Ta]=Vo-1)}else Ds(vs)}return $o.filter(function(_o){return _o.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(zo,Eo){return zo.sortKey-Eo.sortKey})}},ot.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},ot.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},ot.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},ot.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},ot.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},ot.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},ot.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var f=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),y={},x=e.segment+1;x<t.length;x++)y[x]={x:t[x].x,y:t[x].y,tileUnitDistanceFromAnchor:f},x<t.length-1&&(f+=t[x+1].dist(t[x]));for(var P=e.segment||0;P>=0;P--)y[P]={x:t[P].x,y:t[P].y,tileUnitDistanceFromAnchor:v},P>0&&(v+=t[P-1].dist(t[P]));for(var F=0;F<t.length;F++){var U=y[F];this.lineVertexArray.emplaceBack(U.x,U.y,U.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},ot.prototype.addSymbols=function(e,t,r,f,v,y,x,P,F,U,W,ne){for(var de=e.indexArray,be=e.layoutVertexArray,He=e.segments.prepareSegment(4*t.length,be,de,this.canOverlap?y.sortKey:void 0),Xe=this.glyphOffsetArray.length,_t=He.vertexLength,rt=this.allowVerticalPlacement&&x===Dr.vertical?Math.PI/2:0,Dt=y.text&&y.text.sections,qt=0;qt<t.length;qt++){var mr=t[qt],xr=mr.tl,Nr=mr.tr,ln=mr.bl,wn=mr.br,ei=mr.tex,jn=mr.pixelOffsetTL,ci=mr.pixelOffsetBR,$n=mr.minFontScaleX,oa=mr.minFontScaleY,Ri=mr.glyphOffset,si=mr.isSDF,ua=mr.sectionIndex,Wi=He.vertexLength,wa=Ri[1];tt(be,P.x,P.y,xr.x,wa+xr.y,ei.x,ei.y,r,si,jn.x,jn.y,$n,oa),tt(be,P.x,P.y,Nr.x,wa+Nr.y,ei.x+ei.w,ei.y,r,si,ci.x,jn.y,$n,oa),tt(be,P.x,P.y,ln.x,wa+ln.y,ei.x,ei.y+ei.h,r,si,jn.x,ci.y,$n,oa),tt(be,P.x,P.y,wn.x,wa+wn.y,ei.x+ei.w,ei.y+ei.h,r,si,ci.x,ci.y,$n,oa),Ut(e.dynamicLayoutVertexArray,P,rt),de.emplaceBack(Wi,Wi+1,Wi+2),de.emplaceBack(Wi+1,Wi+2,Wi+3),He.vertexLength+=4,He.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ri[0]),qt!==t.length-1&&ua===t[qt+1].sectionIndex||e.programConfigurations.populatePaintArrays(be.length,y,y.index,{},ne,Dt&&Dt[ua])}e.placedSymbolArray.emplaceBack(P.x,P.y,Xe,this.glyphOffsetArray.length-Xe,_t,F,U,P.segment,r?r[0]:0,r?r[1]:0,f[0],f[1],x,0,!1,0,W)},ot.prototype._addCollisionDebugVertex=function(e,t,r,f,v,y){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,f,v,Math.round(y.x),Math.round(y.y))},ot.prototype.addCollisionDebugVertices=function(e,t,r,f,v,y,x){var P=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),F=P.vertexLength,U=v.layoutVertexArray,W=v.collisionVertexArray,ne=x.anchorX,de=x.anchorY;this._addCollisionDebugVertex(U,W,y,ne,de,new ae(e,t)),this._addCollisionDebugVertex(U,W,y,ne,de,new ae(r,t)),this._addCollisionDebugVertex(U,W,y,ne,de,new ae(r,f)),this._addCollisionDebugVertex(U,W,y,ne,de,new ae(e,f)),P.vertexLength+=4;var be=v.indexArray;be.emplaceBack(F,F+1),be.emplaceBack(F+1,F+2),be.emplaceBack(F+2,F+3),be.emplaceBack(F+3,F),P.primitiveLength+=4},ot.prototype.addDebugCollisionBoxes=function(e,t,r,f){for(var v=e;v<t;v++){var y=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,f?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,r)}},ot.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new mt(ul,Uh.members,ic),this.iconCollisionBox=new mt(ul,Uh.members,ic);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},ot.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,f,v,y,x,P,F){for(var U={},W=t;W<r;W++){var ne=e.get(W);U.textBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},U.textFeatureIndex=ne.featureIndex;break}for(var de=f;de<v;de++){var be=e.get(de);U.verticalTextBox={x1:be.x1,y1:be.y1,x2:be.x2,y2:be.y2,anchorPointX:be.anchorPointX,anchorPointY:be.anchorPointY},U.verticalTextFeatureIndex=be.featureIndex;break}for(var He=y;He<x;He++){var Xe=e.get(He);U.iconBox={x1:Xe.x1,y1:Xe.y1,x2:Xe.x2,y2:Xe.y2,anchorPointX:Xe.anchorPointX,anchorPointY:Xe.anchorPointY},U.iconFeatureIndex=Xe.featureIndex;break}for(var _t=P;_t<F;_t++){var rt=e.get(_t);U.verticalIconBox={x1:rt.x1,y1:rt.y1,x2:rt.x2,y2:rt.y2,anchorPointX:rt.anchorPointX,anchorPointY:rt.anchorPointY},U.verticalIconFeatureIndex=rt.featureIndex;break}return U},ot.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},ot.prototype.hasTextData=function(){return this.text.segments.get().length>0},ot.prototype.hasIconData=function(){return this.icon.segments.get().length>0},ot.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},ot.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},ot.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},ot.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),f=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<f;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},ot.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),f=[],v=[],y=[],x=0;x<this.symbolInstances.length;++x){y.push(x);var P=this.symbolInstances.get(x);f.push(0|Math.round(t*P.anchorX+r*P.anchorY)),v.push(P.featureIndex)}return y.sort(function(F,U){return f[F]-f[U]||v[U]-v[F]}),y},ot.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},ot.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,f=this.symbolInstanceIndexes;r<f.length;r+=1){var v=this.symbolInstances.get(f[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(y,x,P){y>=0&&P.indexOf(y)===x&&t.addIndicesForPlacedSymbol(t.text,y)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Vn("SymbolBucket",ot,{omit:["layers","collisionBoxArray","features","compareText"]}),ot.MAX_GLYPHS=65535,ot.addDynamicAttributes=Ut;var Re=new Io({"symbol-placement":new Gn(oe.layout_symbol["symbol-placement"]),"symbol-spacing":new Gn(oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Gn(oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wn(oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Gn(oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Gn(oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Gn(oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Gn(oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Gn(oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wn(oe.layout_symbol["icon-size"]),"icon-text-fit":new Gn(oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gn(oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wn(oe.layout_symbol["icon-image"]),"icon-rotate":new Wn(oe.layout_symbol["icon-rotate"]),"icon-padding":new Gn(oe.layout_symbol["icon-padding"]),"icon-keep-upright":new Gn(oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Wn(oe.layout_symbol["icon-offset"]),"icon-anchor":new Wn(oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Gn(oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Gn(oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Gn(oe.layout_symbol["text-rotation-alignment"]),"text-field":new Wn(oe.layout_symbol["text-field"]),"text-font":new Wn(oe.layout_symbol["text-font"]),"text-size":new Wn(oe.layout_symbol["text-size"]),"text-max-width":new Wn(oe.layout_symbol["text-max-width"]),"text-line-height":new Gn(oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Wn(oe.layout_symbol["text-letter-spacing"]),"text-justify":new Wn(oe.layout_symbol["text-justify"]),"text-radial-offset":new Wn(oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Gn(oe.layout_symbol["text-variable-anchor"]),"text-anchor":new Wn(oe.layout_symbol["text-anchor"]),"text-max-angle":new Gn(oe.layout_symbol["text-max-angle"]),"text-writing-mode":new Gn(oe.layout_symbol["text-writing-mode"]),"text-rotate":new Wn(oe.layout_symbol["text-rotate"]),"text-padding":new Gn(oe.layout_symbol["text-padding"]),"text-keep-upright":new Gn(oe.layout_symbol["text-keep-upright"]),"text-transform":new Wn(oe.layout_symbol["text-transform"]),"text-offset":new Wn(oe.layout_symbol["text-offset"]),"text-allow-overlap":new Gn(oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Gn(oe.layout_symbol["text-ignore-placement"]),"text-optional":new Gn(oe.layout_symbol["text-optional"])}),st={paint:new Io({"icon-opacity":new Wn(oe.paint_symbol["icon-opacity"]),"icon-color":new Wn(oe.paint_symbol["icon-color"]),"icon-halo-color":new Wn(oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wn(oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wn(oe.paint_symbol["icon-halo-blur"]),"icon-translate":new Gn(oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Gn(oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Wn(oe.paint_symbol["text-opacity"]),"text-color":new Wn(oe.paint_symbol["text-color"],{runtimeType:xn,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Wn(oe.paint_symbol["text-halo-color"]),"text-halo-width":new Wn(oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Wn(oe.paint_symbol["text-halo-blur"]),"text-translate":new Gn(oe.paint_symbol["text-translate"]),"text-translate-anchor":new Gn(oe.paint_symbol["text-translate-anchor"])}),layout:Re},ze=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Fn,this.defaultValue=e};ze.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},ze.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},ze.prototype.outputDefined=function(){return!1},ze.prototype.serialize=function(){return null},Vn("FormatSectionOverride",ze,{omit:["defaultValue"]});var Vt=function(e){function t(r){e.call(this,r,st)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){if(e.prototype.recalculate.call(this,r,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var y=[],x=0,P=v;x<P.length;x+=1){var F=P[x];y.indexOf(F)<0&&y.push(F)}this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,f,v,y){var x=this.layout.get(r).evaluate(f,{},v,y),P=this._unevaluatedLayout._values[r];return P.isDataDriven()||tl(P.value)||!x?x:function(F,U){return U.replace(/{([^{}]+)}/g,function(W,ne){return ne in F?String(F[ne]):""})}(f.properties,x)},t.prototype.createBucket=function(r){return new ot(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,f=st.paint.overridableProperties;r<f.length;r+=1){var v=f[r];if(t.hasPaintOverride(this.layout,v)){var y,x=this.paint.get(v),P=new ze(x),F=new Au(P,x.property.specification);y=x.value.kind==="constant"||x.value.kind==="source"?new Cl("source",F):new rl("composite",F,x.value.zoomStops,x.value._interpolationType),this.paint._values[v]=new co(x.property,y,x.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,f){var v=r.get("text-field"),y=st.paint.properties[f],x=!1,P=function(W){for(var ne=0,de=W;ne<de.length;ne+=1)if(y.overrides&&y.overrides.hasOverride(de[ne]))return void(x=!0)};if(v.value.kind==="constant"&&v.value.value instanceof za)P(v.value.value.sections);else if(v.value.kind==="source"){var F=function(W){x||(W instanceof Qi&&Ji(W.value)===ra?P(W.value.sections):W instanceof Do?P(W.sections):W.eachChild(F))},U=v.value;U._styleExpression&&F(U._styleExpression.expression)}return x},t}(ru),Qt={paint:new Io({"background-color":new Gn(oe.paint_background["background-color"]),"background-pattern":new ls(oe.paint_background["background-pattern"]),"background-opacity":new Gn(oe.paint_background["background-opacity"])})},Ur=function(e){function t(r){e.call(this,r,Qt)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ru),_n={paint:new Io({"raster-opacity":new Gn(oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Gn(oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Gn(oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Gn(oe.paint_raster["raster-brightness-max"]),"raster-saturation":new Gn(oe.paint_raster["raster-saturation"]),"raster-contrast":new Gn(oe.paint_raster["raster-contrast"]),"raster-resampling":new Gn(oe.paint_raster["raster-resampling"]),"raster-fade-duration":new Gn(oe.paint_raster["raster-fade-duration"])})},on=function(e){function t(r){e.call(this,r,_n)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ru),Rn=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(ru),mn={circle:Es,heatmap:vf,hillshade:lh,fill:xf,"fill-extrusion":mh,line:vp,symbol:Vt,background:Ur,raster:on},ai=K.HTMLImageElement,Un=K.HTMLCanvasElement,Yn=K.HTMLVideoElement,Qn=K.ImageData,qn=K.ImageBitmap,yi=function(e,t,r,f){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,f)};yi.prototype.update=function(e,t,r){var f=e.width,v=e.height,y=!(this.size&&this.size[0]===f&&this.size[1]===v||r),x=this.context,P=x.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!t||t.premultiply!==!1)),y)this.size=[f,v],e instanceof ai||e instanceof Un||e instanceof Yn||e instanceof Qn||qn&&e instanceof qn?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,e):P.texImage2D(P.TEXTURE_2D,0,this.format,f,v,0,this.format,P.UNSIGNED_BYTE,e.data);else{var F=r||{x:0,y:0},U=F.x,W=F.y;e instanceof ai||e instanceof Un||e instanceof Yn||e instanceof Qn||qn&&e instanceof qn?P.texSubImage2D(P.TEXTURE_2D,0,U,W,P.RGBA,P.UNSIGNED_BYTE,e):P.texSubImage2D(P.TEXTURE_2D,0,U,W,f,v,P.RGBA,P.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)},yi.prototype.bind=function(e,t,r){var f=this.context.gl;f.bindTexture(f.TEXTURE_2D,this.texture),r!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t),this.wrap=t)},yi.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},yi.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Za=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};Za.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},Za.prototype.remove=function(){delete this._channel,this._callback=function(){}};var No=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},er(["receive","process"],this),this.invoker=new Za(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=tr()?e:K};function Yl(e,t,r){var f=2*Math.PI*6378137/256/Math.pow(2,r);return[e*f-2*Math.PI*6378137/2,t*f-2*Math.PI*6378137/2]}No.prototype.send=function(e,t,r,f,v){var y=this;v===void 0&&(v=!1);var x=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[x]=r);var P=Me(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:e,hasCallback:!!r,targetMapId:f,mustQueue:v,sourceMapId:this.mapId,data:eo(t,P)},P),{cancel:function(){r&&delete y.callbacks[x],y.target.postMessage({id:x,type:"<cancel>",targetMapId:f,sourceMapId:y.mapId})}}},No.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var f=this.cancelCallbacks[r];delete this.cancelCallbacks[r],f&&f()}else tr()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},No.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},No.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var f=this.callbacks[e];delete this.callbacks[e],f&&(t.error?f(Ms(t.error)):f(null,Ms(t.data)))}else{var v=!1,y=Me(this.globalScope)?void 0:[],x=t.hasCallback?function(W,ne){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:W?eo(W):null,data:eo(ne,y)},y)}:function(W){v=!0},P=null,F=Ms(t.data);if(this.parent[t.type])P=this.parent[t.type](t.sourceMapId,F,x);else if(this.parent.getWorkerSource){var U=t.type.split(".");P=this.parent.getWorkerSource(t.sourceMapId,U[0],F.source)[U[1]](F,x)}else x(new Error("Could not find function "+t.type));!v&&P&&P.cancel&&(this.cancelCallbacks[e]=P.cancel)}},No.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ha=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};Ha.prototype.setNorthEast=function(e){return this._ne=e instanceof ba?new ba(e.lng,e.lat):ba.convert(e),this},Ha.prototype.setSouthWest=function(e){return this._sw=e instanceof ba?new ba(e.lng,e.lat):ba.convert(e),this},Ha.prototype.extend=function(e){var t,r,f=this._sw,v=this._ne;if(e instanceof ba)t=e,r=e;else{if(!(e instanceof Ha))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ha.convert(e)):this.extend(ba.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return f||v?(f.lng=Math.min(t.lng,f.lng),f.lat=Math.min(t.lat,f.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new ba(t.lng,t.lat),this._ne=new ba(r.lng,r.lat)),this},Ha.prototype.getCenter=function(){return new ba((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ha.prototype.getSouthWest=function(){return this._sw},Ha.prototype.getNorthEast=function(){return this._ne},Ha.prototype.getNorthWest=function(){return new ba(this.getWest(),this.getNorth())},Ha.prototype.getSouthEast=function(){return new ba(this.getEast(),this.getSouth())},Ha.prototype.getWest=function(){return this._sw.lng},Ha.prototype.getSouth=function(){return this._sw.lat},Ha.prototype.getEast=function(){return this._ne.lng},Ha.prototype.getNorth=function(){return this._ne.lat},Ha.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ha.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ha.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ha.prototype.contains=function(e){var t=ba.convert(e),r=t.lng,f=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&v},Ha.convert=function(e){return!e||e instanceof Ha?e:new Ha(e)};var ba=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ba.prototype.wrap=function(){return new ba(Jt(this.lng,-180,180),this.lat)},ba.prototype.toArray=function(){return[this.lng,this.lat]},ba.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ba.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,f=e.lat*t,v=Math.sin(r)*Math.sin(f)+Math.cos(r)*Math.cos(f)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},ba.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new Ha(new ba(this.lng-r,this.lat-t),new ba(this.lng+r,this.lat+t))},ba.convert=function(e){if(e instanceof ba)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ba(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ba(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var nu=2*Math.PI*63710088e-1;function Rl(e){return nu*Math.cos(e*Math.PI/180)}function Yu(e){return(180+e)/360}function bh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Ku(e,t){return e/Rl(t)}function Gf(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var uf=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};uf.fromLngLat=function(e,t){t===void 0&&(t=0);var r=ba.convert(e);return new uf(Yu(r.lng),bh(r.lat),Ku(t,r.lat))},uf.prototype.toLngLat=function(){return new ba(360*this.x-180,Gf(this.y))},uf.prototype.toAltitude=function(){return this.z*Rl(Gf(this.y))},uf.prototype.meterInMercatorCoordinateUnits=function(){return 1/nu*(e=Gf(this.y),1/Math.cos(e*Math.PI/180));var e};var lf=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=Hf(0,e,e,t,r)};lf.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},lf.prototype.url=function(e,t){var r,f,v,y,x,P=(f=this.y,v=this.z,y=Yl(256*(r=this.x),256*(f=Math.pow(2,v)-f-1),v),x=Yl(256*(r+1),256*(f+1),v),y[0]+","+y[1]+","+x[0]+","+x[1]),F=function(U,W,ne){for(var de,be="",He=U;He>0;He--)be+=(W&(de=1<<He-1)?1:0)+(ne&de?2:0);return be}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",F).replace("{bbox-epsg-3857}",P)},lf.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new ae(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},lf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var xp=function(e,t){this.wrap=e,this.canonical=t,this.key=Hf(e,t.z,t.z,t.x,t.y)},ds=function(e,t,r,f,v){this.overscaledZ=e,this.wrap=t,this.canonical=new lf(r,+f,+v),this.key=Hf(t,e,r,f,v)};function Hf(e,t,r,f,v){(e*=2)<0&&(e=-1*e-1);var y=1<<r;return(y*y*e+y*v+f).toString(36)+r.toString(36)+t.toString(36)}ds.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},ds.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new ds(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ds(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},ds.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?Hf(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):Hf(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},ds.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},ds.prototype.children=function(e){if(this.overscaledZ>=e)return[new ds(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,f=2*this.canonical.y;return[new ds(t,this.wrap,t,r,f),new ds(t,this.wrap,t,r+1,f),new ds(t,this.wrap,t,r,f+1),new ds(t,this.wrap,t,r+1,f+1)]},ds.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},ds.prototype.wrapped=function(){return new ds(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ds.prototype.unwrapTo=function(e){return new ds(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},ds.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ds.prototype.toUnwrapped=function(){return new xp(this.wrap,this.canonical)},ds.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ds.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new uf(e.x-this.wrap,e.y))},Vn("CanonicalTileID",lf),Vn("OverscaledTileID",ds,{omit:["posMatrix"]});var zc=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return De('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var f=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var v=0;v<f;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(f,v)]=this.data[this._idx(f-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,f)]=this.data[this._idx(v,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)]};zc.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),f=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[f],r[f+1],r[f+2])},zc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},zc.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},zc.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},zc.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},zc.prototype.getPixels=function(){return new fs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},zc.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var f=t*this.dim,v=t*this.dim+this.dim,y=r*this.dim,x=r*this.dim+this.dim;switch(t){case-1:f=v-1;break;case 1:v=f+1}switch(r){case-1:y=x-1;break;case 1:x=y+1}for(var P=-t*this.dim,F=-r*this.dim,U=y;U<x;U++)for(var W=f;W<v;W++)this.data[this._idx(W,U)]=e.data[this._idx(W+P,U+F)]},Vn("DEMData",zc);var wf=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};wf.prototype.encode=function(e){return this._stringToNumber[e]},wf.prototype.decode=function(e){return this._numberToString[e]};var Wf=function(e,t,r,f,v){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=f,this.properties=e.properties,this.id=v},Hh={geometry:{configurable:!0}};Hh.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Hh.geometry.set=function(e){this._geometry=e},Wf.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(Wf.prototype,Hh);var Xf=function(){this.state={},this.stateChanges={},this.deletedStates={}};Xf.prototype.updateState=function(e,t,r){var f=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},Ft(this.stateChanges[e][f],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==f&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][f]===null)for(var y in this.deletedStates[e][f]={},this.state[e][f])r[y]||(this.deletedStates[e][f][y]=null);else for(var x in r)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][x]===null&&delete this.deletedStates[e][f][x]},Xf.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var f=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(r in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][r]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}},Xf.prototype.getState=function(e,t){var r=String(t),f=Ft({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var y in v)delete f[y]}return f},Xf.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},Xf.prototype.coalesceChanges=function(e,t){var r={};for(var f in this.stateChanges){this.state[f]=this.state[f]||{};var v={};for(var y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),Ft(this.state[f][y],this.stateChanges[f][y]),v[y]=this.state[f][y];r[f]=v}for(var x in this.deletedStates){this.state[x]=this.state[x]||{};var P={};if(this.deletedStates[x]===null)for(var F in this.state[x])P[F]={},this.state[x][F]={};else for(var U in this.deletedStates[x]){if(this.deletedStates[x][U]===null)this.state[x][U]={};else for(var W=0,ne=Object.keys(this.deletedStates[x][U]);W<ne.length;W+=1)delete this.state[x][U][ne[W]];P[U]=this.state[x][U]}r[x]=r[x]||{},Ft(r[x],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var de in e)e[de].setFeatureState(r,t)};var Zc=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new yu(8192,16,0),this.grid3D=new yu(8192,16,0),this.featureIndexArray=new se,this.promoteId=t};function Gp(e,t,r,f,v){return Bt(e,function(y,x){var P=t instanceof Il?t.get(x):null;return P&&P.evaluate?P.evaluate(r,f,v):P})}function Hp(e){for(var t=1/0,r=1/0,f=-1/0,v=-1/0,y=0,x=e;y<x.length;y+=1){var P=x[y];t=Math.min(t,P.x),r=Math.min(r,P.y),f=Math.max(f,P.x),v=Math.max(v,P.y)}return{minX:t,minY:r,maxX:f,maxY:v}}function Wh(e,t){return t-e}Zc.prototype.insert=function(e,t,r,f,v,y){var x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,f,v);for(var P=y?this.grid3D:this.grid,F=0;F<t.length;F++){for(var U=t[F],W=[1/0,1/0,-1/0,-1/0],ne=0;ne<U.length;ne++){var de=U[ne];W[0]=Math.min(W[0],de.x),W[1]=Math.min(W[1],de.y),W[2]=Math.max(W[2],de.x),W[3]=Math.max(W[3],de.y)}W[0]<8192&&W[1]<8192&&W[2]>=0&&W[3]>=0&&P.insert(x,W[0],W[1],W[2],W[3])}},Zc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Pc.VectorTile(new Cf(this.rawTileData)).layers,this.sourceLayerCoder=new wf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Zc.prototype.query=function(e,t,r,f){var v=this;this.loadVTLayers();for(var y=e.params||{},x=8192/e.tileSize/e.scale,P=Bl(y.filter),F=e.queryGeometry,U=e.queryPadding*x,W=Hp(F),ne=this.grid.query(W.minX-U,W.minY-U,W.maxX+U,W.maxY+U),de=Hp(e.cameraQueryGeometry),be=this.grid3D.query(de.minX-U,de.minY-U,de.maxX+U,de.maxY+U,function(mr,xr,Nr,ln){return function(wn,ei,jn,ci,$n){for(var oa=0,Ri=wn;oa<Ri.length;oa+=1){var si=Ri[oa];if(ei<=si.x&&jn<=si.y&&ci>=si.x&&$n>=si.y)return!0}var ua=[new ae(ei,jn),new ae(ei,$n),new ae(ci,$n),new ae(ci,jn)];if(wn.length>2){for(var Wi=0,wa=ua;Wi<wa.length;Wi+=1)if(Va(wn,wa[Wi]))return!0}for(var vi=0;vi<wn.length-1;vi++)if(Ga(wn[vi],wn[vi+1],ua))return!0;return!1}(e.cameraQueryGeometry,mr-U,xr-U,Nr+U,ln+U)}),He=0,Xe=be;He<Xe.length;He+=1)ne.push(Xe[He]);ne.sort(Wh);for(var _t,rt={},Dt=function(mr){var xr=ne[mr];if(xr!==_t){_t=xr;var Nr=v.featureIndexArray.get(xr),ln=null;v.loadMatchingFeature(rt,Nr.bucketIndex,Nr.sourceLayerIndex,Nr.featureIndex,P,y.layers,y.availableImages,t,r,f,function(wn,ei,jn){return ln||(ln=ft(wn)),ei.queryIntersectsFeature(F,wn,jn,ln,v.z,e.transform,x,e.pixelPosMatrix)})}},qt=0;qt<ne.length;qt++)Dt(qt);return rt},Zc.prototype.loadMatchingFeature=function(e,t,r,f,v,y,x,P,F,U,W){var ne=this.bucketLayerIDs[t];if(!y||function(wn,ei){for(var jn=0;jn<wn.length;jn++)if(ei.indexOf(wn[jn])>=0)return!0;return!1}(y,ne)){var de=this.sourceLayerCoder.decode(r),be=this.vtLayers[de].feature(f);if(v.needGeometry){var He=Rt(be,!0);if(!v.filter(new ea(this.tileID.overscaledZ),He,this.tileID.canonical))return}else if(!v.filter(new ea(this.tileID.overscaledZ),be))return;for(var Xe=this.getId(be,de),_t=0;_t<ne.length;_t++){var rt=ne[_t];if(!(y&&y.indexOf(rt)<0)){var Dt=P[rt];if(Dt){var qt={};Xe!==void 0&&U&&(qt=U.getState(Dt.sourceLayer||"_geojsonTileLayer",Xe));var mr=Ft({},F[rt]);mr.paint=Gp(mr.paint,Dt.paint,be,qt,x),mr.layout=Gp(mr.layout,Dt.layout,be,qt,x);var xr=!W||W(be,Dt,qt);if(xr){var Nr=new Wf(be,this.z,this.x,this.y,Xe);Nr.layer=mr;var ln=e[rt];ln===void 0&&(ln=e[rt]=[]),ln.push({featureIndex:f,feature:Nr,intersectionZ:xr})}}}}}},Zc.prototype.lookupSymbolFeatures=function(e,t,r,f,v,y,x,P){var F={};this.loadVTLayers();for(var U=Bl(v),W=0,ne=e;W<ne.length;W+=1)this.loadMatchingFeature(F,r,f,ne[W],U,y,x,P,t);return F},Zc.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var f=0,v=r[t];f<v.length;f+=1)if(e===v[f])return!0;return!1},Zc.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},Vn("FeatureIndex",Zc,{omit:["rawTileData","sourceLayerCoder"]});var Rs=function(e,t){this.tileID=e,this.uid=At(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Rs.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<fi.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},Rs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Rs.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var f in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(U,W){var ne={};if(!W)return ne;for(var de=function(){var Xe=He[be],_t=Xe.layerIds.map(function(qt){return W.getLayer(qt)}).filter(Boolean);if(_t.length!==0){Xe.layers=_t,Xe.stateDependentLayerIds&&(Xe.stateDependentLayers=Xe.stateDependentLayerIds.map(function(qt){return _t.filter(function(mr){return mr.id===qt})[0]}));for(var rt=0,Dt=_t;rt<Dt.length;rt+=1)ne[Dt[rt].id]=Xe}},be=0,He=U;be<He.length;be+=1)de();return ne}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[f];if(v instanceof ot){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var y in this.buckets){var x=this.buckets[y];if(x instanceof ot&&x.hasRTLText){this.hasRTLText=!0,Mo.isLoading()||Mo.isLoaded()||Bo()!=="deferred"||Gs();break}}for(var P in this.queryPadding=0,this.buckets){var F=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(P).queryRadius(F))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u},Rs.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Rs.prototype.getBucket=function(e){return this.buckets[e.id]},Rs.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var f=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new yi(e,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new yi(e,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)},Rs.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},Rs.prototype.queryRenderedFeatures=function(e,t,r,f,v,y,x,P,F,U){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:y,tileSize:this.tileSize,pixelPosMatrix:U,transform:P,params:x,queryPadding:this.queryPadding*F},e,t,r):{}},Rs.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var f=r.loadVTLayers(),v=t?t.sourceLayer:"",y=f._geojsonTileLayer||f[v];if(y)for(var x=Bl(t&&t.filter),P=this.tileID.canonical,F=P.z,U=P.x,W=P.y,ne={z:F,x:U,y:W},de=0;de<y.length;de++){var be=y.feature(de);if(x.needGeometry){var He=Rt(be,!0);if(!x.filter(new ea(this.tileID.overscaledZ),He,this.tileID.canonical))continue}else if(!x.filter(new ea(this.tileID.overscaledZ),be))continue;var Xe=r.getId(be,v),_t=new Wf(be,F,U,W,Xe);_t.tile=ne,e.push(_t)}}},Rs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Rs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Rs.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=j(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var f=Date.now(),v=!1;if(this.expirationTime>f)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var y=this.expirationTime-t;y?this.expirationTime=f+Math.max(y,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Rs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Rs.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var f in this.buckets)if(t.style.hasLayer(f)){var v=this.buckets[f],y=v.layers[0].sourceLayer||"_geojsonTileLayer",x=r[y],P=e[y];if(x&&P&&Object.keys(P).length!==0){v.update(P,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});var F=t&&t.style&&t.style.getLayer(f);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(v)))}}}},Rs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Rs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<fi.now()},Rs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Rs.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=fi.now()+e},Rs.prototype.setDependencies=function(e,t){for(var r={},f=0,v=t;f<v.length;f+=1)r[v[f]]=!0;this.dependencies[e]=r},Rs.prototype.hasDependency=function(e,t){for(var r=0,f=e;r<f.length;r+=1){var v=this.dependencies[f[r]];if(v){for(var y=0,x=t;y<x.length;y+=1)if(v[x[y]])return!0}}return!1};var Uc=K.performance,bp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},Uc.mark(this._marks.start)};bp.prototype.finish=function(){Uc.mark(this._marks.end);var e=Uc.getEntriesByName(this._marks.measure);return e.length===0&&(Uc.measure(this._marks.measure,this._marks.start,this._marks.end),e=Uc.getEntriesByName(this._marks.measure),Uc.clearMarks(this._marks.start),Uc.clearMarks(this._marks.end),Uc.clearMeasures(this._marks.measure)),e},p.Actor=No,p.AlphaImage=Xu,p.CanonicalTileID=lf,p.CollisionBoxArray=u,p.Color=$i,p.DEMData=zc,p.DataConstantProperty=Gn,p.DictionaryCoder=wf,p.EXTENT=8192,p.ErrorEvent=pe,p.EvaluationParameters=ea,p.Event=ee,p.Evented=Ae,p.FeatureIndex=Zc,p.FillBucket=fu,p.FillExtrusionBucket=pl,p.ImageAtlas=Dn,p.ImagePosition=gr,p.LineBucket=Xo,p.LngLat=ba,p.LngLatBounds=Ha,p.MercatorCoordinate=uf,p.ONE_EM=24,p.OverscaledTileID=ds,p.Point=ae,p.Point$1=ae,p.Properties=Io,p.Protobuf=Cf,p.RGBAImage=fs,p.RequestManager=ar,p.RequestPerformance=bp,p.ResourceType=Xr,p.SegmentVector=we,p.SourceFeatureState=Xf,p.StructArrayLayout1ui2=jl,p.StructArrayLayout2f1f2i16=Gu,p.StructArrayLayout2i4=Bs,p.StructArrayLayout3ui6=xu,p.StructArrayLayout4i8=Ol,p.SymbolBucket=ot,p.Texture=yi,p.Tile=Rs,p.Transitionable=Wo,p.Uniform1f=pn,p.Uniform1i=Gr,p.Uniform2f=an,p.Uniform3f=Zn,p.Uniform4f=ui,p.UniformColor=di,p.UniformMatrix4f=ia,p.UnwrappedTileID=xp,p.ValidationError=_e,p.WritingMode=Dr,p.ZoomHistory=_c,p.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},p.addDynamicAttributes=Ut,p.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var f=e.length,v=new Array(e.length),y=null;e.forEach(function(x,P){t(x,function(F,U){F&&(y=F),v[P]=U,--f==0&&r(y,v)})})},p.bezier=xt,p.bindAll=er,p.browser=fi,p.cacheEntryPossiblyAdded=function(e){++Je>Mt&&(e.getActor().send("enforceCacheSizeLimit",ht),Je=0)},p.clamp=$t,p.clearTileCache=function(e){var t=K.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},p.clipLine=Ls,p.clone=function(e){var t=new Fi(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.clone$1=je,p.clone$2=function(e){var t=new Fi(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},p.collisionCircleLayout=gp,p.config=Yt,p.create=function(){var e=new Fi(16);return Fi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},p.create$1=function(){var e=new Fi(9);return Fi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},p.create$2=function(){var e=new Fi(4);return Fi!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},p.createCommonjsModule=me,p.createExpression=El,p.createLayout=ji,p.createStyleLayer=function(e){return e.type==="custom"?new Rn(e):new mn[e.type](e)},p.cross=function(e,t,r){var f=t[0],v=t[1],y=t[2],x=r[0],P=r[1],F=r[2];return e[0]=v*F-y*P,e[1]=y*x-f*F,e[2]=f*P-v*x,e},p.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var f=0;f<t.length;f++)if(!e(t[f],r[f]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},p.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},p.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},p.ease=Ht,p.emitValidationErrors=Ul,p.endsWith=q,p.enforceCacheSizeLimit=function(e){Nt(),ct&&ct.then(function(t){t.keys().then(function(r){for(var f=0;f<r.length-e;f++)t.delete(r[f])})})},p.evaluateSizeForFeature=Ui,p.evaluateSizeForZoom=ma,p.evaluateVariableOffset=Ge,p.evented=bc,p.extend=Ft,p.featureFilter=Bl,p.filterObject=et,p.fromRotation=function(e,t){var r=Math.sin(t),f=Math.cos(t);return e[0]=f,e[1]=r,e[2]=0,e[3]=-r,e[4]=f,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.getAnchorAlignment=Gi,p.getAnchorJustification=sr,p.getArrayBuffer=Ln,p.getImage=ce,p.getJSON=function(e,t){return Kn(Ft(e,{type:"json"}),t)},p.getRTLTextPluginStatus=Bo,p.getReferrer=vr,p.getVideo=function(e,t){var r,f,v=K.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var y=0;y<e.length;y++){var x=K.document.createElement("source");r=e[y],f=void 0,(f=K.document.createElement("a")).href=r,(f.protocol!==K.document.location.protocol||f.host!==K.document.location.host)&&(v.crossOrigin="Anonymous"),x.src=e[y],v.appendChild(x)}return{cancel:function(){}}},p.identity=Ia,p.invert=function(e,t){var r=t[0],f=t[1],v=t[2],y=t[3],x=t[4],P=t[5],F=t[6],U=t[7],W=t[8],ne=t[9],de=t[10],be=t[11],He=t[12],Xe=t[13],_t=t[14],rt=t[15],Dt=r*P-f*x,qt=r*F-v*x,mr=r*U-y*x,xr=f*F-v*P,Nr=f*U-y*P,ln=v*U-y*F,wn=W*Xe-ne*He,ei=W*_t-de*He,jn=W*rt-be*He,ci=ne*_t-de*Xe,$n=ne*rt-be*Xe,oa=de*rt-be*_t,Ri=Dt*oa-qt*$n+mr*ci+xr*jn-Nr*ei+ln*wn;return Ri?(e[0]=(P*oa-F*$n+U*ci)*(Ri=1/Ri),e[1]=(v*$n-f*oa-y*ci)*Ri,e[2]=(Xe*ln-_t*Nr+rt*xr)*Ri,e[3]=(de*Nr-ne*ln-be*xr)*Ri,e[4]=(F*jn-x*oa-U*ei)*Ri,e[5]=(r*oa-v*jn+y*ei)*Ri,e[6]=(_t*mr-He*ln-rt*qt)*Ri,e[7]=(W*ln-de*mr+be*qt)*Ri,e[8]=(x*$n-P*jn+U*wn)*Ri,e[9]=(f*jn-r*$n-y*wn)*Ri,e[10]=(He*Nr-Xe*mr+rt*Dt)*Ri,e[11]=(ne*mr-W*Nr-be*Dt)*Ri,e[12]=(P*ei-x*ci-F*wn)*Ri,e[13]=(r*ci-f*ei+v*wn)*Ri,e[14]=(Xe*qt-He*xr-_t*Dt)*Ri,e[15]=(W*xr-ne*qt+de*Dt)*Ri,e):null},p.isChar=En,p.isMapboxURL=ur,p.keysDifference=function(e,t){var r=[];for(var f in e)f in t||r.push(f);return r},p.makeRequest=Kn,p.mapObject=Bt,p.mercatorXfromLng=Yu,p.mercatorYfromLat=bh,p.mercatorZfromAltitude=Ku,p.mul=ac,p.multiply=Ka,p.mvt=Pc,p.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},p.normalize=function(e,t){var r=t[0],f=t[1],v=t[2],y=r*r+f*f+v*v;return y>0&&(y=1/Math.sqrt(y)),e[0]=t[0]*y,e[1]=t[1]*y,e[2]=t[2]*y,e},p.number=Aa,p.offscreenCanvasSupported=Hr,p.ortho=function(e,t,r,f,v,y,x){var P=1/(t-r),F=1/(f-v),U=1/(y-x);return e[0]=-2*P,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*F,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*U,e[11]=0,e[12]=(t+r)*P,e[13]=(v+f)*F,e[14]=(x+y)*U,e[15]=1,e},p.parseGlyphPBF=function(e){return new Cf(e).readFields(bn,[])},p.pbf=Cf,p.performSymbolLayout=function(e,t,r,f,v,y,x){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var P=e.layers[0].layout,F=e.layers[0]._unevaluatedLayout._values,U={};if(e.textSizeData.kind==="composite"){var W=e.textSizeData,ne=W.maxZoom;U.compositeTextSizes=[F["text-size"].possiblyEvaluate(new ea(W.minZoom),x),F["text-size"].possiblyEvaluate(new ea(ne),x)]}if(e.iconSizeData.kind==="composite"){var de=e.iconSizeData,be=de.maxZoom;U.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new ea(de.minZoom),x),F["icon-size"].possiblyEvaluate(new ea(be),x)]}U.layoutTextSize=F["text-size"].possiblyEvaluate(new ea(e.zoom+1),x),U.layoutIconSize=F["icon-size"].possiblyEvaluate(new ea(e.zoom+1),x),U.textMaxSize=F["text-size"].possiblyEvaluate(new ea(18));for(var He=24*P.get("text-line-height"),Xe=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",_t=P.get("text-keep-upright"),rt=P.get("text-size"),Dt=function(){var xr=mr[qt],Nr=P.get("text-font").evaluate(xr,{},x).join(","),ln=rt.evaluate(xr,{},x),wn=U.layoutTextSize.evaluate(xr,{},x),ei=U.layoutIconSize.evaluate(xr,{},x),jn={horizontal:{},vertical:void 0},ci=xr.text,$n=[0,0];if(ci){var oa=ci.toString(),Ri=24*P.get("text-letter-spacing").evaluate(xr,{},x),si=function(Sa){for(var mo=0,io=Sa;mo<io.length;mo+=1)if(Ta=io[mo].charCodeAt(0),En.Arabic(Ta)||En["Arabic Supplement"](Ta)||En["Arabic Extended-A"](Ta)||En["Arabic Presentation Forms-A"](Ta)||En["Arabic Presentation Forms-B"](Ta))return!1;var Ta;return!0}(oa)?Ri:0,ua=P.get("text-anchor").evaluate(xr,{},x),Wi=P.get("text-variable-anchor");if(!Wi){var wa=P.get("text-radial-offset").evaluate(xr,{},x);$n=wa?Ge(ua,[24*wa,dl]):P.get("text-offset").evaluate(xr,{},x).map(function(Sa){return 24*Sa})}var vi=Xe?"center":P.get("text-justify").evaluate(xr,{},x),Da=P.get("symbol-placement"),$a=Da==="point"?24*P.get("text-max-width").evaluate(xr,{},x):0,zo=function(){e.allowVerticalPlacement&&Pu(oa)&&(jn.vertical=pi(ci,t,r,v,Nr,$a,He,ua,"left",si,$n,Dr.vertical,!0,Da,wn,ln))};if(!Xe&&Wi){for(var Eo=vi==="auto"?Wi.map(function(Sa){return sr(Sa)}):[vi],Ro=!1,$o=0;$o<Eo.length;$o++){var Vo=Eo[$o];if(!jn.horizontal[Vo])if(Ro)jn.horizontal[Vo]=jn.horizontal[0];else{var Ds=pi(ci,t,r,v,Nr,$a,He,"center",Vo,si,$n,Dr.horizontal,!1,Da,wn,ln);Ds&&(jn.horizontal[Vo]=Ds,Ro=Ds.positionedLines.length===1)}}zo()}else{vi==="auto"&&(vi=sr(ua));var hu=pi(ci,t,r,v,Nr,$a,He,ua,vi,si,$n,Dr.horizontal,!1,Da,wn,ln);hu&&(jn.horizontal[vi]=hu),zo(),Pu(oa)&&Xe&&_t&&(jn.vertical=pi(ci,t,r,v,Nr,$a,He,ua,vi,si,$n,Dr.vertical,!1,Da,wn,ln))}}var Ws=void 0,Eu=!1;if(xr.icon&&xr.icon.name){var vs=f[xr.icon.name];vs&&(Ws=function(Sa,mo,io){var Ta=Gi(io),iu=mo[0]-Sa.displaySize[0]*Ta.horizontalAlign,pu=mo[1]-Sa.displaySize[1]*Ta.verticalAlign;return{image:Sa,top:pu,bottom:pu+Sa.displaySize[1],left:iu,right:iu+Sa.displaySize[0]}}(v[xr.icon.name],P.get("icon-offset").evaluate(xr,{},x),P.get("icon-anchor").evaluate(xr,{},x)),Eu=vs.sdf,e.sdfIcons===void 0?e.sdfIcons=vs.sdf:e.sdfIcons!==vs.sdf&&De("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(vs.pixelRatio!==e.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Xs=Xn(jn.horizontal)||jn.vertical;e.iconsInText=!!Xs&&Xs.iconsInText,(Xs||Ws)&&function(Sa,mo,io,Ta,iu,pu,_o,ms,du,ka,Mc){var Dl=pu.textMaxSize.evaluate(mo,{});Dl===void 0&&(Dl=_o);var fc,ns=Sa.layers[0].layout,jc=ns.get("icon-offset").evaluate(mo,{},Mc),$u=Xn(io.horizontal),Yf=_o/24,Kf=Sa.tilePixelRatio*Yf,Kl=Sa.tilePixelRatio*Dl/24,Ic=Sa.tilePixelRatio*ms,Vc=Sa.tilePixelRatio*ns.get("symbol-spacing"),Xh=ns.get("text-padding")*Sa.tilePixelRatio,$f=ns.get("icon-padding")*Sa.tilePixelRatio,Oc=ns.get("text-max-angle")/180*Math.PI,Yh=ns.get("text-rotation-alignment")==="map"&&ns.get("symbol-placement")!=="point",Kh=ns.get("icon-rotation-alignment")==="map"&&ns.get("symbol-placement")!=="point",cf=ns.get("symbol-placement"),$h=Vc/2,Sh=ns.get("icon-text-fit");Ta&&Sh!=="none"&&(Sa.allowVerticalPlacement&&io.vertical&&(fc=kn(Ta,io.vertical,Sh,ns.get("icon-text-fit-padding"),jc,Yf)),$u&&(Ta=kn(Ta,$u,Sh,ns.get("icon-text-fit-padding"),jc,Yf)));var Af=function(Pd,wh){wh.x<0||wh.x>=8192||wh.y<0||wh.y>=8192||function(is,hc,Xp,Hc,Ap,Yp,Qh,pc,qh,ih,ep,tp,Tp,Kp,Ah,$p,Jp,Pp,Qp,qp,vl,Th,ed,Lc,Md){var td,Mf,ah,If,oh,sh=is.addToLineVertexArray(hc,Xp),rd=0,nd=0,id=0,ad=0,Mp=-1,Ip=-1,Rc={},od=Ue(""),Op=0,Lp=0;if(pc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Op=(td=pc.layout.get("text-offset").evaluate(vl,{},Lc).map(function(Ih){return 24*Ih}))[0],Lp=td[1]):(Op=24*pc.layout.get("text-radial-offset").evaluate(vl,{},Lc),Lp=dl),is.allowVerticalPlacement&&Hc.vertical){var Rp=pc.layout.get("text-rotate").evaluate(vl,{},Lc)+90;If=new Oa(qh,hc,ih,ep,tp,Hc.vertical,Tp,Kp,Ah,Rp),Qh&&(oh=new Oa(qh,hc,ih,ep,tp,Qh,Jp,Pp,Ah,Rp))}if(Ap){var Dp=pc.layout.get("icon-rotate").evaluate(vl,{}),sd=pc.layout.get("icon-text-fit")!=="none",ud=zs(Ap,Dp,ed,sd),kp=Qh?zs(Qh,Dp,ed,sd):void 0;ah=new Oa(qh,hc,ih,ep,tp,Ap,Jp,Pp,!1,Dp),rd=4*ud.length;var ld=is.iconSizeData,Ph=null;ld.kind==="source"?(Ph=[128*pc.layout.get("icon-size").evaluate(vl,{})])[0]>32640&&De(is.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):ld.kind==="composite"&&((Ph=[128*Th.compositeIconSizes[0].evaluate(vl,{},Lc),128*Th.compositeIconSizes[1].evaluate(vl,{},Lc)])[0]>32640||Ph[1]>32640)&&De(is.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),is.addSymbols(is.icon,ud,Ph,qp,Qp,vl,!1,hc,sh.lineStartIndex,sh.lineLength,-1,Lc),Mp=is.icon.placedSymbolArray.length-1,kp&&(nd=4*kp.length,is.addSymbols(is.icon,kp,Ph,qp,Qp,vl,Dr.vertical,hc,sh.lineStartIndex,sh.lineLength,-1,Lc),Ip=is.icon.placedSymbolArray.length-1)}for(var Fp in Hc.horizontal){var rp=Hc.horizontal[Fp];if(!Mf){od=Ue(rp.text);var Id=pc.layout.get("text-rotate").evaluate(vl,{},Lc);Mf=new Oa(qh,hc,ih,ep,tp,rp,Tp,Kp,Ah,Id)}var cd=rp.positionedLines.length===1;if(id+=rr(is,hc,rp,Yp,pc,Ah,vl,$p,sh,Hc.vertical?Dr.horizontal:Dr.horizontalOnly,cd?Object.keys(Hc.horizontal):[Fp],Rc,Mp,Th,Lc),cd)break}Hc.vertical&&(ad+=rr(is,hc,Hc.vertical,Yp,pc,Ah,vl,$p,sh,Dr.vertical,["vertical"],Rc,Ip,Th,Lc));var Od=Mf?Mf.boxStartIndex:is.collisionBoxArray.length,Ld=Mf?Mf.boxEndIndex:is.collisionBoxArray.length,Rd=If?If.boxStartIndex:is.collisionBoxArray.length,Dd=If?If.boxEndIndex:is.collisionBoxArray.length,kd=ah?ah.boxStartIndex:is.collisionBoxArray.length,fd=ah?ah.boxEndIndex:is.collisionBoxArray.length,hd=oh?oh.boxStartIndex:is.collisionBoxArray.length,pd=oh?oh.boxEndIndex:is.collisionBoxArray.length,Ju=-1,Mh=function(Ih,vd){return Ih&&Ih.circleDiameter?Math.max(Ih.circleDiameter,vd):vd};Ju=Mh(Mf,Ju),Ju=Mh(If,Ju),Ju=Mh(ah,Ju);var dd=(Ju=Mh(oh,Ju))>-1?1:0;dd&&(Ju*=Md/24),is.glyphOffsetArray.length>=ot.MAX_GLYPHS&&De("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vl.sortKey!==void 0&&is.addToSortKeyRanges(is.symbolInstances.length,vl.sortKey),is.symbolInstances.emplaceBack(hc.x,hc.y,Rc.right>=0?Rc.right:-1,Rc.center>=0?Rc.center:-1,Rc.left>=0?Rc.left:-1,Rc.vertical||-1,Mp,Ip,od,Od,Ld,Rd,Dd,kd,fd,hd,pd,ih,id,ad,rd,nd,dd,0,Tp,Op,Lp,Ju)}(Sa,wh,Pd,io,Ta,iu,fc,Sa.layers[0],Sa.collisionBoxArray,mo.index,mo.sourceLayerIndex,Sa.index,Kf,Xh,Yh,du,Ic,$f,Kh,jc,mo,pu,ka,Mc,_o)};if(cf==="line")for(var Eh=0,Sp=Ls(mo.geometry,0,0,8192,8192);Eh<Sp.length;Eh+=1)for(var Ep=Sp[Eh],Jf=0,Qf=Uo(Ep,Vc,Oc,io.vertical||$u,Ta,24,Kl,Sa.overscaling,8192);Jf<Qf.length;Jf+=1){var Cp=Qf[Jf];$u&&ha(Sa,$u.text,$h,Cp)||Af(Ep,Cp)}else if(cf==="line-center")for(var Tf=0,Gc=mo.geometry;Tf<Gc.length;Tf+=1){var Jh=Gc[Tf];if(Jh.length>1){var qf=Yo(Jh,Oc,io.vertical||$u,Ta,24,Kl);qf&&Af(Jh,qf)}}else if(mo.type==="Polygon")for(var ff=0,hf=af(mo.geometry,0);ff<hf.length;ff+=1){var eh=hf[ff],th=fa(eh,16);Af(eh[0],new An(th.x,th.y,0))}else if(mo.type==="LineString")for(var ys=0,Ch=mo.geometry;ys<Ch.length;ys+=1){var rh=Ch[ys];Af(rh,new An(rh[0].x,rh[0].y,0))}else if(mo.type==="Point")for(var ao=0,Wp=mo.geometry;ao<Wp.length;ao+=1)for(var Pf=0,nh=Wp[ao];Pf<nh.length;Pf+=1){var wp=nh[Pf];Af([wp],new An(wp.x,wp.y,0))}}(e,xr,jn,Ws,f,U,wn,ei,$n,Eu,x)},qt=0,mr=e.features;qt<mr.length;qt+=1)Dt();y&&e.generateCollisionDebugBuffers()},p.perspective=function(e,t,r,f,v){var y,x=1/Math.tan(t/2);return e[0]=x/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+f)*(y=1/(f-v)),e[14]=2*v*f*y):(e[10]=-1,e[14]=-2*f),e},p.pick=function(e,t){for(var r={},f=0;f<t.length;f++){var v=t[f];v in e&&(r[v]=e[v])}return r},p.plugin=Mo,p.polygonIntersectsPolygon=Kr,p.postMapLoadEvent=Ke,p.postTurnstileEvent=Tr,p.potpack=zt,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.register=Vn,p.registerForPluginStateChange=function(e){return e({pluginStatus:Is,pluginURL:_u}),bc.on("pluginStateChange",e),e},p.renderColorRamp=df,p.rotate=function(e,t,r){var f=t[0],v=t[1],y=t[2],x=t[3],P=Math.sin(r),F=Math.cos(r);return e[0]=f*F+y*P,e[1]=v*F+x*P,e[2]=f*-P+y*F,e[3]=v*-P+x*F,e},p.rotateX=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),y=t[4],x=t[5],P=t[6],F=t[7],U=t[8],W=t[9],ne=t[10],de=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=y*v+U*f,e[5]=x*v+W*f,e[6]=P*v+ne*f,e[7]=F*v+de*f,e[8]=U*v-y*f,e[9]=W*v-x*f,e[10]=ne*v-P*f,e[11]=de*v-F*f,e},p.rotateZ=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),y=t[0],x=t[1],P=t[2],F=t[3],U=t[4],W=t[5],ne=t[6],de=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=y*v+U*f,e[1]=x*v+W*f,e[2]=P*v+ne*f,e[3]=F*v+de*f,e[4]=U*v-y*f,e[5]=W*v-x*f,e[6]=ne*v-P*f,e[7]=de*v-F*f,e},p.scale=function(e,t,r){var f=r[0],v=r[1],y=r[2];return e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e[3]=t[3]*f,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*y,e[9]=t[9]*y,e[10]=t[10]*y,e[11]=t[11]*y,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},p.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},p.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},p.setCacheLimits=function(e,t){ht=e,Mt=t},p.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Is==="deferred"||Is==="loading"||Is==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");_u=fi.resolveURL(e),Is="deferred",Vs=t,rc(),r||Gs()},p.sphericalToCartesian=function(e){var t=e[0],r=e[1],f=e[2];return r+=90,r*=Math.PI/180,f*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(f),y:t*Math.sin(r)*Math.sin(f),z:t*Math.cos(f)}},p.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},p.styleSpec=oe,p.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},p.symbolSize=Zo,p.transformMat3=function(e,t,r){var f=t[0],v=t[1],y=t[2];return e[0]=f*r[0]+v*r[3]+y*r[6],e[1]=f*r[1]+v*r[4]+y*r[7],e[2]=f*r[2]+v*r[5]+y*r[8],e},p.transformMat4=bu,p.translate=function(e,t,r){var f,v,y,x,P,F,U,W,ne,de,be,He,Xe=r[0],_t=r[1],rt=r[2];return t===e?(e[12]=t[0]*Xe+t[4]*_t+t[8]*rt+t[12],e[13]=t[1]*Xe+t[5]*_t+t[9]*rt+t[13],e[14]=t[2]*Xe+t[6]*_t+t[10]*rt+t[14],e[15]=t[3]*Xe+t[7]*_t+t[11]*rt+t[15]):(v=t[1],y=t[2],x=t[3],P=t[4],F=t[5],U=t[6],W=t[7],ne=t[8],de=t[9],be=t[10],He=t[11],e[0]=f=t[0],e[1]=v,e[2]=y,e[3]=x,e[4]=P,e[5]=F,e[6]=U,e[7]=W,e[8]=ne,e[9]=de,e[10]=be,e[11]=He,e[12]=f*Xe+P*_t+ne*rt+t[12],e[13]=v*Xe+F*_t+de*rt+t[13],e[14]=y*Xe+U*_t+be*rt+t[14],e[15]=x*Xe+W*_t+He*rt+t[15]),e},p.triggerPluginCompletionEvent=Jc,p.uniqueId=At,p.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},p.validateLight=pf,p.validateStyle=ts,p.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},p.vectorTile=Pc,p.version="1.13.2",p.warnOnce=De,p.webpSupported=he,p.window=K,p.wrap=Jt}),E(["./shared"],function(p){"use strict";function me(Y){var ce=typeof Y;if(ce==="number"||ce==="boolean"||ce==="string"||Y==null)return JSON.stringify(Y);if(Array.isArray(Y)){for(var ve="[",B=0,ee=Y;B<ee.length;B+=1)ve+=me(ee[B])+",";return ve+"]"}for(var pe=Object.keys(Y).sort(),Ae="{",oe=0;oe<pe.length;oe++)Ae+=JSON.stringify(pe[oe])+":"+me(Y[pe[oe]])+",";return Ae+"}"}function te(Y){for(var ce="",ve=0,B=p.refProperties;ve<B.length;ve+=1)ce+="/"+me(Y[B[ve]]);return ce}var ue=function(Y){this.keyCache={},Y&&this.replace(Y)};ue.prototype.replace=function(Y){this._layerConfigs={},this._layers={},this.update(Y,[])},ue.prototype.update=function(Y,ce){for(var ve=this,B=0,ee=Y;B<ee.length;B+=1){var pe=ee[B];this._layerConfigs[pe.id]=pe;var Ae=this._layers[pe.id]=p.createStyleLayer(pe);Ae._featureFilter=p.featureFilter(Ae.filter),this.keyCache[pe.id]&&delete this.keyCache[pe.id]}for(var oe=0,_e=ce;oe<_e.length;oe+=1){var dt=_e[oe];delete this.keyCache[dt],delete this._layerConfigs[dt],delete this._layers[dt]}this.familiesBySource={};for(var Er=0,Kt=function(vn,xn){for(var zi={},Tn=0;Tn<vn.length;Tn++){var Di=xn&&xn[vn[Tn].id]||te(vn[Tn]);xn&&(xn[vn[Tn].id]=Di);var ra=zi[Di];ra||(ra=zi[Di]=[]),ra.push(vn[Tn])}var hi=[];for(var na in zi)hi.push(zi[na]);return hi}(p.values(this._layerConfigs),this.keyCache);Er<Kt.length;Er+=1){var ir=Kt[Er].map(function(vn){return ve._layers[vn.id]}),Zr=ir[0];if(Zr.visibility!=="none"){var Bn=Zr.source||"",Fn=this.familiesBySource[Bn];Fn||(Fn=this.familiesBySource[Bn]={});var nr=Zr.sourceLayer||"_geojsonTileLayer",In=Fn[nr];In||(In=Fn[nr]=[]),In.push(ir)}}};var ae=function(Y){var ce={},ve=[];for(var B in Y){var ee=Y[B],pe=ce[B]={};for(var Ae in ee){var oe=ee[+Ae];if(oe&&oe.bitmap.width!==0&&oe.bitmap.height!==0){var _e={x:0,y:0,w:oe.bitmap.width+2,h:oe.bitmap.height+2};ve.push(_e),pe[Ae]={rect:_e,metrics:oe.metrics}}}}var dt=p.potpack(ve),Er=new p.AlphaImage({width:dt.w||1,height:dt.h||1});for(var Kt in Y){var ir=Y[Kt];for(var Zr in ir){var Bn=ir[+Zr];if(Bn&&Bn.bitmap.width!==0&&Bn.bitmap.height!==0){var Fn=ce[Kt][Zr].rect;p.AlphaImage.copy(Bn.bitmap,Er,{x:0,y:0},{x:Fn.x+1,y:Fn.y+1},Bn.bitmap)}}}this.image=Er,this.positions=ce};p.register("GlyphAtlas",ae);var Ne=function(Y){this.tileID=new p.OverscaledTileID(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.uid=Y.uid,this.zoom=Y.zoom,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.returnDependencies=!!Y.returnDependencies,this.promoteId=Y.promoteId};function K(Y,ce,ve){for(var B=new p.EvaluationParameters(ce),ee=0,pe=Y;ee<pe.length;ee+=1)pe[ee].recalculate(B,ve)}function Qe(Y,ce){var ve=p.getArrayBuffer(Y.request,function(B,ee,pe,Ae){B?ce(B):ee&&ce(null,{vectorTile:new p.vectorTile.VectorTile(new p.pbf(ee)),rawData:ee,cacheControl:pe,expires:Ae})});return function(){ve.cancel(),ce()}}Ne.prototype.parse=function(Y,ce,ve,B,ee){var pe=this;this.status="parsing",this.data=Y,this.collisionBoxArray=new p.CollisionBoxArray;var Ae=new p.DictionaryCoder(Object.keys(Y.layers).sort()),oe=new p.FeatureIndex(this.tileID,this.promoteId);oe.bucketLayerIDs=[];var _e,dt,Er,Kt,ir={},Zr={featureIndex:oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ve},Bn=ce.familiesBySource[this.source];for(var Fn in Bn){var nr=Y.layers[Fn];if(nr){nr.version===1&&p.warnOnce('Vector tile source "'+this.source+'" layer "'+Fn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var In=Ae.encode(Fn),vn=[],xn=0;xn<nr.length;xn++){var zi=nr.feature(xn),Tn=oe.getId(zi,Fn);vn.push({feature:zi,id:Tn,index:xn,sourceLayerIndex:In})}for(var Di=0,ra=Bn[Fn];Di<ra.length;Di+=1){var hi=ra[Di],na=hi[0];na.minzoom&&this.zoom<Math.floor(na.minzoom)||na.maxzoom&&this.zoom>=na.maxzoom||na.visibility!=="none"&&(K(hi,this.zoom,ve),(ir[na.id]=na.createBucket({index:oe.bucketLayerIDs.length,layers:hi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:In,sourceID:this.source})).populate(vn,Zr,this.tileID.canonical),oe.bucketLayerIDs.push(hi.map(function(Ki){return Ki.id})))}}}var Yi=p.mapObject(Zr.glyphDependencies,function(Ki){return Object.keys(Ki).map(Number)});Object.keys(Yi).length?B.send("getGlyphs",{uid:this.uid,stacks:Yi},function(Ki,Zi){_e||(_e=Ki,dt=Zi,Fa.call(pe))}):dt={};var Ii=Object.keys(Zr.iconDependencies);Ii.length?B.send("getImages",{icons:Ii,source:this.source,tileID:this.tileID,type:"icons"},function(Ki,Zi){_e||(_e=Ki,Er=Zi,Fa.call(pe))}):Er={};var ya=Object.keys(Zr.patternDependencies);function Fa(){if(_e)return ee(_e);if(dt&&Er&&Kt){var Ki=new ae(dt),Zi=new p.ImageAtlas(Er,Kt);for(var $i in ir){var so=ir[$i];so instanceof p.SymbolBucket?(K(so.layers,this.zoom,ve),p.performSymbolLayout(so,dt,Ki.positions,Er,Zi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):so.hasPattern&&(so instanceof p.LineBucket||so instanceof p.FillBucket||so instanceof p.FillExtrusionBucket)&&(K(so.layers,this.zoom,ve),so.addFeatures(Zr,this.tileID.canonical,Zi.patternPositions))}this.status="done",ee(null,{buckets:p.values(ir).filter(function(Jo){return!Jo.isEmpty()}),featureIndex:oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ki.image,imageAtlas:Zi,glyphMap:this.returnDependencies?dt:null,iconMap:this.returnDependencies?Er:null,glyphPositions:this.returnDependencies?Ki.positions:null})}}ya.length?B.send("getImages",{icons:ya,source:this.source,tileID:this.tileID,type:"patterns"},function(Ki,Zi){_e||(_e=Ki,Kt=Zi,Fa.call(pe))}):Kt={},Fa.call(this)};var xt=function(Y,ce,ve,B){this.actor=Y,this.layerIndex=ce,this.availableImages=ve,this.loadVectorData=B||Qe,this.loading={},this.loaded={}};xt.prototype.loadTile=function(Y,ce){var ve=this,B=Y.uid;this.loading||(this.loading={});var ee=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new p.RequestPerformance(Y.request),pe=this.loading[B]=new Ne(Y);pe.abort=this.loadVectorData(Y,function(Ae,oe){if(delete ve.loading[B],Ae||!oe)return pe.status="done",ve.loaded[B]=pe,ce(Ae);var _e=oe.rawData,dt={};oe.expires&&(dt.expires=oe.expires),oe.cacheControl&&(dt.cacheControl=oe.cacheControl);var Er={};if(ee){var Kt=ee.finish();Kt&&(Er.resourceTiming=JSON.parse(JSON.stringify(Kt)))}pe.vectorTile=oe.vectorTile,pe.parse(oe.vectorTile,ve.layerIndex,ve.availableImages,ve.actor,function(ir,Zr){if(ir||!Zr)return ce(ir);ce(null,p.extend({rawTileData:_e.slice(0)},Zr,dt,Er))}),ve.loaded=ve.loaded||{},ve.loaded[B]=pe})},xt.prototype.reloadTile=function(Y,ce){var ve=this,B=this.loaded,ee=Y.uid,pe=this;if(B&&B[ee]){var Ae=B[ee];Ae.showCollisionBoxes=Y.showCollisionBoxes;var oe=function(_e,dt){var Er=Ae.reloadCallback;Er&&(delete Ae.reloadCallback,Ae.parse(Ae.vectorTile,pe.layerIndex,ve.availableImages,pe.actor,Er)),ce(_e,dt)};Ae.status==="parsing"?Ae.reloadCallback=oe:Ae.status==="done"&&(Ae.vectorTile?Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,oe):oe())}},xt.prototype.abortTile=function(Y,ce){var ve=this.loading,B=Y.uid;ve&&ve[B]&&ve[B].abort&&(ve[B].abort(),delete ve[B]),ce()},xt.prototype.removeTile=function(Y,ce){var ve=this.loaded,B=Y.uid;ve&&ve[B]&&delete ve[B],ce()};var Ht=p.window.ImageBitmap,$t=function(){this.loaded={}};function Jt(Y,ce){if(Y.length!==0){Ft(Y[0],ce);for(var ve=1;ve<Y.length;ve++)Ft(Y[ve],!ce)}}function Ft(Y,ce){for(var ve=0,B=0,ee=Y.length,pe=ee-1;B<ee;pe=B++)ve+=(Y[B][0]-Y[pe][0])*(Y[pe][1]+Y[B][1]);ve>=0!=!!ce&&Y.reverse()}$t.prototype.loadTile=function(Y,ce){var ve=Y.uid,B=Y.encoding,ee=Y.rawImageData,pe=Ht&&ee instanceof Ht?this.getImageData(ee):ee,Ae=new p.DEMData(ve,pe,B);this.loaded=this.loaded||{},this.loaded[ve]=Ae,ce(null,Ae)},$t.prototype.getImageData=function(Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);var ce=this.offscreenCanvasContext.getImageData(-1,-1,Y.width+2,Y.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:ce.width,height:ce.height},ce.data)},$t.prototype.removeTile=function(Y){var ce=this.loaded,ve=Y.uid;ce&&ce[ve]&&delete ce[ve]};var Gt=p.vectorTile.VectorTileFeature.prototype.toGeoJSON,At=function(Y){this._feature=Y,this.extent=p.EXTENT,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))};At.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Y=[],ce=0,ve=this._feature.geometry;ce<ve.length;ce+=1){var B=ve[ce];Y.push([new p.Point$1(B[0],B[1])])}return Y}for(var ee=[],pe=0,Ae=this._feature.geometry;pe<Ae.length;pe+=1){for(var oe=[],_e=0,dt=Ae[pe];_e<dt.length;_e+=1){var Er=dt[_e];oe.push(new p.Point$1(Er[0],Er[1]))}ee.push(oe)}return ee},At.prototype.toGeoJSON=function(Y,ce,ve){return Gt.call(this,Y,ce,ve)};var Et=function(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=Y.length,this._features=Y};Et.prototype.feature=function(Y){return new At(this._features[Y])};var bt=p.vectorTile.VectorTileFeature,er=q;function q(Y,ce){this.options=ce||{},this.features=Y,this.length=Y.length}function Bt(Y,ce){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=ce||4096}q.prototype.feature=function(Y){return new Bt(this.features[Y],this.options.extent)},Bt.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var ce=0;ce<Y.length;ce++){for(var ve=Y[ce],B=[],ee=0;ee<ve.length;ee++)B.push(new p.Point$1(ve[ee][0],ve[ee][1]));this.geometry.push(B)}return this.geometry},Bt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,ce=1/0,ve=-1/0,B=1/0,ee=-1/0,pe=0;pe<Y.length;pe++)for(var Ae=Y[pe],oe=0;oe<Ae.length;oe++){var _e=Ae[oe];ce=Math.min(ce,_e.x),ve=Math.max(ve,_e.x),B=Math.min(B,_e.y),ee=Math.max(ee,_e.y)}return[ce,B,ve,ee]},Bt.prototype.toGeoJSON=bt.prototype.toGeoJSON;var et=nt,je=er;function nt(Y){var ce=new p.pbf;return function(ve,B){for(var ee in ve.layers)B.writeMessage(3,De,ve.layers[ee])}(Y,ce),ce.finish()}function De(Y,ce){var ve;ce.writeVarintField(15,Y.version||1),ce.writeStringField(1,Y.name||""),ce.writeVarintField(5,Y.extent||4096);var B={keys:[],values:[],keycache:{},valuecache:{}};for(ve=0;ve<Y.length;ve++)B.feature=Y.feature(ve),ce.writeMessage(2,It,B);var ee=B.keys;for(ve=0;ve<ee.length;ve++)ce.writeStringField(3,ee[ve]);var pe=B.values;for(ve=0;ve<pe.length;ve++)ce.writeMessage(4,Me,pe[ve])}function It(Y,ce){var ve=Y.feature;ve.id!==void 0&&ce.writeVarintField(1,ve.id),ce.writeMessage(2,hr,Y),ce.writeVarintField(3,ve.type),ce.writeMessage(4,ie,ve)}function hr(Y,ce){var ve=Y.feature,B=Y.keys,ee=Y.values,pe=Y.keycache,Ae=Y.valuecache;for(var oe in ve.properties){var _e=pe[oe];_e===void 0&&(B.push(oe),pe[oe]=_e=B.length-1),ce.writeVarint(_e);var dt=ve.properties[oe],Er=typeof dt;Er!=="string"&&Er!=="boolean"&&Er!=="number"&&(dt=JSON.stringify(dt));var Kt=Er+":"+dt,ir=Ae[Kt];ir===void 0&&(ee.push(dt),Ae[Kt]=ir=ee.length-1),ce.writeVarint(ir)}}function tr(Y,ce){return(ce<<3)+(7&Y)}function j(Y){return Y<<1^Y>>31}function ie(Y,ce){for(var ve=Y.loadGeometry(),B=Y.type,ee=0,pe=0,Ae=ve.length,oe=0;oe<Ae;oe++){var _e=ve[oe],dt=1;B===1&&(dt=_e.length),ce.writeVarint(tr(1,dt));for(var Er=B===3?_e.length-1:_e.length,Kt=0;Kt<Er;Kt++){Kt===1&&B!==1&&ce.writeVarint(tr(2,Er-1));var ir=_e[Kt].x-ee,Zr=_e[Kt].y-pe;ce.writeVarint(j(ir)),ce.writeVarint(j(Zr)),ee+=ir,pe+=Zr}B===3&&ce.writeVarint(tr(7,1))}}function Me(Y,ce){var ve=typeof Y;ve==="string"?ce.writeStringField(1,Y):ve==="boolean"?ce.writeBooleanField(7,Y):ve==="number"&&(Y%1!=0?ce.writeDoubleField(3,Y):Y<0?ce.writeSVarintField(6,Y):ce.writeVarintField(5,Y))}function ye(Y,ce,ve,B){it(Y,ve,B),it(ce,2*ve,2*B),it(ce,2*ve+1,2*B+1)}function it(Y,ce,ve){var B=Y[ce];Y[ce]=Y[ve],Y[ve]=B}function lt(Y,ce,ve,B){var ee=Y-ve,pe=ce-B;return ee*ee+pe*pe}et.fromVectorTileJs=nt,et.fromGeojsonVt=function(Y,ce){ce=ce||{};var ve={};for(var B in Y)ve[B]=new er(Y[B].features,ce),ve[B].name=B,ve[B].version=ce.version,ve[B].extent=ce.extent;return nt({layers:ve})},et.GeoJSONWrapper=je;var Lt=function(Y){return Y[0]},Pt=function(Y){return Y[1]},Lr=function(Y,ce,ve,B,ee){ce===void 0&&(ce=Lt),ve===void 0&&(ve=Pt),B===void 0&&(B=64),ee===void 0&&(ee=Float64Array),this.nodeSize=B,this.points=Y;for(var pe=Y.length<65536?Uint16Array:Uint32Array,Ae=this.ids=new pe(Y.length),oe=this.coords=new ee(2*Y.length),_e=0;_e<Y.length;_e++)Ae[_e]=_e,oe[2*_e]=ce(Y[_e]),oe[2*_e+1]=ve(Y[_e]);(function dt(Er,Kt,ir,Zr,Bn,Fn){if(!(Bn-Zr<=ir)){var nr=Zr+Bn>>1;(function In(vn,xn,zi,Tn,Di,ra){for(;Di>Tn;){if(Di-Tn>600){var hi=Di-Tn+1,na=zi-Tn+1,Yi=Math.log(hi),Ii=.5*Math.exp(2*Yi/3),ya=.5*Math.sqrt(Yi*Ii*(hi-Ii)/hi)*(na-hi/2<0?-1:1);In(vn,xn,zi,Math.max(Tn,Math.floor(zi-na*Ii/hi+ya)),Math.min(Di,Math.floor(zi+(hi-na)*Ii/hi+ya)),ra)}var Fa=xn[2*zi+ra],Ki=Tn,Zi=Di;for(ye(vn,xn,Tn,zi),xn[2*Di+ra]>Fa&&ye(vn,xn,Tn,Di);Ki<Zi;){for(ye(vn,xn,Ki,Zi),Ki++,Zi--;xn[2*Ki+ra]<Fa;)Ki++;for(;xn[2*Zi+ra]>Fa;)Zi--}xn[2*Tn+ra]===Fa?ye(vn,xn,Tn,Zi):ye(vn,xn,++Zi,Di),Zi<=zi&&(Tn=Zi+1),zi<=Zi&&(Di=Zi-1)}})(Er,Kt,nr,Zr,Bn,Fn%2),dt(Er,Kt,ir,Zr,nr-1,Fn+1),dt(Er,Kt,ir,nr+1,Bn,Fn+1)}})(Ae,oe,B,0,Ae.length-1,0)};Lr.prototype.range=function(Y,ce,ve,B){return function(ee,pe,Ae,oe,_e,dt,Er){for(var Kt,ir,Zr=[0,ee.length-1,0],Bn=[];Zr.length;){var Fn=Zr.pop(),nr=Zr.pop(),In=Zr.pop();if(nr-In<=Er)for(var vn=In;vn<=nr;vn++)ir=pe[2*vn+1],(Kt=pe[2*vn])>=Ae&&Kt<=_e&&ir>=oe&&ir<=dt&&Bn.push(ee[vn]);else{var xn=Math.floor((In+nr)/2);ir=pe[2*xn+1],(Kt=pe[2*xn])>=Ae&&Kt<=_e&&ir>=oe&&ir<=dt&&Bn.push(ee[xn]);var zi=(Fn+1)%2;(Fn===0?Ae<=Kt:oe<=ir)&&(Zr.push(In),Zr.push(xn-1),Zr.push(zi)),(Fn===0?_e>=Kt:dt>=ir)&&(Zr.push(xn+1),Zr.push(nr),Zr.push(zi))}}return Bn}(this.ids,this.coords,Y,ce,ve,B,this.nodeSize)},Lr.prototype.within=function(Y,ce,ve){return function(B,ee,pe,Ae,oe,_e){for(var dt=[0,B.length-1,0],Er=[],Kt=oe*oe;dt.length;){var ir=dt.pop(),Zr=dt.pop(),Bn=dt.pop();if(Zr-Bn<=_e)for(var Fn=Bn;Fn<=Zr;Fn++)lt(ee[2*Fn],ee[2*Fn+1],pe,Ae)<=Kt&&Er.push(B[Fn]);else{var nr=Math.floor((Bn+Zr)/2),In=ee[2*nr],vn=ee[2*nr+1];lt(In,vn,pe,Ae)<=Kt&&Er.push(B[nr]);var xn=(ir+1)%2;(ir===0?pe-oe<=In:Ae-oe<=vn)&&(dt.push(Bn),dt.push(nr-1),dt.push(xn)),(ir===0?pe+oe>=In:Ae+oe>=vn)&&(dt.push(nr+1),dt.push(Zr),dt.push(xn))}}return Er}(this.ids,this.coords,Y,ce,ve,this.nodeSize)};var cn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Y){return Y}},qr=function(Y){this.options=Ot(Object.create(cn),Y),this.trees=new Array(this.options.maxZoom+1)};function fi(Y,ce,ve,B,ee){return{x:Y,y:ce,zoom:1/0,id:ve,parentId:-1,numPoints:B,properties:ee}}function Yt(Y,ce){var ve=Y.geometry.coordinates,B=ve[1];return{x:Ze(ve[0]),y:Oe(B),zoom:1/0,index:ce,parentId:-1}}function he(Y){return{type:"Feature",id:Y.id,properties:Te(Y),geometry:{type:"Point",coordinates:[(B=Y.x,360*(B-.5)),(ce=Y.y,ve=(180-360*ce)*Math.PI/180,360*Math.atan(Math.exp(ve))/Math.PI-90)]}};var ce,ve,B}function Te(Y){var ce=Y.numPoints,ve=ce>=1e4?Math.round(ce/1e3)+"k":ce>=1e3?Math.round(ce/100)/10+"k":ce;return Ot(Ot({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:ce,point_count_abbreviated:ve})}function Ze(Y){return Y/360+.5}function Oe(Y){var ce=Math.sin(Y*Math.PI/180),ve=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return ve<0?0:ve>1?1:ve}function Ot(Y,ce){for(var ve in ce)Y[ve]=ce[ve];return Y}function ar(Y){return Y.x}function ur(Y){return Y.y}function Pr(Y,ce,ve,B,ee,pe){var Ae=ee-ve,oe=pe-B;if(Ae!==0||oe!==0){var _e=((Y-ve)*Ae+(ce-B)*oe)/(Ae*Ae+oe*oe);_e>1?(ve=ee,B=pe):_e>0&&(ve+=Ae*_e,B+=oe*_e)}return(Ae=Y-ve)*Ae+(oe=ce-B)*oe}function or(Y,ce,ve,B){var ee={id:Y===void 0?null:Y,type:ce,geometry:ve,tags:B,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(pe){var Ae=pe.geometry,oe=pe.type;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")nn(pe,Ae);else if(oe==="Polygon"||oe==="MultiLineString")for(var _e=0;_e<Ae.length;_e++)nn(pe,Ae[_e]);else if(oe==="MultiPolygon")for(_e=0;_e<Ae.length;_e++)for(var dt=0;dt<Ae[_e].length;dt++)nn(pe,Ae[_e][dt])}(ee),ee}function nn(Y,ce){for(var ve=0;ve<ce.length;ve+=3)Y.minX=Math.min(Y.minX,ce[ve]),Y.minY=Math.min(Y.minY,ce[ve+1]),Y.maxX=Math.max(Y.maxX,ce[ve]),Y.maxY=Math.max(Y.maxY,ce[ve+1])}function C(Y,ce,ve,B){if(ce.geometry){var ee=ce.geometry.coordinates,pe=ce.geometry.type,Ae=Math.pow(ve.tolerance/((1<<ve.maxZoom)*ve.extent),2),oe=[],_e=ce.id;if(ve.promoteId?_e=ce.properties[ve.promoteId]:ve.generateId&&(_e=B||0),pe==="Point")V(ee,oe);else if(pe==="MultiPoint")for(var dt=0;dt<ee.length;dt++)V(ee[dt],oe);else if(pe==="LineString")Ve(ee,oe,Ae,!1);else if(pe==="MultiLineString"){if(ve.lineMetrics){for(dt=0;dt<ee.length;dt++)Ve(ee[dt],oe=[],Ae,!1),Y.push(or(_e,"LineString",oe,ce.properties));return}$e(ee,oe,Ae,!1)}else if(pe==="Polygon")$e(ee,oe,Ae,!0);else{if(pe!=="MultiPolygon"){if(pe==="GeometryCollection"){for(dt=0;dt<ce.geometry.geometries.length;dt++)C(Y,{id:_e,geometry:ce.geometry.geometries[dt],properties:ce.properties},ve,B);return}throw new Error("Input data is not a valid GeoJSON object.")}for(dt=0;dt<ee.length;dt++){var Er=[];$e(ee[dt],Er,Ae,!0),oe.push(Er)}}Y.push(or(_e,pe,oe,ce.properties))}}function V(Y,ce){ce.push(ct(Y[0])),ce.push(Ct(Y[1])),ce.push(0)}function Ve(Y,ce,ve,B){for(var ee,pe,Ae=0,oe=0;oe<Y.length;oe++){var _e=ct(Y[oe][0]),dt=Ct(Y[oe][1]);ce.push(_e),ce.push(dt),ce.push(0),oe>0&&(Ae+=B?(ee*dt-_e*pe)/2:Math.sqrt(Math.pow(_e-ee,2)+Math.pow(dt-pe,2))),ee=_e,pe=dt}var Er=ce.length-3;ce[2]=1,function Kt(ir,Zr,Bn,Fn){for(var nr,In=Fn,vn=Bn-Zr>>1,xn=Bn-Zr,zi=ir[Zr],Tn=ir[Zr+1],Di=ir[Bn],ra=ir[Bn+1],hi=Zr+3;hi<Bn;hi+=3){var na=Pr(ir[hi],ir[hi+1],zi,Tn,Di,ra);if(na>In)nr=hi,In=na;else if(na===In){var Yi=Math.abs(hi-vn);Yi<xn&&(nr=hi,xn=Yi)}}In>Fn&&(nr-Zr>3&&Kt(ir,Zr,nr,Fn),ir[nr+2]=In,Bn-nr>3&&Kt(ir,nr,Bn,Fn))}(ce,0,Er,ve),ce[Er+2]=1,ce.size=Math.abs(Ae),ce.start=0,ce.end=ce.size}function $e(Y,ce,ve,B){for(var ee=0;ee<Y.length;ee++){var pe=[];Ve(Y[ee],pe,ve,B),ce.push(pe)}}function ct(Y){return Y/360+.5}function Ct(Y){var ce=Math.sin(Y*Math.PI/180),ve=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return ve<0?0:ve>1?1:ve}function J(Y,ce,ve,B,ee,pe,Ae,oe){if(B/=ce,pe>=(ve/=ce)&&Ae<B)return Y;if(Ae<ve||pe>=B)return null;for(var _e=[],dt=0;dt<Y.length;dt++){var Er=Y[dt],Kt=Er.geometry,ir=Er.type,Zr=ee===0?Er.minX:Er.minY,Bn=ee===0?Er.maxX:Er.maxY;if(Zr>=ve&&Bn<B)_e.push(Er);else if(!(Bn<ve||Zr>=B)){var Fn=[];if(ir==="Point"||ir==="MultiPoint")Wt(Kt,Fn,ve,B,ee);else if(ir==="LineString")Tr(Kt,Fn,ve,B,ee,!1,oe.lineMetrics);else if(ir==="MultiLineString")Ke(Kt,Fn,ve,B,ee,!1);else if(ir==="Polygon")Ke(Kt,Fn,ve,B,ee,!0);else if(ir==="MultiPolygon")for(var nr=0;nr<Kt.length;nr++){var In=[];Ke(Kt[nr],In,ve,B,ee,!0),In.length&&Fn.push(In)}if(Fn.length){if(oe.lineMetrics&&ir==="LineString"){for(nr=0;nr<Fn.length;nr++)_e.push(or(Er.id,ir,Fn[nr],Er.tags));continue}ir!=="LineString"&&ir!=="MultiLineString"||(Fn.length===1?(ir="LineString",Fn=Fn[0]):ir="MultiLineString"),ir!=="Point"&&ir!=="MultiPoint"||(ir=Fn.length===3?"Point":"MultiPoint"),_e.push(or(Er.id,ir,Fn,Er.tags))}}}return _e.length?_e:null}function Wt(Y,ce,ve,B,ee){for(var pe=0;pe<Y.length;pe+=3){var Ae=Y[pe+ee];Ae>=ve&&Ae<=B&&(ce.push(Y[pe]),ce.push(Y[pe+1]),ce.push(Y[pe+2]))}}function Tr(Y,ce,ve,B,ee,pe,Ae){for(var oe,_e,dt=Mr(Y),Er=ee===0?Mt:Nt,Kt=Y.start,ir=0;ir<Y.length-3;ir+=3){var Zr=Y[ir],Bn=Y[ir+1],Fn=Y[ir+2],nr=Y[ir+3],In=Y[ir+4],vn=ee===0?Zr:Bn,xn=ee===0?nr:In,zi=!1;Ae&&(oe=Math.sqrt(Math.pow(Zr-nr,2)+Math.pow(Bn-In,2))),vn<ve?xn>ve&&(_e=Er(dt,Zr,Bn,nr,In,ve),Ae&&(dt.start=Kt+oe*_e)):vn>B?xn<B&&(_e=Er(dt,Zr,Bn,nr,In,B),Ae&&(dt.start=Kt+oe*_e)):ht(dt,Zr,Bn,Fn),xn<ve&&vn>=ve&&(_e=Er(dt,Zr,Bn,nr,In,ve),zi=!0),xn>B&&vn<=B&&(_e=Er(dt,Zr,Bn,nr,In,B),zi=!0),!pe&&zi&&(Ae&&(dt.end=Kt+oe*_e),ce.push(dt),dt=Mr(Y)),Ae&&(Kt+=oe)}var Tn=Y.length-3;Zr=Y[Tn],Bn=Y[Tn+1],Fn=Y[Tn+2],(vn=ee===0?Zr:Bn)>=ve&&vn<=B&&ht(dt,Zr,Bn,Fn),Tn=dt.length-3,pe&&Tn>=3&&(dt[Tn]!==dt[0]||dt[Tn+1]!==dt[1])&&ht(dt,dt[0],dt[1],dt[2]),dt.length&&ce.push(dt)}function Mr(Y){var ce=[];return ce.size=Y.size,ce.start=Y.start,ce.end=Y.end,ce}function Ke(Y,ce,ve,B,ee,pe){for(var Ae=0;Ae<Y.length;Ae++)Tr(Y[Ae],ce,ve,B,ee,pe,!1)}function ht(Y,ce,ve,B){Y.push(ce),Y.push(ve),Y.push(B)}function Mt(Y,ce,ve,B,ee,pe){var Ae=(pe-ce)/(B-ce);return Y.push(pe),Y.push(ve+(ee-ve)*Ae),Y.push(1),Ae}function Nt(Y,ce,ve,B,ee,pe){var Ae=(pe-ve)/(ee-ve);return Y.push(ce+(B-ce)*Ae),Y.push(pe),Y.push(1),Ae}function br(Y,ce){for(var ve=[],B=0;B<Y.length;B++){var ee,pe=Y[B],Ae=pe.type;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")ee=Sr(pe.geometry,ce);else if(Ae==="MultiLineString"||Ae==="Polygon"){ee=[];for(var oe=0;oe<pe.geometry.length;oe++)ee.push(Sr(pe.geometry[oe],ce))}else if(Ae==="MultiPolygon")for(ee=[],oe=0;oe<pe.geometry.length;oe++){for(var _e=[],dt=0;dt<pe.geometry[oe].length;dt++)_e.push(Sr(pe.geometry[oe][dt],ce));ee.push(_e)}ve.push(or(pe.id,Ae,ee,pe.tags))}return ve}function Sr(Y,ce){var ve=[];ve.size=Y.size,Y.start!==void 0&&(ve.start=Y.start,ve.end=Y.end);for(var B=0;B<Y.length;B+=3)ve.push(Y[B]+ce,Y[B+1],Y[B+2]);return ve}function Je(Y,ce){if(Y.transformed)return Y;var ve,B,ee,pe=1<<Y.z,Ae=Y.x,oe=Y.y;for(ve=0;ve<Y.features.length;ve++){var _e=Y.features[ve],dt=_e.geometry,Er=_e.type;if(_e.geometry=[],Er===1)for(B=0;B<dt.length;B+=2)_e.geometry.push(Hr(dt[B],dt[B+1],ce,pe,Ae,oe));else for(B=0;B<dt.length;B++){var Kt=[];for(ee=0;ee<dt[B].length;ee+=2)Kt.push(Hr(dt[B][ee],dt[B][ee+1],ce,pe,Ae,oe));_e.geometry.push(Kt)}}return Y.transformed=!0,Y}function Hr(Y,ce,ve,B,ee,pe){return[Math.round(ve*(Y*B-ee)),Math.round(ve*(ce*B-pe))]}function Xr(Y,ce,ve,B,ee){for(var pe=ce===ee.maxZoom?0:ee.tolerance/((1<<ce)*ee.extent),Ae={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ve,y:B,z:ce,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},oe=0;oe<Y.length;oe++){Ae.numFeatures++,yn(Ae,Y[oe],pe,ee);var _e=Y[oe].minX,dt=Y[oe].minY,Er=Y[oe].maxX,Kt=Y[oe].maxY;_e<Ae.minX&&(Ae.minX=_e),dt<Ae.minY&&(Ae.minY=dt),Er>Ae.maxX&&(Ae.maxX=Er),Kt>Ae.maxY&&(Ae.maxY=Kt)}return Ae}function yn(Y,ce,ve,B){var ee=ce.geometry,pe=ce.type,Ae=[];if(pe==="Point"||pe==="MultiPoint")for(var oe=0;oe<ee.length;oe+=3)Ae.push(ee[oe]),Ae.push(ee[oe+1]),Y.numPoints++,Y.numSimplified++;else if(pe==="LineString")vr(Ae,ee,Y,ve,!1,!1);else if(pe==="MultiLineString"||pe==="Polygon")for(oe=0;oe<ee.length;oe++)vr(Ae,ee[oe],Y,ve,pe==="Polygon",oe===0);else if(pe==="MultiPolygon")for(var _e=0;_e<ee.length;_e++){var dt=ee[_e];for(oe=0;oe<dt.length;oe++)vr(Ae,dt[oe],Y,ve,!0,oe===0)}if(Ae.length){var Er=ce.tags||null;if(pe==="LineString"&&B.lineMetrics){for(var Kt in Er={},ce.tags)Er[Kt]=ce.tags[Kt];Er.mapbox_clip_start=ee.start/ee.size,Er.mapbox_clip_end=ee.end/ee.size}var ir={geometry:Ae,type:pe==="Polygon"||pe==="MultiPolygon"?3:pe==="LineString"||pe==="MultiLineString"?2:1,tags:Er};ce.id!==null&&(ir.id=ce.id),Y.features.push(ir)}}function vr(Y,ce,ve,B,ee,pe){var Ae=B*B;if(B>0&&ce.size<(ee?Ae:B))ve.numPoints+=ce.length/3;else{for(var oe=[],_e=0;_e<ce.length;_e+=3)(B===0||ce[_e+2]>Ae)&&(ve.numSimplified++,oe.push(ce[_e]),oe.push(ce[_e+1])),ve.numPoints++;ee&&function(dt,Er){for(var Kt=0,ir=0,Zr=dt.length,Bn=Zr-2;ir<Zr;Bn=ir,ir+=2)Kt+=(dt[ir]-dt[Bn])*(dt[ir+1]+dt[Bn+1]);if(Kt>0===Er)for(ir=0,Zr=dt.length;ir<Zr/2;ir+=2){var Fn=dt[ir],nr=dt[ir+1];dt[ir]=dt[Zr-2-ir],dt[ir+1]=dt[Zr-1-ir],dt[Zr-2-ir]=Fn,dt[Zr-1-ir]=nr}}(oe,pe),Y.push(oe)}}function Or(Y,ce){var ve=(ce=this.options=function(ee,pe){for(var Ae in pe)ee[Ae]=pe[Ae];return ee}(Object.create(this.options),ce)).debug;if(ve&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");var B=function(ee,pe){var Ae=[];if(ee.type==="FeatureCollection")for(var oe=0;oe<ee.features.length;oe++)C(Ae,ee.features[oe],pe,oe);else C(Ae,ee.type==="Feature"?ee:{geometry:ee},pe);return Ae}(Y,ce);this.tiles={},this.tileCoords=[],ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(B=function(ee,pe){var Ae=pe.buffer/pe.extent,oe=ee,_e=J(ee,1,-1-Ae,Ae,0,-1,2,pe),dt=J(ee,1,1-Ae,2+Ae,0,-1,2,pe);return(_e||dt)&&(oe=J(ee,1,-Ae,1+Ae,0,-1,2,pe)||[],_e&&(oe=br(_e,1).concat(oe)),dt&&(oe=oe.concat(br(dt,-1)))),oe}(B,ce)).length&&this.splitTile(B,0,0,0),ve&&(B.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function St(Y,ce,ve){return 32*((1<<Y)*ve+ce)+Y}function Kn(Y,ce){var ve=Y.tileID.canonical;if(!this._geoJSONIndex)return ce(null,null);var B=this._geoJSONIndex.getTile(ve.z,ve.x,ve.y);if(!B)return ce(null,null);var ee=new Et(B.features),pe=et(ee);pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),ce(null,{vectorTile:ee,rawData:pe.buffer})}qr.prototype.load=function(Y){var ce=this.options,ve=ce.log,B=ce.minZoom,ee=ce.maxZoom,pe=ce.nodeSize;ve&&console.time("total time");var Ae="prepare "+Y.length+" points";ve&&console.time(Ae),this.points=Y;for(var oe=[],_e=0;_e<Y.length;_e++)Y[_e].geometry&&oe.push(Yt(Y[_e],_e));this.trees[ee+1]=new Lr(oe,ar,ur,pe,Float32Array),ve&&console.timeEnd(Ae);for(var dt=ee;dt>=B;dt--){var Er=+Date.now();oe=this._cluster(oe,dt),this.trees[dt]=new Lr(oe,ar,ur,pe,Float32Array),ve&&console.log("z%d: %d clusters in %dms",dt,oe.length,+Date.now()-Er)}return ve&&console.timeEnd("total time"),this},qr.prototype.getClusters=function(Y,ce){var ve=((Y[0]+180)%360+360)%360-180,B=Math.max(-90,Math.min(90,Y[1])),ee=Y[2]===180?180:((Y[2]+180)%360+360)%360-180,pe=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ve=-180,ee=180;else if(ve>ee){var Ae=this.getClusters([ve,B,180,pe],ce),oe=this.getClusters([-180,B,ee,pe],ce);return Ae.concat(oe)}for(var _e=this.trees[this._limitZoom(ce)],dt=[],Er=0,Kt=_e.range(Ze(ve),Oe(pe),Ze(ee),Oe(B));Er<Kt.length;Er+=1){var ir=_e.points[Kt[Er]];dt.push(ir.numPoints?he(ir):this.points[ir.index])}return dt},qr.prototype.getChildren=function(Y){var ce=this._getOriginId(Y),ve=this._getOriginZoom(Y),B="No cluster with the specified id.",ee=this.trees[ve];if(!ee)throw new Error(B);var pe=ee.points[ce];if(!pe)throw new Error(B);for(var Ae=this.options.radius/(this.options.extent*Math.pow(2,ve-1)),oe=[],_e=0,dt=ee.within(pe.x,pe.y,Ae);_e<dt.length;_e+=1){var Er=ee.points[dt[_e]];Er.parentId===Y&&oe.push(Er.numPoints?he(Er):this.points[Er.index])}if(oe.length===0)throw new Error(B);return oe},qr.prototype.getLeaves=function(Y,ce,ve){var B=[];return this._appendLeaves(B,Y,ce=ce||10,ve=ve||0,0),B},qr.prototype.getTile=function(Y,ce,ve){var B=this.trees[this._limitZoom(Y)],ee=Math.pow(2,Y),pe=this.options,Ae=pe.radius/pe.extent,oe=(ve-Ae)/ee,_e=(ve+1+Ae)/ee,dt={features:[]};return this._addTileFeatures(B.range((ce-Ae)/ee,oe,(ce+1+Ae)/ee,_e),B.points,ce,ve,ee,dt),ce===0&&this._addTileFeatures(B.range(1-Ae/ee,oe,1,_e),B.points,ee,ve,ee,dt),ce===ee-1&&this._addTileFeatures(B.range(0,oe,Ae/ee,_e),B.points,-1,ve,ee,dt),dt.features.length?dt:null},qr.prototype.getClusterExpansionZoom=function(Y){for(var ce=this._getOriginZoom(Y)-1;ce<=this.options.maxZoom;){var ve=this.getChildren(Y);if(ce++,ve.length!==1)break;Y=ve[0].properties.cluster_id}return ce},qr.prototype._appendLeaves=function(Y,ce,ve,B,ee){for(var pe=0,Ae=this.getChildren(ce);pe<Ae.length;pe+=1){var oe=Ae[pe],_e=oe.properties;if(_e&&_e.cluster?ee+_e.point_count<=B?ee+=_e.point_count:ee=this._appendLeaves(Y,_e.cluster_id,ve,B,ee):ee<B?ee++:Y.push(oe),Y.length===ve)break}return ee},qr.prototype._addTileFeatures=function(Y,ce,ve,B,ee,pe){for(var Ae=0,oe=Y;Ae<oe.length;Ae+=1){var _e=ce[oe[Ae]],dt=_e.numPoints,Er={type:1,geometry:[[Math.round(this.options.extent*(_e.x*ee-ve)),Math.round(this.options.extent*(_e.y*ee-B))]],tags:dt?Te(_e):this.points[_e.index].properties},Kt=void 0;dt?Kt=_e.id:this.options.generateId?Kt=_e.index:this.points[_e.index].id&&(Kt=this.points[_e.index].id),Kt!==void 0&&(Er.id=Kt),pe.features.push(Er)}},qr.prototype._limitZoom=function(Y){return Math.max(this.options.minZoom,Math.min(+Y,this.options.maxZoom+1))},qr.prototype._cluster=function(Y,ce){for(var ve=[],B=this.options,ee=B.reduce,pe=B.minPoints,Ae=B.radius/(B.extent*Math.pow(2,ce)),oe=0;oe<Y.length;oe++){var _e=Y[oe];if(!(_e.zoom<=ce)){_e.zoom=ce;for(var dt=this.trees[ce+1],Er=dt.within(_e.x,_e.y,Ae),Kt=_e.numPoints||1,ir=Kt,Zr=0,Bn=Er;Zr<Bn.length;Zr+=1){var Fn=dt.points[Bn[Zr]];Fn.zoom>ce&&(ir+=Fn.numPoints||1)}if(ir>=pe){for(var nr=_e.x*Kt,In=_e.y*Kt,vn=ee&&Kt>1?this._map(_e,!0):null,xn=(oe<<5)+(ce+1)+this.points.length,zi=0,Tn=Er;zi<Tn.length;zi+=1){var Di=dt.points[Tn[zi]];if(!(Di.zoom<=ce)){Di.zoom=ce;var ra=Di.numPoints||1;nr+=Di.x*ra,In+=Di.y*ra,Di.parentId=xn,ee&&(vn||(vn=this._map(_e,!0)),ee(vn,this._map(Di)))}}_e.parentId=xn,ve.push(fi(nr/ir,In/ir,xn,ir,vn))}else if(ve.push(_e),ir>1)for(var hi=0,na=Er;hi<na.length;hi+=1){var Yi=dt.points[na[hi]];Yi.zoom<=ce||(Yi.zoom=ce,ve.push(Yi))}}}return ve},qr.prototype._getOriginId=function(Y){return Y-this.points.length>>5},qr.prototype._getOriginZoom=function(Y){return(Y-this.points.length)%32},qr.prototype._map=function(Y,ce){if(Y.numPoints)return ce?Ot({},Y.properties):Y.properties;var ve=this.points[Y.index].properties,B=this.options.map(ve);return ce&&B===ve?Ot({},B):B},Or.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Or.prototype.splitTile=function(Y,ce,ve,B,ee,pe,Ae){for(var oe=[Y,ce,ve,B],_e=this.options,dt=_e.debug;oe.length;){B=oe.pop(),ve=oe.pop(),ce=oe.pop(),Y=oe.pop();var Er=1<<ce,Kt=St(ce,ve,B),ir=this.tiles[Kt];if(!ir&&(dt>1&&console.time("creation"),ir=this.tiles[Kt]=Xr(Y,ce,ve,B,_e),this.tileCoords.push({z:ce,x:ve,y:B}),dt)){dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,ve,B,ir.numFeatures,ir.numPoints,ir.numSimplified),console.timeEnd("creation"));var Zr="z"+ce;this.stats[Zr]=(this.stats[Zr]||0)+1,this.total++}if(ir.source=Y,ee){if(ce===_e.maxZoom||ce===ee)continue;var Bn=1<<ee-ce;if(ve!==Math.floor(pe/Bn)||B!==Math.floor(Ae/Bn))continue}else if(ce===_e.indexMaxZoom||ir.numPoints<=_e.indexMaxPoints)continue;if(ir.source=null,Y.length!==0){dt>1&&console.time("clipping");var Fn,nr,In,vn,xn,zi,Tn=.5*_e.buffer/_e.extent,Di=.5-Tn,ra=.5+Tn,hi=1+Tn;Fn=nr=In=vn=null,xn=J(Y,Er,ve-Tn,ve+ra,0,ir.minX,ir.maxX,_e),zi=J(Y,Er,ve+Di,ve+hi,0,ir.minX,ir.maxX,_e),Y=null,xn&&(Fn=J(xn,Er,B-Tn,B+ra,1,ir.minY,ir.maxY,_e),nr=J(xn,Er,B+Di,B+hi,1,ir.minY,ir.maxY,_e),xn=null),zi&&(In=J(zi,Er,B-Tn,B+ra,1,ir.minY,ir.maxY,_e),vn=J(zi,Er,B+Di,B+hi,1,ir.minY,ir.maxY,_e),zi=null),dt>1&&console.timeEnd("clipping"),oe.push(Fn||[],ce+1,2*ve,2*B),oe.push(nr||[],ce+1,2*ve,2*B+1),oe.push(In||[],ce+1,2*ve+1,2*B),oe.push(vn||[],ce+1,2*ve+1,2*B+1)}}},Or.prototype.getTile=function(Y,ce,ve){var B=this.options,ee=B.extent,pe=B.debug;if(Y<0||Y>24)return null;var Ae=1<<Y,oe=St(Y,ce=(ce%Ae+Ae)%Ae,ve);if(this.tiles[oe])return Je(this.tiles[oe],ee);pe>1&&console.log("drilling down to z%d-%d-%d",Y,ce,ve);for(var _e,dt=Y,Er=ce,Kt=ve;!_e&&dt>0;)dt--,Er=Math.floor(Er/2),Kt=Math.floor(Kt/2),_e=this.tiles[St(dt,Er,Kt)];return _e&&_e.source?(pe>1&&console.log("found parent tile z%d-%d-%d",dt,Er,Kt),pe>1&&console.time("drilling down"),this.splitTile(_e.source,dt,Er,Kt,Y,ce,ve),pe>1&&console.timeEnd("drilling down"),this.tiles[oe]?Je(this.tiles[oe],ee):null):null};var Ln=function(Y){function ce(ve,B,ee,pe){Y.call(this,ve,B,ee,Kn),pe&&(this.loadGeoJSON=pe)}return Y&&(ce.__proto__=Y),(ce.prototype=Object.create(Y&&Y.prototype)).constructor=ce,ce.prototype.loadData=function(ve,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=B,this._pendingLoadDataParams=ve,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ce.prototype._loadData=function(){var ve=this;if(this._pendingCallback&&this._pendingLoadDataParams){var B=this._pendingCallback,ee=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var pe=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new p.RequestPerformance(ee.request);this.loadGeoJSON(ee,function(Ae,oe){if(Ae||!oe)return B(Ae);if(typeof oe!="object")return B(new Error("Input data given to '"+ee.source+"' is not a valid GeoJSON object."));(function ir(Zr,Bn){var Fn,nr=Zr&&Zr.type;if(nr==="FeatureCollection")for(Fn=0;Fn<Zr.features.length;Fn++)ir(Zr.features[Fn],Bn);else if(nr==="GeometryCollection")for(Fn=0;Fn<Zr.geometries.length;Fn++)ir(Zr.geometries[Fn],Bn);else if(nr==="Feature")ir(Zr.geometry,Bn);else if(nr==="Polygon")Jt(Zr.coordinates,Bn);else if(nr==="MultiPolygon")for(Fn=0;Fn<Zr.coordinates.length;Fn++)Jt(Zr.coordinates[Fn],Bn);return Zr})(oe,!0);try{if(ee.filter){var _e=p.createExpression(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(_e.result==="error")throw new Error(_e.value.map(function(ir){return ir.key+": "+ir.message}).join(", "));var dt=oe.features.filter(function(ir){return _e.value.evaluate({zoom:0},ir)});oe={type:"FeatureCollection",features:dt}}ve._geoJSONIndex=ee.cluster?new qr(function(ir){var Zr=ir.superclusterOptions,Bn=ir.clusterProperties;if(!Bn||!Zr)return Zr;for(var Fn={},nr={},In={accumulated:null,zoom:0},vn={properties:null},xn=Object.keys(Bn),zi=0,Tn=xn;zi<Tn.length;zi+=1){var Di=Tn[zi],ra=Bn[Di],hi=ra[0],na=p.createExpression(ra[1]),Yi=p.createExpression(typeof hi=="string"?[hi,["accumulated"],["get",Di]]:hi);Fn[Di]=na.value,nr[Di]=Yi.value}return Zr.map=function(Ii){vn.properties=Ii;for(var ya={},Fa=0,Ki=xn;Fa<Ki.length;Fa+=1){var Zi=Ki[Fa];ya[Zi]=Fn[Zi].evaluate(In,vn)}return ya},Zr.reduce=function(Ii,ya){vn.properties=ya;for(var Fa=0,Ki=xn;Fa<Ki.length;Fa+=1){var Zi=Ki[Fa];In.accumulated=Ii[Zi],Ii[Zi]=nr[Zi].evaluate(In,vn)}},Zr}(ee)).load(oe.features):function(ir,Zr){return new Or(ir,Zr)}(oe,ee.geojsonVtOptions)}catch(ir){return B(ir)}ve.loaded={};var Er={};if(pe){var Kt=pe.finish();Kt&&(Er.resourceTiming={},Er.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Kt)))}B(null,Er)})}},ce.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ce.prototype.reloadTile=function(ve,B){var ee=this.loaded;return ee&&ee[ve.uid]?Y.prototype.reloadTile.call(this,ve,B):this.loadTile(ve,B)},ce.prototype.loadGeoJSON=function(ve,B){if(ve.request)p.getJSON(ve.request,B);else{if(typeof ve.data!="string")return B(new Error("Input data given to '"+ve.source+"' is not a valid GeoJSON object."));try{return B(null,JSON.parse(ve.data))}catch(ee){return B(new Error("Input data given to '"+ve.source+"' is not a valid GeoJSON object."))}}},ce.prototype.removeSource=function(ve,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()},ce.prototype.getClusterExpansionZoom=function(ve,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(ve.clusterId))}catch(ee){B(ee)}},ce.prototype.getClusterChildren=function(ve,B){try{B(null,this._geoJSONIndex.getChildren(ve.clusterId))}catch(ee){B(ee)}},ce.prototype.getClusterLeaves=function(ve,B){try{B(null,this._geoJSONIndex.getLeaves(ve.clusterId,ve.limit,ve.offset))}catch(ee){B(ee)}},ce}(xt),zr=function(Y){var ce=this;this.self=Y,this.actor=new p.Actor(Y,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:xt,geojson:Ln},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ve,B){if(ce.workerSourceTypes[ve])throw new Error('Worker source with name "'+ve+'" already registered.');ce.workerSourceTypes[ve]=B},this.self.registerRTLTextPlugin=function(ve){if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=ve.applyArabicShaping,p.plugin.processBidirectionalText=ve.processBidirectionalText,p.plugin.processStyledBidirectionalText=ve.processStyledBidirectionalText}};return zr.prototype.setReferrer=function(Y,ce){this.referrer=ce},zr.prototype.setImages=function(Y,ce,ve){for(var B in this.availableImages[Y]=ce,this.workerSources[Y]){var ee=this.workerSources[Y][B];for(var pe in ee)ee[pe].availableImages=ce}ve()},zr.prototype.setLayers=function(Y,ce,ve){this.getLayerIndex(Y).replace(ce),ve()},zr.prototype.updateLayers=function(Y,ce,ve){this.getLayerIndex(Y).update(ce.layers,ce.removedIds),ve()},zr.prototype.loadTile=function(Y,ce,ve){this.getWorkerSource(Y,ce.type,ce.source).loadTile(ce,ve)},zr.prototype.loadDEMTile=function(Y,ce,ve){this.getDEMWorkerSource(Y,ce.source).loadTile(ce,ve)},zr.prototype.reloadTile=function(Y,ce,ve){this.getWorkerSource(Y,ce.type,ce.source).reloadTile(ce,ve)},zr.prototype.abortTile=function(Y,ce,ve){this.getWorkerSource(Y,ce.type,ce.source).abortTile(ce,ve)},zr.prototype.removeTile=function(Y,ce,ve){this.getWorkerSource(Y,ce.type,ce.source).removeTile(ce,ve)},zr.prototype.removeDEMTile=function(Y,ce){this.getDEMWorkerSource(Y,ce.source).removeTile(ce)},zr.prototype.removeSource=function(Y,ce,ve){if(this.workerSources[Y]&&this.workerSources[Y][ce.type]&&this.workerSources[Y][ce.type][ce.source]){var B=this.workerSources[Y][ce.type][ce.source];delete this.workerSources[Y][ce.type][ce.source],B.removeSource!==void 0?B.removeSource(ce,ve):ve()}},zr.prototype.loadWorkerSource=function(Y,ce,ve){try{this.self.importScripts(ce.url),ve()}catch(B){ve(B.toString())}},zr.prototype.syncRTLPluginState=function(Y,ce,ve){try{p.plugin.setState(ce);var B=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&B!=null){this.self.importScripts(B);var ee=p.plugin.isParsed();ve(ee?void 0:new Error("RTL Text Plugin failed to import scripts from "+B),ee)}}catch(pe){ve(pe.toString())}},zr.prototype.getAvailableImages=function(Y){var ce=this.availableImages[Y];return ce||(ce=[]),ce},zr.prototype.getLayerIndex=function(Y){var ce=this.layerIndexes[Y];return ce||(ce=this.layerIndexes[Y]=new ue),ce},zr.prototype.getWorkerSource=function(Y,ce,ve){var B=this;return this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][ce]||(this.workerSources[Y][ce]={}),this.workerSources[Y][ce][ve]||(this.workerSources[Y][ce][ve]=new this.workerSourceTypes[ce]({send:function(ee,pe,Ae){B.actor.send(ee,pe,Ae,Y)}},this.getLayerIndex(Y),this.getAvailableImages(Y))),this.workerSources[Y][ce][ve]},zr.prototype.getDEMWorkerSource=function(Y,ce){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][ce]||(this.demWorkerSources[Y][ce]=new $t),this.demWorkerSources[Y][ce]},zr.prototype.enforceCacheSizeLimit=function(Y,ce){p.enforceCacheSizeLimit(ce)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new zr(self)),zr}),E(["./shared"],function(p){"use strict";var me=p.createCommonjsModule(function(i){function u(g){return!o(g)}function o(g){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,R,G=new Blob([""],{type:"text/javascript"}),se=URL.createObjectURL(G);try{R=new Worker(se),T=!0}catch(Ee){T=!1}return R&&R.terminate(),URL.revokeObjectURL(se),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var R=T.getContext("2d");if(!R)return!1;var G=R.getImageData(0,0,1,1);return G&&G.width===T.width}()?(h[S=g&&g.failIfMajorPerformanceCaveat]===void 0&&(h[S]=function(T){var R=function(se){var Ee=document.createElement("canvas"),we=Object.create(u.webGLContextAttributes);return we.failIfMajorPerformanceCaveat=se,Ee.probablySupportsContext?Ee.probablySupportsContext("webgl",we)||Ee.probablySupportsContext("experimental-webgl",we):Ee.supportsContext?Ee.supportsContext("webgl",we)||Ee.supportsContext("experimental-webgl",we):Ee.getContext("webgl",we)||Ee.getContext("experimental-webgl",we)}(T);if(!R)return!1;var G=R.createShader(R.VERTEX_SHADER);return!(!G||R.isContextLost())&&(R.shaderSource(G,"void main() {}"),R.compileShader(G),R.getShaderParameter(G,R.COMPILE_STATUS)===!0)}(S)),h[S]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var S}i.exports?i.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=o);var h={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),te={create:function(i,u,o){var h=p.window.document.createElement(i);return u!==void 0&&(h.className=u),o&&o.appendChild(h),h},createNS:function(i,u){return p.window.document.createElementNS(i,u)}},ue=p.window.document&&p.window.document.documentElement.style;function ae(i){if(!ue)return i[0];for(var u=0;u<i.length;u++)if(i[u]in ue)return i[u];return i[0]}var Ne,K=ae(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);te.disableDrag=function(){ue&&K&&(Ne=ue[K],ue[K]="none")},te.enableDrag=function(){ue&&K&&(ue[K]=Ne)};var Qe=ae(["transform","WebkitTransform"]);te.setTransform=function(i,u){i.style[Qe]=u};var xt=!1;try{var Ht=Object.defineProperty({},"passive",{get:function(){xt=!0}});p.window.addEventListener("test",Ht,Ht),p.window.removeEventListener("test",Ht,Ht)}catch(i){xt=!1}te.addEventListener=function(i,u,o,h){h===void 0&&(h={}),i.addEventListener(u,o,"passive"in h&&xt?h:h.capture)},te.removeEventListener=function(i,u,o,h){h===void 0&&(h={}),i.removeEventListener(u,o,"passive"in h&&xt?h:h.capture)};var $t=function(i){i.preventDefault(),i.stopPropagation(),p.window.removeEventListener("click",$t,!0)};function Jt(i){var u=i.userImage;return!!(u&&u.render&&u.render())&&(i.data.replace(new Uint8Array(u.data.buffer)),!0)}te.suppressClick=function(){p.window.addEventListener("click",$t,!0),p.window.setTimeout(function(){p.window.removeEventListener("click",$t,!0)},0)},te.mousePos=function(i,u){var o=i.getBoundingClientRect();return new p.Point(u.clientX-o.left-i.clientLeft,u.clientY-o.top-i.clientTop)},te.touchPos=function(i,u){for(var o=i.getBoundingClientRect(),h=[],g=0;g<u.length;g++)h.push(new p.Point(u[g].clientX-o.left-i.clientLeft,u[g].clientY-o.top-i.clientTop));return h},te.mouseButton=function(i){return p.window.InstallTrigger!==void 0&&i.button===2&&i.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:i.button},te.remove=function(i){i.parentNode&&i.parentNode.removeChild(i)};var Ft=function(i){function u(){i.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(o){if(this.loaded!==o&&(this.loaded=o,o)){for(var h=0,g=this.requestors;h<g.length;h+=1){var S=g[h];this._notify(S.ids,S.callback)}this.requestors=[]}},u.prototype.getImage=function(o){return this.images[o]},u.prototype.addImage=function(o,h){this._validate(o,h)&&(this.images[o]=h)},u.prototype._validate=function(o,h){var g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchX" value'))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchY" value'))),g=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error('Image "'+o+'" has invalid "content" value'))),g=!1),g},u.prototype._validateStretch=function(o,h){if(!o)return!0;for(var g=0,S=0,T=o;S<T.length;S+=1){var R=T[S];if(R[0]<g||R[1]<R[0]||h<R[1])return!1;g=R[1]}return!0},u.prototype._validateContent=function(o,h){return!(o&&(o.length!==4||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))},u.prototype.updateImage=function(o,h){h.version=this.images[o].version+1,this.images[o]=h,this.updatedImages[o]=!0},u.prototype.removeImage=function(o){var h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(o,h){var g=!0;if(!this.isLoaded())for(var S=0,T=o;S<T.length;S+=1)this.images[T[S]]||(g=!1);this.isLoaded()||g?this._notify(o,h):this.requestors.push({ids:o,callback:h})},u.prototype._notify=function(o,h){for(var g={},S=0,T=o;S<T.length;S+=1){var R=T[S];this.images[R]||this.fire(new p.Event("styleimagemissing",{id:R}));var G=this.images[R];G?g[R]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:Boolean(G.userImage&&G.userImage.render)}:p.warnOnce('Image "'+R+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,g)},u.prototype.getPixelSize=function(){var o=this.atlasImage;return{width:o.width,height:o.height}},u.prototype.getPattern=function(o){var h=this.patterns[o],g=this.getImage(o);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{var S={w:g.data.width+2,h:g.data.height+2,x:0,y:0},T=new p.ImagePosition(S,g);this.patterns[o]={bin:S,position:T}}return this._updatePatternAtlas(),this.patterns[o].position},u.prototype.bind=function(o){var h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var o=[];for(var h in this.patterns)o.push(this.patterns[h].bin);var g=p.potpack(o),S=g.w,T=g.h,R=this.atlasImage;for(var G in R.resize({width:S||1,height:T||1}),this.patterns){var se=this.patterns[G].bin,Ee=se.x+1,we=se.y+1,Pe=this.images[G].data,Ye=Pe.width,We=Pe.height;p.RGBAImage.copy(Pe,R,{x:0,y:0},{x:Ee,y:we},{width:Ye,height:We}),p.RGBAImage.copy(Pe,R,{x:0,y:We-1},{x:Ee,y:we-1},{width:Ye,height:1}),p.RGBAImage.copy(Pe,R,{x:0,y:0},{x:Ee,y:we+We},{width:Ye,height:1}),p.RGBAImage.copy(Pe,R,{x:Ye-1,y:0},{x:Ee-1,y:we},{width:1,height:We}),p.RGBAImage.copy(Pe,R,{x:0,y:0},{x:Ee+Ye,y:we},{width:1,height:We})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(o){for(var h=0,g=o;h<g.length;h+=1){var S=g[h];if(!this.callbackDispatchedThisFrame[S]){this.callbackDispatchedThisFrame[S]=!0;var T=this.images[S];Jt(T)&&this.updateImage(S,T)}}},u}(p.Evented),Gt=bt,At=bt,Et=1e20;function bt(i,u,o,h,g,S){this.fontSize=i||24,this.buffer=u===void 0?3:u,this.cutoff=h||.25,this.fontFamily=g||"sans-serif",this.fontWeight=S||"normal",this.radius=o||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function er(i,u,o,h,g,S,T){for(var R=0;R<u;R++){for(var G=0;G<o;G++)h[G]=i[G*u+R];for(q(h,g,S,T,o),G=0;G<o;G++)i[G*u+R]=g[G]}for(G=0;G<o;G++){for(R=0;R<u;R++)h[R]=i[G*u+R];for(q(h,g,S,T,u),R=0;R<u;R++)i[G*u+R]=Math.sqrt(g[R])}}function q(i,u,o,h,g){o[0]=0,h[0]=-Et,h[1]=+Et;for(var S=1,T=0;S<g;S++){for(var R=(i[S]+S*S-(i[o[T]]+o[T]*o[T]))/(2*S-2*o[T]);R<=h[T];)T--,R=(i[S]+S*S-(i[o[T]]+o[T]*o[T]))/(2*S-2*o[T]);o[++T]=S,h[T]=R,h[T+1]=+Et}for(S=0,T=0;S<g;S++){for(;h[T+1]<S;)T++;u[S]=(S-o[T])*(S-o[T])+i[o[T]]}}bt.prototype.draw=function(i){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(i,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),o=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var g=u.data[4*h+3]/255;this.gridOuter[h]=g===1?0:g===0?Et:Math.pow(Math.max(0,.5-g),2),this.gridInner[h]=g===1?Et:g===0?0:Math.pow(Math.max(0,g-.5),2)}for(er(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),er(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)o[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return o},Gt.default=At;var Bt=function(i,u){this.requestManager=i,this.localIdeographFontFamily=u,this.entries={}};Bt.prototype.setURL=function(i){this.url=i},Bt.prototype.getGlyphs=function(i,u){var o=this,h=[];for(var g in i)for(var S=0,T=i[g];S<T.length;S+=1)h.push({stack:g,id:T[S]});p.asyncAll(h,function(R,G){var se=R.stack,Ee=R.id,we=o.entries[se];we||(we=o.entries[se]={glyphs:{},requests:{},ranges:{}});var Pe=we.glyphs[Ee];if(Pe===void 0){if(Pe=o._tinySDF(we,se,Ee))return we.glyphs[Ee]=Pe,void G(null,{stack:se,id:Ee,glyph:Pe});var Ye=Math.floor(Ee/256);if(256*Ye>65535)G(new Error("glyphs > 65535 not supported"));else if(we.ranges[Ye])G(null,{stack:se,id:Ee,glyph:Pe});else{var We=we.requests[Ye];We||(We=we.requests[Ye]=[],Bt.loadGlyphRange(se,Ye,o.url,o.requestManager,function(ut,Ue){if(Ue){for(var at in Ue)o._doesCharSupportLocalGlyph(+at)||(we.glyphs[+at]=Ue[+at]);we.ranges[Ye]=!0}for(var wt=0,Xt=We;wt<Xt.length;wt+=1)(0,Xt[wt])(ut,Ue);delete we.requests[Ye]})),We.push(function(ut,Ue){ut?G(ut):Ue&&G(null,{stack:se,id:Ee,glyph:Ue[Ee]||null})})}}else G(null,{stack:se,id:Ee,glyph:Pe})},function(R,G){if(R)u(R);else if(G){for(var se={},Ee=0,we=G;Ee<we.length;Ee+=1){var Pe=we[Ee],Ye=Pe.stack,We=Pe.id,ut=Pe.glyph;(se[Ye]||(se[Ye]={}))[We]=ut&&{id:ut.id,bitmap:ut.bitmap.clone(),metrics:ut.metrics}}u(null,se)}})},Bt.prototype._doesCharSupportLocalGlyph=function(i){return!!this.localIdeographFontFamily&&(p.isChar["CJK Unified Ideographs"](i)||p.isChar["Hangul Syllables"](i)||p.isChar.Hiragana(i)||p.isChar.Katakana(i))},Bt.prototype._tinySDF=function(i,u,o){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(o)){var g=i.tinySDF;if(!g){var S="400";/bold/i.test(u)?S="900":/medium/i.test(u)?S="500":/light/i.test(u)&&(S="200"),g=i.tinySDF=new Bt.TinySDF(24,3,8,.25,h,S)}return{id:o,bitmap:new p.AlphaImage({width:30,height:30},g.draw(String.fromCharCode(o))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Bt.loadGlyphRange=function(i,u,o,h,g){var S=256*u,T=S+255,R=h.transformRequest(h.normalizeGlyphsURL(o).replace("{fontstack}",i).replace("{range}",S+"-"+T),p.ResourceType.Glyphs);p.getArrayBuffer(R,function(G,se){if(G)g(G);else if(se){for(var Ee={},we=0,Pe=p.parseGlyphPBF(se);we<Pe.length;we+=1){var Ye=Pe[we];Ee[Ye.id]=Ye}g(null,Ee)}})},Bt.TinySDF=Gt;var et=function(){this.specification=p.styleSpec.light.position};et.prototype.possiblyEvaluate=function(i,u){return p.sphericalToCartesian(i.expression.evaluate(u))},et.prototype.interpolate=function(i,u,o){return{x:p.number(i.x,u.x,o),y:p.number(i.y,u.y,o),z:p.number(i.z,u.z,o)}};var je=new p.Properties({anchor:new p.DataConstantProperty(p.styleSpec.light.anchor),position:new et,color:new p.DataConstantProperty(p.styleSpec.light.color),intensity:new p.DataConstantProperty(p.styleSpec.light.intensity)}),nt=function(i){function u(o){i.call(this),this._transitionable=new p.Transitionable(je),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(o,h){if(h===void 0&&(h={}),!this._validate(p.validateLight,o,h))for(var g in o){var S=o[g];p.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-"-transition".length),S):this._transitionable.setValue(g,S)}},u.prototype.updateTransitions=function(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(o){this.properties=this._transitioning.possiblyEvaluate(o)},u.prototype._validate=function(o,h,g){return(!g||g.validate!==!1)&&p.emitValidationErrors(this,o.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.styleSpec})))},u}(p.Evented),De=function(i,u){this.width=i,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};De.prototype.getDash=function(i,u){var o=i.join(",")+String(u);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(i,u)),this.dashEntry[o]},De.prototype.getDashRanges=function(i,u,o){var h=[],g=i.length%2==1?-i[i.length-1]*o:0,S=i[0]*o,T=!0;h.push({left:g,right:S,isDash:T,zeroLength:i[0]===0});for(var R=i[0],G=1;G<i.length;G++){var se=i[G];h.push({left:g=R*o,right:S=(R+=se)*o,isDash:T=!T,zeroLength:se===0})}return h},De.prototype.addRoundDash=function(i,u,o){for(var h=u/2,g=-o;g<=o;g++)for(var S=this.width*(this.nextRow+o+g),T=0,R=i[T],G=0;G<this.width;G++){G/R.right>1&&(R=i[++T]);var se=Math.abs(G-R.left),Ee=Math.abs(G-R.right),we=Math.min(se,Ee),Pe=void 0,Ye=g/o*(h+1);if(R.isDash){var We=h-Math.abs(Ye);Pe=Math.sqrt(we*we+We*We)}else Pe=h-Math.sqrt(we*we+Ye*Ye);this.data[S+G]=Math.max(0,Math.min(255,Pe+128))}},De.prototype.addRegularDash=function(i){for(var u=i.length-1;u>=0;--u){var o=i[u],h=i[u+1];o.zeroLength?i.splice(u,1):h&&h.isDash===o.isDash&&(h.left=o.left,i.splice(u,1))}var g=i[0],S=i[i.length-1];g.isDash===S.isDash&&(g.left=S.left-this.width,S.right=g.right+this.width);for(var T=this.width*this.nextRow,R=0,G=i[R],se=0;se<this.width;se++){se/G.right>1&&(G=i[++R]);var Ee=Math.abs(se-G.left),we=Math.abs(se-G.right),Pe=Math.min(Ee,we);this.data[T+se]=Math.max(0,Math.min(255,(G.isDash?Pe:-Pe)+128))}},De.prototype.addDash=function(i,u){var o=u?7:0,h=2*o+1;if(this.nextRow+h>this.height)return p.warnOnce("LineAtlas out of space"),null;for(var g=0,S=0;S<i.length;S++)g+=i[S];if(g!==0){var T=this.width/g,R=this.getDashRanges(i,this.width,T);u?this.addRoundDash(R,T,o):this.addRegularDash(R)}var G={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:g};return this.nextRow+=h,this.dirty=!0,G},De.prototype.bind=function(i){var u=i.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var It=function i(u,o){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=p.uniqueId();for(var h=this.workerPool.acquire(this.id),g=0;g<h.length;g++){var S=new i.Actor(h[g],o,this.id);S.name="Worker "+g,this.actors.push(S)}};function hr(i,u,o){var h=function(g,S){if(g)return o(g);if(S){var T=p.pick(p.extend(S,i),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(T.vectorLayers=S.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(R){return R.id})),T.tiles=u.canonicalizeTileset(T,i.url),o(null,T)}};return i.url?p.getJSON(u.transformRequest(u.normalizeSourceURL(i.url),p.ResourceType.Source),h):p.browser.frame(function(){return h(null,i)})}It.prototype.broadcast=function(i,u,o){p.asyncAll(this.actors,function(h,g){h.send(i,u,g)},o=o||function(){})},It.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},It.prototype.remove=function(){this.actors.forEach(function(i){i.remove()}),this.actors=[],this.workerPool.release(this.id)},It.Actor=p.Actor;var tr=function(i,u,o){this.bounds=p.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=u||0,this.maxzoom=o||24};tr.prototype.validateBounds=function(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]},tr.prototype.contains=function(i){var u=Math.pow(2,i.z),o=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*u),h=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*u),g=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*u),S=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*u);return i.x>=o&&i.x<g&&i.y>=h&&i.y<S};var j=function(i){function u(o,h,g,S){if(i.call(this),this.id=o,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=hr(this._options,this.map._requestManager,function(h,g){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new p.ErrorEvent(h)):g&&(p.extend(o,g),g.bounds&&(o.tileBounds=new tr(g.bounds,o.minzoom,o.maxzoom)),p.postTurnstileEvent(g.tiles,o.map._requestManager._customAccessToken),p.postMapLoadEvent(g.tiles,o.map._getMapId(),o.map._requestManager._skuToken,o.map._requestManager._customAccessToken),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setSourceProperty=function(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(o){var h=this;return this.setSourceProperty(function(){h._options.tiles=o}),this},u.prototype.setUrl=function(o){var h=this;return this.setSourceProperty(function(){h.url=o,h._options.url=o}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.loadTile=function(o,h){var g=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),S={request:this.map._requestManager.transformRequest(g,p.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(R,G){return delete o.request,o.aborted?h(null):R&&R.status!==404?h(R):(G&&G.resourceTiming&&(o.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&o.setExpiryData(G),o.loadVectorData(G,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}S.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",S,T.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",S,T.bind(this)))},u.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(p.Evented),ie=function(i){function u(o,h,g,S){i.call(this),this.id=o,this.dispatcher=g,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=hr(this._options,this.map._requestManager,function(h,g){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new p.ErrorEvent(h)):g&&(p.extend(o,g),g.bounds&&(o.tileBounds=new tr(g.bounds,o.minzoom,o.maxzoom)),p.postTurnstileEvent(g.tiles),p.postMapLoadEvent(g.tiles,o.map._getMapId(),o.map._requestManager._skuToken),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},u.prototype.loadTile=function(o,h){var g=this,S=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);o.request=p.getImage(this.map._requestManager.transformRequest(S,p.ResourceType.Tile),function(T,R){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(T)o.state="errored",h(T);else if(R){g.map._refreshExpiredTiles&&o.setExpiryData(R),delete R.cacheControl,delete R.expires;var G=g.map.painter.context,se=G.gl;o.texture=g.map.painter.getTileTexture(R.width),o.texture?o.texture.update(R,{useMipmap:!0}):(o.texture=new p.Texture(G,R,se.RGBA,{useMipmap:!0}),o.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE,se.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&se.texParameterf(se.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),o.state="loaded",p.cacheEntryPossiblyAdded(g.dispatcher),h(null)}})},u.prototype.abortTile=function(o,h){o.request&&(o.request.cancel(),delete o.request),h()},u.prototype.unloadTile=function(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()},u.prototype.hasTransition=function(){return!1},u}(p.Evented),Me=function(i){function u(o,h,g,S){i.call(this,o,h,g,S),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(o,h){var g=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function S(T,R){T&&(o.state="errored",h(T)),R&&(o.dem=R,o.needsHillshadePrepare=!0,o.state="loaded",h(null))}o.request=p.getImage(this.map._requestManager.transformRequest(g,p.ResourceType.Tile),function(T,R){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(T)o.state="errored",h(T);else if(R){this.map._refreshExpiredTiles&&o.setExpiryData(R),delete R.cacheControl,delete R.expires;var G=p.window.ImageBitmap&&R instanceof p.window.ImageBitmap&&p.offscreenCanvasSupported()?R:p.browser.getImageData(R,1),se={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:G,encoding:this.encoding};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",se,S.bind(this)))}}.bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)},u.prototype._getNeighboringTiles=function(o){var h=o.canonical,g=Math.pow(2,h.z),S=(h.x-1+g)%g,T=h.x===0?o.wrap-1:o.wrap,R=(h.x+1+g)%g,G=h.x+1===g?o.wrap+1:o.wrap,se={};return se[new p.OverscaledTileID(o.overscaledZ,T,h.z,S,h.y).key]={backfilled:!1},se[new p.OverscaledTileID(o.overscaledZ,G,h.z,R,h.y).key]={backfilled:!1},h.y>0&&(se[new p.OverscaledTileID(o.overscaledZ,T,h.z,S,h.y-1).key]={backfilled:!1},se[new p.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},se[new p.OverscaledTileID(o.overscaledZ,G,h.z,R,h.y-1).key]={backfilled:!1}),h.y+1<g&&(se[new p.OverscaledTileID(o.overscaledZ,T,h.z,S,h.y+1).key]={backfilled:!1},se[new p.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},se[new p.OverscaledTileID(o.overscaledZ,G,h.z,R,h.y+1).key]={backfilled:!1}),se},u.prototype.unloadTile=function(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})},u}(ie),ye=function(i){function u(o,h,g,S){i.call(this),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(S),this._data=h.data,this._options=p.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var T=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*T,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*T,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:p.EXTENT,radius:(h.clusterRadius||50)*T,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)o.fire(new p.ErrorEvent(h));else{var g={dataType:"source",sourceDataType:"metadata"};o._collectResourceTiming&&o._resourceTiming&&o._resourceTiming.length>0&&(g.resourceTiming=o._resourceTiming,o._resourceTiming=[]),o.fire(new p.Event("data",g))}})},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setData=function(o){var h=this;return this._data=o,this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new p.ErrorEvent(g));else{var S={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(S.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new p.Event("data",S))}}),this},u.prototype.getClusterExpansionZoom=function(o,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},h),this},u.prototype.getClusterChildren=function(o,h){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},h),this},u.prototype.getClusterLeaves=function(o,h,g,S){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:h,offset:g},S),this},u.prototype._updateWorkerData=function(o){var h=this;this._loaded=!1;var g=p.extend({},this.workerOptions),S=this._data;typeof S=="string"?(g.request=this.map._requestManager.transformRequest(p.browser.resolveURL(S),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(S),this.actor.send(this.type+".loadData",g,function(T,R){h._removed||R&&R.abandoned||(h._loaded=!0,R&&R.resourceTiming&&R.resourceTiming[h.id]&&(h._resourceTiming=R.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:g.source},null),o(T))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(o,h){var g=this,S=o.actor?"reloadTile":"loadTile";o.actor=this.actor,o.request=this.actor.send(S,{type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,R){return delete o.request,o.unloadVectorData(),o.aborted?h(null):T?h(T):(o.loadVectorData(R,g.map.painter,S==="reloadTile"),h(null))})},u.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0},u.prototype.unloadTile=function(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return p.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(p.Evented),it=p.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),lt=function(i){function u(o,h,g,S){i.call(this),this.id=o,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(o,h){var g=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),function(S,T){g._loaded=!0,S?g.fire(new p.ErrorEvent(S)):T&&(g.image=T,o&&(g.coordinates=o),h&&h(),g._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(o){var h=this;return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,function(){h.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setCoordinates=function(o){var h=this;this.coordinates=o;var g=o.map(p.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var R=1/0,G=1/0,se=-1/0,Ee=-1/0,we=0,Pe=T;we<Pe.length;we+=1){var Ye=Pe[we];R=Math.min(R,Ye.x),G=Math.min(G,Ye.y),se=Math.max(se,Ye.x),Ee=Math.max(Ee,Ye.y)}var We=Math.max(se-R,Ee-G),ut=Math.max(0,Math.floor(-Math.log(We)/Math.LN2)),Ue=Math.pow(2,ut);return new p.CanonicalTileID(ut,Math.floor((R+se)/2*Ue),Math.floor((G+Ee)/2*Ue))}(g),this.minzoom=this.maxzoom=this.tileID.z;var S=g.map(function(T){return h.tileID.getTilePoint(T)._round()});return this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(S[0].x,S[0].y,0,0),this._boundsArray.emplaceBack(S[1].x,S[1].y,p.EXTENT,0),this._boundsArray.emplaceBack(S[3].x,S[3].y,0,p.EXTENT),this._boundsArray.emplaceBack(S[2].x,S[2].y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var o=this.map.painter.context,h=o.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,it.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var S=this.tiles[g];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},u.prototype.loadTile=function(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(p.Evented),Lt=function(i){function u(o,h,g,S){i.call(this,o,h,g,S),this.roundZoom=!0,this.type="video",this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1;var h=this.options;this.urls=[];for(var g=0,S=h.urls;g<S.length;g+=1)this.urls.push(this.map._requestManager.transformRequest(S[g],p.ResourceType.Source).url);p.getVideo(this.urls,function(T,R){o._loaded=!0,T?o.fire(new p.ErrorEvent(T)):R&&(o.video=R,o.video.loop=!0,o.video.addEventListener("playing",function(){o.map.triggerRepaint()}),o.map&&o.video.play(),o._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(o){if(this.video){var h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=o}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var o=this.map.painter.context,h=o.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,it.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var S=this.tiles[g];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(lt),Pt=function(i){function u(o,h,g,S){i.call(this,o,h,g,S),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(R){return typeof R!="number"})})||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+o,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,g=h.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,it.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(h,this.canvas,g.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[S];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var o=0,h=[this.canvas.width,this.canvas.height];o<h.length;o+=1){var g=h[o];if(isNaN(g)||g<=0)return!0}return!1},u}(lt),Lr={vector:j,raster:ie,"raster-dem":Me,geojson:ye,video:Lt,image:lt,canvas:Pt};function cn(i,u){var o=p.identity([]);return p.translate(o,o,[1,1,0]),p.scale(o,o,[.5*i.width,.5*i.height,1]),p.multiply(o,o,i.calculatePosMatrix(u.toUnwrapped()))}function qr(i,u,o,h,g,S){var T=function(ut,Ue,at){if(ut)for(var wt=0,Xt=ut;wt<Xt.length;wt+=1){var _r=Ue[Xt[wt]];if(_r&&_r.source===at&&_r.type==="fill-extrusion")return!0}else for(var dr in Ue){var Cr=Ue[dr];if(Cr.source===at&&Cr.type==="fill-extrusion")return!0}return!1}(g&&g.layers,u,i.id),R=S.maxPitchScaleFactor(),G=i.tilesIn(h,R,T);G.sort(fi);for(var se=[],Ee=0,we=G;Ee<we.length;Ee+=1){var Pe=we[Ee];se.push({wrappedTileID:Pe.tileID.wrapped().key,queryResults:Pe.tile.queryRenderedFeatures(u,o,i._state,Pe.queryGeometry,Pe.cameraQueryGeometry,Pe.scale,g,S,R,cn(i.transform,Pe.tileID))})}var Ye=function(ut){for(var Ue={},at={},wt=0,Xt=ut;wt<Xt.length;wt+=1){var _r=Xt[wt],dr=_r.queryResults,Cr=_r.wrappedTileID,Gr=at[Cr]=at[Cr]||{};for(var pn in dr)for(var an=dr[pn],Zn=Gr[pn]=Gr[pn]||{},ui=Ue[pn]=Ue[pn]||[],di=0,dn=an;di<dn.length;di+=1){var ia=dn[di];Zn[ia.featureIndex]||(Zn[ia.featureIndex]=!0,ui.push(ia))}}return Ue}(se);for(var We in Ye)Ye[We].forEach(function(ut){var Ue=ut.feature,at=i.getFeatureState(Ue.layer["source-layer"],Ue.id);Ue.source=Ue.layer.source,Ue.layer["source-layer"]&&(Ue.sourceLayer=Ue.layer["source-layer"]),Ue.state=at});return Ye}function fi(i,u){var o=i.tileID,h=u.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}var Yt=function(i,u){this.max=i,this.onRemove=u,this.reset()};Yt.prototype.reset=function(){for(var i in this.data)for(var u=0,o=this.data[i];u<o.length;u+=1){var h=o[u];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},Yt.prototype.add=function(i,u,o){var h=this,g=i.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);var S={value:u,timeout:void 0};if(o!==void 0&&(S.timeout=setTimeout(function(){h.remove(i,S)},o)),this.data[g].push(S),this.order.push(g),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},Yt.prototype.has=function(i){return i.wrapped().key in this.data},Yt.prototype.getAndRemove=function(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null},Yt.prototype._getAndRemoveByKey=function(i){var u=this.data[i].shift();return u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),u.value},Yt.prototype.getByKey=function(i){var u=this.data[i];return u?u[0].value:null},Yt.prototype.get=function(i){return this.has(i)?this.data[i.wrapped().key][0].value:null},Yt.prototype.remove=function(i,u){if(!this.has(i))return this;var o=i.wrapped().key,h=u===void 0?0:this.data[o].indexOf(u),g=this.data[o][h];return this.data[o].splice(h,1),g.timeout&&clearTimeout(g.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(g.value),this.order.splice(this.order.indexOf(o),1),this},Yt.prototype.setMaxSize=function(i){for(this.max=i;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},Yt.prototype.filter=function(i){var u=[];for(var o in this.data)for(var h=0,g=this.data[o];h<g.length;h+=1){var S=g[h];i(S.value)||u.push(S)}for(var T=0,R=u;T<R.length;T+=1){var G=R[T];this.remove(G.value.tileID,G)}};var he=function(i,u,o){this.context=i;var h=i.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(o),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};he.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},he.prototype.updateData=function(i){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)},he.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Te={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ze=function(i,u,o,h){this.length=u.length,this.attributes=o,this.itemSize=u.bytesPerElement,this.dynamicDraw=h,this.context=i;var g=i.gl;this.buffer=g.createBuffer(),i.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};Ze.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ze.prototype.updateData=function(i){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,i.arrayBuffer)},Ze.prototype.enableAttributes=function(i,u){for(var o=0;o<this.attributes.length;o++){var h=u.attributes[this.attributes[o].name];h!==void 0&&i.enableVertexAttribArray(h)}},Ze.prototype.setVertexAttribPointers=function(i,u,o){for(var h=0;h<this.attributes.length;h++){var g=this.attributes[h],S=u.attributes[g.name];S!==void 0&&i.vertexAttribPointer(S,g.components,i[Te[g.type]],!1,this.itemSize,g.offset+this.itemSize*(o||0))}},Ze.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Oe=function(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Oe.prototype.get=function(){return this.current},Oe.prototype.set=function(i){},Oe.prototype.getDefault=function(){return this.default},Oe.prototype.setDefault=function(){this.set(this.default)};var Ot=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},u}(Oe),ar=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)},u}(Oe),ur=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)},u}(Oe),Pr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},u}(Oe),or=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)},u}(Oe),nn=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)},u}(Oe),C=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(o){var h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)},u}(Oe),V=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)},u}(Oe),Ve=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}},u}(Oe),$e=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)},u}(Oe),ct=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}},u}(Oe),Ct=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)},u}(Oe),J=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}},u}(Oe),Wt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[o.ONE,o.ZERO]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)},u}(Oe),Tr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},u}(Oe),Mr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)},u}(Oe),Ke=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}},u}(Oe),ht=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)},u}(Oe),Mt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)},u}(Oe),Nt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)},u}(Oe),br=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)},u}(Oe),Sr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},u}(Oe),Je=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}},u}(Oe),Hr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},u}(Oe),Xr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}},u}(Oe),yn=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}},u}(Oe),vr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1},u}(Oe),Or=function(i){function u(o){i.call(this,o),this.vao=o.extVertexArrayObject}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)},u}(Oe),St=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}},u}(Oe),Kn=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}},u}(Oe),Ln=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}},u}(Oe),zr=function(i){function u(o,h){i.call(this,o),this.context=o,this.parent=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(Oe),Y=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}},u}(zr),ce=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},u}(zr),ve=function(i,u,o,h){this.context=i,this.width=u,this.height=o;var g=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new Y(i,g),h&&(this.depthAttachment=new ce(i,g))};ve.prototype.destroy=function(){var i=this.context.gl,u=this.colorAttachment.get();if(u&&i.deleteTexture(u),this.depthAttachment){var o=this.depthAttachment.get();o&&i.deleteRenderbuffer(o)}i.deleteFramebuffer(this.framebuffer)};var B=function(i,u,o){this.func=i,this.mask=u,this.range=o};B.ReadOnly=!1,B.ReadWrite=!0,B.disabled=new B(519,B.ReadOnly,[0,1]);var ee=function(i,u,o,h,g,S){this.test=i,this.ref=u,this.mask=o,this.fail=h,this.depthFail=g,this.pass=S};ee.disabled=new ee({func:519,mask:0},0,0,7680,7680,7680);var pe=function(i,u,o){this.blendFunction=i,this.blendColor=u,this.mask=o};pe.disabled=new pe(pe.Replace=[1,0],p.Color.transparent,[!1,!1,!1,!1]),pe.unblended=new pe(pe.Replace,p.Color.transparent,[!0,!0,!0,!0]),pe.alphaBlended=new pe([1,771],p.Color.transparent,[!0,!0,!0,!0]);var Ae=function(i,u,o){this.enable=i,this.mode=u,this.frontFace=o};Ae.disabled=new Ae(!1,1029,2305),Ae.backCCW=new Ae(!0,1029,2305);var oe=function(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ot(this),this.clearDepth=new ar(this),this.clearStencil=new ur(this),this.colorMask=new Pr(this),this.depthMask=new or(this),this.stencilMask=new nn(this),this.stencilFunc=new C(this),this.stencilOp=new V(this),this.stencilTest=new Ve(this),this.depthRange=new $e(this),this.depthTest=new ct(this),this.depthFunc=new Ct(this),this.blend=new J(this),this.blendFunc=new Wt(this),this.blendColor=new Tr(this),this.blendEquation=new Mr(this),this.cullFace=new Ke(this),this.cullFaceSide=new ht(this),this.frontFace=new Mt(this),this.program=new Nt(this),this.activeTexture=new br(this),this.viewport=new Sr(this),this.bindFramebuffer=new Je(this),this.bindRenderbuffer=new Hr(this),this.bindTexture=new Xr(this),this.bindVertexBuffer=new yn(this),this.bindElementBuffer=new vr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Or(this),this.pixelStoreUnpack=new St(this),this.pixelStoreUnpackPremultiplyAlpha=new Kn(this),this.pixelStoreUnpackFlipY=new Ln(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)};oe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},oe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},oe.prototype.createIndexBuffer=function(i,u){return new he(this,i,u)},oe.prototype.createVertexBuffer=function(i,u,o){return new Ze(this,i,u,o)},oe.prototype.createRenderbuffer=function(i,u,o){var h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,i,u,o),this.bindRenderbuffer.set(null),g},oe.prototype.createFramebuffer=function(i,u,o){return new ve(this,i,u,o)},oe.prototype.clear=function(i){var u=i.color,o=i.depth,h=this.gl,g=0;u&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h.clear(g)},oe.prototype.setCullFace=function(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))},oe.prototype.setDepthMode=function(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)},oe.prototype.setStencilMode=function(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)},oe.prototype.setColorMode=function(i){p.deepEqual(i.blendFunction,pe.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)},oe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var _e=function(i){function u(o,h,g){var S=this;i.call(this),this.id=o,this.dispatcher=g,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(S._sourceLoaded=!0),S._sourceLoaded&&!S._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(S.reload(),S.transform&&S.update(S.transform))}),this.on("error",function(){S._sourceErrored=!0}),this._source=function(T,R,G,se){var Ee=new Lr[R.type](T,R,G,se);if(Ee.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+Ee.id);return p.bindAll(["load","abort","unload","serialize","prepare"],Ee),Ee}(o,h,g,this),this._tiles={},this._cache=new Yt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new p.SourceFeatureState}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)},u.prototype.onRemove=function(o){this._source&&this._source.onRemove&&this._source.onRemove(o)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var o in this._tiles){var h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(o,h){return this._source.loadTile(o,h)},u.prototype._unloadTile=function(o){if(this._source.unloadTile)return this._source.unloadTile(o,function(){})},u.prototype._abortTile=function(o){if(this._source.abortTile)return this._source.abortTile(o,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(o){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var g=this._tiles[h];g.upload(o),g.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return p.values(this._tiles).map(function(o){return o.tileID}).sort(dt).map(function(o){return o.key})},u.prototype.getRenderableIds=function(o){var h=this,g=[];for(var S in this._tiles)this._isIdRenderable(S,o)&&g.push(this._tiles[S]);return o?g.sort(function(T,R){var G=T.tileID,se=R.tileID,Ee=new p.Point(G.canonical.x,G.canonical.y)._rotate(h.transform.angle),we=new p.Point(se.canonical.x,se.canonical.y)._rotate(h.transform.angle);return G.overscaledZ-se.overscaledZ||we.y-Ee.y||we.x-Ee.x}).map(function(T){return T.tileID.key}):g.map(function(T){return T.tileID}).sort(dt).map(function(T){return T.key})},u.prototype.hasRenderableParent=function(o){var h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)},u.prototype._isIdRenderable=function(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var o in this._cache.reset(),this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")},u.prototype._reloadTile=function(o,h){var g=this._tiles[o];g&&(g.state!=="loading"&&(g.state=h),this._loadTile(g,this._tileLoaded.bind(this,g,o,h)))},u.prototype._tileLoaded=function(o,h,g,S){if(S)return o.state="errored",void(S.status!==404?this._source.fire(new p.ErrorEvent(S,{tile:o})):this.update(this.transform));o.timeAdded=p.browser.now(),g==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new p.Event("data",{dataType:"source",tile:o,coord:o.tileID}))},u.prototype._backfillDEM=function(o){for(var h=this.getRenderableIds(),g=0;g<h.length;g++){var S=h[g];if(o.neighboringTiles&&o.neighboringTiles[S]){var T=this.getTileByID(S);R(o,T),R(T,o)}}function R(G,se){G.needsHillshadePrepare=!0;var Ee=se.tileID.canonical.x-G.tileID.canonical.x,we=se.tileID.canonical.y-G.tileID.canonical.y,Pe=Math.pow(2,G.tileID.canonical.z),Ye=se.tileID.key;Ee===0&&we===0||Math.abs(we)>1||(Math.abs(Ee)>1&&(Math.abs(Ee+Pe)===1?Ee+=Pe:Math.abs(Ee-Pe)===1&&(Ee-=Pe)),se.dem&&G.dem&&(G.dem.backfillBorder(se.dem,Ee,we),G.neighboringTiles&&G.neighboringTiles[Ye]&&(G.neighboringTiles[Ye].backfilled=!0)))}},u.prototype.getTile=function(o){return this.getTileByID(o.key)},u.prototype.getTileByID=function(o){return this._tiles[o]},u.prototype._retainLoadedChildren=function(o,h,g,S){for(var T in this._tiles){var R=this._tiles[T];if(!(S[T]||!R.hasData()||R.tileID.overscaledZ<=h||R.tileID.overscaledZ>g)){for(var G=R.tileID;R&&R.tileID.overscaledZ>h+1;){var se=R.tileID.scaledTo(R.tileID.overscaledZ-1);(R=this._tiles[se.key])&&R.hasData()&&(G=se)}for(var Ee=G;Ee.overscaledZ>h;)if(o[(Ee=Ee.scaledTo(Ee.overscaledZ-1)).key]){S[G.key]=G;break}}}},u.prototype.findLoadedParent=function(o,h){if(o.key in this._loadedParentTiles){var g=this._loadedParentTiles[o.key];return g&&g.tileID.overscaledZ>=h?g:null}for(var S=o.overscaledZ-1;S>=h;S--){var T=o.scaledTo(S),R=this._getLoadedTile(T);if(R)return R}},u.prototype._getLoadedTile=function(o){var h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)},u.prototype.updateCacheSize=function(o){var h=Math.ceil(o.width/this._source.tileSize)+1,g=Math.ceil(o.height/this._source.tileSize)+1,S=Math.floor(h*g*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(T)},u.prototype.handleWrapJump=function(o){var h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){var g={};for(var S in this._tiles){var T=this._tiles[S];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+h),g[T.tileID.key]=T}for(var R in this._tiles=g,this._timers)clearTimeout(this._timers[R]),delete this._timers[R];for(var G in this._tiles)this._setTileReloadTimer(G,this._tiles[G])}},u.prototype.update=function(o){var h=this;if(this.transform=o,this._sourceLoaded&&!this._paused){var g;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?g=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Gr){return new p.OverscaledTileID(Gr.canonical.z,Gr.wrap,Gr.canonical.z,Gr.canonical.x,Gr.canonical.y)}):(g=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(g=g.filter(function(Gr){return h._source.hasTile(Gr)}))):g=[];var S=o.coveringZoomLevel(this._source),T=Math.max(S-u.maxOverzooming,this._source.minzoom),R=Math.max(S+u.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(g,S);if(Er(this._source.type)){for(var se={},Ee={},we=0,Pe=Object.keys(G);we<Pe.length;we+=1){var Ye=Pe[we],We=G[Ye],ut=this._tiles[Ye];if(ut&&!(ut.fadeEndTime&&ut.fadeEndTime<=p.browser.now())){var Ue=this.findLoadedParent(We,T);Ue&&(this._addTile(Ue.tileID),se[Ue.tileID.key]=Ue.tileID),Ee[Ye]=We}}for(var at in this._retainLoadedChildren(Ee,S,R,G),se)G[at]||(this._coveredTiles[at]=!0,G[at]=se[at])}for(var wt in G)this._tiles[wt].clearFadeHold();for(var Xt=0,_r=p.keysDifference(this._tiles,G);Xt<_r.length;Xt+=1){var dr=_r[Xt],Cr=this._tiles[dr];Cr.hasSymbolBuckets&&!Cr.holdingForFade()?Cr.setHoldDuration(this.map._fadeDuration):Cr.hasSymbolBuckets&&!Cr.symbolFadeFinished()||this._removeTile(dr)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)},u.prototype._updateRetainedTiles=function(o,h){for(var g={},S={},T=Math.max(h-u.maxOverzooming,this._source.minzoom),R=Math.max(h+u.maxUnderzooming,this._source.minzoom),G={},se=0,Ee=o;se<Ee.length;se+=1){var we=Ee[se],Pe=this._addTile(we);g[we.key]=we,Pe.hasData()||h<this._source.maxzoom&&(G[we.key]=we)}this._retainLoadedChildren(G,h,R,g);for(var Ye=0,We=o;Ye<We.length;Ye+=1){var ut=We[Ye],Ue=this._tiles[ut.key];if(!Ue.hasData()){if(h+1>this._source.maxzoom){var at=ut.children(this._source.maxzoom)[0],wt=this.getTile(at);if(wt&&wt.hasData()){g[at.key]=at;continue}}else{var Xt=ut.children(this._source.maxzoom);if(g[Xt[0].key]&&g[Xt[1].key]&&g[Xt[2].key]&&g[Xt[3].key])continue}for(var _r=Ue.wasRequested(),dr=ut.overscaledZ-1;dr>=T;--dr){var Cr=ut.scaledTo(dr);if(S[Cr.key]||(S[Cr.key]=!0,!(Ue=this.getTile(Cr))&&_r&&(Ue=this._addTile(Cr)),Ue&&(g[Cr.key]=Cr,_r=Ue.wasRequested(),Ue.hasData())))break}}}return g},u.prototype._updateLoadedParentTileCache=function(){for(var o in this._loadedParentTiles={},this._tiles){for(var h=[],g=void 0,S=this._tiles[o].tileID;S.overscaledZ>0;){if(S.key in this._loadedParentTiles){g=this._loadedParentTiles[S.key];break}h.push(S.key);var T=S.scaledTo(S.overscaledZ-1);if(g=this._getLoadedTile(T))break;S=T}for(var R=0,G=h;R<G.length;R+=1)this._loadedParentTiles[G[R]]=g}},u.prototype._addTile=function(o){var h=this._tiles[o.key];if(h)return h;(h=this._cache.getAndRemove(o))&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));var g=Boolean(h);return g||(h=new p.Tile(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,o.key,h.state))),h?(h.uses++,this._tiles[o.key]=h,g||this._source.fire(new p.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},u.prototype._setTileReloadTimer=function(o,h){var g=this;o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);var S=h.getExpiryTimeout();S&&(this._timers[o]=setTimeout(function(){g._reloadTile(o,"expired"),delete g._timers[o]},S))},u.prototype._removeTile=function(o){var h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},u.prototype.clearTiles=function(){for(var o in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(o);this._cache.reset()},u.prototype.tilesIn=function(o,h,g){var S=this,T=[],R=this.transform;if(!R)return T;for(var G=g?R.getCameraQueryGeometry(o):o,se=o.map(function(dr){return R.pointCoordinate(dr)}),Ee=G.map(function(dr){return R.pointCoordinate(dr)}),we=this.getIds(),Pe=1/0,Ye=1/0,We=-1/0,ut=-1/0,Ue=0,at=Ee;Ue<at.length;Ue+=1){var wt=at[Ue];Pe=Math.min(Pe,wt.x),Ye=Math.min(Ye,wt.y),We=Math.max(We,wt.x),ut=Math.max(ut,wt.y)}for(var Xt=function(dr){var Cr=S._tiles[we[dr]];if(!Cr.holdingForFade()){var Gr=Cr.tileID,pn=Math.pow(2,R.zoom-Cr.tileID.overscaledZ),an=h*Cr.queryPadding*p.EXTENT/Cr.tileSize/pn,Zn=[Gr.getTilePoint(new p.MercatorCoordinate(Pe,Ye)),Gr.getTilePoint(new p.MercatorCoordinate(We,ut))];if(Zn[0].x-an<p.EXTENT&&Zn[0].y-an<p.EXTENT&&Zn[1].x+an>=0&&Zn[1].y+an>=0){var ui=se.map(function(dn){return Gr.getTilePoint(dn)}),di=Ee.map(function(dn){return Gr.getTilePoint(dn)});T.push({tile:Cr,tileID:Gr,queryGeometry:ui,cameraQueryGeometry:di,scale:pn})}}},_r=0;_r<we.length;_r++)Xt(_r);return T},u.prototype.getVisibleCoordinates=function(o){for(var h=this,g=this.getRenderableIds(o).map(function(G){return h._tiles[G].tileID}),S=0,T=g;S<T.length;S+=1){var R=T[S];R.posMatrix=this.transform.calculatePosMatrix(R.toUnwrapped())}return g},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Er(this._source.type))for(var o in this._tiles){var h=this._tiles[o];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=p.browser.now())return!0}return!1},u.prototype.setFeatureState=function(o,h,g){this._state.updateState(o=o||"_geojsonTileLayer",h,g)},u.prototype.removeFeatureState=function(o,h,g){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,g)},u.prototype.getFeatureState=function(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)},u.prototype.setDependencies=function(o,h,g){var S=this._tiles[o];S&&S.setDependencies(h,g)},u.prototype.reloadTilesForDependencies=function(o,h){for(var g in this._tiles)this._tiles[g].hasDependency(o,h)&&this._reloadTile(g,"reloading");this._cache.filter(function(S){return!S.hasDependency(o,h)})},u}(p.Evented);function dt(i,u){var o=Math.abs(2*i.wrap)-+(i.wrap<0),h=Math.abs(2*u.wrap)-+(u.wrap<0);return i.overscaledZ-u.overscaledZ||h-o||u.canonical.y-i.canonical.y||u.canonical.x-i.canonical.x}function Er(i){return i==="raster"||i==="image"||i==="video"}function Kt(){return new p.window.Worker(cl.workerUrl)}_e.maxOverzooming=10,_e.maxUnderzooming=3;var ir="mapboxgl_preloaded_worker_pool",Zr=function(){this.active={}};Zr.prototype.acquire=function(i){if(!this.workers)for(this.workers=[];this.workers.length<Zr.workerCount;)this.workers.push(new Kt);return this.active[i]=!0,this.workers.slice()},Zr.prototype.release=function(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},Zr.prototype.isPreloaded=function(){return!!this.active[ir]},Zr.prototype.numActive=function(){return Object.keys(this.active).length};var Bn,Fn=Math.floor(p.browser.hardwareConcurrency/2);function nr(){return Bn||(Bn=new Zr),Bn}function In(i,u){var o={};for(var h in i)h!=="ref"&&(o[h]=i[h]);return p.refProperties.forEach(function(g){g in u&&(o[g]=u[g])}),o}function vn(i){i=i.slice();for(var u=Object.create(null),o=0;o<i.length;o++)u[i[o].id]=i[o];for(var h=0;h<i.length;h++)"ref"in i[h]&&(i[h]=In(i[h],u[i[h].ref]));return i}Zr.workerCount=Math.max(Math.min(Fn,6),1);var xn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function zi(i,u,o){o.push({command:xn.addSource,args:[i,u[i]]})}function Tn(i,u,o){u.push({command:xn.removeSource,args:[i]}),o[i]=!0}function Di(i,u,o,h){Tn(i,o,h),zi(i,u,o)}function ra(i,u,o){var h;for(h in i[o])if(i[o].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(i[o][h],u[o][h]))return!1;for(h in u[o])if(u[o].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(i[o][h],u[o][h]))return!1;return!0}function hi(i,u,o,h,g,S){var T;for(T in u=u||{},i=i||{})i.hasOwnProperty(T)&&(p.deepEqual(i[T],u[T])||o.push({command:S,args:[h,T,u[T],g]}));for(T in u)u.hasOwnProperty(T)&&!i.hasOwnProperty(T)&&(p.deepEqual(i[T],u[T])||o.push({command:S,args:[h,T,u[T],g]}))}function na(i){return i.id}function Yi(i,u){return i[u.id]=u,i}var Ii=function(i,u){this.reset(i,u)};Ii.prototype.reset=function(i,u){this.points=i||[],this._distances=[0];for(var o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Ii.prototype.lerp=function(i){if(this.points.length===1)return this.points[0];i=p.clamp(i,0,1);for(var u=1,o=this._distances[u],h=i*this.paddedLength+this.padding;o<h&&u<this._distances.length;)o=this._distances[++u];var g=u-1,S=this._distances[g],T=o-S,R=T>0?(h-S)/T:0;return this.points[g].mult(1-R).add(this.points[u].mult(R))};var ya=function(i,u,o){var h=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(i/o),this.yCellCount=Math.ceil(u/o);for(var S=0;S<this.xCellCount*this.yCellCount;S++)h.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=u,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function Fa(i,u,o,h,g){var S=p.create();return u?(p.scale(S,S,[1/g,1/g,1]),o||p.rotateZ(S,S,h.angle)):p.multiply(S,h.labelPlaneMatrix,i),S}function Ki(i,u,o,h,g){if(u){var S=p.clone(i);return p.scale(S,S,[g,g,1]),o||p.rotateZ(S,S,-h.angle),S}return h.glCoordMatrix}function Zi(i,u){var o=[i.x,i.y,0,1];Ja(o,o,u);var h=o[3];return{point:new p.Point(o[0]/h,o[1]/h),signedDistanceFromCamera:h}}function $i(i,u){return .5+i/u*.5}function so(i,u){var o=i[0]/i[3],h=i[1]/i[3];return o>=-u[0]&&o<=u[0]&&h>=-u[1]&&h<=u[1]}function Jo(i,u,o,h,g,S,T,R){var G=h?i.textSizeData:i.iconSizeData,se=p.evaluateSizeForZoom(G,o.transform.zoom),Ee=[256/o.width*2+1,256/o.height*2+1],we=h?i.text.dynamicLayoutVertexArray:i.icon.dynamicLayoutVertexArray;we.clear();for(var Pe=i.lineVertexArray,Ye=h?i.text.placedSymbolArray:i.icon.placedSymbolArray,We=o.transform.width/o.transform.height,ut=!1,Ue=0;Ue<Ye.length;Ue++){var at=Ye.get(Ue);if(at.hidden||at.writingMode===p.WritingMode.vertical&&!ut)Qi(at.numGlyphs,we);else{ut=!1;var wt=[at.anchorX,at.anchorY,0,1];if(p.transformMat4(wt,wt,u),so(wt,Ee)){var Xt=$i(o.transform.cameraToCenterDistance,wt[3]),_r=p.evaluateSizeForFeature(G,se,at),dr=T?_r/Xt:_r*Xt,Cr=new p.Point(at.anchorX,at.anchorY),Gr=Zi(Cr,g).point,pn={},an=ou(at,dr,!1,R,u,g,S,i.glyphOffsetArray,Pe,we,Gr,Cr,pn,We);ut=an.useVertical,(an.notEnoughRoom||ut||an.needsFlipping&&ou(at,dr,!0,R,u,g,S,i.glyphOffsetArray,Pe,we,Gr,Cr,pn,We).notEnoughRoom)&&Qi(at.numGlyphs,we)}else Qi(at.numGlyphs,we)}}h?i.text.dynamicLayoutVertexBuffer.updateData(we):i.icon.dynamicLayoutVertexBuffer.updateData(we)}function za(i,u,o,h,g,S,T,R,G,se,Ee){var we=R.glyphStartIndex+R.numGlyphs,Pe=R.lineStartIndex,Ye=R.lineStartIndex+R.lineLength,We=u.getoffsetX(R.glyphStartIndex),ut=u.getoffsetX(we-1),Ue=Ji(i*We,o,h,g,S,T,R.segment,Pe,Ye,G,se,Ee);if(!Ue)return null;var at=Ji(i*ut,o,h,g,S,T,R.segment,Pe,Ye,G,se,Ee);return at?{first:Ue,last:at}:null}function qi(i,u,o,h){return i===p.WritingMode.horizontal&&Math.abs(o.y-u.y)>Math.abs(o.x-u.x)*h?{useVertical:!0}:(i===p.WritingMode.vertical?u.y<o.y:u.x>o.x)?{needsFlipping:!0}:null}function ou(i,u,o,h,g,S,T,R,G,se,Ee,we,Pe,Ye){var We,ut=u/24,Ue=i.lineOffsetX*ut,at=i.lineOffsetY*ut;if(i.numGlyphs>1){var wt=i.glyphStartIndex+i.numGlyphs,Xt=i.lineStartIndex,_r=i.lineStartIndex+i.lineLength,dr=za(ut,R,Ue,at,o,Ee,we,i,G,S,Pe);if(!dr)return{notEnoughRoom:!0};var Cr=Zi(dr.first.point,T).point,Gr=Zi(dr.last.point,T).point;if(h&&!o){var pn=qi(i.writingMode,Cr,Gr,Ye);if(pn)return pn}We=[dr.first];for(var an=i.glyphStartIndex+1;an<wt-1;an++)We.push(Ji(ut*R.getoffsetX(an),Ue,at,o,Ee,we,i.segment,Xt,_r,G,S,Pe));We.push(dr.last)}else{if(h&&!o){var Zn=Zi(we,g).point,ui=i.lineStartIndex+i.segment+1,di=new p.Point(G.getx(ui),G.gety(ui)),dn=Zi(di,g),ia=dn.signedDistanceFromCamera>0?dn.point:Cu(we,di,Zn,1,g),Hn=qi(i.writingMode,Zn,ia,Ye);if(Hn)return Hn}var bi=Ji(ut*R.getoffsetX(i.glyphStartIndex),Ue,at,o,Ee,we,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,G,S,Pe);if(!bi)return{notEnoughRoom:!0};We=[bi]}for(var Hi=0,mi=We;Hi<mi.length;Hi+=1){var Ci=mi[Hi];p.addDynamicAttributes(se,Ci.point,Ci.angle)}return{}}function Cu(i,u,o,h,g){var S=Zi(i.add(i.sub(u)._unit()),g).point,T=o.sub(S);return o.add(T._mult(h/T.mag()))}function Ji(i,u,o,h,g,S,T,R,G,se,Ee,we){var Pe=h?i-u:i+u,Ye=Pe>0?1:-1,We=0;h&&(Ye*=-1,We=Math.PI),Ye<0&&(We+=Math.PI);for(var ut=Ye>0?R+T:R+T+1,Ue=g,at=g,wt=0,Xt=0,_r=Math.abs(Pe),dr=[];wt+Xt<=_r;){if((ut+=Ye)<R||ut>=G)return null;if(at=Ue,dr.push(Ue),(Ue=we[ut])===void 0){var Cr=new p.Point(se.getx(ut),se.gety(ut)),Gr=Zi(Cr,Ee);if(Gr.signedDistanceFromCamera>0)Ue=we[ut]=Gr.point;else{var pn=ut-Ye;Ue=Cu(wt===0?S:new p.Point(se.getx(pn),se.gety(pn)),Cr,at,_r-wt+1,Ee)}}wt+=Xt,Xt=at.dist(Ue)}var an=(_r-wt)/Xt,Zn=Ue.sub(at),ui=Zn.mult(an)._add(at);ui._add(Zn._unit()._perp()._mult(o*Ye));var di=We+Math.atan2(Ue.y-at.y,Ue.x-at.x);return dr.push(ui),{point:ui,angle:di,path:dr}}ya.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ya.prototype.insert=function(i,u,o,h,g){this._forEachCell(u,o,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(u),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(g)},ya.prototype.insertCircle=function(i,u,o,h){this._forEachCell(u-h,o-h,u+h,o+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(u),this.circles.push(o),this.circles.push(h)},ya.prototype._insertBoxCell=function(i,u,o,h,g,S){this.boxCells[g].push(S)},ya.prototype._insertCircleCell=function(i,u,o,h,g,S){this.circleCells[g].push(S)},ya.prototype._query=function(i,u,o,h,g,S){if(o<0||i>this.width||h<0||u>this.height)return!g&&[];var T=[];if(i<=0&&u<=0&&this.width<=o&&this.height<=h){if(g)return!0;for(var R=0;R<this.boxKeys.length;R++)T.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(var G=0;G<this.circleKeys.length;G++){var se=this.circles[3*G],Ee=this.circles[3*G+1],we=this.circles[3*G+2];T.push({key:this.circleKeys[G],x1:se-we,y1:Ee-we,x2:se+we,y2:Ee+we})}return S?T.filter(S):T}return this._forEachCell(i,u,o,h,this._queryCell,T,{hitTest:g,seenUids:{box:{},circle:{}}},S),g?T.length>0:T},ya.prototype._queryCircle=function(i,u,o,h,g){var S=i-o,T=i+o,R=u-o,G=u+o;if(T<0||S>this.width||G<0||R>this.height)return!h&&[];var se=[];return this._forEachCell(S,R,T,G,this._queryCellCircle,se,{hitTest:h,circle:{x:i,y:u,radius:o},seenUids:{box:{},circle:{}}},g),h?se.length>0:se},ya.prototype.query=function(i,u,o,h,g){return this._query(i,u,o,h,!1,g)},ya.prototype.hitTest=function(i,u,o,h,g){return this._query(i,u,o,h,!0,g)},ya.prototype.hitTestCircle=function(i,u,o,h){return this._queryCircle(i,u,o,!0,h)},ya.prototype._queryCell=function(i,u,o,h,g,S,T,R){var G=T.seenUids,se=this.boxCells[g];if(se!==null)for(var Ee=this.bboxes,we=0,Pe=se;we<Pe.length;we+=1){var Ye=Pe[we];if(!G.box[Ye]){G.box[Ye]=!0;var We=4*Ye;if(i<=Ee[We+2]&&u<=Ee[We+3]&&o>=Ee[We+0]&&h>=Ee[We+1]&&(!R||R(this.boxKeys[Ye]))){if(T.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[Ye],x1:Ee[We],y1:Ee[We+1],x2:Ee[We+2],y2:Ee[We+3]})}}}var ut=this.circleCells[g];if(ut!==null)for(var Ue=this.circles,at=0,wt=ut;at<wt.length;at+=1){var Xt=wt[at];if(!G.circle[Xt]){G.circle[Xt]=!0;var _r=3*Xt;if(this._circleAndRectCollide(Ue[_r],Ue[_r+1],Ue[_r+2],i,u,o,h)&&(!R||R(this.circleKeys[Xt]))){if(T.hitTest)return S.push(!0),!0;var dr=Ue[_r],Cr=Ue[_r+1],Gr=Ue[_r+2];S.push({key:this.circleKeys[Xt],x1:dr-Gr,y1:Cr-Gr,x2:dr+Gr,y2:Cr+Gr})}}}},ya.prototype._queryCellCircle=function(i,u,o,h,g,S,T,R){var G=T.circle,se=T.seenUids,Ee=this.boxCells[g];if(Ee!==null)for(var we=this.bboxes,Pe=0,Ye=Ee;Pe<Ye.length;Pe+=1){var We=Ye[Pe];if(!se.box[We]){se.box[We]=!0;var ut=4*We;if(this._circleAndRectCollide(G.x,G.y,G.radius,we[ut+0],we[ut+1],we[ut+2],we[ut+3])&&(!R||R(this.boxKeys[We])))return S.push(!0),!0}}var Ue=this.circleCells[g];if(Ue!==null)for(var at=this.circles,wt=0,Xt=Ue;wt<Xt.length;wt+=1){var _r=Xt[wt];if(!se.circle[_r]){se.circle[_r]=!0;var dr=3*_r;if(this._circlesCollide(at[dr],at[dr+1],at[dr+2],G.x,G.y,G.radius)&&(!R||R(this.circleKeys[_r])))return S.push(!0),!0}}},ya.prototype._forEachCell=function(i,u,o,h,g,S,T,R){for(var G=this._convertToXCellCoord(i),se=this._convertToYCellCoord(u),Ee=this._convertToXCellCoord(o),we=this._convertToYCellCoord(h),Pe=G;Pe<=Ee;Pe++)for(var Ye=se;Ye<=we;Ye++)if(g.call(this,i,u,o,h,this.xCellCount*Ye+Pe,S,T,R))return},ya.prototype._convertToXCellCoord=function(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))},ya.prototype._convertToYCellCoord=function(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))},ya.prototype._circlesCollide=function(i,u,o,h,g,S){var T=h-i,R=g-u,G=o+S;return G*G>T*T+R*R},ya.prototype._circleAndRectCollide=function(i,u,o,h,g,S,T){var R=(S-h)/2,G=Math.abs(i-(h+R));if(G>R+o)return!1;var se=(T-g)/2,Ee=Math.abs(u-(g+se));if(Ee>se+o)return!1;if(G<=R||Ee<=se)return!0;var we=G-R,Pe=Ee-se;return we*we+Pe*Pe<=o*o};var xo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Qi(i,u){for(var o=0;o<i;o++){var h=u.length;u.resize(h+4),u.float32.set(xo,3*h)}}function Ja(i,u,o){var h=u[0],g=u[1];return i[0]=o[0]*h+o[4]*g+o[12],i[1]=o[1]*h+o[5]*g+o[13],i[3]=o[3]*h+o[7]*g+o[15],i}var Qo=function(i,u,o){u===void 0&&(u=new ya(i.width+200,i.height+200,25)),o===void 0&&(o=new ya(i.width+200,i.height+200,25)),this.transform=i,this.grid=u,this.ignoredGrid=o,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+100,this.screenBottomBoundary=i.height+100,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200};function Ea(i,u,o){return u*(p.EXTENT/(i.tileSize*Math.pow(2,o-i.tileID.overscaledZ)))}Qo.prototype.placeCollisionBox=function(i,u,o,h,g){var S=this.projectAndGetPerspectiveRatio(h,i.anchorPointX,i.anchorPointY),T=o*S.perspectiveRatio,R=i.x1*T+S.point.x,G=i.y1*T+S.point.y,se=i.x2*T+S.point.x,Ee=i.y2*T+S.point.y;return!this.isInsideGrid(R,G,se,Ee)||!u&&this.grid.hitTest(R,G,se,Ee,g)?{box:[],offscreen:!1}:{box:[R,G,se,Ee],offscreen:this.isOffscreen(R,G,se,Ee)}},Qo.prototype.placeCollisionCircles=function(i,u,o,h,g,S,T,R,G,se,Ee,we,Pe){var Ye=[],We=new p.Point(u.anchorX,u.anchorY),ut=Zi(We,S),Ue=$i(this.transform.cameraToCenterDistance,ut.signedDistanceFromCamera),at=(se?g/Ue:g*Ue)/p.ONE_EM,wt=Zi(We,T).point,Xt=za(at,h,u.lineOffsetX*at,u.lineOffsetY*at,!1,wt,We,u,o,T,{}),_r=!1,dr=!1,Cr=!0;if(Xt){for(var Gr=.5*we*Ue+Pe,pn=new p.Point(-100,-100),an=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),Zn=new Ii,ui=Xt.first,di=Xt.last,dn=[],ia=ui.path.length-1;ia>=1;ia--)dn.push(ui.path[ia]);for(var Hn=1;Hn<di.path.length;Hn++)dn.push(di.path[Hn]);var bi=2.5*Gr;if(R){var Hi=dn.map(function(li){return Zi(li,R)});dn=Hi.some(function(li){return li.signedDistanceFromCamera<=0})?[]:Hi.map(function(li){return li.point})}var mi=[];if(dn.length>0){for(var Ci=dn[0].clone(),Vi=dn[0].clone(),X=1;X<dn.length;X++)Ci.x=Math.min(Ci.x,dn[X].x),Ci.y=Math.min(Ci.y,dn[X].y),Vi.x=Math.max(Vi.x,dn[X].x),Vi.y=Math.max(Vi.y,dn[X].y);mi=Ci.x>=pn.x&&Vi.x<=an.x&&Ci.y>=pn.y&&Vi.y<=an.y?[dn]:Vi.x<pn.x||Ci.x>an.x||Vi.y<pn.y||Ci.y>an.y?[]:p.clipLine([dn],pn.x,pn.y,an.x,an.y)}for(var Q=0,D=mi;Q<D.length;Q+=1){var k;Zn.reset(D[Q],.25*Gr),k=Zn.length<=.5*Gr?1:Math.ceil(Zn.paddedLength/bi)+1;for(var le=0;le<k;le++){var Ce=le/Math.max(k-1,1),ft=Zn.lerp(Ce),Rt=ft.x+100,Tt=ft.y+100;Ye.push(Rt,Tt,Gr,0);var cr=Rt-Gr,Kr=Tt-Gr,Nn=Rt+Gr,ni=Tt+Gr;if(Cr=Cr&&this.isOffscreen(cr,Kr,Nn,ni),dr=dr||this.isInsideGrid(cr,Kr,Nn,ni),!i&&this.grid.hitTestCircle(Rt,Tt,Gr,Ee)&&(_r=!0,!G))return{circles:[],offscreen:!1,collisionDetected:_r}}}}return{circles:!G&&_r||!dr?[]:Ye,offscreen:Cr,collisionDetected:_r}},Qo.prototype.queryRenderedSymbols=function(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],o=1/0,h=1/0,g=-1/0,S=-1/0,T=0,R=i;T<R.length;T+=1){var G=R[T],se=new p.Point(G.x+100,G.y+100);o=Math.min(o,se.x),h=Math.min(h,se.y),g=Math.max(g,se.x),S=Math.max(S,se.y),u.push(se)}for(var Ee={},we={},Pe=0,Ye=this.grid.query(o,h,g,S).concat(this.ignoredGrid.query(o,h,g,S));Pe<Ye.length;Pe+=1){var We=Ye[Pe],ut=We.key;if(Ee[ut.bucketInstanceId]===void 0&&(Ee[ut.bucketInstanceId]={}),!Ee[ut.bucketInstanceId][ut.featureIndex]){var Ue=[new p.Point(We.x1,We.y1),new p.Point(We.x2,We.y1),new p.Point(We.x2,We.y2),new p.Point(We.x1,We.y2)];p.polygonIntersectsPolygon(u,Ue)&&(Ee[ut.bucketInstanceId][ut.featureIndex]=!0,we[ut.bucketInstanceId]===void 0&&(we[ut.bucketInstanceId]=[]),we[ut.bucketInstanceId].push(ut.featureIndex))}}return we},Qo.prototype.insertCollisionBox=function(i,u,o,h,g){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:h,collisionGroupID:g},i[0],i[1],i[2],i[3])},Qo.prototype.insertCollisionCircles=function(i,u,o,h,g){for(var S=u?this.ignoredGrid:this.grid,T={bucketInstanceId:o,featureIndex:h,collisionGroupID:g},R=0;R<i.length;R+=4)S.insertCircle(T,i[R],i[R+1],i[R+2])},Qo.prototype.projectAndGetPerspectiveRatio=function(i,u,o){var h=[u,o,0,1];return Ja(h,h,i),{point:new p.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},Qo.prototype.isOffscreen=function(i,u,o,h){return o<100||i>=this.screenRightBoundary||h<100||u>this.screenBottomBoundary},Qo.prototype.isInsideGrid=function(i,u,o,h){return o>=0&&i<this.gridRightBoundary&&h>=0&&u<this.gridBottomBoundary},Qo.prototype.getViewportMatrix=function(){var i=p.identity([]);return p.translate(i,i,[-100,-100,0]),i};var Do=function(i,u,o,h){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?u:-u))):h&&o?1:0,this.placed=o};Do.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var ko=function(i,u,o,h,g){this.text=new Do(i?i.text:null,u,o,g),this.icon=new Do(i?i.icon:null,u,h,g)};ko.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var ks=function(i,u,o){this.text=i,this.icon=u,this.skipFade=o},yo=function(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]},Go=function(i,u,o,h,g){this.bucketInstanceId=i,this.featureIndex=u,this.sourceLayerIndex=o,this.bucketIndex=h,this.tileID=g},Ba=function(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}};function ho(i,u,o,h,g){var S=p.getAnchorAlignment(i),T=-(S.horizontalAlign-.5)*u,R=-(S.verticalAlign-.5)*o,G=p.evaluateVariableOffset(i,h);return new p.Point(T+G[0]*g,R+G[1]*g)}function as(i,u,o,h,g,S){var T=i.x1,R=i.x2,G=i.y1,se=i.y2,Ee=i.anchorPointX,we=i.anchorPointY,Pe=new p.Point(u,o);return h&&Pe._rotate(g?S:-S),{x1:T+Pe.x,y1:G+Pe.y,x2:R+Pe.x,y2:se+Pe.y,anchorPointX:Ee,anchorPointY:we}}Ba.prototype.get=function(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){var u=++this.maxGroupID;this.collisionGroups[i]={ID:u,predicate:function(o){return o.collisionGroupID===u}}}return this.collisionGroups[i]};var Fo=function(i,u,o,h){this.transform=i.clone(),this.collisionIndex=new Qo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Ba(o),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function Se(i,u,o,h,g){i.emplaceBack(u?1:0,o?1:0,h||0,g||0),i.emplaceBack(u?1:0,o?1:0,h||0,g||0),i.emplaceBack(u?1:0,o?1:0,h||0,g||0),i.emplaceBack(u?1:0,o?1:0,h||0,g||0)}Fo.prototype.getBucketParts=function(i,u,o,h){var g=o.getBucket(u),S=o.latestFeatureIndex;if(g&&S&&u.id===g.layerIds[0]){var T=o.collisionBoxArray,R=g.layers[0].layout,G=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),se=o.tileSize/p.EXTENT,Ee=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),we=R.get("text-pitch-alignment")==="map",Pe=R.get("text-rotation-alignment")==="map",Ye=Ea(o,1,this.transform.zoom),We=Fa(Ee,we,Pe,this.transform,Ye),ut=null;if(we){var Ue=Ki(Ee,we,Pe,this.transform,Ye);ut=p.multiply([],this.transform.labelPlaneMatrix,Ue)}this.retainedQueryData[g.bucketInstanceId]=new Go(g.bucketInstanceId,S,g.sourceLayerIndex,g.index,o.tileID);var at={bucket:g,layout:R,posMatrix:Ee,textLabelPlaneMatrix:We,labelToScreenMatrix:ut,scale:G,textPixelRatio:se,holdingForFade:o.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(var wt=0,Xt=g.sortKeyRanges;wt<Xt.length;wt+=1){var _r=Xt[wt];i.push({sortKey:_r.sortKey,symbolInstanceStart:_r.symbolInstanceStart,symbolInstanceEnd:_r.symbolInstanceEnd,parameters:at})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:at})}},Fo.prototype.attemptAnchorPlacement=function(i,u,o,h,g,S,T,R,G,se,Ee,we,Pe,Ye,We){var ut,Ue=[we.textOffset0,we.textOffset1],at=ho(i,o,h,Ue,g),wt=this.collisionIndex.placeCollisionBox(as(u,at.x,at.y,S,T,this.transform.angle),Ee,R,G,se.predicate);if(!We||this.collisionIndex.placeCollisionBox(as(We,at.x,at.y,S,T,this.transform.angle),Ee,R,G,se.predicate).box.length!==0)return wt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID].text&&(ut=this.prevPlacement.variableOffsets[we.crossTileID].anchor),this.variableOffsets[we.crossTileID]={textOffset:Ue,width:o,height:h,anchor:i,textBoxScale:g,prevAnchor:ut},this.markUsedJustification(Pe,i,we,Ye),Pe.allowVerticalPlacement&&(this.markUsedOrientation(Pe,Ye,we),this.placedOrientations[we.crossTileID]=Ye),{shift:at,placedGlyphBoxes:wt}):void 0},Fo.prototype.placeLayerBucketPart=function(i,u,o){var h=this,g=i.parameters,S=g.bucket,T=g.layout,R=g.posMatrix,G=g.textLabelPlaneMatrix,se=g.labelToScreenMatrix,Ee=g.textPixelRatio,we=g.holdingForFade,Pe=g.collisionBoxArray,Ye=g.partiallyEvaluatedTextSize,We=g.collisionGroup,ut=T.get("text-optional"),Ue=T.get("icon-optional"),at=T.get("text-allow-overlap"),wt=T.get("icon-allow-overlap"),Xt=T.get("text-rotation-alignment")==="map",_r=T.get("text-pitch-alignment")==="map",dr=T.get("icon-text-fit")!=="none",Cr=T.get("symbol-z-order")==="viewport-y",Gr=at&&(wt||!S.hasIconData()||Ue),pn=wt&&(at||!S.hasTextData()||ut);!S.collisionArrays&&Pe&&S.deserializeCollisionBoxes(Pe);var an=function(Hn,bi){if(!u[Hn.crossTileID])if(we)h.placements[Hn.crossTileID]=new ks(!1,!1,!1);else{var Hi,mi=!1,Ci=!1,Vi=!0,X=null,Q={box:null,offscreen:null},D={box:null,offscreen:null},k=null,le=null,Ce=0,ft=0,Rt=0;bi.textFeatureIndex?Ce=bi.textFeatureIndex:Hn.useRuntimeCollisionCircles&&(Ce=Hn.featureIndex),bi.verticalTextFeatureIndex&&(ft=bi.verticalTextFeatureIndex);var Tt=bi.textBox;if(Tt){var cr=function(Fi){var Ia=p.WritingMode.horizontal;if(S.allowVerticalPlacement&&!Fi&&h.prevPlacement){var Ka=h.prevPlacement.placedOrientations[Hn.crossTileID];Ka&&(h.placedOrientations[Hn.crossTileID]=Ka,h.markUsedOrientation(S,Ia=Ka,Hn))}return Ia},Kr=function(Fi,Ia){if(S.allowVerticalPlacement&&Hn.numVerticalGlyphVertices>0&&bi.verticalTextBox)for(var Ka=0,Oo=S.writingModes;Ka<Oo.length&&(Oo[Ka]===p.WritingMode.vertical?(Q=Ia(),D=Q):Q=Fi(),!(Q&&Q.box&&Q.box.length));Ka+=1);else Q=Fi()};if(T.get("text-variable-anchor")){var Nn=T.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[Hn.crossTileID]){var ni=h.prevPlacement.variableOffsets[Hn.crossTileID];Nn.indexOf(ni.anchor)>0&&(Nn=Nn.filter(function(Fi){return Fi!==ni.anchor})).unshift(ni.anchor)}var li=function(Fi,Ia,Ka){for(var Oo=Fi.x2-Fi.x1,ac=Fi.y2-Fi.y1,bu=Hn.textBoxScale,Es=dr&&!wt?Ia:null,Ou={box:[],offscreen:!1},Wu=at?2*Nn.length:Nn.length,fl=0;fl<Wu;++fl){var Vl=h.attemptAnchorPlacement(Nn[fl%Nn.length],Fi,Oo,ac,bu,Xt,_r,Ee,R,We,fl>=Nn.length,Hn,S,Ka,Es);if(Vl&&(Ou=Vl.placedGlyphBoxes)&&Ou.box&&Ou.box.length){mi=!0,X=Vl.shift;break}}return Ou};Kr(function(){return li(Tt,bi.iconBox,p.WritingMode.horizontal)},function(){var Fi=bi.verticalTextBox;return S.allowVerticalPlacement&&!(Q&&Q.box&&Q.box.length)&&Hn.numVerticalGlyphVertices>0&&Fi?li(Fi,bi.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),Q&&(mi=Q.box,Vi=Q.offscreen);var Li=cr(Q&&Q.box);if(!mi&&h.prevPlacement){var Mi=h.prevPlacement.variableOffsets[Hn.crossTileID];Mi&&(h.variableOffsets[Hn.crossTileID]=Mi,h.markUsedJustification(S,Mi.anchor,Hn,Li))}}else{var aa=function(Fi,Ia){var Ka=h.collisionIndex.placeCollisionBox(Fi,at,Ee,R,We.predicate);return Ka&&Ka.box&&Ka.box.length&&(h.markUsedOrientation(S,Ia,Hn),h.placedOrientations[Hn.crossTileID]=Ia),Ka};Kr(function(){return aa(Tt,p.WritingMode.horizontal)},function(){var Fi=bi.verticalTextBox;return S.allowVerticalPlacement&&Hn.numVerticalGlyphVertices>0&&Fi?aa(Fi,p.WritingMode.vertical):{box:null,offscreen:null}}),cr(Q&&Q.box&&Q.box.length)}}if(mi=(Hi=Q)&&Hi.box&&Hi.box.length>0,Vi=Hi&&Hi.offscreen,Hn.useRuntimeCollisionCircles){var xa=S.text.placedSymbolArray.get(Hn.centerJustifiedTextSymbolIndex),Ca=p.evaluateSizeForFeature(S.textSizeData,Ye,xa),Va=T.get("text-padding");k=h.collisionIndex.placeCollisionCircles(at,xa,S.lineVertexArray,S.glyphOffsetArray,Ca,R,G,se,o,_r,We.predicate,Hn.collisionCircleDiameter,Va),mi=at||k.circles.length>0&&!k.collisionDetected,Vi=Vi&&k.offscreen}if(bi.iconFeatureIndex&&(Rt=bi.iconFeatureIndex),bi.iconBox){var Ga=function(Fi){var Ia=dr&&X?as(Fi,X.x,X.y,Xt,_r,h.transform.angle):Fi;return h.collisionIndex.placeCollisionBox(Ia,wt,Ee,R,We.predicate)};Ci=D&&D.box&&D.box.length&&bi.verticalIconBox?(le=Ga(bi.verticalIconBox)).box.length>0:(le=Ga(bi.iconBox)).box.length>0,Vi=Vi&&le.offscreen}var to=ut||Hn.numHorizontalGlyphVertices===0&&Hn.numVerticalGlyphVertices===0,ca=Ue||Hn.numIconVertices===0;if(to||ca?ca?to||(Ci=Ci&&mi):mi=Ci&&mi:Ci=mi=Ci&&mi,mi&&Hi&&Hi.box&&h.collisionIndex.insertCollisionBox(Hi.box,T.get("text-ignore-placement"),S.bucketInstanceId,D&&D.box&&ft?ft:Ce,We.ID),Ci&&le&&h.collisionIndex.insertCollisionBox(le.box,T.get("icon-ignore-placement"),S.bucketInstanceId,Rt,We.ID),k&&(mi&&h.collisionIndex.insertCollisionCircles(k.circles,T.get("text-ignore-placement"),S.bucketInstanceId,Ce,We.ID),o)){var da=S.bucketInstanceId,va=h.collisionCircleArrays[da];va===void 0&&(va=h.collisionCircleArrays[da]=new yo);for(var vo=0;vo<k.circles.length;vo+=4)va.circles.push(k.circles[vo+0]),va.circles.push(k.circles[vo+1]),va.circles.push(k.circles[vo+2]),va.circles.push(k.collisionDetected?1:0)}h.placements[Hn.crossTileID]=new ks(mi||Gr,Ci||pn,Vi||S.justReloaded),u[Hn.crossTileID]=!0}};if(Cr)for(var Zn=S.getSortedSymbolIndexes(this.transform.angle),ui=Zn.length-1;ui>=0;--ui){var di=Zn[ui];an(S.symbolInstances.get(di),S.collisionArrays[di])}else for(var dn=i.symbolInstanceStart;dn<i.symbolInstanceEnd;dn++)an(S.symbolInstances.get(dn),S.collisionArrays[dn]);if(o&&S.bucketInstanceId in this.collisionCircleArrays){var ia=this.collisionCircleArrays[S.bucketInstanceId];p.invert(ia.invProjMatrix,R),ia.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1},Fo.prototype.markUsedJustification=function(i,u,o,h){var g;g=h===p.WritingMode.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(u)];for(var S=0,T=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];S<T.length;S+=1){var R=T[S];R>=0&&(i.text.placedSymbolArray.get(R).crossTileID=g>=0&&R!==g?0:o.crossTileID)}},Fo.prototype.markUsedOrientation=function(i,u,o){for(var h=u===p.WritingMode.horizontal||u===p.WritingMode.horizontalOnly?u:0,g=u===p.WritingMode.vertical?u:0,S=0,T=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];S<T.length;S+=1)i.text.placedSymbolArray.get(T[S]).placedOrientation=h;o.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=g)},Fo.prototype.commit=function(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,o=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var h=u?u.symbolFadeChange(i):1,g=u?u.opacities:{},S=u?u.variableOffsets:{},T=u?u.placedOrientations:{};for(var R in this.placements){var G=this.placements[R],se=g[R];se?(this.opacities[R]=new ko(se,h,G.text,G.icon),o=o||G.text!==se.text.placed||G.icon!==se.icon.placed):(this.opacities[R]=new ko(null,h,G.text,G.icon,G.skipFade),o=o||G.text||G.icon)}for(var Ee in g){var we=g[Ee];if(!this.opacities[Ee]){var Pe=new ko(we,h,!1,!1);Pe.isHidden()||(this.opacities[Ee]=Pe,o=o||we.text.placed||we.icon.placed)}}for(var Ye in S)this.variableOffsets[Ye]||!this.opacities[Ye]||this.opacities[Ye].isHidden()||(this.variableOffsets[Ye]=S[Ye]);for(var We in T)this.placedOrientations[We]||!this.opacities[We]||this.opacities[We].isHidden()||(this.placedOrientations[We]=T[We]);o?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:i)},Fo.prototype.updateLayerOpacities=function(i,u){for(var o={},h=0,g=u;h<g.length;h+=1){var S=g[h],T=S.getBucket(i);T&&S.latestFeatureIndex&&i.id===T.layerIds[0]&&this.updateBucketOpacities(T,o,S.collisionBoxArray)}},Fo.prototype.updateBucketOpacities=function(i,u,o){var h=this;i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();var g=i.layers[0].layout,S=new ko(null,0,!1,!1,!0),T=g.get("text-allow-overlap"),R=g.get("icon-allow-overlap"),G=g.get("text-variable-anchor"),se=g.get("text-rotation-alignment")==="map",Ee=g.get("text-pitch-alignment")==="map",we=g.get("icon-text-fit")!=="none",Pe=new ko(null,0,T&&(R||!i.hasIconData()||g.get("icon-optional")),R&&(T||!i.hasTextData()||g.get("text-optional")),!0);!i.collisionArrays&&o&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(o);for(var Ye=function(at,wt,Xt){for(var _r=0;_r<wt/4;_r++)at.opacityVertexArray.emplaceBack(Xt)},We=function(at){var wt=i.symbolInstances.get(at),Xt=wt.numHorizontalGlyphVertices,_r=wt.numVerticalGlyphVertices,dr=wt.crossTileID,Cr=h.opacities[dr];u[dr]?Cr=S:Cr||(h.opacities[dr]=Cr=Pe),u[dr]=!0;var Gr=wt.numIconVertices>0,pn=h.placedOrientations[wt.crossTileID],an=pn===p.WritingMode.vertical,Zn=pn===p.WritingMode.horizontal||pn===p.WritingMode.horizontalOnly;if(Xt>0||_r>0){var ui=Qa(Cr.text);Ye(i.text,Xt,an?Wa:ui),Ye(i.text,_r,Zn?Wa:ui);var di=Cr.text.isHidden();[wt.rightJustifiedTextSymbolIndex,wt.centerJustifiedTextSymbolIndex,wt.leftJustifiedTextSymbolIndex].forEach(function(Q){Q>=0&&(i.text.placedSymbolArray.get(Q).hidden=di||an?1:0)}),wt.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(wt.verticalPlacedTextSymbolIndex).hidden=di||Zn?1:0);var dn=h.variableOffsets[wt.crossTileID];dn&&h.markUsedJustification(i,dn.anchor,wt,pn);var ia=h.placedOrientations[wt.crossTileID];ia&&(h.markUsedJustification(i,"left",wt,ia),h.markUsedOrientation(i,ia,wt))}if(Gr){var Hn=Qa(Cr.icon),bi=!(we&&wt.verticalPlacedIconSymbolIndex&&an);wt.placedIconSymbolIndex>=0&&(Ye(i.icon,wt.numIconVertices,bi?Hn:Wa),i.icon.placedSymbolArray.get(wt.placedIconSymbolIndex).hidden=Cr.icon.isHidden()),wt.verticalPlacedIconSymbolIndex>=0&&(Ye(i.icon,wt.numVerticalIconVertices,bi?Wa:Hn),i.icon.placedSymbolArray.get(wt.verticalPlacedIconSymbolIndex).hidden=Cr.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){var Hi=i.collisionArrays[at];if(Hi){var mi=new p.Point(0,0);if(Hi.textBox||Hi.verticalTextBox){var Ci=!0;if(G){var Vi=h.variableOffsets[dr];Vi?(mi=ho(Vi.anchor,Vi.width,Vi.height,Vi.textOffset,Vi.textBoxScale),se&&mi._rotate(Ee?h.transform.angle:-h.transform.angle)):Ci=!1}Hi.textBox&&Se(i.textCollisionBox.collisionVertexArray,Cr.text.placed,!Ci||an,mi.x,mi.y),Hi.verticalTextBox&&Se(i.textCollisionBox.collisionVertexArray,Cr.text.placed,!Ci||Zn,mi.x,mi.y)}var X=Boolean(!Zn&&Hi.verticalIconBox);Hi.iconBox&&Se(i.iconCollisionBox.collisionVertexArray,Cr.icon.placed,X,we?mi.x:0,we?mi.y:0),Hi.verticalIconBox&&Se(i.iconCollisionBox.collisionVertexArray,Cr.icon.placed,!X,we?mi.x:0,we?mi.y:0)}}},ut=0;ut<i.symbolInstances.length;ut++)We(ut);if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){var Ue=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=Ue.invProjMatrix,i.placementViewportMatrix=Ue.viewportMatrix,i.collisionCircleArray=Ue.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}},Fo.prototype.symbolFadeChange=function(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Fo.prototype.zoomAdjustment=function(i){return Math.max(0,(this.transform.zoom-i)/1.5)},Fo.prototype.hasTransitions=function(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration},Fo.prototype.stillRecent=function(i,u){var o=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*o>i},Fo.prototype.setStale=function(){this.stale=!0};var ke=Math.pow(2,25),yt=Math.pow(2,24),O=Math.pow(2,17),Qr=Math.pow(2,16),oi=Math.pow(2,9),Ai=Math.pow(2,8),po=Math.pow(2,1);function Qa(i){if(i.opacity===0&&!i.placed)return 0;if(i.opacity===1&&i.placed)return 4294967295;var u=i.placed?1:0,o=Math.floor(127*i.opacity);return o*ke+u*yt+o*O+u*Qr+o*oi+u*Ai+o*po+u}var Wa=0,os=function(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};os.prototype.continuePlacement=function(i,u,o,h,g){for(var S=this._bucketParts;this._currentTileIndex<i.length;)if(u.getBucketParts(S,h,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort(function(T,R){return T.sortKey-R.sortKey}));this._currentPartIndex<S.length;)if(u.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,g())return!0;return!1};var su=function(i,u,o,h,g,S,T){this.placement=new Fo(i,g,S,T),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=h,this._done=!1};su.prototype.isDone=function(){return this._done},su.prototype.continuePlacement=function(i,u,o){for(var h=this,g=p.browser.now(),S=function(){var G=p.browser.now()-g;return!h._forceFullPlacement&&G>2};this._currentPlacementIndex>=0;){var T=u[i[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=R)&&(!T.maxzoom||T.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new os(T)),this._inProgressLayer.continuePlacement(o[T.source],this.placement,this._showCollisionBoxes,T,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},su.prototype.commit=function(i){return this.placement.commit(i),this.placement};var wu=512/p.EXTENT/2,Qu=function(i,u,o){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=o;for(var h=0;h<u.length;h++){var g=u.get(h),S=g.key;this.indexedSymbolInstances[S]||(this.indexedSymbolInstances[S]=[]),this.indexedSymbolInstances[S].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,i)})}};Qu.prototype.getScaledCoordinates=function(i,u){var o=wu/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*p.EXTENT+i.anchorX)*o),y:Math.floor((u.canonical.y*p.EXTENT+i.anchorY)*o)}},Qu.prototype.findMatches=function(i,u,o){for(var h=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),g=0;g<i.length;g++){var S=i.get(g);if(!S.crossTileID){var T=this.indexedSymbolInstances[S.key];if(T)for(var R=this.getScaledCoordinates(S,u),G=0,se=T;G<se.length;G+=1){var Ee=se[G];if(Math.abs(Ee.coord.x-R.x)<=h&&Math.abs(Ee.coord.y-R.y)<=h&&!o[Ee.crossTileID]){o[Ee.crossTileID]=!0,S.crossTileID=Ee.crossTileID;break}}}}};var qo=function(){this.maxCrossTileID=0};qo.prototype.generate=function(){return++this.maxCrossTileID};var es=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};es.prototype.handleWrapJump=function(i){var u=Math.round((i-this.lng)/360);if(u!==0)for(var o in this.indexes){var h=this.indexes[o],g={};for(var S in h){var T=h[S];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+u),g[T.tileID.key]=T}this.indexes[o]=g}this.lng=i},es.prototype.addBucket=function(i,u,o){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(var h=0;h<u.symbolInstances.length;h++)u.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});var g=this.usedCrossTileIDs[i.overscaledZ];for(var S in this.indexes){var T=this.indexes[S];if(Number(S)>i.overscaledZ)for(var R in T){var G=T[R];G.tileID.isChildOf(i)&&G.findMatches(u.symbolInstances,i,g)}else{var se=T[i.scaledTo(Number(S)).key];se&&se.findMatches(u.symbolInstances,i,g)}}for(var Ee=0;Ee<u.symbolInstances.length;Ee++){var we=u.symbolInstances.get(Ee);we.crossTileID||(we.crossTileID=o.generate(),g[we.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Qu(i,u.symbolInstances,u.bucketInstanceId),!0},es.prototype.removeBucketCrossTileIDs=function(i,u){for(var o in u.indexedSymbolInstances)for(var h=0,g=u.indexedSymbolInstances[o];h<g.length;h+=1)delete this.usedCrossTileIDs[i][g[h].crossTileID]},es.prototype.removeStaleBuckets=function(i){var u=!1;for(var o in this.indexes){var h=this.indexes[o];for(var g in h)i[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,h[g]),delete h[g],u=!0)}return u};var ss=function(){this.layerIndexes={},this.crossTileIDs=new qo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ss.prototype.addLayer=function(i,u,o){var h=this.layerIndexes[i.id];h===void 0&&(h=this.layerIndexes[i.id]=new es);var g=!1,S={};h.handleWrapJump(o);for(var T=0,R=u;T<R.length;T+=1){var G=R[T],se=G.getBucket(i);se&&i.id===se.layerIds[0]&&(se.bucketInstanceId||(se.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(G.tileID,se,this.crossTileIDs)&&(g=!0),S[se.bucketInstanceId]=!0)}return h.removeStaleBuckets(S)&&(g=!0),g},ss.prototype.pruneUnusedLayers=function(i){var u={};for(var o in i.forEach(function(h){u[h]=!0}),this.layerIndexes)u[o]||delete this.layerIndexes[o]};var As=function(i,u){return p.emitValidationErrors(i,u&&u.filter(function(o){return o.identifier!=="source.canvas"}))},us=p.pick(xn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Zs=p.pick(xn,["setCenter","setZoom","setBearing","setPitch"]),Ys=function(){var i={},u=p.styleSpec.$version;for(var o in p.styleSpec.$root){var h,g=p.styleSpec.$root[o];g.required&&(h=o==="version"?u:g.type==="array"?[]:{})!=null&&(i[o]=h)}return i}(),Ts=function(i){function u(o,h){var g=this;h===void 0&&(h={}),i.call(this),this.map=o,this.dispatcher=new It(nr(),this),this.imageManager=new Ft,this.imageManager.setEventedParent(this),this.glyphManager=new Bt(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new De(256,512),this.crossTileSymbolIndex=new ss,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());var S=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(T){S.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(R,G){if(p.triggerPluginCompletionEvent(R),G&&G.every(function(Ee){return Ee}))for(var se in S.sourceCaches)S.sourceCaches[se].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var R=g.sourceCaches[T.sourceId];if(R){var G=R.getSource();if(G&&G.vectorLayerIds)for(var se in g._layers){var Ee=g._layers[se];Ee.source===G.id&&g._validateLayer(Ee)}}}})}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.loadURL=function(o,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"}));var S=typeof h.validate=="boolean"?h.validate:!p.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,h.accessToken);var T=this.map._requestManager.transformRequest(o,p.ResourceType.Style);this._request=p.getJSON(T,function(R,G){g._request=null,R?g.fire(new p.ErrorEvent(R)):G&&g._load(G,S)})},u.prototype.loadJSON=function(o,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.browser.frame(function(){g._request=null,g._load(o,h.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Ys,!1)},u.prototype._load=function(o,h){if(!h||!As(this,p.validateStyle(o))){for(var g in this._loaded=!0,this.stylesheet=o,o.sources)this.addSource(g,o.sources[g],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);var S=vn(this.stylesheet.layers);this._order=S.map(function(se){return se.id}),this._layers={},this._serializedLayers={};for(var T=0,R=S;T<R.length;T+=1){var G=R[T];(G=p.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new nt(this.stylesheet.light),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}},u.prototype._loadSprite=function(o){var h=this;this._spriteRequest=function(g,S,T){var R,G,se,Ee=p.browser.devicePixelRatio>1?"@2x":"",we=p.getJSON(S.transformRequest(S.normalizeSpriteURL(g,Ee,".json"),p.ResourceType.SpriteJSON),function(We,ut){we=null,se||(se=We,R=ut,Ye())}),Pe=p.getImage(S.transformRequest(S.normalizeSpriteURL(g,Ee,".png"),p.ResourceType.SpriteImage),function(We,ut){Pe=null,se||(se=We,G=ut,Ye())});function Ye(){if(se)T(se);else if(R&&G){var We=p.browser.getImageData(G),ut={};for(var Ue in R){var at=R[Ue],wt=at.width,Xt=at.height,_r=at.x,dr=at.y,Cr=at.sdf,Gr=at.pixelRatio,pn=at.stretchX,an=at.stretchY,Zn=at.content,ui=new p.RGBAImage({width:wt,height:Xt});p.RGBAImage.copy(We,ui,{x:_r,y:dr},{x:0,y:0},{width:wt,height:Xt}),ut[Ue]={data:ui,pixelRatio:Gr,sdf:Cr,stretchX:pn,stretchY:an,content:Zn}}T(null,ut)}}return{cancel:function(){we&&(we.cancel(),we=null),Pe&&(Pe.cancel(),Pe=null)}}}(o,this.map._requestManager,function(g,S){if(h._spriteRequest=null,g)h.fire(new p.ErrorEvent(g));else if(S)for(var T in S)h.imageManager.addImage(T,S[T]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new p.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(o){var h=this.sourceCaches[o.source];if(h){var g=o.sourceLayer;if(g){var S=h.getSource();(S.type==="geojson"||S.vectorLayerIds&&S.vectorLayerIds.indexOf(g)===-1)&&this.fire(new p.ErrorEvent(new Error('Source layer "'+g+'" does not exist on source "'+S.id+'" as specified by style layer "'+o.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(o){for(var h=[],g=0,S=o;g<S.length;g+=1){var T=this._layers[S[g]];T.type!=="custom"&&h.push(T.serialize())}return h},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(o){if(this._loaded){var h=this._changed;if(this._changed){var g=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);for(var T in(g.length||S.length)&&this._updateWorkerLayers(g,S),this._updatedSources){var R=this._updatedSources[T];R==="reload"?this._reloadSource(T):R==="clear"&&this._clearSource(T)}for(var G in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[G].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}var se={};for(var Ee in this.sourceCaches){var we=this.sourceCaches[Ee];se[Ee]=we.used,we.used=!1}for(var Pe=0,Ye=this._order;Pe<Ye.length;Pe+=1){var We=this._layers[Ye[Pe]];We.recalculate(o,this._availableImages),!We.isHidden(o.zoom)&&We.source&&(this.sourceCaches[We.source].used=!0)}for(var ut in se){var Ue=this.sourceCaches[ut];se[ut]!==Ue.used&&Ue.fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ut}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new p.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var o=Object.keys(this._changedImages);if(o.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}},u.prototype._updateWorkerLayers=function(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(o){var h=this;if(this._checkLoaded(),As(this,p.validateStyle(o)))return!1;(o=p.clone$1(o)).layers=vn(o.layers);var g=function(T,R){if(!T)return[{command:xn.setStyle,args:[R]}];var G=[];try{if(!p.deepEqual(T.version,R.version))return[{command:xn.setStyle,args:[R]}];p.deepEqual(T.center,R.center)||G.push({command:xn.setCenter,args:[R.center]}),p.deepEqual(T.zoom,R.zoom)||G.push({command:xn.setZoom,args:[R.zoom]}),p.deepEqual(T.bearing,R.bearing)||G.push({command:xn.setBearing,args:[R.bearing]}),p.deepEqual(T.pitch,R.pitch)||G.push({command:xn.setPitch,args:[R.pitch]}),p.deepEqual(T.sprite,R.sprite)||G.push({command:xn.setSprite,args:[R.sprite]}),p.deepEqual(T.glyphs,R.glyphs)||G.push({command:xn.setGlyphs,args:[R.glyphs]}),p.deepEqual(T.transition,R.transition)||G.push({command:xn.setTransition,args:[R.transition]}),p.deepEqual(T.light,R.light)||G.push({command:xn.setLight,args:[R.light]});var se={},Ee=[];(function(Pe,Ye,We,ut){var Ue;for(Ue in Ye=Ye||{},Pe=Pe||{})Pe.hasOwnProperty(Ue)&&(Ye.hasOwnProperty(Ue)||Tn(Ue,We,ut));for(Ue in Ye)Ye.hasOwnProperty(Ue)&&(Pe.hasOwnProperty(Ue)?p.deepEqual(Pe[Ue],Ye[Ue])||(Pe[Ue].type==="geojson"&&Ye[Ue].type==="geojson"&&ra(Pe,Ye,Ue)?We.push({command:xn.setGeoJSONSourceData,args:[Ue,Ye[Ue].data]}):Di(Ue,Ye,We,ut)):zi(Ue,Ye,We))})(T.sources,R.sources,Ee,se);var we=[];T.layers&&T.layers.forEach(function(Pe){se[Pe.source]?G.push({command:xn.removeLayer,args:[Pe.id]}):we.push(Pe)}),G=G.concat(Ee),function(Pe,Ye,We){Ye=Ye||[];var ut,Ue,at,wt,Xt,_r,dr,Cr=(Pe=Pe||[]).map(na),Gr=Ye.map(na),pn=Pe.reduce(Yi,{}),an=Ye.reduce(Yi,{}),Zn=Cr.slice(),ui=Object.create(null);for(ut=0,Ue=0;ut<Cr.length;ut++)an.hasOwnProperty(at=Cr[ut])?Ue++:(We.push({command:xn.removeLayer,args:[at]}),Zn.splice(Zn.indexOf(at,Ue),1));for(ut=0,Ue=0;ut<Gr.length;ut++)Zn[Zn.length-1-ut]!==(at=Gr[Gr.length-1-ut])&&(pn.hasOwnProperty(at)?(We.push({command:xn.removeLayer,args:[at]}),Zn.splice(Zn.lastIndexOf(at,Zn.length-Ue),1)):Ue++,We.push({command:xn.addLayer,args:[an[at],_r=Zn[Zn.length-ut]]}),Zn.splice(Zn.length-ut,0,at),ui[at]=!0);for(ut=0;ut<Gr.length;ut++)if(wt=pn[at=Gr[ut]],Xt=an[at],!ui[at]&&!p.deepEqual(wt,Xt))if(p.deepEqual(wt.source,Xt.source)&&p.deepEqual(wt["source-layer"],Xt["source-layer"])&&p.deepEqual(wt.type,Xt.type)){for(dr in hi(wt.layout,Xt.layout,We,at,null,xn.setLayoutProperty),hi(wt.paint,Xt.paint,We,at,null,xn.setPaintProperty),p.deepEqual(wt.filter,Xt.filter)||We.push({command:xn.setFilter,args:[at,Xt.filter]}),p.deepEqual(wt.minzoom,Xt.minzoom)&&p.deepEqual(wt.maxzoom,Xt.maxzoom)||We.push({command:xn.setLayerZoomRange,args:[at,Xt.minzoom,Xt.maxzoom]}),wt)wt.hasOwnProperty(dr)&&dr!=="layout"&&dr!=="paint"&&dr!=="filter"&&dr!=="metadata"&&dr!=="minzoom"&&dr!=="maxzoom"&&(dr.indexOf("paint.")===0?hi(wt[dr],Xt[dr],We,at,dr.slice(6),xn.setPaintProperty):p.deepEqual(wt[dr],Xt[dr])||We.push({command:xn.setLayerProperty,args:[at,dr,Xt[dr]]}));for(dr in Xt)Xt.hasOwnProperty(dr)&&!wt.hasOwnProperty(dr)&&dr!=="layout"&&dr!=="paint"&&dr!=="filter"&&dr!=="metadata"&&dr!=="minzoom"&&dr!=="maxzoom"&&(dr.indexOf("paint.")===0?hi(wt[dr],Xt[dr],We,at,dr.slice(6),xn.setPaintProperty):p.deepEqual(wt[dr],Xt[dr])||We.push({command:xn.setLayerProperty,args:[at,dr,Xt[dr]]}))}else We.push({command:xn.removeLayer,args:[at]}),_r=Zn[Zn.lastIndexOf(at)+1],We.push({command:xn.addLayer,args:[Xt,_r]})}(we,R.layers,G)}catch(Pe){console.warn("Unable to compute style diff:",Pe),G=[{command:xn.setStyle,args:[R]}]}return G}(this.serialize(),o).filter(function(T){return!(T.command in Zs)});if(g.length===0)return!1;var S=g.filter(function(T){return!(T.command in us)});if(S.length>0)throw new Error("Unimplemented: "+S.map(function(T){return T.command}).join(", ")+".");return g.forEach(function(T){T.command!=="setTransition"&&h[T.command].apply(h,T.args)}),this.stylesheet=o,!0},u.prototype.addImage=function(o,h){if(this.getImage(o))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(o,h),this._afterImageUpdated(o)},u.prototype.updateImage=function(o,h){this.imageManager.updateImage(o,h)},u.prototype.getImage=function(o){return this.imageManager.getImage(o)},u.prototype.removeImage=function(o){if(!this.getImage(o))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(o),this._afterImageUpdated(o)},u.prototype._afterImageUpdated=function(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(o,h,g){var S=this;if(g===void 0&&(g={}),this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateStyle.source,"sources."+o,h,null,g))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var T=this.sourceCaches[o]=new _e(o,h,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:S.loaded(),source:T.serialize(),sourceId:o}}),T.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===o)return this.fire(new p.ErrorEvent(new Error('Source "'+o+'" cannot be removed while layer "'+h+'" is using it.')));var g=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],g.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),g.setEventedParent(null),g.clearTiles(),g.onRemove&&g.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(o,h){this._checkLoaded(),this.sourceCaches[o].getSource().setData(h),this._changed=!0},u.prototype.getSource=function(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()},u.prototype.addLayer=function(o,h,g){g===void 0&&(g={}),this._checkLoaded();var S=o.id;if(this.getLayer(S))this.fire(new p.ErrorEvent(new Error('Layer with id "'+S+'" already exists on this map')));else{var T;if(o.type==="custom"){if(As(this,p.validateCustomStyleLayer(o)))return;T=p.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(S,o.source),o=p.clone$1(o),o=p.extend(o,{source:S})),this._validate(p.validateStyle.layer,"layers."+S,o,{arrayIndex:-1},g))return;T=p.createStyleLayer(o),this._validateLayer(T),T.setEventedParent(this,{layer:{id:S}}),this._serializedLayers[T.id]=T.serialize()}var R=h?this._order.indexOf(h):this._order.length;if(h&&R===-1)this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(R,0,S),this._layerOrderChanged=!0,this._layers[S]=T,this._removedLayers[S]&&T.source&&T.type!=="custom"){var G=this._removedLayers[S];delete this._removedLayers[S],G.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},u.prototype.moveLayer=function(o,h){if(this._checkLoaded(),this._changed=!0,this._layers[o]){if(o!==h){var g=this._order.indexOf(o);this._order.splice(g,1);var S=h?this._order.indexOf(h):this._order.length;h&&S===-1?this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(S,0,o),this._layerOrderChanged=!0)}}else this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(o){this._checkLoaded();var h=this._layers[o];if(h){h.setEventedParent(null);var g=this._order.indexOf(o);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}else this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(o){return this._layers[o]},u.prototype.hasLayer=function(o){return o in this._layers},u.prototype.setLayerZoomRange=function(o,h,g){this._checkLoaded();var S=this.getLayer(o);S?S.minzoom===h&&S.maxzoom===g||(h!=null&&(S.minzoom=h),g!=null&&(S.maxzoom=g),this._updateLayer(S)):this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(o,h,g){g===void 0&&(g={}),this._checkLoaded();var S=this.getLayer(o);if(S){if(!p.deepEqual(S.filter,h))return h==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(p.validateStyle.filter,"layers."+S.id+".filter",h,null,g)||(S.filter=p.clone$1(h),this._updateLayer(S)))}else this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(o){return p.clone$1(this.getLayer(o).filter)},u.prototype.setLayoutProperty=function(o,h,g,S){S===void 0&&(S={}),this._checkLoaded();var T=this.getLayer(o);T?p.deepEqual(T.getLayoutProperty(h),g)||(T.setLayoutProperty(h,g,S),this._updateLayer(T)):this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(o,h){var g=this.getLayer(o);if(g)return g.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(o,h,g,S){S===void 0&&(S={}),this._checkLoaded();var T=this.getLayer(o);T?p.deepEqual(T.getPaintProperty(h),g)||(T.setPaintProperty(h,g,S)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new p.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(o,h){return this.getLayer(o).getPaintProperty(h)},u.prototype.setFeatureState=function(o,h){this._checkLoaded();var g=o.source,S=o.sourceLayer,T=this.sourceCaches[g];if(T!==void 0){var R=T.getSource().type;R==="geojson"&&S?this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||S?(o.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(S,o.id,h)):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(o,h){this._checkLoaded();var g=o.source,S=this.sourceCaches[g];if(S!==void 0){var T=S.getSource().type,R=T==="vector"?o.sourceLayer:void 0;T!=="vector"||R?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):S.removeFeatureState(R,o.id,h):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(o){this._checkLoaded();var h=o.source,g=o.sourceLayer,S=this.sourceCaches[h];if(S!==void 0){if(S.getSource().type!=="vector"||g)return o.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),S.getFeatureState(g,o.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:p.mapObject(this.sourceCaches,function(o){return o.serialize()}),layers:this._serializeLayers(this._order)},function(o){return o!==void 0})},u.prototype._updateLayer=function(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(o){for(var h=this,g=function(pn){return h._layers[pn].type==="fill-extrusion"},S={},T=[],R=this._order.length-1;R>=0;R--){var G=this._order[R];if(g(G)){S[G]=R;for(var se=0,Ee=o;se<Ee.length;se+=1){var we=Ee[se][G];if(we)for(var Pe=0,Ye=we;Pe<Ye.length;Pe+=1)T.push(Ye[Pe])}}}T.sort(function(pn,an){return an.intersectionZ-pn.intersectionZ});for(var We=[],ut=this._order.length-1;ut>=0;ut--){var Ue=this._order[ut];if(g(Ue))for(var at=T.length-1;at>=0;at--){var wt=T[at].feature;if(S[wt.layer.id]<ut)break;We.push(wt),T.pop()}else for(var Xt=0,_r=o;Xt<_r.length;Xt+=1){var dr=_r[Xt][Ue];if(dr)for(var Cr=0,Gr=dr;Cr<Gr.length;Cr+=1)We.push(Gr[Cr].feature)}}return We},u.prototype.queryRenderedFeatures=function(o,h,g){h&&h.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var S={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,R=h.layers;T<R.length;T+=1){var G=R[T],se=this._layers[G];if(!se)return this.fire(new p.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];S[se.source]=!0}}var Ee=[];for(var we in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!S[we]||Ee.push(qr(this.sourceCaches[we],this._layers,this._serializedLayers,o,h,g));return this.placement&&Ee.push(function(Pe,Ye,We,ut,Ue,at,wt){for(var Xt={},_r=at.queryRenderedSymbols(ut),dr=[],Cr=0,Gr=Object.keys(_r).map(Number);Cr<Gr.length;Cr+=1)dr.push(wt[Gr[Cr]]);dr.sort(fi);for(var pn=function(){var dn=Zn[an],ia=dn.featureIndex.lookupSymbolFeatures(_r[dn.bucketInstanceId],Ye,dn.bucketIndex,dn.sourceLayerIndex,Ue.filter,Ue.layers,Ue.availableImages,Pe);for(var Hn in ia){var bi=Xt[Hn]=Xt[Hn]||[],Hi=ia[Hn];Hi.sort(function(Vi,X){var Q=dn.featureSortOrder;if(Q){var D=Q.indexOf(Vi.featureIndex);return Q.indexOf(X.featureIndex)-D}return X.featureIndex-Vi.featureIndex});for(var mi=0,Ci=Hi;mi<Ci.length;mi+=1)bi.push(Ci[mi])}},an=0,Zn=dr;an<Zn.length;an+=1)pn();var ui=function(dn){Xt[dn].forEach(function(ia){var Hn=ia.feature,bi=We[Pe[dn].source].getFeatureState(Hn.layer["source-layer"],Hn.id);Hn.source=Hn.layer.source,Hn.layer["source-layer"]&&(Hn.sourceLayer=Hn.layer["source-layer"]),Hn.state=bi})};for(var di in Xt)ui(di);return Xt}(this._layers,this._serializedLayers,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Ee)},u.prototype.querySourceFeatures=function(o,h){h&&h.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var g=this.sourceCaches[o];return g?function(S,T){for(var R=S.getRenderableIds().map(function(Ye){return S.getTileByID(Ye)}),G=[],se={},Ee=0;Ee<R.length;Ee++){var we=R[Ee],Pe=we.tileID.canonical.key;se[Pe]||(se[Pe]=!0,we.querySourceFeatures(G,T))}return G}(g,h):[]},u.prototype.addSourceType=function(o,h,g){return u.getSourceType(o)?g(new Error('A source type called "'+o+'" already exists.')):(u.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},g):g(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(o,h){h===void 0&&(h={}),this._checkLoaded();var g=this.light.getLight(),S=!1;for(var T in o)if(!p.deepEqual(o[T],g[T])){S=!0;break}if(S){var R={now:p.browser.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(R)}},u.prototype._validate=function(o,h,g,S,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&As(this,o.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:g,styleSpec:p.styleSpec},S)))},u.prototype._remove=function(){for(var o in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[o].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(o){this.sourceCaches[o].clearTiles()},u.prototype._reloadSource=function(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()},u.prototype._updateSources=function(o){for(var h in this.sourceCaches)this.sourceCaches[h].update(o)},u.prototype._generateCollisionBoxes=function(){for(var o in this.sourceCaches)this._reloadSource(o)},u.prototype._updatePlacement=function(o,h,g,S,T){T===void 0&&(T=!1);for(var R=!1,G=!1,se={},Ee=0,we=this._order;Ee<we.length;Ee+=1){var Pe=this._layers[we[Ee]];if(Pe.type==="symbol"){if(!se[Pe.source]){var Ye=this.sourceCaches[Pe.source];se[Pe.source]=Ye.getRenderableIds(!0).map(function(wt){return Ye.getTileByID(wt)}).sort(function(wt,Xt){return Xt.tileID.overscaledZ-wt.tileID.overscaledZ||(wt.tileID.isLessThan(Xt.tileID)?-1:1)})}var We=this.crossTileSymbolIndex.addLayer(Pe,se[Pe.source],o.center.lng);R=R||We}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.browser.now(),o.zoom))&&(this.pauseablePlacement=new su(o,this._order,T,h,g,S,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,se),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.browser.now()),G=!0),R&&this.pauseablePlacement.placement.setStale()),G||R)for(var ut=0,Ue=this._order;ut<Ue.length;ut+=1){var at=this._layers[Ue[ut]];at.type==="symbol"&&this.placement.updateLayerOpacities(at,se[at.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()},u.prototype.getImages=function(o,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();var S=this.sourceCaches[h.source];S&&S.setDependencies(h.tileID.key,h.type,h.icons)},u.prototype.getGlyphs=function(o,h,g){this.glyphManager.getGlyphs(h.stacks,g)},u.prototype.getResource=function(o,h,g){return p.makeRequest(h,g)},u}(p.Evented);Ts.getSourceType=function(i){return Lr[i]},Ts.setSourceType=function(i,u){Lr[i]=u},Ts.registerForPluginStateChange=p.registerForPluginStateChange;var Aa=p.createLayout([{name:"a_pos",type:"Int16",components:2}]),wo=_i(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),ml=_i(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),yl=_i(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),qu=_i(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Jl=_i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),gl=_i(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Lu=_i(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Us=_i("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),_l=_i("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),m=_i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),w=_i(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),z=_i(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),I=_i(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fe=_i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Le=_i(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),pt=_i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Zt=_i(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),jt=_i(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Fr=_i(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Wr=_i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),hn=_i(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Oi=_i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Ei=_i(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),pa=_i(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Ma=_i(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),ga=_i(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function _i(i,u){var o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=u.match(/attribute ([\w]+) ([\w]+)/g),g=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=S?S.concat(g):g,R={};return{fragmentSource:i=i.replace(o,function(G,se,Ee,we,Pe){return R[Pe]=!0,se==="define"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
varying `+Ee+" "+we+" "+Pe+`;
#else
uniform `+Ee+" "+we+" u_"+Pe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Pe+`
    `+Ee+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`}),vertexSource:u=u.replace(o,function(G,se,Ee,we,Pe){var Ye=we==="float"?"vec2":"vec4",We=Pe.match(/color/)?"color":Ye;return R[Pe]?se==="define"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
uniform lowp float u_`+Pe+`_t;
attribute `+Ee+" "+Ye+" a_"+Pe+`;
varying `+Ee+" "+we+" "+Pe+`;
#else
uniform `+Ee+" "+we+" u_"+Pe+`;
#endif
`:We==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Pe+" = a_"+Pe+`;
#else
    `+Ee+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Pe+" = unpack_mix_"+We+"(a_"+Pe+", u_"+Pe+`_t);
#else
    `+Ee+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`:se==="define"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
uniform lowp float u_`+Pe+`_t;
attribute `+Ee+" "+Ye+" a_"+Pe+`;
#else
uniform `+Ee+" "+we+" u_"+Pe+`;
#endif
`:We==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Ee+" "+we+" "+Pe+" = a_"+Pe+`;
#else
    `+Ee+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Ee+" "+we+" "+Pe+" = unpack_mix_"+We+"(a_"+Pe+", u_"+Pe+`_t);
#else
    `+Ee+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`}),staticAttributes:h,staticUniforms:T}}var go=Object.freeze({__proto__:null,prelude:wo,background:ml,backgroundPattern:yl,circle:qu,clippingMask:Jl,heatmap:gl,heatmapTexture:Lu,collisionBox:Us,collisionCircle:_l,debug:m,fill:w,fillOutline:z,fillOutlinePattern:I,fillPattern:fe,fillExtrusion:Le,fillExtrusionPattern:pt,hillshadePrepare:Zt,hillshade:jt,line:Fr,lineGradient:Wr,linePattern:hn,lineSDF:Oi,raster:Ei,symbolIcon:pa,symbolSDF:Ma,symbolTextAndIcon:ga}),Ao=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Ks(i){for(var u=[],o=0;o<i.length;o++)if(i[o]!==null){var h=i[o].split(" ");u.push(h.pop())}return u}Ao.prototype.bind=function(i,u,o,h,g,S,T,R){this.context=i;for(var G=this.boundPaintVertexBuffers.length!==h.length,se=0;!G&&se<h.length;se++)this.boundPaintVertexBuffers[se]!==h[se]&&(G=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===o&&!G&&this.boundIndexBuffer===g&&this.boundVertexOffset===S&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===R?(i.bindVertexArrayOES.set(this.vao),T&&T.bind(),g&&g.dynamicDraw&&g.bind(),R&&R.bind()):this.freshBind(u,o,h,g,S,T,R)},Ao.prototype.freshBind=function(i,u,o,h,g,S,T){var R,G=i.numAttributes,se=this.context,Ee=se.gl;if(se.extVertexArrayObject)this.vao&&this.destroy(),this.vao=se.extVertexArrayObject.createVertexArrayOES(),se.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=i,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=T;else{R=se.currentNumAttributes||0;for(var we=G;we<R;we++)Ee.disableVertexAttribArray(we)}u.enableAttributes(Ee,i);for(var Pe=0,Ye=o;Pe<Ye.length;Pe+=1)Ye[Pe].enableAttributes(Ee,i);S&&S.enableAttributes(Ee,i),T&&T.enableAttributes(Ee,i),u.bind(),u.setVertexAttribPointers(Ee,i,g);for(var We=0,ut=o;We<ut.length;We+=1){var Ue=ut[We];Ue.bind(),Ue.setVertexAttribPointers(Ee,i,g)}S&&(S.bind(),S.setVertexAttribPointers(Ee,i,g)),h&&h.bind(),T&&(T.bind(),T.setVertexAttribPointers(Ee,i,g)),se.currentNumAttributes=G},Ao.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var uu=function(i,u,o,h,g,S){var T=i.gl;this.program=T.createProgram();for(var R=Ks(o.staticAttributes),G=h?h.getBinderAttributes():[],se=R.concat(G),Ee=o.staticUniforms?Ks(o.staticUniforms):[],we=h?h.getBinderUniforms():[],Pe=[],Ye=0,We=Ee.concat(we);Ye<We.length;Ye+=1){var ut=We[Ye];Pe.indexOf(ut)<0&&Pe.push(ut)}var Ue=h?h.defines():[];S&&Ue.push("#define OVERDRAW_INSPECTOR;");var at=Ue.concat(wo.fragmentSource,o.fragmentSource).join(`
`),wt=Ue.concat(wo.vertexSource,o.vertexSource).join(`
`),Xt=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Xt,at),T.compileShader(Xt),T.attachShader(this.program,Xt);var _r=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(_r,wt),T.compileShader(_r),T.attachShader(this.program,_r),this.attributes={};var dr={};this.numAttributes=se.length;for(var Cr=0;Cr<this.numAttributes;Cr++)se[Cr]&&(T.bindAttribLocation(this.program,Cr,se[Cr]),this.attributes[se[Cr]]=Cr);T.linkProgram(this.program),T.deleteShader(_r),T.deleteShader(Xt);for(var Gr=0;Gr<Pe.length;Gr++){var pn=Pe[Gr];if(pn&&!dr[pn]){var an=T.getUniformLocation(this.program,pn);an&&(dr[pn]=an)}}this.fixedUniforms=g(i,dr),this.binderUniforms=h?h.getUniforms(i,dr):[]}}};function $s(i,u,o){var h=1/Ea(o,1,u.transform.tileZoom),g=Math.pow(2,o.tileID.overscaledZ),S=o.tileSize*Math.pow(2,u.transform.tileZoom)/g,T=S*(o.tileID.canonical.x+o.tileID.wrap*g),R=S*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,i.fromScale,i.toScale],u_fade:i.t,u_pixel_coord_upper:[T>>16,R>>16],u_pixel_coord_lower:[65535&T,65535&R]}}uu.prototype.draw=function(i,u,o,h,g,S,T,R,G,se,Ee,we,Pe,Ye,We,ut){var Ue,at=i.gl;if(!this.failedToCreate){for(var wt in i.program.set(this.program),i.setDepthMode(o),i.setStencilMode(h),i.setColorMode(g),i.setCullFace(S),this.fixedUniforms)this.fixedUniforms[wt].set(T[wt]);Ye&&Ye.setUniforms(i,this.binderUniforms,we,{zoom:Pe});for(var Xt=(Ue={},Ue[at.LINES]=2,Ue[at.TRIANGLES]=3,Ue[at.LINE_STRIP]=1,Ue)[u],_r=0,dr=Ee.get();_r<dr.length;_r+=1){var Cr=dr[_r],Gr=Cr.vaos||(Cr.vaos={});(Gr[R]||(Gr[R]=new Ao)).bind(i,this,G,Ye?Ye.getPaintVertexBuffers():[],se,Cr.vertexOffset,We,ut),at.drawElements(u,Cr.primitiveLength*Xt,at.UNSIGNED_SHORT,Cr.primitiveOffset*Xt*2)}}};var Ru=function(i,u,o,h){var g=u.style.light,S=g.properties.get("position"),T=[S.x,S.y,S.z],R=p.create$1();g.properties.get("anchor")==="viewport"&&p.fromRotation(R,-u.transform.angle),p.transformMat3(T,T,R);var G=g.properties.get("color");return{u_matrix:i,u_lightpos:T,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+o,u_opacity:h}},Ho=function(i,u,o,h,g,S,T){return p.extend(Ru(i,u,o,h),$s(S,u,T),{u_height_factor:-Math.pow(2,g.overscaledZ)/T.tileSize/8})},_s=function(i){return{u_matrix:i}},uo=function(i,u,o,h){return p.extend(_s(i),$s(o,u,h))},La=function(i,u){return{u_matrix:i,u_world:u}},Js=function(i,u,o,h,g){return p.extend(uo(i,u,o,h),{u_world:g})},xl=function(i,u,o,h){var g,S,T=i.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var R=Ea(o,1,T.zoom);g=!0,S=[R,R]}else g=!1,S=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:i.translatePosMatrix(u.posMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:p.browser.devicePixelRatio,u_extrude_scale:S}},xs=function(i,u,o){var h=Ea(o,1,u.zoom),g=Math.pow(2,u.zoom-o.tileID.overscaledZ),S=o.tileID.overscaleFactor();return{u_matrix:i,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[u.pixelsToGLUnits[0]/(h*g),u.pixelsToGLUnits[1]/(h*g)],u_overscale_factor:S}},kl=function(i,u,o){return{u_matrix:i,u_inv_matrix:u,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}},Qs=function(i,u,o){return o===void 0&&(o=1),{u_matrix:i,u_color:u,u_overlay:0,u_overlay_scale:o}},qs=function(i){return{u_matrix:i}},mc=function(i,u,o,h){return{u_matrix:i,u_extrude_scale:Ea(u,1,o),u_intensity:h}},Du=function(i,u,o){var h=i.transform;return{u_matrix:Sl(i,u,o),u_ratio:1/Ea(u,1,h.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Ra=function(i,u,o,h){return p.extend(Du(i,u,o),{u_image:0,u_image_height:h})},bl=function(i,u,o,h){var g=i.transform,S=ku(u,g);return{u_matrix:Sl(i,u,o),u_texsize:u.imageAtlasTexture.size,u_ratio:1/Ea(u,1,g.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_image:0,u_scale:[S,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Kc=function(i,u,o,h,g){var S=i.lineAtlas,T=ku(u,i.transform),R=o.layout.get("line-cap")==="round",G=S.getDash(h.from,R),se=S.getDash(h.to,R),Ee=G.width*g.fromScale,we=se.width*g.toScale;return p.extend(Du(i,u,o),{u_patternscale_a:[T/Ee,-G.height/2],u_patternscale_b:[T/we,-se.height/2],u_sdfgamma:S.width/(256*Math.min(Ee,we)*p.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:se.y,u_mix:g.t})};function ku(i,u){return 1/Ea(i,1,u.tileZoom)}function Sl(i,u,o){return i.translatePosMatrix(u.tileID.posMatrix,u,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}var $c=function(i,u,o,h,g){return{u_matrix:i,u_tl_parent:u,u_scale_parent:o,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(T=g.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(S=g.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:el(g.paint.get("raster-hue-rotate"))};var S,T};function el(i){i*=Math.PI/180;var u=Math.sin(i),o=Math.cos(i);return[(2*o+1)/3,(-Math.sqrt(3)*u-o+1)/3,(Math.sqrt(3)*u-o+1)/3]}var Ql,Au=function(i,u,o,h,g,S,T,R,G,se){var Ee=g.transform;return{u_is_size_zoom_constant:+(i==="constant"||i==="source"),u_is_size_feature_constant:+(i==="constant"||i==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:Ee.cameraToCenterDistance,u_pitch:Ee.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:Ee.width/Ee.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:T,u_coord_matrix:R,u_is_text:+G,u_pitch_with_map:+h,u_texsize:se,u_texture:0}},tl=function(i,u,o,h,g,S,T,R,G,se,Ee){var we=g.transform;return p.extend(Au(i,u,o,h,g,S,T,R,G,se),{u_gamma_scale:h?Math.cos(we._pitch)*we.cameraToCenterDistance:1,u_device_pixel_ratio:p.browser.devicePixelRatio,u_is_halo:+Ee})},El=function(i,u,o,h,g,S,T,R,G,se){return p.extend(tl(i,u,o,h,g,S,T,R,!0,G,!0),{u_texsize_icon:se,u_texture_icon:1})},Cl=function(i,u,o){return{u_matrix:i,u_opacity:u,u_color:o}},rl=function(i,u,o,h,g,S){return p.extend(function(T,R,G,se){var Ee=G.imageManager.getPattern(T.from.toString()),we=G.imageManager.getPattern(T.to.toString()),Pe=G.imageManager.getPixelSize(),Ye=Pe.width,We=Pe.height,ut=Math.pow(2,se.tileID.overscaledZ),Ue=se.tileSize*Math.pow(2,G.transform.tileZoom)/ut,at=Ue*(se.tileID.canonical.x+se.tileID.wrap*ut),wt=Ue*se.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Ee.tl,u_pattern_br_a:Ee.br,u_pattern_tl_b:we.tl,u_pattern_br_b:we.br,u_texsize:[Ye,We],u_mix:R.t,u_pattern_size_a:Ee.displaySize,u_pattern_size_b:we.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/Ea(se,1,G.transform.tileZoom),u_pixel_coord_upper:[at>>16,wt>>16],u_pixel_coord_lower:[65535&at,65535&wt]}}(h,S,o,g),{u_matrix:i,u_opacity:u})},wl={fillExtrusion:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_lightpos:new p.Uniform3f(i,u.u_lightpos),u_lightintensity:new p.Uniform1f(i,u.u_lightintensity),u_lightcolor:new p.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(i,u.u_vertical_gradient),u_opacity:new p.Uniform1f(i,u.u_opacity)}},fillExtrusionPattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_lightpos:new p.Uniform3f(i,u.u_lightpos),u_lightintensity:new p.Uniform1f(i,u.u_lightintensity),u_lightcolor:new p.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(i,u.u_vertical_gradient),u_height_factor:new p.Uniform1f(i,u.u_height_factor),u_image:new p.Uniform1i(i,u.u_image),u_texsize:new p.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade),u_opacity:new p.Uniform1f(i,u.u_opacity)}},fill:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},fillPattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_image:new p.Uniform1i(i,u.u_image),u_texsize:new p.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade)}},fillOutline:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_world:new p.Uniform2f(i,u.u_world)}},fillOutlinePattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_world:new p.Uniform2f(i,u.u_world),u_image:new p.Uniform1i(i,u.u_image),u_texsize:new p.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade)}},circle:function(i,u){return{u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_scale_with_map:new p.Uniform1i(i,u.u_scale_with_map),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_extrude_scale:new p.Uniform2f(i,u.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},collisionBox:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pixels_to_tile_units:new p.Uniform1f(i,u.u_pixels_to_tile_units),u_extrude_scale:new p.Uniform2f(i,u.u_extrude_scale),u_overscale_factor:new p.Uniform1f(i,u.u_overscale_factor)}},collisionCircle:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_inv_matrix:new p.UniformMatrix4f(i,u.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(i,u.u_viewport_size)}},debug:function(i,u){return{u_color:new p.UniformColor(i,u.u_color),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_overlay:new p.Uniform1i(i,u.u_overlay),u_overlay_scale:new p.Uniform1f(i,u.u_overlay_scale)}},clippingMask:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},heatmap:function(i,u){return{u_extrude_scale:new p.Uniform1f(i,u.u_extrude_scale),u_intensity:new p.Uniform1f(i,u.u_intensity),u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},heatmapTexture:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_world:new p.Uniform2f(i,u.u_world),u_image:new p.Uniform1i(i,u.u_image),u_color_ramp:new p.Uniform1i(i,u.u_color_ramp),u_opacity:new p.Uniform1f(i,u.u_opacity)}},hillshade:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_image:new p.Uniform1i(i,u.u_image),u_latrange:new p.Uniform2f(i,u.u_latrange),u_light:new p.Uniform2f(i,u.u_light),u_shadow:new p.UniformColor(i,u.u_shadow),u_highlight:new p.UniformColor(i,u.u_highlight),u_accent:new p.UniformColor(i,u.u_accent)}},hillshadePrepare:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_image:new p.Uniform1i(i,u.u_image),u_dimension:new p.Uniform2f(i,u.u_dimension),u_zoom:new p.Uniform1f(i,u.u_zoom),u_unpack:new p.Uniform4f(i,u.u_unpack)}},line:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels)}},lineGradient:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels),u_image:new p.Uniform1i(i,u.u_image),u_image_height:new p.Uniform1f(i,u.u_image_height)}},linePattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_texsize:new p.Uniform2f(i,u.u_texsize),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_image:new p.Uniform1i(i,u.u_image),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade)}},lineSDF:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels),u_patternscale_a:new p.Uniform2f(i,u.u_patternscale_a),u_patternscale_b:new p.Uniform2f(i,u.u_patternscale_b),u_sdfgamma:new p.Uniform1f(i,u.u_sdfgamma),u_image:new p.Uniform1i(i,u.u_image),u_tex_y_a:new p.Uniform1f(i,u.u_tex_y_a),u_tex_y_b:new p.Uniform1f(i,u.u_tex_y_b),u_mix:new p.Uniform1f(i,u.u_mix)}},raster:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_tl_parent:new p.Uniform2f(i,u.u_tl_parent),u_scale_parent:new p.Uniform1f(i,u.u_scale_parent),u_buffer_scale:new p.Uniform1f(i,u.u_buffer_scale),u_fade_t:new p.Uniform1f(i,u.u_fade_t),u_opacity:new p.Uniform1f(i,u.u_opacity),u_image0:new p.Uniform1i(i,u.u_image0),u_image1:new p.Uniform1i(i,u.u_image1),u_brightness_low:new p.Uniform1f(i,u.u_brightness_low),u_brightness_high:new p.Uniform1f(i,u.u_brightness_high),u_saturation_factor:new p.Uniform1f(i,u.u_saturation_factor),u_contrast_factor:new p.Uniform1f(i,u.u_contrast_factor),u_spin_weights:new p.Uniform3f(i,u.u_spin_weights)}},symbolIcon:function(i,u){return{u_is_size_zoom_constant:new p.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(i,u.u_size_t),u_size:new p.Uniform1f(i,u.u_size),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(i,u.u_pitch),u_rotate_symbol:new p.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(i,u.u_fade_change),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new p.Uniform1i(i,u.u_is_text),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_texsize:new p.Uniform2f(i,u.u_texsize),u_texture:new p.Uniform1i(i,u.u_texture)}},symbolSDF:function(i,u){return{u_is_size_zoom_constant:new p.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(i,u.u_size_t),u_size:new p.Uniform1f(i,u.u_size),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(i,u.u_pitch),u_rotate_symbol:new p.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(i,u.u_fade_change),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new p.Uniform1i(i,u.u_is_text),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_texsize:new p.Uniform2f(i,u.u_texsize),u_texture:new p.Uniform1i(i,u.u_texture),u_gamma_scale:new p.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(i,u.u_is_halo)}},symbolTextAndIcon:function(i,u){return{u_is_size_zoom_constant:new p.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(i,u.u_size_t),u_size:new p.Uniform1f(i,u.u_size),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(i,u.u_pitch),u_rotate_symbol:new p.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(i,u.u_fade_change),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new p.Uniform1i(i,u.u_is_text),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_texsize:new p.Uniform2f(i,u.u_texsize),u_texsize_icon:new p.Uniform2f(i,u.u_texsize_icon),u_texture:new p.Uniform1i(i,u.u_texture),u_texture_icon:new p.Uniform1i(i,u.u_texture_icon),u_gamma_scale:new p.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(i,u.u_is_halo)}},background:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_opacity:new p.Uniform1f(i,u.u_opacity),u_color:new p.UniformColor(i,u.u_color)}},backgroundPattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_opacity:new p.Uniform1f(i,u.u_opacity),u_image:new p.Uniform1i(i,u.u_image),u_pattern_tl_a:new p.Uniform2f(i,u.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(i,u.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(i,u.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(i,u.u_pattern_br_b),u_texsize:new p.Uniform2f(i,u.u_texsize),u_mix:new p.Uniform1f(i,u.u_mix),u_pattern_size_a:new p.Uniform2f(i,u.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(i,u.u_pattern_size_b),u_scale_a:new p.Uniform1f(i,u.u_scale_a),u_scale_b:new p.Uniform1f(i,u.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(i,u.u_tile_units_to_pixels)}}};function nl(i,u,o,h,g,S,T){for(var R=i.context,G=R.gl,se=i.useProgram("collisionBox"),Ee=[],we=0,Pe=0,Ye=0;Ye<h.length;Ye++){var We=h[Ye],ut=u.getTile(We),Ue=ut.getBucket(o);if(Ue){var at=We.posMatrix;g[0]===0&&g[1]===0||(at=i.translatePosMatrix(We.posMatrix,ut,g,S));var wt=T?Ue.textCollisionBox:Ue.iconCollisionBox,Xt=Ue.collisionCircleArray;if(Xt.length>0){var _r=p.create(),dr=at;p.mul(_r,Ue.placementInvProjMatrix,i.transform.glCoordMatrix),p.mul(_r,_r,Ue.placementViewportMatrix),Ee.push({circleArray:Xt,circleOffset:Pe,transform:dr,invTransform:_r}),Pe=we+=Xt.length/4}wt&&se.draw(R,G.LINES,B.disabled,ee.disabled,i.colorModeForRenderPass(),Ae.disabled,xs(at,i.transform,ut),o.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,null,i.transform.zoom,null,null,wt.collisionVertexBuffer)}}if(T&&Ee.length){var Cr=i.useProgram("collisionCircle"),Gr=new p.StructArrayLayout2f1f2i16;Gr.resize(4*we),Gr._trim();for(var pn=0,an=0,Zn=Ee;an<Zn.length;an+=1)for(var ui=Zn[an],di=0;di<ui.circleArray.length/4;di++){var dn=4*di,ia=ui.circleArray[dn+0],Hn=ui.circleArray[dn+1],bi=ui.circleArray[dn+2],Hi=ui.circleArray[dn+3];Gr.emplace(pn++,ia,Hn,bi,Hi,0),Gr.emplace(pn++,ia,Hn,bi,Hi,1),Gr.emplace(pn++,ia,Hn,bi,Hi,2),Gr.emplace(pn++,ia,Hn,bi,Hi,3)}(!Ql||Ql.length<2*we)&&(Ql=function(k){var le=2*k,Ce=new p.StructArrayLayout3ui6;Ce.resize(le),Ce._trim();for(var ft=0;ft<le;ft++){var Rt=6*ft;Ce.uint16[Rt+0]=4*ft+0,Ce.uint16[Rt+1]=4*ft+1,Ce.uint16[Rt+2]=4*ft+2,Ce.uint16[Rt+3]=4*ft+2,Ce.uint16[Rt+4]=4*ft+3,Ce.uint16[Rt+5]=4*ft+0}return Ce}(we));for(var mi=R.createIndexBuffer(Ql,!0),Ci=R.createVertexBuffer(Gr,p.collisionCircleLayout.members,!0),Vi=0,X=Ee;Vi<X.length;Vi+=1){var Q=X[Vi],D=kl(Q.transform,Q.invTransform,i.transform);Cr.draw(R,G.TRIANGLES,B.disabled,ee.disabled,i.colorModeForRenderPass(),Ae.disabled,D,o.id,Ci,mi,p.SegmentVector.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,i.transform.zoom,null,null,null)}Ci.destroy(),mi.destroy()}}var eu=p.identity(new Float32Array(16));function ql(i,u,o,h,g,S){var T=p.getAnchorAlignment(i),R=-(T.horizontalAlign-.5)*u,G=-(T.verticalAlign-.5)*o,se=p.evaluateVariableOffset(i,h);return new p.Point((R/g+se[0])*S,(G/g+se[1])*S)}function Fu(i,u,o,h,g,S,T,R,G,se,Ee){var we=i.text.placedSymbolArray,Pe=i.text.dynamicLayoutVertexArray,Ye=i.icon.dynamicLayoutVertexArray,We={};Pe.clear();for(var ut=0;ut<we.length;ut++){var Ue=we.get(ut),at=Ue.hidden||!Ue.crossTileID||i.allowVerticalPlacement&&!Ue.placedOrientation?null:h[Ue.crossTileID];if(at){var wt=new p.Point(Ue.anchorX,Ue.anchorY),Xt=Zi(wt,o?R:T),_r=$i(S.cameraToCenterDistance,Xt.signedDistanceFromCamera),dr=g.evaluateSizeForFeature(i.textSizeData,se,Ue)*_r/p.ONE_EM;o&&(dr*=i.tilePixelRatio/G);for(var Cr=ql(at.anchor,at.width,at.height,at.textOffset,at.textBoxScale,dr),Gr=o?Zi(wt.add(Cr),T).point:Xt.point.add(u?Cr.rotate(-S.angle):Cr),pn=i.allowVerticalPlacement&&Ue.placedOrientation===p.WritingMode.vertical?Math.PI/2:0,an=0;an<Ue.numGlyphs;an++)p.addDynamicAttributes(Pe,Gr,pn);Ee&&Ue.associatedIconIndex>=0&&(We[Ue.associatedIconIndex]={shiftedAnchor:Gr,angle:pn})}else Qi(Ue.numGlyphs,Pe)}if(Ee){Ye.clear();for(var Zn=i.icon.placedSymbolArray,ui=0;ui<Zn.length;ui++){var di=Zn.get(ui);if(di.hidden)Qi(di.numGlyphs,Ye);else{var dn=We[ui];if(dn)for(var ia=0;ia<di.numGlyphs;ia++)p.addDynamicAttributes(Ye,dn.shiftedAnchor,dn.angle);else Qi(di.numGlyphs,Ye)}}i.icon.dynamicLayoutVertexBuffer.updateData(Ye)}i.text.dynamicLayoutVertexBuffer.updateData(Pe)}function Dc(i,u,o){return o.iconsInText&&u?"symbolTextAndIcon":i?"symbolSDF":"symbolIcon"}function il(i,u,o,h,g,S,T,R,G,se,Ee,we){for(var Pe=i.context,Ye=Pe.gl,We=i.transform,ut=R==="map",Ue=G==="map",at=ut&&o.layout.get("symbol-placement")!=="point",wt=ut&&!Ue&&!at,Xt=o.layout.get("symbol-sort-key").constantOr(1)!==void 0,_r=!1,dr=i.depthModeForSublayer(0,B.ReadOnly),Cr=o.layout.get("text-variable-anchor"),Gr=[],pn=0,an=h;pn<an.length;pn+=1){var Zn=an[pn],ui=u.getTile(Zn),di=ui.getBucket(o);if(di){var dn=g?di.text:di.icon;if(dn&&dn.segments.get().length){var ia=dn.programConfigurations.get(o.id),Hn=g||di.sdfIcons,bi=g?di.textSizeData:di.iconSizeData,Hi=Ue||We.pitch!==0,mi=i.useProgram(Dc(Hn,g,di),ia),Ci=p.evaluateSizeForZoom(bi,We.zoom),Vi=void 0,X=[0,0],Q=void 0,D=void 0,k=null,le=void 0;if(g)Q=ui.glyphAtlasTexture,D=Ye.LINEAR,Vi=ui.glyphAtlasTexture.size,di.iconsInText&&(X=ui.imageAtlasTexture.size,k=ui.imageAtlasTexture,le=Hi||i.options.rotating||i.options.zooming||bi.kind==="composite"||bi.kind==="camera"?Ye.LINEAR:Ye.NEAREST);else{var Ce=o.layout.get("icon-size").constantOr(0)!==1||di.iconsNeedLinear;Q=ui.imageAtlasTexture,D=Hn||i.options.rotating||i.options.zooming||Ce||Hi?Ye.LINEAR:Ye.NEAREST,Vi=ui.imageAtlasTexture.size}var ft=Ea(ui,1,i.transform.zoom),Rt=Fa(Zn.posMatrix,Ue,ut,i.transform,ft),Tt=Ki(Zn.posMatrix,Ue,ut,i.transform,ft),cr=Cr&&di.hasTextData(),Kr=o.layout.get("icon-text-fit")!=="none"&&cr&&di.hasIconData();at&&Jo(di,Zn.posMatrix,i,g,Rt,Tt,Ue,se);var Nn=i.translatePosMatrix(Zn.posMatrix,ui,S,T),ni=at||g&&Cr||Kr?eu:Rt,li=i.translatePosMatrix(Tt,ui,S,T,!0),Li=Hn&&o.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Mi={program:mi,buffers:dn,uniformValues:Hn?di.iconsInText?El(bi.kind,Ci,wt,Ue,i,Nn,ni,li,Vi,X):tl(bi.kind,Ci,wt,Ue,i,Nn,ni,li,g,Vi,!0):Au(bi.kind,Ci,wt,Ue,i,Nn,ni,li,g,Vi),atlasTexture:Q,atlasTextureIcon:k,atlasInterpolation:D,atlasInterpolationIcon:le,isSDF:Hn,hasHalo:Li};if(Xt&&di.canOverlap){_r=!0;for(var aa=0,xa=dn.segments.get();aa<xa.length;aa+=1){var Ca=xa[aa];Gr.push({segments:new p.SegmentVector([Ca]),sortKey:Ca.sortKey,state:Mi})}}else Gr.push({segments:dn.segments,sortKey:0,state:Mi})}}}_r&&Gr.sort(function(va,vo){return va.sortKey-vo.sortKey});for(var Va=0,Ga=Gr;Va<Ga.length;Va+=1){var to=Ga[Va],ca=to.state;if(Pe.activeTexture.set(Ye.TEXTURE0),ca.atlasTexture.bind(ca.atlasInterpolation,Ye.CLAMP_TO_EDGE),ca.atlasTextureIcon&&(Pe.activeTexture.set(Ye.TEXTURE1),ca.atlasTextureIcon&&ca.atlasTextureIcon.bind(ca.atlasInterpolationIcon,Ye.CLAMP_TO_EDGE)),ca.isSDF){var da=ca.uniformValues;ca.hasHalo&&(da.u_is_halo=1,Al(ca.buffers,to.segments,o,i,ca.program,dr,Ee,we,da)),da.u_is_halo=0}Al(ca.buffers,to.segments,o,i,ca.program,dr,Ee,we,ca.uniformValues)}}function Al(i,u,o,h,g,S,T,R,G){var se=h.context;g.draw(se,se.gl.TRIANGLES,S,T,R,Ae.disabled,G,o.id,i.layoutVertexBuffer,i.indexBuffer,u,o.paint,h.transform.zoom,i.programConfigurations.get(o.id),i.dynamicLayoutVertexBuffer,i.opacityVertexBuffer)}function Fl(i,u,o,h,g,S,T){var R,G,se,Ee,we,Pe=i.context.gl,Ye=o.paint.get("fill-pattern"),We=Ye&&Ye.constantOr(1),ut=o.getCrossfadeParameters();T?(G=We&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=Pe.LINES):(G=We?"fillPattern":"fill",R=Pe.TRIANGLES);for(var Ue=0,at=h;Ue<at.length;Ue+=1){var wt=at[Ue],Xt=u.getTile(wt);if(!We||Xt.patternsLoaded()){var _r=Xt.getBucket(o);if(_r){var dr=_r.programConfigurations.get(o.id),Cr=i.useProgram(G,dr);We&&(i.context.activeTexture.set(Pe.TEXTURE0),Xt.imageAtlasTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE),dr.updatePaintBuffers(ut));var Gr=Ye.constantOr(null);if(Gr&&Xt.imageAtlas){var pn=Xt.imageAtlas,an=pn.patternPositions[Gr.to.toString()],Zn=pn.patternPositions[Gr.from.toString()];an&&Zn&&dr.setConstantPatternPositions(an,Zn)}var ui=i.translatePosMatrix(wt.posMatrix,Xt,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(T){Ee=_r.indexBuffer2,we=_r.segments2;var di=[Pe.drawingBufferWidth,Pe.drawingBufferHeight];se=G==="fillOutlinePattern"&&We?Js(ui,i,ut,Xt,di):La(ui,di)}else Ee=_r.indexBuffer,we=_r.segments,se=We?uo(ui,i,ut,Xt):_s(ui);Cr.draw(i.context,R,g,i.stencilModeForClipping(wt),S,Ae.disabled,se,o.id,_r.layoutVertexBuffer,Ee,we,o.paint,i.transform.zoom,dr)}}}}function yc(i,u,o,h,g,S,T){for(var R=i.context,G=R.gl,se=o.paint.get("fill-extrusion-pattern"),Ee=se.constantOr(1),we=o.getCrossfadeParameters(),Pe=o.paint.get("fill-extrusion-opacity"),Ye=0,We=h;Ye<We.length;Ye+=1){var ut=We[Ye],Ue=u.getTile(ut),at=Ue.getBucket(o);if(at){var wt=at.programConfigurations.get(o.id),Xt=i.useProgram(Ee?"fillExtrusionPattern":"fillExtrusion",wt);Ee&&(i.context.activeTexture.set(G.TEXTURE0),Ue.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),wt.updatePaintBuffers(we));var _r=se.constantOr(null);if(_r&&Ue.imageAtlas){var dr=Ue.imageAtlas,Cr=dr.patternPositions[_r.to.toString()],Gr=dr.patternPositions[_r.from.toString()];Cr&&Gr&&wt.setConstantPatternPositions(Cr,Gr)}var pn=i.translatePosMatrix(ut.posMatrix,Ue,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),an=o.paint.get("fill-extrusion-vertical-gradient"),Zn=Ee?Ho(pn,i,an,Pe,ut,we,Ue):Ru(pn,i,an,Pe);Xt.draw(R,R.gl.TRIANGLES,g,S,T,Ae.backCCW,Zn,o.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,o.paint,i.transform.zoom,wt)}}}function Bl(i,u,o,h,g,S){var T=i.context,R=T.gl,G=u.fbo;if(G){var se=i.useProgram("hillshade");T.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,G.colorAttachment.get());var Ee=function(we,Pe,Ye){var We=Ye.paint.get("hillshade-shadow-color"),ut=Ye.paint.get("hillshade-highlight-color"),Ue=Ye.paint.get("hillshade-accent-color"),at=Ye.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ye.paint.get("hillshade-illumination-anchor")==="viewport"&&(at-=we.transform.angle);var wt,Xt,_r,dr=!we.options.moving;return{u_matrix:we.transform.calculatePosMatrix(Pe.tileID.toUnwrapped(),dr),u_image:0,u_latrange:(wt=Pe.tileID,Xt=Math.pow(2,wt.canonical.z),_r=wt.canonical.y,[new p.MercatorCoordinate(0,_r/Xt).toLngLat().lat,new p.MercatorCoordinate(0,(_r+1)/Xt).toLngLat().lat]),u_light:[Ye.paint.get("hillshade-exaggeration"),at],u_shadow:We,u_highlight:ut,u_accent:Ue}}(i,u,o);se.draw(T,R.TRIANGLES,h,g,S,Ae.disabled,Ee,o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}}function kc(i,u,o,h,g,S){var T=i.context,R=T.gl,G=u.dem;if(G&&G.data){var se=G.dim,Ee=G.stride,we=G.getPixels();if(T.activeTexture.set(R.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||i.getTileTexture(Ee),u.demTexture){var Pe=u.demTexture;Pe.update(we,{premultiply:!1}),Pe.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else u.demTexture=new p.Texture(T,we,R.RGBA,{premultiply:!1}),u.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);T.activeTexture.set(R.TEXTURE0);var Ye=u.fbo;if(!Ye){var We=new p.Texture(T,{width:se,height:se,data:null},R.RGBA);We.bind(R.LINEAR,R.CLAMP_TO_EDGE),(Ye=u.fbo=T.createFramebuffer(se,se,!0)).colorAttachment.set(We.texture)}T.bindFramebuffer.set(Ye.framebuffer),T.viewport.set([0,0,se,se]),i.useProgram("hillshadePrepare").draw(T,R.TRIANGLES,h,g,S,Ae.disabled,function(ut,Ue){var at=Ue.stride,wt=p.create();return p.ortho(wt,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(wt,wt,[0,-p.EXTENT,0]),{u_matrix:wt,u_image:1,u_dimension:[at,at],u_zoom:ut.overscaledZ,u_unpack:Ue.getUnpackVector()}}(u.tileID,G),o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function ec(i,u,o,h,g){var S=h.paint.get("raster-fade-duration");if(S>0){var T=p.browser.now(),R=(T-i.timeAdded)/S,G=u?(T-u.timeAdded)/S:-1,se=o.getSource(),Ee=g.coveringZoomLevel({tileSize:se.tileSize,roundZoom:se.roundZoom}),we=!u||Math.abs(u.tileID.overscaledZ-Ee)>Math.abs(i.tileID.overscaledZ-Ee),Pe=we&&i.refreshedUponExpiration?1:p.clamp(we?R:1-G,0,1);return i.refreshedUponExpiration&&R>=1&&(i.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Pe}:{opacity:Pe,mix:0}}return{opacity:1,mix:0}}var vu=new p.Color(1,0,0,1),Xa=new p.Color(0,1,0,1),lo=new p.Color(0,0,1,1),Bu=new p.Color(1,0,1,1),Fs=new p.Color(0,1,1,1);function tc(i,u,o,h){Nu(i,0,u+o/2,i.transform.width,o,h)}function Nl(i,u,o,h){Nu(i,u-o/2,0,o,i.transform.height,h)}function Nu(i,u,o,h,g,S){var T=i.context,R=T.gl;R.enable(R.SCISSOR_TEST),R.scissor(u*p.browser.devicePixelRatio,o*p.browser.devicePixelRatio,h*p.browser.devicePixelRatio,g*p.browser.devicePixelRatio),T.clear({color:S}),R.disable(R.SCISSOR_TEST)}function Tl(i,u,o){var h=i.context,g=h.gl,S=o.posMatrix,T=i.useProgram("debug"),R=B.disabled,G=ee.disabled,se=i.colorModeForRenderPass();h.activeTexture.set(g.TEXTURE0),i.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),T.draw(h,g.LINE_STRIP,R,G,se,Ae.disabled,Qs(S,p.Color.red),"$debug",i.debugBuffer,i.tileBorderIndexBuffer,i.debugSegments);var Ee=u.getTileByID(o.key).latestRawTileData,we=Math.floor((Ee&&Ee.byteLength||0)/1024),Pe=u.getTile(o).tileSize,Ye=512/Math.min(Pe,512)*(o.overscaledZ/i.transform.zoom)*.5,We=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(We+=" => "+o.overscaledZ),function(ut,Ue){ut.initDebugOverlayCanvas();var at=ut.debugOverlayCanvas,wt=ut.context.gl,Xt=ut.debugOverlayCanvas.getContext("2d");Xt.clearRect(0,0,at.width,at.height),Xt.shadowColor="white",Xt.shadowBlur=2,Xt.lineWidth=1.5,Xt.strokeStyle="white",Xt.textBaseline="top",Xt.font="bold 36px Open Sans, sans-serif",Xt.fillText(Ue,5,5),Xt.strokeText(Ue,5,5),ut.debugOverlayTexture.update(at),ut.debugOverlayTexture.bind(wt.LINEAR,wt.CLAMP_TO_EDGE)}(i,We+" "+we+"kb"),T.draw(h,g.TRIANGLES,R,G,pe.alphaBlended,Ae.disabled,Qs(S,p.Color.transparent,Ye),"$debug",i.debugBuffer,i.quadTriangleIndexBuffer,i.debugSegments)}var zu={symbol:function(i,u,o,h,g){if(i.renderPass==="translucent"){var S=ee.disabled,T=i.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(R,G,se,Ee,we,Pe,Ye){for(var We=G.transform,ut=we==="map",Ue=Pe==="map",at=0,wt=R;at<wt.length;at+=1){var Xt=wt[at],_r=Ee.getTile(Xt),dr=_r.getBucket(se);if(dr&&dr.text&&dr.text.segments.get().length){var Cr=p.evaluateSizeForZoom(dr.textSizeData,We.zoom),Gr=Ea(_r,1,G.transform.zoom),pn=Fa(Xt.posMatrix,Ue,ut,G.transform,Gr),an=se.layout.get("icon-text-fit")!=="none"&&dr.hasIconData();if(Cr){var Zn=Math.pow(2,We.zoom-_r.tileID.overscaledZ);Fu(dr,ut,Ue,Ye,p.symbolSize,We,pn,Xt.posMatrix,Zn,Cr,an)}}}}(h,i,o,u,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),g),o.paint.get("icon-opacity").constantOr(1)!==0&&il(i,u,o,h,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),S,T),o.paint.get("text-opacity").constantOr(1)!==0&&il(i,u,o,h,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),S,T),u.map.showCollisionBoxes&&(nl(i,u,o,h,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),nl(i,u,o,h,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))}},circle:function(i,u,o,h){if(i.renderPass==="translucent"){var g=o.paint.get("circle-opacity"),S=o.paint.get("circle-stroke-width"),T=o.paint.get("circle-stroke-opacity"),R=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(g.constantOr(1)!==0||S.constantOr(1)!==0&&T.constantOr(1)!==0){for(var G=i.context,se=G.gl,Ee=i.depthModeForSublayer(0,B.ReadOnly),we=ee.disabled,Pe=i.colorModeForRenderPass(),Ye=[],We=0;We<h.length;We++){var ut=h[We],Ue=u.getTile(ut),at=Ue.getBucket(o);if(at){var wt=at.programConfigurations.get(o.id),Xt={programConfiguration:wt,program:i.useProgram("circle",wt),layoutVertexBuffer:at.layoutVertexBuffer,indexBuffer:at.indexBuffer,uniformValues:xl(i,ut,Ue,o)};if(R)for(var _r=0,dr=at.segments.get();_r<dr.length;_r+=1){var Cr=dr[_r];Ye.push({segments:new p.SegmentVector([Cr]),sortKey:Cr.sortKey,state:Xt})}else Ye.push({segments:at.segments,sortKey:0,state:Xt})}}R&&Ye.sort(function(ui,di){return ui.sortKey-di.sortKey});for(var Gr=0,pn=Ye;Gr<pn.length;Gr+=1){var an=pn[Gr],Zn=an.state;Zn.program.draw(G,se.TRIANGLES,Ee,we,Pe,Ae.disabled,Zn.uniformValues,o.id,Zn.layoutVertexBuffer,Zn.indexBuffer,an.segments,o.paint,i.transform.zoom,Zn.programConfiguration)}}}},heatmap:function(i,u,o,h){if(o.paint.get("heatmap-opacity")!==0)if(i.renderPass==="offscreen"){var g=i.context,S=g.gl,T=ee.disabled,R=new pe([S.ONE,S.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(Ye,We,ut){var Ue=Ye.gl;Ye.activeTexture.set(Ue.TEXTURE1),Ye.viewport.set([0,0,We.width/4,We.height/4]);var at=ut.heatmapFbo;if(at)Ue.bindTexture(Ue.TEXTURE_2D,at.colorAttachment.get()),Ye.bindFramebuffer.set(at.framebuffer);else{var wt=Ue.createTexture();Ue.bindTexture(Ue.TEXTURE_2D,wt),Ue.texParameteri(Ue.TEXTURE_2D,Ue.TEXTURE_WRAP_S,Ue.CLAMP_TO_EDGE),Ue.texParameteri(Ue.TEXTURE_2D,Ue.TEXTURE_WRAP_T,Ue.CLAMP_TO_EDGE),Ue.texParameteri(Ue.TEXTURE_2D,Ue.TEXTURE_MIN_FILTER,Ue.LINEAR),Ue.texParameteri(Ue.TEXTURE_2D,Ue.TEXTURE_MAG_FILTER,Ue.LINEAR),at=ut.heatmapFbo=Ye.createFramebuffer(We.width/4,We.height/4,!1),function(Xt,_r,dr,Cr){var Gr=Xt.gl;Gr.texImage2D(Gr.TEXTURE_2D,0,Gr.RGBA,_r.width/4,_r.height/4,0,Gr.RGBA,Xt.extRenderToTextureHalfFloat?Xt.extTextureHalfFloat.HALF_FLOAT_OES:Gr.UNSIGNED_BYTE,null),Cr.colorAttachment.set(dr)}(Ye,We,wt,at)}})(g,i,o),g.clear({color:p.Color.transparent});for(var G=0;G<h.length;G++){var se=h[G];if(!u.hasRenderableParent(se)){var Ee=u.getTile(se),we=Ee.getBucket(o);if(we){var Pe=we.programConfigurations.get(o.id);i.useProgram("heatmap",Pe).draw(g,S.TRIANGLES,B.disabled,T,R,Ae.disabled,mc(se.posMatrix,Ee,i.transform.zoom,o.paint.get("heatmap-intensity")),o.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,o.paint,i.transform.zoom,Pe)}}}g.viewport.set([0,0,i.width,i.height])}else i.renderPass==="translucent"&&(i.context.setColorMode(i.colorModeForRenderPass()),function(Ye,We){var ut=Ye.context,Ue=ut.gl,at=We.heatmapFbo;if(at){ut.activeTexture.set(Ue.TEXTURE0),Ue.bindTexture(Ue.TEXTURE_2D,at.colorAttachment.get()),ut.activeTexture.set(Ue.TEXTURE1);var wt=We.colorRampTexture;wt||(wt=We.colorRampTexture=new p.Texture(ut,We.colorRamp,Ue.RGBA)),wt.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE),Ye.useProgram("heatmapTexture").draw(ut,Ue.TRIANGLES,B.disabled,ee.disabled,Ye.colorModeForRenderPass(),Ae.disabled,function(Xt,_r,dr,Cr){var Gr=p.create();p.ortho(Gr,0,Xt.width,Xt.height,0,0,1);var pn=Xt.context.gl;return{u_matrix:Gr,u_world:[pn.drawingBufferWidth,pn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:_r.paint.get("heatmap-opacity")}}(Ye,We),We.id,Ye.viewportBuffer,Ye.quadTriangleIndexBuffer,Ye.viewportSegments,We.paint,Ye.transform.zoom)}}(i,o))},line:function(i,u,o,h){if(i.renderPass==="translucent"){var g=o.paint.get("line-opacity"),S=o.paint.get("line-width");if(g.constantOr(1)!==0&&S.constantOr(1)!==0)for(var T=i.depthModeForSublayer(0,B.ReadOnly),R=i.colorModeForRenderPass(),G=o.paint.get("line-dasharray"),se=o.paint.get("line-pattern"),Ee=se.constantOr(1),we=o.paint.get("line-gradient"),Pe=o.getCrossfadeParameters(),Ye=Ee?"linePattern":G?"lineSDF":we?"lineGradient":"line",We=i.context,ut=We.gl,Ue=!0,at=0,wt=h;at<wt.length;at+=1){var Xt=wt[at],_r=u.getTile(Xt);if(!Ee||_r.patternsLoaded()){var dr=_r.getBucket(o);if(dr){var Cr=dr.programConfigurations.get(o.id),Gr=i.context.program.get(),pn=i.useProgram(Ye,Cr),an=Ue||pn.program!==Gr,Zn=se.constantOr(null);if(Zn&&_r.imageAtlas){var ui=_r.imageAtlas,di=ui.patternPositions[Zn.to.toString()],dn=ui.patternPositions[Zn.from.toString()];di&&dn&&Cr.setConstantPatternPositions(di,dn)}var ia=Ee?bl(i,_r,o,Pe):G?Kc(i,_r,o,G,Pe):we?Ra(i,_r,o,dr.lineClipsArray.length):Du(i,_r,o);if(Ee)We.activeTexture.set(ut.TEXTURE0),_r.imageAtlasTexture.bind(ut.LINEAR,ut.CLAMP_TO_EDGE),Cr.updatePaintBuffers(Pe);else if(G&&(an||i.lineAtlas.dirty))We.activeTexture.set(ut.TEXTURE0),i.lineAtlas.bind(We);else if(we){var Hn=dr.gradients[o.id],bi=Hn.texture;if(o.gradientVersion!==Hn.version){var Hi=256;if(o.stepInterpolant){var mi=u.getSource().maxzoom,Ci=Xt.canonical.z===mi?Math.ceil(1<<i.transform.maxZoom-Xt.canonical.z):1;Hi=p.clamp(p.nextPowerOfTwo(dr.maxLineLength/p.EXTENT*1024*Ci),256,We.maxTextureSize)}Hn.gradient=p.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Hi,image:Hn.gradient||void 0,clips:dr.lineClipsArray}),Hn.texture?Hn.texture.update(Hn.gradient):Hn.texture=new p.Texture(We,Hn.gradient,ut.RGBA),Hn.version=o.gradientVersion,bi=Hn.texture}We.activeTexture.set(ut.TEXTURE0),bi.bind(o.stepInterpolant?ut.NEAREST:ut.LINEAR,ut.CLAMP_TO_EDGE)}pn.draw(We,ut.TRIANGLES,T,i.stencilModeForClipping(Xt),R,Ae.disabled,ia,o.id,dr.layoutVertexBuffer,dr.indexBuffer,dr.segments,o.paint,i.transform.zoom,Cr,dr.layoutVertexBuffer2),Ue=!1}}}}},fill:function(i,u,o,h){var g=o.paint.get("fill-color"),S=o.paint.get("fill-opacity");if(S.constantOr(1)!==0){var T=i.colorModeForRenderPass(),R=o.paint.get("fill-pattern"),G=i.opaquePassEnabledForLayer()&&!R.constantOr(1)&&g.constantOr(p.Color.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(i.renderPass===G){var se=i.depthModeForSublayer(1,i.renderPass==="opaque"?B.ReadWrite:B.ReadOnly);Fl(i,u,o,h,se,T,!1)}if(i.renderPass==="translucent"&&o.paint.get("fill-antialias")){var Ee=i.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,B.ReadOnly);Fl(i,u,o,h,Ee,T,!0)}}},"fill-extrusion":function(i,u,o,h){var g=o.paint.get("fill-extrusion-opacity");if(g!==0&&i.renderPass==="translucent"){var S=new B(i.context.gl.LEQUAL,B.ReadWrite,i.depthRangeFor3D);if(g!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))yc(i,u,o,h,S,ee.disabled,pe.disabled),yc(i,u,o,h,S,i.stencilModeFor3D(),i.colorModeForRenderPass());else{var T=i.colorModeForRenderPass();yc(i,u,o,h,S,ee.disabled,T)}}},hillshade:function(i,u,o,h){if(i.renderPass==="offscreen"||i.renderPass==="translucent"){for(var g=i.context,S=i.depthModeForSublayer(0,B.ReadOnly),T=i.colorModeForRenderPass(),R=i.renderPass==="translucent"?i.stencilConfigForOverlap(h):[{},h],G=R[0],se=0,Ee=R[1];se<Ee.length;se+=1){var we=Ee[se],Pe=u.getTile(we);Pe.needsHillshadePrepare&&i.renderPass==="offscreen"?kc(i,Pe,o,S,ee.disabled,T):i.renderPass==="translucent"&&Bl(i,Pe,o,S,G[we.overscaledZ],T)}g.viewport.set([0,0,i.width,i.height])}},raster:function(i,u,o,h){if(i.renderPass==="translucent"&&o.paint.get("raster-opacity")!==0&&h.length)for(var g=i.context,S=g.gl,T=u.getSource(),R=i.useProgram("raster"),G=i.colorModeForRenderPass(),se=T instanceof lt?[{},h]:i.stencilConfigForOverlap(h),Ee=se[0],we=se[1],Pe=we[we.length-1].overscaledZ,Ye=!i.options.moving,We=0,ut=we;We<ut.length;We+=1){var Ue=ut[We],at=i.depthModeForSublayer(Ue.overscaledZ-Pe,o.paint.get("raster-opacity")===1?B.ReadWrite:B.ReadOnly,S.LESS),wt=u.getTile(Ue),Xt=i.transform.calculatePosMatrix(Ue.toUnwrapped(),Ye);wt.registerFadeDuration(o.paint.get("raster-fade-duration"));var _r=u.findLoadedParent(Ue,0),dr=ec(wt,_r,u,o,i.transform),Cr=void 0,Gr=void 0,pn=o.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;g.activeTexture.set(S.TEXTURE0),wt.texture.bind(pn,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(S.TEXTURE1),_r?(_r.texture.bind(pn,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),Cr=Math.pow(2,_r.tileID.overscaledZ-wt.tileID.overscaledZ),Gr=[wt.tileID.canonical.x*Cr%1,wt.tileID.canonical.y*Cr%1]):wt.texture.bind(pn,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST);var an=$c(Xt,Gr||[0,0],Cr||1,dr,o);T instanceof lt?R.draw(g,S.TRIANGLES,at,ee.disabled,G,Ae.disabled,an,o.id,T.boundsBuffer,i.quadTriangleIndexBuffer,T.boundsSegments):R.draw(g,S.TRIANGLES,at,Ee[Ue.overscaledZ],G,Ae.disabled,an,o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}},background:function(i,u,o){var h=o.paint.get("background-color"),g=o.paint.get("background-opacity");if(g!==0){var S=i.context,T=S.gl,R=i.transform,G=R.tileSize,se=o.paint.get("background-pattern");if(!i.isPatternMissing(se)){var Ee=!se&&h.a===1&&g===1&&i.opaquePassEnabledForLayer()?"opaque":"translucent";if(i.renderPass===Ee){var we=ee.disabled,Pe=i.depthModeForSublayer(0,Ee==="opaque"?B.ReadWrite:B.ReadOnly),Ye=i.colorModeForRenderPass(),We=i.useProgram(se?"backgroundPattern":"background"),ut=R.coveringTiles({tileSize:G});se&&(S.activeTexture.set(T.TEXTURE0),i.imageManager.bind(i.context));for(var Ue=o.getCrossfadeParameters(),at=0,wt=ut;at<wt.length;at+=1){var Xt=wt[at],_r=i.transform.calculatePosMatrix(Xt.toUnwrapped()),dr=se?rl(_r,g,i,se,{tileID:Xt,tileSize:G},Ue):Cl(_r,g,h);We.draw(S,T.TRIANGLES,Pe,we,Ye,Ae.disabled,dr,o.id,i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}}}},debug:function(i,u,o){for(var h=0;h<o.length;h++)Tl(i,u,o[h])},custom:function(i,u,o){var h=i.context,g=o.implementation;if(i.renderPass==="offscreen"){var S=g.prerender;S&&(i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),S.call(g,h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState())}else if(i.renderPass==="translucent"){i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),h.setStencilMode(ee.disabled);var T=g.renderingMode==="3d"?new B(i.context.gl.LEQUAL,B.ReadWrite,i.depthRangeFor3D):i.depthModeForSublayer(0,B.ReadOnly);h.setDepthMode(T),g.render(h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState(),h.bindFramebuffer.set(null)}}},qa=function(i,u){this.context=new oe(i),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=_e.maxUnderzooming+_e.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ss,this.gpuTimers={}};qa.prototype.resize=function(i,u){if(this.width=i*p.browser.devicePixelRatio,this.height=u*p.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var o=0,h=this.style._order;o<h.length;o+=1)this.style._layers[h[o]].resize()},qa.prototype.setup=function(){var i=this.context,u=new p.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(p.EXTENT,0),u.emplaceBack(0,p.EXTENT),u.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(u,Aa.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);var o=new p.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(p.EXTENT,0),o.emplaceBack(0,p.EXTENT),o.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=i.createVertexBuffer(o,Aa.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);var h=new p.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(p.EXTENT,0,p.EXTENT,0),h.emplaceBack(0,p.EXTENT,0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.rasterBoundsBuffer=i.createVertexBuffer(h,it.members),this.rasterBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);var g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(g,Aa.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);var S=new p.StructArrayLayout1ui2;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(S);var T=new p.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(T),this.emptyTexture=new p.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA);var R=this.context.gl;this.stencilClearMode=new ee({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO)},qa.prototype.clearStencil=function(){var i=this.context,u=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var o=p.create();p.ortho(o,0,this.width,this.height,0,0,1),p.scale(o,o,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,u.TRIANGLES,B.disabled,this.stencilClearMode,pe.disabled,Ae.disabled,qs(o),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},qa.prototype._renderTileClippingMasks=function(i,u){if(this.currentStencilSource!==i.source&&i.isTileClipped()&&u&&u.length){this.currentStencilSource=i.source;var o=this.context,h=o.gl;this.nextStencilID+u.length>256&&this.clearStencil(),o.setColorMode(pe.disabled),o.setDepthMode(B.disabled);var g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var S=0,T=u;S<T.length;S+=1){var R=T[S],G=this._tileClippingMaskIDs[R.key]=this.nextStencilID++;g.draw(o,h.TRIANGLES,B.disabled,new ee({func:h.ALWAYS,mask:0},G,255,h.KEEP,h.KEEP,h.REPLACE),pe.disabled,Ae.disabled,qs(R.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},qa.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var i=this.nextStencilID++,u=this.context.gl;return new ee({func:u.NOTEQUAL,mask:255},i,255,u.KEEP,u.KEEP,u.REPLACE)},qa.prototype.stencilModeForClipping=function(i){var u=this.context.gl;return new ee({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,u.KEEP,u.KEEP,u.REPLACE)},qa.prototype.stencilConfigForOverlap=function(i){var u,o=this.context.gl,h=i.sort(function(G,se){return se.overscaledZ-G.overscaledZ}),g=h[h.length-1].overscaledZ,S=h[0].overscaledZ-g+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();for(var T={},R=0;R<S;R++)T[R+g]=new ee({func:o.GEQUAL,mask:255},R+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=S,[T,h]}return[(u={},u[g]=ee.disabled,u),h]},qa.prototype.colorModeForRenderPass=function(){var i=this.context.gl;return this._showOverdrawInspector?new pe([i.CONSTANT_COLOR,i.ONE],new p.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?pe.unblended:pe.alphaBlended},qa.prototype.depthModeForSublayer=function(i,u,o){if(!this.opaquePassEnabledForLayer())return B.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new B(o||this.context.gl.LEQUAL,u,[h,h])},qa.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},qa.prototype.render=function(i,u){var o=this;this.style=i,this.options=u,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(p.browser.now()),this.imageManager.beginFrame();var h=this.style._order,g=this.style.sourceCaches;for(var S in g){var T=g[S];T.used&&T.prepare(this.context)}var R,G,se={},Ee={},we={};for(var Pe in g){var Ye=g[Pe];se[Pe]=Ye.getVisibleCoordinates(),Ee[Pe]=se[Pe].slice().reverse(),we[Pe]=Ye.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var We=0;We<h.length;We++)if(this.style._layers[h[We]].is3D()){this.opaquePassCutoff=We;break}this.renderPass="offscreen";for(var ut=0,Ue=h;ut<Ue.length;ut+=1){var at=this.style._layers[Ue[ut]];if(at.hasOffscreenPass()&&!at.isHidden(this.transform.zoom)){var wt=Ee[at.source];(at.type==="custom"||wt.length)&&this.renderLayer(this,g[at.source],at,wt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var Xt=this.style._layers[h[this.currentLayer]],_r=g[Xt.source],dr=se[Xt.source];this._renderTileClippingMasks(Xt,dr),this.renderLayer(this,_r,Xt,dr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var Cr=this.style._layers[h[this.currentLayer]],Gr=g[Cr.source],pn=(Cr.type==="symbol"?we:Ee)[Cr.source];this._renderTileClippingMasks(Cr,se[Cr.source]),this.renderLayer(this,Gr,Cr,pn)}this.options.showTileBoundaries&&(p.values(this.style._layers).forEach(function(an){an.source&&!an.isHidden(o.transform.zoom)&&(an.source!==(G&&G.id)&&(G=o.style.sourceCaches[an.source]),(!R||R.getSource().maxzoom<G.getSource().maxzoom)&&(R=G))}),R&&zu.debug(this,R,R.getVisibleCoordinates())),this.options.showPadding&&function(an){var Zn=an.transform.padding;tc(an,an.transform.height-(Zn.top||0),3,vu),tc(an,Zn.bottom||0,3,Xa),Nl(an,Zn.left||0,3,lo),Nl(an,an.transform.width-(Zn.right||0),3,Bu);var ui=an.transform.centerPoint;(function(di,dn,ia,Hn){Nu(di,dn-1,ia-10,2,20,Hn),Nu(di,dn-10,ia-1,20,2,Hn)})(an,ui.x,an.transform.height-ui.y,Fs)}(this),this.context.setDefault()},qa.prototype.renderLayer=function(i,u,o,h){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="custom"||h.length)&&(this.id=o.id,this.gpuTimingStart(o),zu[o.type](i,u,o,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},qa.prototype.gpuTimingStart=function(i){if(this.options.gpuTiming){var u=this.context.extTimerQuery,o=this.gpuTimers[i.id];o||(o=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),o.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,o.query)}},qa.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}},qa.prototype.collectGpuTimers=function(){var i=this.gpuTimers;return this.gpuTimers={},i},qa.prototype.queryGpuTimers=function(i){var u={};for(var o in i){var h=i[o],g=this.context.extTimerQuery,S=g.getQueryObjectEXT(h.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(h.query),u[o]=S}return u},qa.prototype.translatePosMatrix=function(i,u,o,h,g){if(!o[0]&&!o[1])return i;var S=g?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(S){var T=Math.sin(S),R=Math.cos(S);o=[o[0]*R-o[1]*T,o[0]*T+o[1]*R]}var G=[g?o[0]:Ea(u,o[0],this.transform.zoom),g?o[1]:Ea(u,o[1],this.transform.zoom),0],se=new Float32Array(16);return p.translate(se,i,G),se},qa.prototype.saveTileTexture=function(i){var u=this._tileTextures[i.size[0]];u?u.push(i):this._tileTextures[i.size[0]]=[i]},qa.prototype.getTileTexture=function(i){var u=this._tileTextures[i];return u&&u.length>0?u.pop():null},qa.prototype.isPatternMissing=function(i){if(!i)return!1;if(!i.from||!i.to)return!0;var u=this.imageManager.getPattern(i.from.toString()),o=this.imageManager.getPattern(i.to.toString());return!u||!o},qa.prototype.useProgram=function(i,u){this.cache=this.cache||{};var o=""+i+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[o]||(this.cache[o]=new uu(this.context,i,go[i],u,wl[i],this._showOverdrawInspector)),this.cache[o]},qa.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},qa.prototype.setBaseState=function(){var i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)},qa.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},qa.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var zl=function(i,u){this.points=i,this.planes=u};zl.fromInvProjectionMatrix=function(i,u,o){var h=Math.pow(2,o),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return p.transformMat4([],T,i)}).map(function(T){return p.scale$1([],T,1/T[3]/u*h)}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var R=p.sub([],g[T[0]],g[T[1]]),G=p.sub([],g[T[2]],g[T[1]]),se=p.normalize([],p.cross([],R,G)),Ee=-p.dot(se,g[T[1]]);return se.concat(Ee)});return new zl(g,S)};var js=function(i,u){this.min=i,this.max=u,this.center=p.scale$2([],p.add([],this.min,this.max),.5)};js.prototype.quadrant=function(i){for(var u=[i%2==0,i<2],o=p.clone$2(this.min),h=p.clone$2(this.max),g=0;g<u.length;g++)o[g]=u[g]?this.min[g]:this.center[g],h[g]=u[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new js(o,h)},js.prototype.distanceX=function(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]},js.prototype.distanceY=function(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]},js.prototype.intersects=function(i){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],o=!0,h=0;h<i.planes.length;h++){for(var g=i.planes[h],S=0,T=0;T<u.length;T++)S+=p.dot$1(g,u[T])>=0;if(S===0)return 0;S!==u.length&&(o=!1)}if(o)return 2;for(var R=0;R<3;R++){for(var G=Number.MAX_VALUE,se=-Number.MAX_VALUE,Ee=0;Ee<i.points.length;Ee++){var we=i.points[Ee][R]-this.min[R];G=Math.min(G,we),se=Math.max(se,we)}if(se<0||G>this.max[R]-this.min[R])return 0}return 1};var mu=function(i,u,o,h){if(i===void 0&&(i=0),u===void 0&&(u=0),o===void 0&&(o=0),h===void 0&&(h=0),isNaN(i)||i<0||isNaN(u)||u<0||isNaN(o)||o<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=u,this.left=o,this.right=h};mu.prototype.interpolate=function(i,u,o){return u.top!=null&&i.top!=null&&(this.top=p.number(i.top,u.top,o)),u.bottom!=null&&i.bottom!=null&&(this.bottom=p.number(i.bottom,u.bottom,o)),u.left!=null&&i.left!=null&&(this.left=p.number(i.left,u.left,o)),u.right!=null&&i.right!=null&&(this.right=p.number(i.right,u.right,o)),this},mu.prototype.getCenter=function(i,u){var o=p.clamp((this.left+i-this.right)/2,0,i),h=p.clamp((this.top+u-this.bottom)/2,0,u);return new p.Point(o,h)},mu.prototype.equals=function(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right},mu.prototype.clone=function(){return new mu(this.top,this.bottom,this.left,this.right)},mu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var la=function(i,u,o,h,g){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=g===void 0||g,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=o==null?0:o,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new mu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Pi={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};la.prototype.clone=function(){var i=new la(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.tileSize=this.tileSize,i.latRange=this.latRange,i.width=this.width,i.height=this.height,i._center=this._center,i.zoom=this.zoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._calcMatrices(),i},Pi.minZoom.get=function(){return this._minZoom},Pi.minZoom.set=function(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))},Pi.maxZoom.get=function(){return this._maxZoom},Pi.maxZoom.set=function(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))},Pi.minPitch.get=function(){return this._minPitch},Pi.minPitch.set=function(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))},Pi.maxPitch.get=function(){return this._maxPitch},Pi.maxPitch.set=function(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))},Pi.renderWorldCopies.get=function(){return this._renderWorldCopies},Pi.renderWorldCopies.set=function(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i},Pi.worldSize.get=function(){return this.tileSize*this.scale},Pi.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Pi.size.get=function(){return new p.Point(this.width,this.height)},Pi.bearing.get=function(){return-this.angle/Math.PI*180},Pi.bearing.set=function(i){var u=-p.wrap(i,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=p.create$2(),p.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Pi.pitch.get=function(){return this._pitch/Math.PI*180},Pi.pitch.set=function(i){var u=p.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},Pi.fov.get=function(){return this._fov/Math.PI*180},Pi.fov.set=function(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())},Pi.zoom.get=function(){return this._zoom},Pi.zoom.set=function(i){var u=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},Pi.center.get=function(){return this._center},Pi.center.set=function(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())},Pi.padding.get=function(){return this._edgeInsets.toJSON()},Pi.padding.set=function(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())},Pi.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},la.prototype.isPaddingEqual=function(i){return this._edgeInsets.equals(i)},la.prototype.interpolatePadding=function(i,u,o){this._unmodified=!1,this._edgeInsets.interpolate(i,u,o),this._constrain(),this._calcMatrices()},la.prototype.coveringZoomLevel=function(i){var u=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,u)},la.prototype.getVisibleUnwrappedCoordinates=function(i){var u=[new p.UnwrappedTileID(0,i)];if(this._renderWorldCopies)for(var o=this.pointCoordinate(new p.Point(0,0)),h=this.pointCoordinate(new p.Point(this.width,0)),g=this.pointCoordinate(new p.Point(this.width,this.height)),S=this.pointCoordinate(new p.Point(0,this.height)),T=Math.floor(Math.min(o.x,h.x,g.x,S.x)),R=Math.floor(Math.max(o.x,h.x,g.x,S.x)),G=T-1;G<=R+1;G++)G!==0&&u.push(new p.UnwrappedTileID(G,i));return u},la.prototype.coveringTiles=function(i){var u=this.coveringZoomLevel(i),o=u;if(i.minzoom!==void 0&&u<i.minzoom)return[];i.maxzoom!==void 0&&u>i.maxzoom&&(u=i.maxzoom);var h=p.MercatorCoordinate.fromLngLat(this.center),g=Math.pow(2,u),S=[g*h.x,g*h.y,0],T=zl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),R=i.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(R=u);var G=function(an){return{aabb:new js([an*g,0,0],[(an+1)*g,g,0]),zoom:0,x:0,y:0,wrap:an,fullyVisible:!1}},se=[],Ee=[],we=u,Pe=i.reparseOverscaled?o:u;if(this._renderWorldCopies)for(var Ye=1;Ye<=3;Ye++)se.push(G(-Ye)),se.push(G(Ye));for(se.push(G(0));se.length>0;){var We=se.pop(),ut=We.x,Ue=We.y,at=We.fullyVisible;if(!at){var wt=We.aabb.intersects(T);if(wt===0)continue;at=wt===2}var Xt=We.aabb.distanceX(S),_r=We.aabb.distanceY(S),dr=Math.max(Math.abs(Xt),Math.abs(_r));if(We.zoom===we||dr>3+(1<<we-We.zoom)-2&&We.zoom>=R)Ee.push({tileID:new p.OverscaledTileID(We.zoom===we?Pe:We.zoom,We.wrap,We.zoom,ut,Ue),distanceSq:p.sqrLen([S[0]-.5-ut,S[1]-.5-Ue])});else for(var Cr=0;Cr<4;Cr++){var Gr=(ut<<1)+Cr%2,pn=(Ue<<1)+(Cr>>1);se.push({aabb:We.aabb.quadrant(Cr),zoom:We.zoom+1,x:Gr,y:pn,wrap:We.wrap,fullyVisible:at})}}return Ee.sort(function(an,Zn){return an.distanceSq-Zn.distanceSq}).map(function(an){return an.tileID})},la.prototype.resize=function(i,u){this.width=i,this.height=u,this.pixelsToGLUnits=[2/i,-2/u],this._constrain(),this._calcMatrices()},Pi.unmodified.get=function(){return this._unmodified},la.prototype.zoomScale=function(i){return Math.pow(2,i)},la.prototype.scaleZoom=function(i){return Math.log(i)/Math.LN2},la.prototype.project=function(i){var u=p.clamp(i.lat,-this.maxValidLatitude,this.maxValidLatitude);return new p.Point(p.mercatorXfromLng(i.lng)*this.worldSize,p.mercatorYfromLat(u)*this.worldSize)},la.prototype.unproject=function(i){return new p.MercatorCoordinate(i.x/this.worldSize,i.y/this.worldSize).toLngLat()},Pi.point.get=function(){return this.project(this.center)},la.prototype.setLocationAtPoint=function(i,u){var o=this.pointCoordinate(u),h=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(i),S=new p.MercatorCoordinate(g.x-(o.x-h.x),g.y-(o.y-h.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())},la.prototype.locationPoint=function(i){return this.coordinatePoint(this.locationCoordinate(i))},la.prototype.pointLocation=function(i){return this.coordinateLocation(this.pointCoordinate(i))},la.prototype.locationCoordinate=function(i){return p.MercatorCoordinate.fromLngLat(i)},la.prototype.coordinateLocation=function(i){return i.toLngLat()},la.prototype.pointCoordinate=function(i){var u=[i.x,i.y,0,1],o=[i.x,i.y,1,1];p.transformMat4(u,u,this.pixelMatrixInverse),p.transformMat4(o,o,this.pixelMatrixInverse);var h=u[3],g=o[3],S=u[1]/h,T=o[1]/g,R=u[2]/h,G=o[2]/g,se=R===G?0:(0-R)/(G-R);return new p.MercatorCoordinate(p.number(u[0]/h,o[0]/g,se)/this.worldSize,p.number(S,T,se)/this.worldSize)},la.prototype.coordinatePoint=function(i){var u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix),new p.Point(u[0]/u[3],u[1]/u[3])},la.prototype.getBounds=function(){return new p.LngLatBounds().extend(this.pointLocation(new p.Point(0,0))).extend(this.pointLocation(new p.Point(this.width,0))).extend(this.pointLocation(new p.Point(this.width,this.height))).extend(this.pointLocation(new p.Point(0,this.height)))},la.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new p.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},la.prototype.setMaxBounds=function(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},la.prototype.calculatePosMatrix=function(i,u){u===void 0&&(u=!1);var o=i.key,h=u?this._alignedPosMatrixCache:this._posMatrixCache;if(h[o])return h[o];var g=i.canonical,S=this.worldSize/this.zoomScale(g.z),T=g.x+Math.pow(2,g.z)*i.wrap,R=p.identity(new Float64Array(16));return p.translate(R,R,[T*S,g.y*S,0]),p.scale(R,R,[S/p.EXTENT,S/p.EXTENT,1]),p.multiply(R,u?this.alignedProjMatrix:this.projMatrix,R),h[o]=new Float32Array(R),h[o]},la.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},la.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var i,u,o,h,g=-90,S=90,T=-180,R=180,G=this.size,se=this._unmodified;if(this.latRange){var Ee=this.latRange;g=p.mercatorYfromLat(Ee[1])*this.worldSize,i=(S=p.mercatorYfromLat(Ee[0])*this.worldSize)-g<G.y?G.y/(S-g):0}if(this.lngRange){var we=this.lngRange;T=p.mercatorXfromLng(we[0])*this.worldSize,u=(R=p.mercatorXfromLng(we[1])*this.worldSize)-T<G.x?G.x/(R-T):0}var Pe=this.point,Ye=Math.max(u||0,i||0);if(Ye)return this.center=this.unproject(new p.Point(u?(R+T)/2:Pe.x,i?(S+g)/2:Pe.y)),this.zoom+=this.scaleZoom(Ye),this._unmodified=se,void(this._constraining=!1);if(this.latRange){var We=Pe.y,ut=G.y/2;We-ut<g&&(h=g+ut),We+ut>S&&(h=S-ut)}if(this.lngRange){var Ue=Pe.x,at=G.x/2;Ue-at<T&&(o=T+at),Ue+at>R&&(o=R-at)}o===void 0&&h===void 0||(this.center=this.unproject(new p.Point(o!==void 0?o:Pe.x,h!==void 0?h:Pe.y))),this._unmodified=se,this._constraining=!1}},la.prototype._calcMatrices=function(){if(this.height){var i=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,o=this._fov*(.5+i.y/this.height),h=Math.sin(o)*this.cameraToCenterDistance/Math.sin(p.clamp(Math.PI-u-o,.01,Math.PI-.01)),g=this.point,S=g.x,T=g.y,R=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),G=this.height/50,se=new Float64Array(16);p.perspective(se,this._fov,this.width/this.height,G,R),se[8]=2*-i.x/this.width,se[9]=2*i.y/this.height,p.scale(se,se,[1,-1,1]),p.translate(se,se,[0,0,-this.cameraToCenterDistance]),p.rotateX(se,se,this._pitch),p.rotateZ(se,se,this.angle),p.translate(se,se,[-S,-T,0]),this.mercatorMatrix=p.scale([],se,[this.worldSize,this.worldSize,this.worldSize]),p.scale(se,se,[1,1,p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=se,this.invProjMatrix=p.invert([],this.projMatrix);var Ee=this.width%2/2,we=this.height%2/2,Pe=Math.cos(this.angle),Ye=Math.sin(this.angle),We=S-Math.round(S)+Pe*Ee+Ye*we,ut=T-Math.round(T)+Pe*we+Ye*Ee,Ue=new Float64Array(se);if(p.translate(Ue,Ue,[We>.5?We-1:We,ut>.5?ut-1:ut,0]),this.alignedProjMatrix=Ue,se=p.create(),p.scale(se,se,[this.width/2,-this.height/2,1]),p.translate(se,se,[1,-1,0]),this.labelPlaneMatrix=se,se=p.create(),p.scale(se,se,[1,-1,1]),p.translate(se,se,[-1,-1,0]),p.scale(se,se,[2/this.width,2/this.height,1]),this.glCoordMatrix=se,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(se=p.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=se,this._posMatrixCache={},this._alignedPosMatrixCache={}}},la.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var i=this.pointCoordinate(new p.Point(0,0)),u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},la.prototype.getCameraPoint=function(){var i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,i))},la.prototype.getCameraQueryGeometry=function(i){var u=this.getCameraPoint();if(i.length===1)return[i[0],u];for(var o=u.x,h=u.y,g=u.x,S=u.y,T=0,R=i;T<R.length;T+=1){var G=R[T];o=Math.min(o,G.x),h=Math.min(h,G.y),g=Math.max(g,G.x),S=Math.max(S,G.y)}return[new p.Point(o,h),new p.Point(g,h),new p.Point(g,S),new p.Point(o,S),new p.Point(o,h)]},Object.defineProperties(la.prototype,Pi);var Ps=function(i){var u,o,h,g;this._hashName=i&&encodeURIComponent(i),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),o=!1,h=null,g=function(){h=null,o&&(u(),h=setTimeout(g,300),o=!1)},function(){return o=!0,h||g(),h})};Ps.prototype.addTo=function(i){return this._map=i,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ps.prototype.remove=function(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ps.prototype.getHashString=function(i){var u=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,h=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),S=Math.round(u.lng*g)/g,T=Math.round(u.lat*g)/g,R=this._map.getBearing(),G=this._map.getPitch(),se="";if(se+=i?"/"+S+"/"+T+"/"+o:o+"/"+T+"/"+S,(R||G)&&(se+="/"+Math.round(10*R)/10),G&&(se+="/"+Math.round(G)),this._hashName){var Ee=this._hashName,we=!1,Pe=p.window.location.hash.slice(1).split("&").map(function(Ye){var We=Ye.split("=")[0];return We===Ee?(we=!0,We+"="+se):Ye}).filter(function(Ye){return Ye});return we||Pe.push(Ee+"="+se),"#"+Pe.join("&")}return"#"+se},Ps.prototype._getCurrentHash=function(){var i,u=this,o=p.window.location.hash.replace("#","");return this._hashName?(o.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===u._hashName&&(i=h)}),(i&&i[1]||"").split("/")):o.split("/")},Ps.prototype._onHashChange=function(){var i=this._getCurrentHash();if(i.length>=3&&!i.some(function(o){return isNaN(o)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:u,pitch:+(i[4]||0)}),!0}return!1},Ps.prototype._updateHashUnthrottled=function(){var i=p.window.location.href.replace(/(#.+)?$/,this.getHashString());try{p.window.history.replaceState(p.window.history.state,null,i)}catch(u){}};var tu={linearity:.3,easing:p.bezier(0,0,.3,1)},Zu=p.extend({deceleration:2500,maxSpeed:1400},tu),ts=p.extend({deceleration:20,maxSpeed:1400},tu),pf=p.extend({deceleration:1e3,maxSpeed:360},tu),gc=p.extend({deceleration:1e3,maxSpeed:90},tu),Zl=function(i){this._map=i,this.clear()};function Ul(i,u){(!i.duration||i.duration<u.duration)&&(i.duration=u.duration,i.easing=u.easing)}function yu(i,u,o){var h=o.maxSpeed,g=o.linearity,S=o.deceleration,T=p.clamp(i*g/(u/1e3),-h,h),R=Math.abs(T)/(S*g);return{easing:o.easing,duration:1e3*R,amount:T*(R/2)}}Zl.prototype.clear=function(){this._inertiaBuffer=[]},Zl.prototype.record=function(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.browser.now(),settings:i})},Zl.prototype._drainInertiaBuffer=function(){for(var i=this._inertiaBuffer,u=p.browser.now();i.length>0&&u-i[0].time>160;)i.shift()},Zl.prototype._onMoveEnd=function(i){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0},o=0,h=this._inertiaBuffer;o<h.length;o+=1){var g=h[o].settings;u.zoom+=g.zoomDelta||0,u.bearing+=g.bearingDelta||0,u.pitch+=g.pitchDelta||0,g.panDelta&&u.pan._add(g.panDelta),g.around&&(u.around=g.around),g.pinchAround&&(u.pinchAround=g.pinchAround)}var S=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(u.pan.mag()){var R=yu(u.pan.mag(),S,p.extend({},Zu,i||{}));T.offset=u.pan.mult(R.amount/u.pan.mag()),T.center=this._map.transform.center,Ul(T,R)}if(u.zoom){var G=yu(u.zoom,S,ts);T.zoom=this._map.transform.zoom+G.amount,Ul(T,G)}if(u.bearing){var se=yu(u.bearing,S,pf);T.bearing=this._map.transform.bearing+p.clamp(se.amount,-179,179),Ul(T,se)}if(u.pitch){var Ee=yu(u.pitch,S,gc);T.pitch=this._map.transform.pitch+Ee.amount,Ul(T,Ee)}if(T.zoom||T.bearing){var we=u.pinchAround===void 0?u.around:u.pinchAround;T.around=we?this._map.unproject(we):this._map.getCenter()}return this.clear(),p.extend(T,{noMoveStart:!0})}};var To=function(i){function u(h,g,S,T){T===void 0&&(T={});var R=te.mousePos(g.getCanvasContainer(),S),G=g.unproject(R);i.call(this,h,p.extend({point:R,lngLat:G,originalEvent:S},T)),this._defaultPrevented=!1,this.target=g}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(p.Event),Tu=function(i){function u(h,g,S){var T=h==="touchend"?S.changedTouches:S.touches,R=te.touchPos(g.getCanvasContainer(),T),G=R.map(function(we){return g.unproject(we)}),se=R.reduce(function(we,Pe,Ye,We){return we.add(Pe.div(We.length))},new p.Point(0,0)),Ee=g.unproject(se);i.call(this,h,{points:R,point:se,lngLats:G,lngLat:Ee,originalEvent:S}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(p.Event),Pl=function(i){function u(h,g,S){i.call(this,h,{originalEvent:S}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(p.Event),Po=function(i,u){this._map=i,this._clickTolerance=u.clickTolerance};Po.prototype.reset=function(){delete this._mousedownPos},Po.prototype.wheel=function(i){return this._firePreventable(new Pl(i.type,this._map,i))},Po.prototype.mousedown=function(i,u){return this._mousedownPos=u,this._firePreventable(new To(i.type,this._map,i))},Po.prototype.mouseup=function(i){this._map.fire(new To(i.type,this._map,i))},Po.prototype.click=function(i,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new To(i.type,this._map,i))},Po.prototype.dblclick=function(i){return this._firePreventable(new To(i.type,this._map,i))},Po.prototype.mouseover=function(i){this._map.fire(new To(i.type,this._map,i))},Po.prototype.mouseout=function(i){this._map.fire(new To(i.type,this._map,i))},Po.prototype.touchstart=function(i){return this._firePreventable(new Tu(i.type,this._map,i))},Po.prototype.touchmove=function(i){this._map.fire(new Tu(i.type,this._map,i))},Po.prototype.touchend=function(i){this._map.fire(new Tu(i.type,this._map,i))},Po.prototype.touchcancel=function(i){this._map.fire(new Tu(i.type,this._map,i))},Po.prototype._firePreventable=function(i){if(this._map.fire(i),i.defaultPrevented)return{}},Po.prototype.isEnabled=function(){return!0},Po.prototype.isActive=function(){return!1},Po.prototype.enable=function(){},Po.prototype.disable=function(){};var Vn=function(i){this._map=i};Vn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Vn.prototype.mousemove=function(i){this._map.fire(new To(i.type,this._map,i))},Vn.prototype.mousedown=function(){this._delayContextMenu=!0},Vn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new To("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Vn.prototype.contextmenu=function(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new To(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()},Vn.prototype.isEnabled=function(){return!0},Vn.prototype.isActive=function(){return!1},Vn.prototype.enable=function(){},Vn.prototype.disable=function(){};var Na=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=u.clickTolerance||1};function gu(i,u){for(var o={},h=0;h<i.length;h++)o[i[h].identifier]=u[h];return o}Na.prototype.isEnabled=function(){return!!this._enabled},Na.prototype.isActive=function(){return!!this._active},Na.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Na.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Na.prototype.mousedown=function(i,u){this.isEnabled()&&i.shiftKey&&i.button===0&&(te.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},Na.prototype.mousemoveWindow=function(i,u){if(this._active){var o=u;if(!(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=o,this._box||(this._box=te.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));var g=Math.min(h.x,o.x),S=Math.max(h.x,o.x),T=Math.min(h.y,o.y),R=Math.max(h.y,o.y);te.setTransform(this._box,"translate("+g+"px,"+T+"px)"),this._box.style.width=S-g+"px",this._box.style.height=R-T+"px"}}},Na.prototype.mouseupWindow=function(i,u){var o=this;if(this._active&&i.button===0){var h=this._startPos,g=u;if(this.reset(),te.suppressClick(),h.x!==g.x||h.y!==g.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:function(S){return S.fitScreenCoordinates(h,g,o._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",i)}},Na.prototype.keydown=function(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))},Na.prototype.blur=function(){this.reset()},Na.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(te.remove(this._box),this._box=null),te.enableDrag(),delete this._startPos,delete this._lastPos},Na.prototype._fireEvent=function(i,u){return this._map.fire(new p.Event(i,{originalEvent:u}))};var Uu=function(i){this.reset(),this.numTouches=i.numTouches};Uu.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Uu.prototype.touchstart=function(i,u,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),o.length===this.numTouches&&(this.centroid=function(h){for(var g=new p.Point(0,0),S=0,T=h;S<T.length;S+=1)g._add(T[S]);return g.div(h.length)}(u),this.touches=gu(o,u)))},Uu.prototype.touchmove=function(i,u,o){if(!this.aborted&&this.centroid){var h=gu(o,u);for(var g in this.touches){var S=h[g];(!S||S.dist(this.touches[g])>30)&&(this.aborted=!0)}}},Uu.prototype.touchend=function(i,u,o){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var eo=function(i){this.singleTap=new Uu(i),this.numTaps=i.numTaps,this.reset()};eo.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},eo.prototype.touchstart=function(i,u,o){this.singleTap.touchstart(i,u,o)},eo.prototype.touchmove=function(i,u,o){this.singleTap.touchmove(i,u,o)},eo.prototype.touchend=function(i,u,o){var h=this.singleTap.touchend(i,u,o);if(h){var g=i.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(h)<30;if(g&&S||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var Ms=function(){this._zoomIn=new eo({numTouches:1,numTaps:2}),this._zoomOut=new eo({numTouches:2,numTaps:1}),this.reset()};Ms.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ms.prototype.touchstart=function(i,u,o){this._zoomIn.touchstart(i,u,o),this._zoomOut.touchstart(i,u,o)},Ms.prototype.touchmove=function(i,u,o){this._zoomIn.touchmove(i,u,o),this._zoomOut.touchmove(i,u,o)},Ms.prototype.touchend=function(i,u,o){var h=this,g=this._zoomIn.touchend(i,u,o),S=this._zoomOut.touchend(i,u,o);return g?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(g)},{originalEvent:i})}}):S?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(S)},{originalEvent:i})}}):void 0},Ms.prototype.touchcancel=function(){this.reset()},Ms.prototype.enable=function(){this._enabled=!0},Ms.prototype.disable=function(){this._enabled=!1,this.reset()},Ms.prototype.isEnabled=function(){return this._enabled},Ms.prototype.isActive=function(){return this._active};var _c={0:1,2:2},En=function(i){this.reset(),this._clickTolerance=i.clickTolerance||1};En.prototype.blur=function(){this.reset()},En.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},En.prototype._correctButton=function(i,u){return!1},En.prototype._move=function(i,u){return{}},En.prototype.mousedown=function(i,u){if(!this._lastPoint){var o=te.mouseButton(i);this._correctButton(i,o)&&(this._lastPoint=u,this._eventButton=o)}},En.prototype.mousemoveWindow=function(i,u){var o=this._lastPoint;if(o){if(i.preventDefault(),function(h,g){var S=_c[g];return h.buttons===void 0||(h.buttons&S)!==S}(i,this._eventButton))this.reset();else if(this._moved||!(u.dist(o)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(o,u)}},En.prototype.mouseupWindow=function(i){this._lastPoint&&te.mouseButton(i)===this._eventButton&&(this._moved&&te.suppressClick(),this.reset())},En.prototype.enable=function(){this._enabled=!0},En.prototype.disable=function(){this._enabled=!1,this.reset()},En.prototype.isEnabled=function(){return this._enabled},En.prototype.isActive=function(){return this._active};var Pu=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.mousedown=function(o,h){i.prototype.mousedown.call(this,o,h),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(o,h){return h===0&&!o.ctrlKey},u.prototype._move=function(o,h){return{around:h,panDelta:h.sub(o)}},u}(En),xc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},u.prototype._move=function(o,h){var g=.8*(h.x-o.x);if(g)return this._active=!0,{bearingDelta:g}},u.prototype.contextmenu=function(o){o.preventDefault()},u}(En),lu=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},u.prototype._move=function(o,h){var g=-.5*(h.y-o.y);if(g)return this._active=!0,{pitchDelta:g}},u.prototype.contextmenu=function(o){o.preventDefault()},u}(En),ja=function(i){this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset()};ja.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)},ja.prototype.touchstart=function(i,u,o){return this._calculateTransform(i,u,o)},ja.prototype.touchmove=function(i,u,o){if(this._active&&!(o.length<this._minTouches))return i.preventDefault(),this._calculateTransform(i,u,o)},ja.prototype.touchend=function(i,u,o){this._calculateTransform(i,u,o),this._active&&o.length<this._minTouches&&this.reset()},ja.prototype.touchcancel=function(){this.reset()},ja.prototype._calculateTransform=function(i,u,o){o.length>0&&(this._active=!0);var h=gu(o,u),g=new p.Point(0,0),S=new p.Point(0,0),T=0;for(var R in h){var G=h[R],se=this._touches[R];se&&(g._add(G),S._add(G.sub(se)),T++,h[R]=G)}if(this._touches=h,!(T<this._minTouches)&&S.mag()){var Ee=S.div(T);if(this._sum._add(Ee),!(this._sum.mag()<this._clickTolerance))return{around:g.div(T),panDelta:Ee}}},ja.prototype.enable=function(){this._enabled=!0},ja.prototype.disable=function(){this._enabled=!1,this.reset()},ja.prototype.isEnabled=function(){return this._enabled},ja.prototype.isActive=function(){return this._active};var bs=function(){this.reset()};function Ml(i,u,o){for(var h=0;h<i.length;h++)if(i[h].identifier===o)return u[h]}function Vs(i,u){return Math.log(i/u)/Math.LN2}bs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},bs.prototype._start=function(i){},bs.prototype._move=function(i,u,o){return{}},bs.prototype.touchstart=function(i,u,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([u[0],u[1]]))},bs.prototype.touchmove=function(i,u,o){if(this._firstTwoTouches){i.preventDefault();var h=this._firstTwoTouches,g=h[1],S=Ml(o,u,h[0]),T=Ml(o,u,g);if(S&&T){var R=this._aroundCenter?null:S.add(T).div(2);return this._move([S,T],R,i)}}},bs.prototype.touchend=function(i,u,o){if(this._firstTwoTouches){var h=this._firstTwoTouches,g=h[1],S=Ml(o,u,h[0]),T=Ml(o,u,g);S&&T||(this._active&&te.suppressClick(),this.reset())}},bs.prototype.touchcancel=function(){this.reset()},bs.prototype.enable=function(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"},bs.prototype.disable=function(){this._enabled=!1,this.reset()},bs.prototype.isEnabled=function(){return this._enabled},bs.prototype.isActive=function(){return this._active};var Is=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(o){this._startDistance=this._distance=o[0].dist(o[1])},u.prototype._move=function(o,h){var g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Vs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Vs(this._distance,g),pinchAround:h}},u}(bs);function _u(i,u){return 180*i.angleWith(u)/Math.PI}var Jc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])},u.prototype._move=function(o,h){var g=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_u(this._vector,g),pinchAround:h}},u.prototype._isBelowThreshold=function(o){this._minDiameter=Math.min(this._minDiameter,o.mag());var h=25/(Math.PI*this._minDiameter)*360,g=_u(o,this._startVector);return Math.abs(g)<h},u}(bs);function rc(i){return Math.abs(i.y)>Math.abs(i.x)}var bc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(o){this._lastPoints=o,rc(o[0].sub(o[1]))&&(this._valid=!1)},u.prototype._move=function(o,h,g){var S=o[0].sub(this._lastPoints[0]),T=o[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(S,T,g.timeStamp),this._valid)return this._lastPoints=o,this._active=!0,{pitchDelta:(S.y+T.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(o,h,g){if(this._valid!==void 0)return this._valid;var S=o.mag()>=2,T=h.mag()>=2;if(S||T){if(!S||!T)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;var R=o.y>0==h.y>0;return rc(o)&&rc(h)&&R}},u}(bs),Bo={panStep:100,bearingStep:15,pitchStep:10},Gs=function(){var i=Bo;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1};function Mo(i){return i*(2-i)}Gs.prototype.blur=function(){this.reset()},Gs.prototype.reset=function(){this._active=!1},Gs.prototype.keydown=function(i){var u=this;if(!(i.altKey||i.ctrlKey||i.metaKey)){var o=0,h=0,g=0,S=0,T=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?h=-1:(i.preventDefault(),S=-1);break;case 39:i.shiftKey?h=1:(i.preventDefault(),S=1);break;case 38:i.shiftKey?g=1:(i.preventDefault(),T=-1);break;case 40:i.shiftKey?g=-1:(i.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:function(R){var G=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Mo,zoom:o?Math.round(G)+o*(i.shiftKey?2:1):G,bearing:R.getBearing()+h*u._bearingStep,pitch:R.getPitch()+g*u._pitchStep,offset:[-S*u._panStep,-T*u._panStep],center:R.getCenter()},{originalEvent:i})}}}},Gs.prototype.enable=function(){this._enabled=!0},Gs.prototype.disable=function(){this._enabled=!1,this.reset()},Gs.prototype.isEnabled=function(){return this._enabled},Gs.prototype.isActive=function(){return this._active},Gs.prototype.disableRotation=function(){this._rotationDisabled=!0},Gs.prototype.enableRotation=function(){this._rotationDisabled=!1};var ea=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,p.bindAll(["_onTimeout"],this)};ea.prototype.setZoomRate=function(i){this._defaultZoomRate=i},ea.prototype.setWheelZoomRate=function(i){this._wheelZoomRate=i},ea.prototype.isEnabled=function(){return!!this._enabled},ea.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},ea.prototype.isZooming=function(){return!!this._zooming},ea.prototype.enable=function(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=i&&i.around==="center")},ea.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ea.prototype.wheel=function(i){if(this.isEnabled()){var u=i.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY,o=p.browser.now(),h=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(h*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),i.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=i,this._delta-=u,this._active||this._start(i)),i.preventDefault()}},ea.prototype._onTimeout=function(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)},ea.prototype._start=function(i){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=te.mousePos(this._el,i);this._around=p.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ea.prototype.renderFrame=function(){var i=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var o=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*o)));this._delta<0&&h!==0&&(h=1/h);var g=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(g*h))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var S,T=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,R=this._startZoom,G=this._easing,se=!1;if(this._type==="wheel"&&R&&G){var Ee=Math.min((p.browser.now()-this._lastWheelEventTime)/200,1),we=G(Ee);S=p.number(R,T,we),Ee<1?this._frameId||(this._frameId=!0):se=!0}else S=T,se=!0;return this._active=!0,se&&(this._active=!1,this._finishTimeout=setTimeout(function(){i._zooming=!1,i._handler._triggerRenderFrame(),delete i._targetZoom,delete i._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!se,zoomDelta:S-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ea.prototype._smoothOutEasing=function(i){var u=p.ease;if(this._prevEase){var o=this._prevEase,h=(p.browser.now()-o.start)/o.duration,g=o.easing(h+.01)-o.easing(h),S=.27/Math.sqrt(g*g+1e-4)*.01,T=Math.sqrt(.0729-S*S);u=p.bezier(S,T,.25,1)}return this._prevEase={start:p.browser.now(),duration:i,easing:u},u},ea.prototype.blur=function(){this.reset()},ea.prototype.reset=function(){this._active=!1};var ju=function(i,u){this._clickZoom=i,this._tapZoom=u};ju.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ju.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ju.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ju.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var cu=function(){this.reset()};cu.prototype.reset=function(){this._active=!1},cu.prototype.blur=function(){this.reset()},cu.prototype.dblclick=function(i,u){return i.preventDefault(),{cameraAnimation:function(o){o.easeTo({duration:300,zoom:o.getZoom()+(i.shiftKey?-1:1),around:o.unproject(u)},{originalEvent:i})}}},cu.prototype.enable=function(){this._enabled=!0},cu.prototype.disable=function(){this._enabled=!1,this.reset()},cu.prototype.isEnabled=function(){return this._enabled},cu.prototype.isActive=function(){return this._active};var Wo=function(){this._tap=new eo({numTouches:1,numTaps:1}),this.reset()};Wo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Wo.prototype.touchstart=function(i,u,o){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?o.length>0&&(this._swipePoint=u[0],this._swipeTouch=o[0].identifier):this._tap.touchstart(i,u,o))},Wo.prototype.touchmove=function(i,u,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;var h=u[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,i.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(i,u,o)},Wo.prototype.touchend=function(i,u,o){this._tapTime?this._swipePoint&&o.length===0&&this.reset():this._tap.touchend(i,u,o)&&(this._tapTime=i.timeStamp)},Wo.prototype.touchcancel=function(){this.reset()},Wo.prototype.enable=function(){this._enabled=!0},Wo.prototype.disable=function(){this._enabled=!1,this.reset()},Wo.prototype.isEnabled=function(){return this._enabled},Wo.prototype.isActive=function(){return this._active};var al=function(i,u,o){this._el=i,this._mousePan=u,this._touchPan=o};al.prototype.enable=function(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},al.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},al.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},al.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Mu=function(i,u,o){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=u,this._mousePitch=o};Mu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Mu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Mu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Mu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var xi=function(i,u,o,h){this._el=i,this._touchZoom=u,this._touchRotate=o,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};xi.prototype.enable=function(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},xi.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},xi.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},xi.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},xi.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},xi.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var co=function(i){return i.zoom||i.drag||i.pitch||i.rotate},Il=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u}(p.Event);function Gn(i){return i.panDelta&&i.panDelta.mag()||i.zoomDelta||i.bearingDelta||i.pitchDelta}var Wn=function(i,u){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Zl(i),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),p.bindAll(["handleEvent","handleWindowEvent"],this);var o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[p.window,"blur",void 0]];for(var h=0,g=this._listeners;h<g.length;h+=1){var S=g[h],T=S[0];te.addEventListener(T,S[1],T===p.window.document?this.handleWindowEvent:this.handleEvent,S[2])}};Wn.prototype.destroy=function(){for(var i=0,u=this._listeners;i<u.length;i+=1){var o=u[i],h=o[0];te.removeEventListener(h,o[1],h===p.window.document?this.handleWindowEvent:this.handleEvent,o[2])}},Wn.prototype._addDefaultHandlers=function(i){var u=this._map,o=u.getCanvasContainer();this._add("mapEvent",new Po(u,i));var h=u.boxZoom=new Na(u,i);this._add("boxZoom",h);var g=new Ms,S=new cu;u.doubleClickZoom=new ju(S,g),this._add("tapZoom",g),this._add("clickZoom",S);var T=new Wo;this._add("tapDragZoom",T);var R=u.touchPitch=new bc;this._add("touchPitch",R);var G=new xc(i),se=new lu(i);u.dragRotate=new Mu(i,G,se),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",se,["mouseRotate"]);var Ee=new Pu(i),we=new ja(i);u.dragPan=new al(o,Ee,we),this._add("mousePan",Ee),this._add("touchPan",we,["touchZoom","touchRotate"]);var Pe=new Jc,Ye=new Is;u.touchZoomRotate=new xi(o,Ye,Pe,T),this._add("touchRotate",Pe,["touchPan","touchZoom"]),this._add("touchZoom",Ye,["touchPan","touchRotate"]);var We=u.scrollZoom=new ea(u,this);this._add("scrollZoom",We,["mousePan"]);var ut=u.keyboard=new Gs;this._add("keyboard",ut),this._add("blockableMapEvent",new Vn(u));for(var Ue=0,at=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ue<at.length;Ue+=1){var wt=at[Ue];i.interactive&&i[wt]&&u[wt].enable(i[wt])}},Wn.prototype._add=function(i,u,o){this._handlers.push({handlerName:i,handler:u,allowed:o}),this._handlersById[i]=u},Wn.prototype.stop=function(i){if(!this._updatingCamera){for(var u=0,o=this._handlers;u<o.length;u+=1)o[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}},Wn.prototype.isActive=function(){for(var i=0,u=this._handlers;i<u.length;i+=1)if(u[i].handler.isActive())return!0;return!1},Wn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Wn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Wn.prototype.isMoving=function(){return Boolean(co(this._eventsInProgress))||this.isZooming()},Wn.prototype._blockedByActive=function(i,u,o){for(var h in i)if(h!==o&&(!u||u.indexOf(h)<0))return!0;return!1},Wn.prototype.handleWindowEvent=function(i){this.handleEvent(i,i.type+"Window")},Wn.prototype._getMapTouches=function(i){for(var u=[],o=0,h=i;o<h.length;o+=1){var g=h[o];this._el.contains(g.target)&&u.push(g)}return u},Wn.prototype.handleEvent=function(i,u){this._updatingCamera=!0;for(var o=i.type==="renderFrame"?void 0:i,h={needsRenderFrame:!1},g={},S={},T=i.touches?this._getMapTouches(i.touches):void 0,R=T?te.touchPos(this._el,T):te.mousePos(this._el,i),G=0,se=this._handlers;G<se.length;G+=1){var Ee=se[G],we=Ee.handlerName,Pe=Ee.handler,Ye=Ee.allowed;if(Pe.isEnabled()){var We=void 0;this._blockedByActive(S,Ye,we)?Pe.reset():Pe[u||i.type]&&(We=Pe[u||i.type](i,R,T),this.mergeHandlerResult(h,g,We,we,o),We&&We.needsRenderFrame&&this._triggerRenderFrame()),(We||Pe.isActive())&&(S[we]=Pe)}}var ut={};for(var Ue in this._previousActiveHandlers)S[Ue]||(ut[Ue]=o);this._previousActiveHandlers=S,(Object.keys(ut).length||Gn(h))&&(this._changes.push([h,g,ut]),this._triggerRenderFrame()),(Object.keys(S).length||Gn(h))&&this._map._stop(!0),this._updatingCamera=!1;var at=h.cameraAnimation;at&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],at(this._map))},Wn.prototype.mergeHandlerResult=function(i,u,o,h,g){if(o){p.extend(i,o);var S={handlerName:h,originalEvent:o.originalEvent||g};o.zoomDelta!==void 0&&(u.zoom=S),o.panDelta!==void 0&&(u.drag=S),o.pitchDelta!==void 0&&(u.pitch=S),o.bearingDelta!==void 0&&(u.rotate=S)}},Wn.prototype._applyChanges=function(){for(var i={},u={},o={},h=0,g=this._changes;h<g.length;h+=1){var S=g[h],T=S[0],R=S[1],G=S[2];T.panDelta&&(i.panDelta=(i.panDelta||new p.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(i.around=T.around),T.pinchAround!==void 0&&(i.pinchAround=T.pinchAround),T.noInertia&&(i.noInertia=T.noInertia),p.extend(u,R),p.extend(o,G)}this._updateMapTransform(i,u,o),this._changes=[]},Wn.prototype._updateMapTransform=function(i,u,o){var h=this._map,g=h.transform;if(!Gn(i))return this._fireEvents(u,o,!0);var S=i.panDelta,T=i.zoomDelta,R=i.bearingDelta,G=i.pitchDelta,se=i.around,Ee=i.pinchAround;Ee!==void 0&&(se=Ee),h._stop(!0),se=se||h.transform.centerPoint;var we=g.pointLocation(S?se.sub(S):se);R&&(g.bearing+=R),G&&(g.pitch+=G),T&&(g.zoom+=T),g.setLocationAtPoint(we,se),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(u,o,!0)},Wn.prototype._fireEvents=function(i,u,o){var h=this,g=co(this._eventsInProgress),S=co(i),T={};for(var R in i)this._eventsInProgress[R]||(T[R+"start"]=i[R].originalEvent),this._eventsInProgress[R]=i[R];for(var G in!g&&S&&this._fireEvent("movestart",S.originalEvent),T)this._fireEvent(G,T[G]);for(var se in S&&this._fireEvent("move",S.originalEvent),i)this._fireEvent(se,i[se].originalEvent);var Ee,we={};for(var Pe in this._eventsInProgress){var Ye=this._eventsInProgress[Pe],We=Ye.handlerName,ut=Ye.originalEvent;this._handlersById[We].isActive()||(delete this._eventsInProgress[Pe],we[Pe+"end"]=Ee=u[We]||ut)}for(var Ue in we)this._fireEvent(Ue,we[Ue]);var at=co(this._eventsInProgress);if(o&&(g||S)&&!at){this._updatingCamera=!0;var wt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Xt=function(_r){return _r!==0&&-h._bearingSnap<_r&&_r<h._bearingSnap};wt?(Xt(wt.bearing||this._map.getBearing())&&(wt.bearing=0),this._map.easeTo(wt,{originalEvent:Ee})):(this._map.fire(new p.Event("moveend",{originalEvent:Ee})),Xt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Wn.prototype._fireEvent=function(i,u){this._map.fire(new p.Event(i,u?{originalEvent:u}:{}))},Wn.prototype._requestFrame=function(){var i=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete i._frameId,i.handleEvent(new Il("renderFrame",{timeStamp:u})),i._applyChanges()})},Wn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var ol=function(i){function u(o,h){i.call(this),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getCenter=function(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(o,h){return this.jumpTo({center:o},h)},u.prototype.panBy=function(o,h,g){return o=p.Point.convert(o).mult(-1),this.panTo(this.transform.center,p.extend({offset:o},h),g)},u.prototype.panTo=function(o,h,g){return this.easeTo(p.extend({center:o},h),g)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(o,h){return this.jumpTo({zoom:o},h),this},u.prototype.zoomTo=function(o,h,g){return this.easeTo(p.extend({zoom:o},h),g)},u.prototype.zoomIn=function(o,h){return this.zoomTo(this.getZoom()+1,o,h),this},u.prototype.zoomOut=function(o,h){return this.zoomTo(this.getZoom()-1,o,h),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(o,h){return this.jumpTo({bearing:o},h),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(o,h){return this.jumpTo({padding:o},h),this},u.prototype.rotateTo=function(o,h,g){return this.easeTo(p.extend({bearing:o},h),g)},u.prototype.resetNorth=function(o,h){return this.rotateTo(0,p.extend({duration:1e3},o),h),this},u.prototype.resetNorthPitch=function(o,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},o),h),this},u.prototype.snapToNorth=function(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(o,h){return this.jumpTo({pitch:o},h),this},u.prototype.cameraForBounds=function(o,h){o=p.LngLatBounds.convert(o);var g=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),g,h)},u.prototype._cameraForBoxAndBearing=function(o,h,g,S){var T={top:0,bottom:0,right:0,left:0};if(typeof(S=p.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},S)).padding=="number"){var R=S.padding;S.padding={top:R,bottom:R,right:R,left:R}}S.padding=p.extend(T,S.padding);var G=this.transform,se=G.padding,Ee=G.project(p.LngLat.convert(o)),we=G.project(p.LngLat.convert(h)),Pe=Ee.rotate(-g*Math.PI/180),Ye=we.rotate(-g*Math.PI/180),We=new p.Point(Math.max(Pe.x,Ye.x),Math.max(Pe.y,Ye.y)),ut=new p.Point(Math.min(Pe.x,Ye.x),Math.min(Pe.y,Ye.y)),Ue=We.sub(ut),at=(G.width-(se.left+se.right+S.padding.left+S.padding.right))/Ue.x,wt=(G.height-(se.top+se.bottom+S.padding.top+S.padding.bottom))/Ue.y;if(!(wt<0||at<0)){var Xt=Math.min(G.scaleZoom(G.scale*Math.min(at,wt)),S.maxZoom),_r=typeof S.offset.x=="number"?new p.Point(S.offset.x,S.offset.y):p.Point.convert(S.offset),dr=new p.Point((S.padding.left-S.padding.right)/2,(S.padding.top-S.padding.bottom)/2).rotate(g*Math.PI/180),Cr=_r.add(dr).mult(G.scale/G.zoomScale(Xt));return{center:G.unproject(Ee.add(we).div(2).sub(Cr)),zoom:Xt,bearing:g}}p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(o,h,g){return this._fitInternal(this.cameraForBounds(o,h),h,g)},u.prototype.fitScreenCoordinates=function(o,h,g,S,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(p.Point.convert(o)),this.transform.pointLocation(p.Point.convert(h)),g,S),S,T)},u.prototype._fitInternal=function(o,h,g){return o?(delete(h=p.extend(o,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this},u.prototype.jumpTo=function(o,h){this.stop();var g=this.transform,S=!1,T=!1,R=!1;return"zoom"in o&&g.zoom!==+o.zoom&&(S=!0,g.zoom=+o.zoom),o.center!==void 0&&(g.center=p.LngLat.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(T=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(R=!0,g.pitch=+o.pitch),o.padding==null||g.isPaddingEqual(o.padding)||(g.padding=o.padding),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),S&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),T&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),R&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h))},u.prototype.easeTo=function(o,h){var g=this;this._stop(!1,o.easeId),((o=p.extend({offset:[0,0],duration:500,easing:p.ease},o)).animate===!1||!o.essential&&p.browser.prefersReducedMotion)&&(o.duration=0);var S=this.transform,T=this.getZoom(),R=this.getBearing(),G=this.getPitch(),se=this.getPadding(),Ee="zoom"in o?+o.zoom:T,we="bearing"in o?this._normalizeBearing(o.bearing,R):R,Pe="pitch"in o?+o.pitch:G,Ye="padding"in o?o.padding:S.padding,We=p.Point.convert(o.offset),ut=S.centerPoint.add(We),Ue=S.pointLocation(ut),at=p.LngLat.convert(o.center||Ue);this._normalizeCenter(at);var wt,Xt,_r=S.project(Ue),dr=S.project(at).sub(_r),Cr=S.zoomScale(Ee-T);o.around&&(wt=p.LngLat.convert(o.around),Xt=S.locationPoint(wt));var Gr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ee!==T,this._rotating=this._rotating||R!==we,this._pitching=this._pitching||Pe!==G,this._padding=!S.isPaddingEqual(Ye),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,Gr),this._ease(function(pn){if(g._zooming&&(S.zoom=p.number(T,Ee,pn)),g._rotating&&(S.bearing=p.number(R,we,pn)),g._pitching&&(S.pitch=p.number(G,Pe,pn)),g._padding&&(S.interpolatePadding(se,Ye,pn),ut=S.centerPoint.add(We)),wt)S.setLocationAtPoint(wt,Xt);else{var an=S.zoomScale(S.zoom-T),Zn=Ee>T?Math.min(2,Cr):Math.max(.5,Cr),ui=Math.pow(Zn,1-pn),di=S.unproject(_r.add(dr.mult(pn*ui)).mult(an));S.setLocationAtPoint(S.renderWorldCopies?di.wrap():di,ut)}g._fireMoveEvents(h)},function(pn){g._afterEase(h,pn)},o),this},u.prototype._prepareEase=function(o,h,g){g===void 0&&(g={}),this._moving=!0,h||g.moving||this.fire(new p.Event("movestart",o)),this._zooming&&!g.zooming&&this.fire(new p.Event("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new p.Event("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new p.Event("pitchstart",o))},u.prototype._fireMoveEvents=function(o){this.fire(new p.Event("move",o)),this._zooming&&this.fire(new p.Event("zoom",o)),this._rotating&&this.fire(new p.Event("rotate",o)),this._pitching&&this.fire(new p.Event("pitch",o))},u.prototype._afterEase=function(o,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var g=this._zooming,S=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new p.Event("zoomend",o)),S&&this.fire(new p.Event("rotateend",o)),T&&this.fire(new p.Event("pitchend",o)),this.fire(new p.Event("moveend",o))}},u.prototype.flyTo=function(o,h){var g=this;if(!o.essential&&p.browser.prefersReducedMotion){var S=p.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(S,h)}this.stop(),o=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},o);var T=this.transform,R=this.getZoom(),G=this.getBearing(),se=this.getPitch(),Ee=this.getPadding(),we="zoom"in o?p.clamp(+o.zoom,T.minZoom,T.maxZoom):R,Pe="bearing"in o?this._normalizeBearing(o.bearing,G):G,Ye="pitch"in o?+o.pitch:se,We="padding"in o?o.padding:T.padding,ut=T.zoomScale(we-R),Ue=p.Point.convert(o.offset),at=T.centerPoint.add(Ue),wt=T.pointLocation(at),Xt=p.LngLat.convert(o.center||wt);this._normalizeCenter(Xt);var _r=T.project(wt),dr=T.project(Xt).sub(_r),Cr=o.curve,Gr=Math.max(T.width,T.height),pn=Gr/ut,an=dr.mag();if("minZoom"in o){var Zn=p.clamp(Math.min(o.minZoom,R,we),T.minZoom,T.maxZoom),ui=Gr/T.zoomScale(Zn-R);Cr=Math.sqrt(ui/an*2)}var di=Cr*Cr;function dn(X){var Q=(pn*pn-Gr*Gr+(X?-1:1)*di*di*an*an)/(2*(X?pn:Gr)*di*an);return Math.log(Math.sqrt(Q*Q+1)-Q)}function ia(X){return(Math.exp(X)-Math.exp(-X))/2}function Hn(X){return(Math.exp(X)+Math.exp(-X))/2}var bi=dn(0),Hi=function(X){return Hn(bi)/Hn(bi+Cr*X)},mi=function(X){return Gr*((Hn(bi)*(ia(Q=bi+Cr*X)/Hn(Q))-ia(bi))/di)/an;var Q},Ci=(dn(1)-bi)/Cr;if(Math.abs(an)<1e-6||!isFinite(Ci)){if(Math.abs(Gr-pn)<1e-6)return this.easeTo(o,h);var Vi=pn<Gr?-1:1;Ci=Math.abs(Math.log(pn/Gr))/Cr,mi=function(){return 0},Hi=function(X){return Math.exp(Vi*Cr*X)}}return o.duration="duration"in o?+o.duration:1e3*Ci/("screenSpeed"in o?+o.screenSpeed/Cr:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=G!==Pe,this._pitching=Ye!==se,this._padding=!T.isPaddingEqual(We),this._prepareEase(h,!1),this._ease(function(X){var Q=X*Ci,D=1/Hi(Q);T.zoom=X===1?we:R+T.scaleZoom(D),g._rotating&&(T.bearing=p.number(G,Pe,X)),g._pitching&&(T.pitch=p.number(se,Ye,X)),g._padding&&(T.interpolatePadding(Ee,We,X),at=T.centerPoint.add(Ue));var k=X===1?Xt:T.unproject(_r.add(dr.mult(mi(Q))).mult(D));T.setLocationAtPoint(T.renderWorldCopies?k.wrap():k,at),g._fireMoveEvents(h)},function(){return g._afterEase(h)},o),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,h)}if(!o){var S=this.handlers;S&&S.stop(!1)}return this},u.prototype._ease=function(o,h,g){g.animate===!1||g.duration===0?(o(1),h()):(this._easeStart=p.browser.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var o=Math.min((p.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(o,h){o=p.wrap(o,-180,180);var g=Math.abs(o-h);return Math.abs(o-360-h)<g&&(o-=360),Math.abs(o+360-h)<g&&(o+=360),o},u.prototype._normalizeCenter=function(o){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var g=o.lng-h.center.lng;o.lng+=g>180?-360:g<-180?360:0}},u}(p.Evented),ls=function(i){i===void 0&&(i={}),this.options=i,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ls.prototype.getDefaultPosition=function(){return"bottom-right"},ls.prototype.onAdd=function(i){var u=this.options&&this.options.compact;return this._map=i,this._container=te.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=te.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=te.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ls.prototype.onRemove=function(){te.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ls.prototype._setElementTitle=function(i,u){var o=this._map._getUIString("AttributionControl."+u);i.title=o,i.setAttribute("aria-label",o)},ls.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ls.prototype._updateEditLink=function(){var i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(i){var o=u.reduce(function(h,g,S){return g.value&&(h+=g.key+"="+g.value+(S<u.length-1?"&":"")),h},"?");i.href=p.config.FEEDBACK_URL+"/"+o+(this._map._hash?this._map._hash.getHashString(!0):""),i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}},ls.prototype._updateData=function(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ls.prototype._updateAttributions=function(){if(this._map.style){var i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(function(R){return typeof R!="string"?"":R})):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var o=this._map.style.sourceCaches;for(var h in o){var g=o[h];if(g.used){var S=g.getSource();S.attribution&&i.indexOf(S.attribution)<0&&i.push(S.attribution)}}i.sort(function(R,G){return R.length-G.length});var T=(i=i.filter(function(R,G){for(var se=G+1;se<i.length;se++)if(i[se].indexOf(R)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,i.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ls.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var cs=function(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)};cs.prototype.onAdd=function(i){this._map=i,this._container=te.create("div","mapboxgl-ctrl");var u=te.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},cs.prototype.onRemove=function(){te.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},cs.prototype.getDefaultPosition=function(){return"bottom-left"},cs.prototype._updateLogo=function(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},cs.prototype._logoRequired=function(){if(this._map.style){var i=this._map.style.sourceCaches;for(var u in i)if(i[u].getSource().mapbox_logo)return!0;return!1}},cs.prototype._updateCompact=function(){var i=this._container.children;if(i.length){var u=i[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var Io=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Io.prototype.add=function(i){var u=++this._id;return this._queue.push({callback:i,id:u,cancelled:!1}),u},Io.prototype.remove=function(i){for(var u=this._currentlyRunning,o=0,h=u?this._queue.concat(u):this._queue;o<h.length;o+=1){var g=h[o];if(g.id===i)return void(g.cancelled=!0)}},Io.prototype.run=function(i){i===void 0&&(i=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var o=0,h=u;o<h.length;o+=1){var g=h[o];if(!g.cancelled&&(g.callback(i),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Io.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var ru={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Sc=p.window.HTMLImageElement,nc=p.window.HTMLElement,Xi=p.window.ImageBitmap,ji={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Qc=function(i){function u(h){var g=this;if((h=p.extend({},ji,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var S=new la(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(i.call(this,S,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new Io,this._controls=[],this._mapId=p.uniqueId(),this._locale=p.extend({},ru,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new p.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=p.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof nc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return g._update(!1)}),this.on("moveend",function(){return g._update(!1)}),this.on("zoom",function(){return g._update(!0)}),p.window!==void 0&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Wn(this,h),this._hash=h.hash&&new Ps(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,p.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new ls({customAttribution:h.customAttribution})),this.addControl(new cs,h.logoPosition),this.on("style.load",function(){g.transform.unmodified&&g.jumpTo(g.style.stylesheet)}),this.on("data",function(T){g._update(T.dataType==="style"),g.fire(new p.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){g.fire(new p.Event(T.dataType+"dataloading",T))})}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(h,g){if(g===void 0&&(g=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var S=h.onAdd(this);this._controls.push(h);var T=this._controlPositions[g];return g.indexOf("bottom")!==-1?T.insertBefore(S,T.firstChild):T.appendChild(S),this},u.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var g=this._controls.indexOf(h);return g>-1&&this._controls.splice(g,1),h.onRemove(this),this},u.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},u.prototype.resize=function(h){var g=this._containerDimensions(),S=g[0],T=g[1];if(S===this.transform.width&&T===this.transform.height)return this;this._resizeCanvas(S,T),this.transform.resize(S,T),this.painter.resize(S,T);var R=!this._moving;return R&&this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),this.fire(new p.Event("resize",h)),R&&this.fire(new p.Event("moveend",h)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(p.LngLatBounds.convert(h)),this._update()},u.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},u.prototype.project=function(h){return this.transform.locationPoint(p.LngLat.convert(h))},u.prototype.unproject=function(h){return this.transform.pointLocation(p.Point.convert(h))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(h,g,S){var T,R=this;if(h==="mouseenter"||h==="mouseover"){var G=!1;return{layer:g,listener:S,delegates:{mousemove:function(Ee){var we=R.getLayer(g)?R.queryRenderedFeatures(Ee.point,{layers:[g]}):[];we.length?G||(G=!0,S.call(R,new To(h,R,Ee.originalEvent,{features:we}))):G=!1},mouseout:function(){G=!1}}}}if(h==="mouseleave"||h==="mouseout"){var se=!1;return{layer:g,listener:S,delegates:{mousemove:function(Ee){(R.getLayer(g)?R.queryRenderedFeatures(Ee.point,{layers:[g]}):[]).length?se=!0:se&&(se=!1,S.call(R,new To(h,R,Ee.originalEvent)))},mouseout:function(Ee){se&&(se=!1,S.call(R,new To(h,R,Ee.originalEvent)))}}}}return{layer:g,listener:S,delegates:(T={},T[h]=function(Ee){var we=R.getLayer(g)?R.queryRenderedFeatures(Ee.point,{layers:[g]}):[];we.length&&(Ee.features=we,S.call(R,Ee),delete Ee.features)},T)}},u.prototype.on=function(h,g,S){if(S===void 0)return i.prototype.on.call(this,h,g);var T=this._createDelegatedListener(h,g,S);for(var R in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(T),T.delegates)this.on(R,T.delegates[R]);return this},u.prototype.once=function(h,g,S){if(S===void 0)return i.prototype.once.call(this,h,g);var T=this._createDelegatedListener(h,g,S);for(var R in T.delegates)this.once(R,T.delegates[R]);return this},u.prototype.off=function(h,g,S){var T=this;return S===void 0?i.prototype.off.call(this,h,g):(this._delegatedListeners&&this._delegatedListeners[h]&&function(R){for(var G=R[h],se=0;se<G.length;se++){var Ee=G[se];if(Ee.layer===g&&Ee.listener===S){for(var we in Ee.delegates)T.off(we,Ee.delegates[we]);return G.splice(se,1),T}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(h,g){if(!this.style)return[];var S;if(g!==void 0||h===void 0||h instanceof p.Point||Array.isArray(h)||(g=h,h=void 0),g=g||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof p.Point||typeof h[0]=="number")S=[p.Point.convert(h)];else{var T=p.Point.convert(h[0]),R=p.Point.convert(h[1]);S=[T,new p.Point(R.x,T.y),R,new p.Point(T.x,R.y),T]}return this.style.queryRenderedFeatures(S,g,this.transform)},u.prototype.querySourceFeatures=function(h,g){return this.style.querySourceFeatures(h,g)},u.prototype.setStyle=function(h,g){return(g=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},g)).diff!==!1&&g.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,g),this):(this._localIdeographFontFamily=g.localIdeographFontFamily,this._updateStyle(h,g))},u.prototype._getUIString=function(h){var g=this._locale[h];if(g==null)throw new Error("Missing UI string '"+h+"'");return g},u.prototype._updateStyle=function(h,g){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new Ts(this,g||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ts(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(h,g){var S=this;if(typeof h=="string"){var T=this._requestManager.normalizeStyleURL(h),R=this._requestManager.transformRequest(T,p.ResourceType.Style);p.getJSON(R,function(G,se){G?S.fire(new p.ErrorEvent(G)):se&&S._updateDiff(se,g)})}else typeof h=="object"&&this._updateDiff(h,g)},u.prototype._updateDiff=function(h,g){try{this.style.setState(h)&&this._update(!0)}catch(S){p.warnOnce("Unable to perform style diff: "+(S.message||S.error||S)+".  Rebuilding the style from scratch."),this._updateStyle(h,g)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(h,g){return this._lazyInitEmptyStyle(),this.style.addSource(h,g),this._update(!0)},u.prototype.isSourceLoaded=function(h){var g=this.style&&this.style.sourceCaches[h];if(g!==void 0)return g.loaded();this.fire(new p.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},u.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var g in h){var S=h[g]._tiles;for(var T in S){var R=S[T];if(R.state!=="loaded"&&R.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(h,g,S){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,g,S)},u.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},u.prototype.getSource=function(h){return this.style.getSource(h)},u.prototype.addImage=function(h,g,S){S===void 0&&(S={});var T=S.pixelRatio;T===void 0&&(T=1);var R=S.sdf;R===void 0&&(R=!1);var G=S.stretchX,se=S.stretchY,Ee=S.content;if(this._lazyInitEmptyStyle(),g instanceof Sc||Xi&&g instanceof Xi){var we=p.browser.getImageData(g);this.style.addImage(h,{data:new p.RGBAImage({width:we.width,height:we.height},we.data),pixelRatio:T,stretchX:G,stretchY:se,content:Ee,sdf:R,version:0})}else{if(g.width===void 0||g.height===void 0)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Pe=g;this.style.addImage(h,{data:new p.RGBAImage({width:g.width,height:g.height},new Uint8Array(g.data)),pixelRatio:T,stretchX:G,stretchY:se,content:Ee,sdf:R,version:0,userImage:Pe}),Pe.onAdd&&Pe.onAdd(this,h)}},u.prototype.updateImage=function(h,g){var S=this.style.getImage(h);if(!S)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=g instanceof Sc||Xi&&g instanceof Xi?p.browser.getImageData(g):g,R=T.width,G=T.height,se=T.data;return R===void 0||G===void 0?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):R!==S.data.width||G!==S.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(S.data.replace(se,!(g instanceof Sc||Xi&&g instanceof Xi)),void this.style.updateImage(h,S))},u.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(h){this.style.removeImage(h)},u.prototype.loadImage=function(h,g){p.getImage(this._requestManager.transformRequest(h,p.ResourceType.Image),g)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(h,g){return this._lazyInitEmptyStyle(),this.style.addLayer(h,g),this._update(!0)},u.prototype.moveLayer=function(h,g){return this.style.moveLayer(h,g),this._update(!0)},u.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},u.prototype.getLayer=function(h){return this.style.getLayer(h)},u.prototype.setLayerZoomRange=function(h,g,S){return this.style.setLayerZoomRange(h,g,S),this._update(!0)},u.prototype.setFilter=function(h,g,S){return S===void 0&&(S={}),this.style.setFilter(h,g,S),this._update(!0)},u.prototype.getFilter=function(h){return this.style.getFilter(h)},u.prototype.setPaintProperty=function(h,g,S,T){return T===void 0&&(T={}),this.style.setPaintProperty(h,g,S,T),this._update(!0)},u.prototype.getPaintProperty=function(h,g){return this.style.getPaintProperty(h,g)},u.prototype.setLayoutProperty=function(h,g,S,T){return T===void 0&&(T={}),this.style.setLayoutProperty(h,g,S,T),this._update(!0)},u.prototype.getLayoutProperty=function(h,g){return this.style.getLayoutProperty(h,g)},u.prototype.setLight=function(h,g){return g===void 0&&(g={}),this._lazyInitEmptyStyle(),this.style.setLight(h,g),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(h,g){return this.style.setFeatureState(h,g),this._update()},u.prototype.removeFeatureState=function(h,g){return this.style.removeFeatureState(h,g),this._update()},u.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var h=0,g=0;return this._container&&(h=this._container.clientWidth||400,g=this._container.clientHeight||300),[h,g]},u.prototype._detectMissingCSS=function(){p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=te.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var g=this._canvasContainer=te.create("div","mapboxgl-canvas-container",h);this._interactive&&g.classList.add("mapboxgl-interactive"),this._canvas=te.create("canvas","mapboxgl-canvas",g),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var S=this._containerDimensions();this._resizeCanvas(S[0],S[1]);var T=this._controlContainer=te.create("div","mapboxgl-control-container",h),R=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(G){R[G]=te.create("div","mapboxgl-ctrl-"+G,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(h,g){var S=p.browser.devicePixelRatio||1;this._canvas.width=S*h,this._canvas.height=S*g,this._canvas.style.width=h+"px",this._canvas.style.height=g+"px"},u.prototype._setupPainter=function(){var h=p.extend({},me.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),g=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);g?(this.painter=new qa(g,this.transform),p.webpSupported.testSupport(g)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:h}))},u.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:h}))},u.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},u.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},u.prototype._render=function(h){var g,S=this,T=0,R=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(g=R.createQueryEXT(),R.beginQueryEXT(R.TIME_ELAPSED_EXT,g),T=p.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var se=this.transform.zoom,Ee=p.browser.now();this.style.zoomHistory.update(se,Ee);var we=new p.EvaluationParameters(se,{now:Ee,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Pe=we.crossFadingFactor();Pe===1&&Pe===this._crossFadingFactor||(G=!0,this._crossFadingFactor=Pe),this.style.update(we)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ye=p.browser.now()-T;R.endQueryEXT(R.TIME_ELAPSED_EXT,g),setTimeout(function(){var Ue=R.getQueryObjectEXT(g,R.QUERY_RESULT_EXT)/1e6;R.deleteQueryEXT(g),S.fire(new p.Event("gpu-timing-frame",{cpuTime:Ye,gpuTime:Ue}))},50)}if(this.listens("gpu-timing-layer")){var We=this.painter.collectGpuTimers();setTimeout(function(){var Ue=S.painter.queryGpuTimers(We);S.fire(new p.Event("gpu-timing-layer",{layerTimes:Ue}))},50)}var ut=this._sourcesDirty||this._styleDirty||this._placementDirty;return ut||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.Event("idle")),!this._loaded||this._fullyLoaded||ut||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,g=this._controls;h<g.length;h+=1)g[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),p.window!==void 0&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));var S=this.painter.context.gl.getExtension("WEBGL_lose_context");S&&S.loseContext(),Bs(this._canvasContainer),Bs(this._controlContainer),Bs(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new p.Event("remove"))},u.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=p.browser.frame(function(g){h._frame=null,h._render(g)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(h){this._vertices=h,this._update()},u.prototype._setCacheLimits=function(h,g){p.setCacheLimits(h,g)},o.version.get=function(){return p.version},Object.defineProperties(u.prototype,o),u}(ol);function Bs(i){i.parentNode&&i.parentNode.removeChild(i)}var Ol={showCompass:!0,showZoom:!0,visualizePitch:!1},Os=function(i){var u=this;this.options=p.extend({},Ol,i),this._container=te.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(o){return o.preventDefault()}),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(o){return u._map.zoomIn({},{originalEvent:o})}),te.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(o){return u._map.zoomOut({},{originalEvent:o})}),te.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(o){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:o}):u._map.resetNorth({},{originalEvent:o})}),this._compassIcon=te.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Os.prototype._updateZoomButtons=function(){var i=this._map.getZoom(),u=i===this._map.getMaxZoom(),o=i===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},Os.prototype._rotateCompassArrow=function(){var i=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=i},Os.prototype.onAdd=function(i){return this._map=i,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ya(this._map,this._compass,this.options.visualizePitch)),this._container},Os.prototype.onRemove=function(){te.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Os.prototype._createButton=function(i,u){var o=te.create("button",i,this._container);return o.type="button",o.addEventListener("click",u),o},Os.prototype._setButtonTitle=function(i,u){var o=this._map._getUIString("NavigationControl."+u);i.title=o,i.setAttribute("aria-label",o)};var Ya=function(i,u,o){o===void 0&&(o=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new xc({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,o&&(this.mousePitch=new lu({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),te.addEventListener(u,"mousedown",this.mousedown),te.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),te.addEventListener(u,"touchmove",this.touchmove),te.addEventListener(u,"touchend",this.touchend),te.addEventListener(u,"touchcancel",this.reset)};function Hs(i,u,o){if(i=new p.LngLat(i.lng,i.lat),u){var h=new p.LngLat(i.lng-360,i.lat),g=new p.LngLat(i.lng+360,i.lat),S=o.locationPoint(i).distSqr(u);o.locationPoint(h).distSqr(u)<S?i=h:o.locationPoint(g).distSqr(u)<S&&(i=g)}for(;Math.abs(i.lng-o.center.lng)>180;){var T=o.locationPoint(i);if(T.x>=0&&T.y>=0&&T.x<=o.width&&T.y<=o.height)break;i.lng>o.center.lng?i.lng-=360:i.lng+=360}return i}Ya.prototype.down=function(i,u){this.mouseRotate.mousedown(i,u),this.mousePitch&&this.mousePitch.mousedown(i,u),te.disableDrag()},Ya.prototype.move=function(i,u){var o=this.map,h=this.mouseRotate.mousemoveWindow(i,u);if(h&&h.bearingDelta&&o.setBearing(o.getBearing()+h.bearingDelta),this.mousePitch){var g=this.mousePitch.mousemoveWindow(i,u);g&&g.pitchDelta&&o.setPitch(o.getPitch()+g.pitchDelta)}},Ya.prototype.off=function(){var i=this.element;te.removeEventListener(i,"mousedown",this.mousedown),te.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),te.removeEventListener(i,"touchmove",this.touchmove),te.removeEventListener(i,"touchend",this.touchend),te.removeEventListener(i,"touchcancel",this.reset),this.offTemp()},Ya.prototype.offTemp=function(){te.enableDrag(),te.removeEventListener(p.window,"mousemove",this.mousemove),te.removeEventListener(p.window,"mouseup",this.mouseup)},Ya.prototype.mousedown=function(i){this.down(p.extend({},i,{ctrlKey:!0,preventDefault:function(){return i.preventDefault()}}),te.mousePos(this.element,i)),te.addEventListener(p.window,"mousemove",this.mousemove),te.addEventListener(p.window,"mouseup",this.mouseup)},Ya.prototype.mousemove=function(i){this.move(i,te.mousePos(this.element,i))},Ya.prototype.mouseup=function(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()},Ya.prototype.touchstart=function(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=te.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return i.preventDefault()}},this._startPos))},Ya.prototype.touchmove=function(i){i.targetTouches.length!==1?this.reset():(this._lastPos=te.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:function(){return i.preventDefault()}},this._lastPos))},Ya.prototype.touchend=function(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ya.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Ss={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vu(i,u,o){var h=i.classList;for(var g in Ss)h.remove("mapboxgl-"+o+"-anchor-"+g);h.add("mapboxgl-"+o+"-anchor-"+u)}var sl,Ll=function(i){function u(o,h){if(i.call(this),(o instanceof p.window.HTMLElement||h)&&(o=p.extend({element:o},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=p.Point.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=te.create("div"),this._element.setAttribute("aria-label","Map marker");var g=te.createNS("http://www.w3.org/2000/svg","svg");g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height","41px"),g.setAttributeNS(null,"width","27px"),g.setAttributeNS(null,"viewBox","0 0 27 41");var S=te.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");var T=te.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var R=te.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");for(var G=0,se=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];G<se.length;G+=1){var Ee=se[G],we=te.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",Ee.rx),we.setAttributeNS(null,"ry",Ee.ry),R.appendChild(we)}var Pe=te.createNS("http://www.w3.org/2000/svg","g");Pe.setAttributeNS(null,"fill",this._color);var Ye=te.createNS("http://www.w3.org/2000/svg","path");Ye.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Pe.appendChild(Ye);var We=te.createNS("http://www.w3.org/2000/svg","g");We.setAttributeNS(null,"opacity","0.25"),We.setAttributeNS(null,"fill","#000000");var ut=te.createNS("http://www.w3.org/2000/svg","path");ut.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),We.appendChild(ut);var Ue=te.createNS("http://www.w3.org/2000/svg","g");Ue.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ue.setAttributeNS(null,"fill","#FFFFFF");var at=te.createNS("http://www.w3.org/2000/svg","g");at.setAttributeNS(null,"transform","translate(8.0, 8.0)");var wt=te.createNS("http://www.w3.org/2000/svg","circle");wt.setAttributeNS(null,"fill","#000000"),wt.setAttributeNS(null,"opacity","0.25"),wt.setAttributeNS(null,"cx","5.5"),wt.setAttributeNS(null,"cy","5.5"),wt.setAttributeNS(null,"r","5.4999962");var Xt=te.createNS("http://www.w3.org/2000/svg","circle");Xt.setAttributeNS(null,"fill","#FFFFFF"),Xt.setAttributeNS(null,"cx","5.5"),Xt.setAttributeNS(null,"cy","5.5"),Xt.setAttributeNS(null,"r","5.4999962"),at.appendChild(wt),at.appendChild(Xt),T.appendChild(R),T.appendChild(Pe),T.appendChild(We),T.appendChild(Ue),T.appendChild(at),g.appendChild(T),g.setAttributeNS(null,"height",41*this._scale+"px"),g.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(g),this._offset=p.Point.convert(o&&o.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(_r){_r.preventDefault()}),this._element.addEventListener("mousedown",function(_r){_r.preventDefault()}),Vu(this._element,this._anchor,"marker"),this._popup=null}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),te.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(o){return this._lngLat=p.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(o){var h=o.code,g=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()},u.prototype._onMapClick=function(o){var h=o.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this},u.prototype._update=function(o){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Hs(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g="rotateX("+this._map.getPitch()+"deg)"),o&&o.type!=="moveend"||(this._pos=this._pos.round()),te.setTransform(this._element,Ss[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+g+" "+h)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(o){return this._offset=p.Point.convert(o),this._update(),this},u.prototype._onMove=function(o){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new p.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(o){return this._rotation=o||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(o){return this._rotationAlignment=o||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(p.Evented),Ec={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ul=0,Gu=!1,ll=function(i){function u(o){i.call(this),this.options=p.extend({},Ec,o),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(o){var h;return this._map=o,this._container=te.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,sl!==void 0?h(sl):p.window.navigator.permissions!==void 0?p.window.navigator.permissions.query({name:"geolocation"}).then(function(g){h(sl=g.state!=="denied")}):h(sl=!!p.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),te.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ul=0,Gu=!1},u.prototype._isOutOfMapMaxBounds=function(o){var h=this._map.getMaxBounds(),g=o.coords;return h&&(g.longitude<h.getWest()||g.longitude>h.getEast()||g.latitude<h.getSouth()||g.latitude>h.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(o){if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",o)),this._finish()}},u.prototype._updateCamera=function(o){var h=new p.LngLat(o.coords.longitude,o.coords.latitude),g=o.coords.accuracy,S=this._map.getBearing(),T=p.extend({bearing:S},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(g),T,{geolocateSource:!0})},u.prototype._updateMarker=function(o){if(o){var h=new p.LngLat(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var o=this._map._container.clientHeight/2,h=this._map.unproject([0,o]),g=this._map.unproject([1,o]),S=h.distanceTo(g),T=Math.ceil(2*this._accuracy/S);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(o){if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&Gu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",o)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(o){var h=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=te.create("button","mapboxgl-ctrl-geolocate",this._container),te.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",o===!1){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{var S=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=te.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ll(this._dotElement),this._circleElement=te.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ll({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||h._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new p.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ul--,Gu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var o;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++ul>1?(o={maximumAge:6e5,timeout:0},Gu=!0):(o=this.options.positionOptions,Gu=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,o)}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(p.Evented),xu={maxWidth:100,unit:"metric"},Hu=function(i){this.options=p.extend({},xu,i),p.bindAll(["_onMove","setUnit"],this)};function Cc(i,u,o){var h=o&&o.maxWidth||100,g=i._container.clientHeight/2,S=i.unproject([0,g]),T=i.unproject([h,g]),R=S.distanceTo(T);if(o&&o.unit==="imperial"){var G=3.2808*R;G>5280?Iu(u,h,G/5280,i._getUIString("ScaleControl.Miles")):Iu(u,h,G,i._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Iu(u,h,R/1852,i._getUIString("ScaleControl.NauticalMiles")):R>=1e3?Iu(u,h,R/1e3,i._getUIString("ScaleControl.Kilometers")):Iu(u,h,R,i._getUIString("ScaleControl.Meters"))}function Iu(i,u,o,h){var g,S,T,R=(g=o,(S=Math.pow(10,(""+Math.floor(g)).length-1))*(T=(T=g/S)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(G){var se=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*se)/se}(T)));i.style.width=u*(R/o)+"px",i.innerHTML=R+"&nbsp;"+h}Hu.prototype.getDefaultPosition=function(){return"bottom-left"},Hu.prototype._onMove=function(){Cc(this._map,this._container,this.options)},Hu.prototype.onAdd=function(i){return this._map=i,this._container=te.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",i.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Hu.prototype.onRemove=function(){te.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Hu.prototype.setUnit=function(i){this.options.unit=i,Cc(this._map,this._container,this.options)};var Ns=function(i){this._fullscreen=!1,i&&i.container&&(i.container instanceof p.window.HTMLElement?this._container=i.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in p.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in p.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in p.window.document&&(this._fullscreenchange="MSFullscreenChange")};Ns.prototype.onAdd=function(i){return this._map=i,this._container||(this._container=this._map.getContainer()),this._controlContainer=te.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Ns.prototype.onRemove=function(){te.remove(this._controlContainer),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Ns.prototype._checkFullscreenSupport=function(){return!!(p.window.document.fullscreenEnabled||p.window.document.mozFullScreenEnabled||p.window.document.msFullscreenEnabled||p.window.document.webkitFullscreenEnabled)},Ns.prototype._setupUI=function(){var i=this._fullscreenButton=te.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);te.create("span","mapboxgl-ctrl-icon",i).setAttribute("aria-hidden",!0),i.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Ns.prototype._updateTitle=function(){var i=this._getTitle();this._fullscreenButton.setAttribute("aria-label",i),this._fullscreenButton.title=i},Ns.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Ns.prototype._isFullscreen=function(){return this._fullscreen},Ns.prototype._changeIcon=function(){(p.window.document.fullscreenElement||p.window.document.mozFullScreenElement||p.window.document.webkitFullscreenElement||p.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Ns.prototype._onClickFullscreen=function(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.mozCancelFullScreen?p.window.document.mozCancelFullScreen():p.window.document.msExitFullscreen?p.window.document.msExitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var wc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ic=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),jl=function(i){function u(o){i.call(this),this.options=p.extend(Object.create(wc),o),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(o){return this._map&&this.remove(),this._map=o,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&te.remove(this._content),this._container&&(te.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(o){return this._lngLat=p.LngLat.convert(o),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(o){return this.setDOMContent(p.window.document.createTextNode(o))},u.prototype.setHTML=function(o){var h,g=p.window.document.createDocumentFragment(),S=p.window.document.createElement("body");for(S.innerHTML=o;h=S.firstChild;)g.appendChild(h);return this.setDOMContent(g)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(o){return this.options.maxWidth=o,this._update(),this},u.prototype.setDOMContent=function(o){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=te.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(o),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(o){this._container&&this._container.classList.add(o)},u.prototype.removeClassName=function(o){this._container&&this._container.classList.remove(o)},u.prototype.setOffset=function(o){return this.options.offset=o,this._update(),this},u.prototype.toggleClassName=function(o){if(this._container)return this._container.classList.toggle(o)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=te.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(o){this._update(o.point)},u.prototype._onMouseMove=function(o){this._update(o.point)},u.prototype._onDrag=function(o){this._update(o.point)},u.prototype._update=function(o){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=te.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=te.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(we){return h._container.classList.add(we)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Hs(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||o)){var g=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat),S=this.options.anchor,T=function we(Pe){if(Pe){if(typeof Pe=="number"){var Ye=Math.round(Math.sqrt(.5*Math.pow(Pe,2)));return{center:new p.Point(0,0),top:new p.Point(0,Pe),"top-left":new p.Point(Ye,Ye),"top-right":new p.Point(-Ye,Ye),bottom:new p.Point(0,-Pe),"bottom-left":new p.Point(Ye,-Ye),"bottom-right":new p.Point(-Ye,-Ye),left:new p.Point(Pe,0),right:new p.Point(-Pe,0)}}if(Pe instanceof p.Point||Array.isArray(Pe)){var We=p.Point.convert(Pe);return{center:We,top:We,"top-left":We,"top-right":We,bottom:We,"bottom-left":We,"bottom-right":We,left:We,right:We}}return{center:p.Point.convert(Pe.center||[0,0]),top:p.Point.convert(Pe.top||[0,0]),"top-left":p.Point.convert(Pe["top-left"]||[0,0]),"top-right":p.Point.convert(Pe["top-right"]||[0,0]),bottom:p.Point.convert(Pe.bottom||[0,0]),"bottom-left":p.Point.convert(Pe["bottom-left"]||[0,0]),"bottom-right":p.Point.convert(Pe["bottom-right"]||[0,0]),left:p.Point.convert(Pe.left||[0,0]),right:p.Point.convert(Pe.right||[0,0])}}return we(new p.Point(0,0))}(this.options.offset);if(!S){var R,G=this._container.offsetWidth,se=this._container.offsetHeight;R=g.y+T.bottom.y<se?["top"]:g.y>this._map.transform.height-se?["bottom"]:[],g.x<G/2?R.push("left"):g.x>this._map.transform.width-G/2&&R.push("right"),S=R.length===0?"bottom":R.join("-")}var Ee=g.add(T[S]).round();te.setTransform(this._container,Ss[S]+" translate("+Ee.x+"px,"+Ee.y+"px)"),Vu(this._container,S,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var o=this._container.querySelector(ic);o&&o.focus()}},u.prototype._onClose=function(){this.remove()},u}(p.Evented),cl={version:p.version,supported:me,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:Qc,NavigationControl:Os,GeolocateControl:ll,AttributionControl:ls,ScaleControl:Hu,FullscreenControl:Ns,Popup:jl,Marker:Ll,Style:Ts,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,Evented:p.Evented,config:p.config,prewarm:function(){nr().acquire(ir)},clearPrewarmedResources:function(){var i=Bn;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(ir),Bn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(i){p.config.ACCESS_TOKEN=i},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(i){p.config.API_URL=i},get workerCount(){return Zr.workerCount},set workerCount(i){Zr.workerCount=i},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(i){p.config.MAX_PARALLEL_IMAGE_REQUESTS=i},clearStorage:function(i){p.clearTileCache(i)},workerUrl:""};return cl}),re})},78892:function(Rr,N,b){var re=b(97671);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var E;(function(p){(function(me){var te=typeof b.g=="object"?b.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ue=ae(p);typeof te.Reflect=="undefined"?te.Reflect=p:ue=ae(te.Reflect,ue),me(ue);function ae(Ne,K){return function(Qe,xt){typeof Ne[Qe]!="function"&&Object.defineProperty(Ne,Qe,{configurable:!0,writable:!0,value:xt}),K&&K(Qe,xt)}}})(function(me){var te=Object.prototype.hasOwnProperty,ue=typeof Symbol=="function",ae=ue&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ne=ue&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",K=typeof Object.create=="function",Qe={__proto__:[]}instanceof Array,xt=!K&&!Qe,Ht={create:K?function(){return Mr(Object.create(null))}:Qe?function(){return Mr({__proto__:null})}:function(){return Mr({})},has:xt?function(Ke,ht){return te.call(Ke,ht)}:function(Ke,ht){return ht in Ke},get:xt?function(Ke,ht){return te.call(Ke,ht)?Ke[ht]:void 0}:function(Ke,ht){return Ke[ht]}},$t=Object.getPrototypeOf(Function),Jt=typeof re=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Ft=!Jt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:J(),Gt=!Jt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Wt(),At=!Jt&&typeof WeakMap=="function"?WeakMap:Tr(),Et=new At;function bt(Ke,ht,Mt,Nt){if(qr(Mt)){if(!ur(Ke))throw new TypeError;if(!or(ht))throw new TypeError;return tr(Ke,ht)}else{if(!ur(Ke))throw new TypeError;if(!he(ht))throw new TypeError;if(!he(Nt)&&!qr(Nt)&&!fi(Nt))throw new TypeError;return fi(Nt)&&(Nt=void 0),Mt=ar(Mt),j(Ke,ht,Mt,Nt)}}me("decorate",bt);function er(Ke,ht){function Mt(Nt,br){if(!he(Nt))throw new TypeError;if(!qr(br)&&!nn(br))throw new TypeError;Lt(Ke,ht,Nt,br)}return Mt}me("metadata",er);function q(Ke,ht,Mt,Nt){if(!he(Mt))throw new TypeError;return qr(Nt)||(Nt=ar(Nt)),Lt(Ke,ht,Mt,Nt)}me("defineMetadata",q);function Bt(Ke,ht,Mt){if(!he(ht))throw new TypeError;return qr(Mt)||(Mt=ar(Mt)),Me(Ke,ht,Mt)}me("hasMetadata",Bt);function et(Ke,ht,Mt){if(!he(ht))throw new TypeError;return qr(Mt)||(Mt=ar(Mt)),ye(Ke,ht,Mt)}me("hasOwnMetadata",et);function je(Ke,ht,Mt){if(!he(ht))throw new TypeError;return qr(Mt)||(Mt=ar(Mt)),it(Ke,ht,Mt)}me("getMetadata",je);function nt(Ke,ht,Mt){if(!he(ht))throw new TypeError;return qr(Mt)||(Mt=ar(Mt)),lt(Ke,ht,Mt)}me("getOwnMetadata",nt);function De(Ke,ht){if(!he(Ke))throw new TypeError;return qr(ht)||(ht=ar(ht)),Pt(Ke,ht)}me("getMetadataKeys",De);function It(Ke,ht){if(!he(Ke))throw new TypeError;return qr(ht)||(ht=ar(ht)),Lr(Ke,ht)}me("getOwnMetadataKeys",It);function hr(Ke,ht,Mt){if(!he(ht))throw new TypeError;qr(Mt)||(Mt=ar(Mt));var Nt=ie(ht,Mt,!1);if(qr(Nt)||!Nt.delete(Ke))return!1;if(Nt.size>0)return!0;var br=Et.get(ht);return br.delete(Mt),br.size>0||Et.delete(ht),!0}me("deleteMetadata",hr);function tr(Ke,ht){for(var Mt=Ke.length-1;Mt>=0;--Mt){var Nt=Ke[Mt],br=Nt(ht);if(!qr(br)&&!fi(br)){if(!or(br))throw new TypeError;ht=br}}return ht}function j(Ke,ht,Mt,Nt){for(var br=Ke.length-1;br>=0;--br){var Sr=Ke[br],Je=Sr(ht,Mt,Nt);if(!qr(Je)&&!fi(Je)){if(!he(Je))throw new TypeError;Nt=Je}}return Nt}function ie(Ke,ht,Mt){var Nt=Et.get(Ke);if(qr(Nt)){if(!Mt)return;Nt=new Ft,Et.set(Ke,Nt)}var br=Nt.get(ht);if(qr(br)){if(!Mt)return;br=new Ft,Nt.set(ht,br)}return br}function Me(Ke,ht,Mt){var Nt=ye(Ke,ht,Mt);if(Nt)return!0;var br=Ct(ht);return fi(br)?!1:Me(Ke,br,Mt)}function ye(Ke,ht,Mt){var Nt=ie(ht,Mt,!1);return qr(Nt)?!1:Oe(Nt.has(Ke))}function it(Ke,ht,Mt){var Nt=ye(Ke,ht,Mt);if(Nt)return lt(Ke,ht,Mt);var br=Ct(ht);if(!fi(br))return it(Ke,br,Mt)}function lt(Ke,ht,Mt){var Nt=ie(ht,Mt,!1);if(!qr(Nt))return Nt.get(Ke)}function Lt(Ke,ht,Mt,Nt){var br=ie(Mt,Nt,!0);br.set(Ke,ht)}function Pt(Ke,ht){var Mt=Lr(Ke,ht),Nt=Ct(Ke);if(Nt===null)return Mt;var br=Pt(Nt,ht);if(br.length<=0)return Mt;if(Mt.length<=0)return br;for(var Sr=new Gt,Je=[],Hr=0,Xr=Mt;Hr<Xr.length;Hr++){var yn=Xr[Hr],vr=Sr.has(yn);vr||(Sr.add(yn),Je.push(yn))}for(var Or=0,St=br;Or<St.length;Or++){var yn=St[Or],vr=Sr.has(yn);vr||(Sr.add(yn),Je.push(yn))}return Je}function Lr(Ke,ht){var Mt=[],Nt=ie(Ke,ht,!1);if(qr(Nt))return Mt;for(var br=Nt.keys(),Sr=V(br),Je=0;;){var Hr=$e(Sr);if(!Hr)return Mt.length=Je,Mt;var Xr=Ve(Hr);try{Mt[Je]=Xr}catch(yn){try{ct(Sr)}finally{throw yn}}Je++}}function cn(Ke){if(Ke===null)return 1;switch(typeof Ke){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ke===null?1:6;default:return 6}}function qr(Ke){return Ke===void 0}function fi(Ke){return Ke===null}function Yt(Ke){return typeof Ke=="symbol"}function he(Ke){return typeof Ke=="object"?Ke!==null:typeof Ke=="function"}function Te(Ke,ht){switch(cn(Ke)){case 0:return Ke;case 1:return Ke;case 2:return Ke;case 3:return Ke;case 4:return Ke;case 5:return Ke}var Mt=ht===3?"string":ht===5?"number":"default",Nt=C(Ke,ae);if(Nt!==void 0){var br=Nt.call(Ke,Mt);if(he(br))throw new TypeError;return br}return Ze(Ke,Mt==="default"?"number":Mt)}function Ze(Ke,ht){if(ht==="string"){var Mt=Ke.toString;if(Pr(Mt)){var Nt=Mt.call(Ke);if(!he(Nt))return Nt}var br=Ke.valueOf;if(Pr(br)){var Nt=br.call(Ke);if(!he(Nt))return Nt}}else{var br=Ke.valueOf;if(Pr(br)){var Nt=br.call(Ke);if(!he(Nt))return Nt}var Sr=Ke.toString;if(Pr(Sr)){var Nt=Sr.call(Ke);if(!he(Nt))return Nt}}throw new TypeError}function Oe(Ke){return!!Ke}function Ot(Ke){return""+Ke}function ar(Ke){var ht=Te(Ke,3);return Yt(ht)?ht:Ot(ht)}function ur(Ke){return Array.isArray?Array.isArray(Ke):Ke instanceof Object?Ke instanceof Array:Object.prototype.toString.call(Ke)==="[object Array]"}function Pr(Ke){return typeof Ke=="function"}function or(Ke){return typeof Ke=="function"}function nn(Ke){switch(cn(Ke)){case 3:return!0;case 4:return!0;default:return!1}}function C(Ke,ht){var Mt=Ke[ht];if(Mt!=null){if(!Pr(Mt))throw new TypeError;return Mt}}function V(Ke){var ht=C(Ke,Ne);if(!Pr(ht))throw new TypeError;var Mt=ht.call(Ke);if(!he(Mt))throw new TypeError;return Mt}function Ve(Ke){return Ke.value}function $e(Ke){var ht=Ke.next();return ht.done?!1:ht}function ct(Ke){var ht=Ke.return;ht&&ht.call(Ke)}function Ct(Ke){var ht=Object.getPrototypeOf(Ke);if(typeof Ke!="function"||Ke===$t||ht!==$t)return ht;var Mt=Ke.prototype,Nt=Mt&&Object.getPrototypeOf(Mt);if(Nt==null||Nt===Object.prototype)return ht;var br=Nt.constructor;return typeof br!="function"||br===Ke?ht:br}function J(){var Ke={},ht=[],Mt=function(){function Je(Hr,Xr,yn){this._index=0,this._keys=Hr,this._values=Xr,this._selector=yn}return Je.prototype["@@iterator"]=function(){return this},Je.prototype[Ne]=function(){return this},Je.prototype.next=function(){var Hr=this._index;if(Hr>=0&&Hr<this._keys.length){var Xr=this._selector(this._keys[Hr],this._values[Hr]);return Hr+1>=this._keys.length?(this._index=-1,this._keys=ht,this._values=ht):this._index++,{value:Xr,done:!1}}return{value:void 0,done:!0}},Je.prototype.throw=function(Hr){throw this._index>=0&&(this._index=-1,this._keys=ht,this._values=ht),Hr},Je.prototype.return=function(Hr){return this._index>=0&&(this._index=-1,this._keys=ht,this._values=ht),{value:Hr,done:!0}},Je}();return function(){function Je(){this._keys=[],this._values=[],this._cacheKey=Ke,this._cacheIndex=-2}return Object.defineProperty(Je.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Je.prototype.has=function(Hr){return this._find(Hr,!1)>=0},Je.prototype.get=function(Hr){var Xr=this._find(Hr,!1);return Xr>=0?this._values[Xr]:void 0},Je.prototype.set=function(Hr,Xr){var yn=this._find(Hr,!0);return this._values[yn]=Xr,this},Je.prototype.delete=function(Hr){var Xr=this._find(Hr,!1);if(Xr>=0){for(var yn=this._keys.length,vr=Xr+1;vr<yn;vr++)this._keys[vr-1]=this._keys[vr],this._values[vr-1]=this._values[vr];return this._keys.length--,this._values.length--,Hr===this._cacheKey&&(this._cacheKey=Ke,this._cacheIndex=-2),!0}return!1},Je.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ke,this._cacheIndex=-2},Je.prototype.keys=function(){return new Mt(this._keys,this._values,Nt)},Je.prototype.values=function(){return new Mt(this._keys,this._values,br)},Je.prototype.entries=function(){return new Mt(this._keys,this._values,Sr)},Je.prototype["@@iterator"]=function(){return this.entries()},Je.prototype[Ne]=function(){return this.entries()},Je.prototype._find=function(Hr,Xr){return this._cacheKey!==Hr&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Hr)),this._cacheIndex<0&&Xr&&(this._cacheIndex=this._keys.length,this._keys.push(Hr),this._values.push(void 0)),this._cacheIndex},Je}();function Nt(Je,Hr){return Je}function br(Je,Hr){return Hr}function Sr(Je,Hr){return[Je,Hr]}}function Wt(){return function(){function Ke(){this._map=new Ft}return Object.defineProperty(Ke.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ke.prototype.has=function(ht){return this._map.has(ht)},Ke.prototype.add=function(ht){return this._map.set(ht,ht),this},Ke.prototype.delete=function(ht){return this._map.delete(ht)},Ke.prototype.clear=function(){this._map.clear()},Ke.prototype.keys=function(){return this._map.keys()},Ke.prototype.values=function(){return this._map.values()},Ke.prototype.entries=function(){return this._map.entries()},Ke.prototype["@@iterator"]=function(){return this.keys()},Ke.prototype[Ne]=function(){return this.keys()},Ke}()}function Tr(){var Ke=16,ht=Ht.create(),Mt=Nt();return function(){function Xr(){this._key=Nt()}return Xr.prototype.has=function(yn){var vr=br(yn,!1);return vr!==void 0?Ht.has(vr,this._key):!1},Xr.prototype.get=function(yn){var vr=br(yn,!1);return vr!==void 0?Ht.get(vr,this._key):void 0},Xr.prototype.set=function(yn,vr){var Or=br(yn,!0);return Or[this._key]=vr,this},Xr.prototype.delete=function(yn){var vr=br(yn,!1);return vr!==void 0?delete vr[this._key]:!1},Xr.prototype.clear=function(){this._key=Nt()},Xr}();function Nt(){var Xr;do Xr="@@WeakMap@@"+Hr();while(Ht.has(ht,Xr));return ht[Xr]=!0,Xr}function br(Xr,yn){if(!te.call(Xr,Mt)){if(!yn)return;Object.defineProperty(Xr,Mt,{value:Ht.create()})}return Xr[Mt]}function Sr(Xr,yn){for(var vr=0;vr<yn;++vr)Xr[vr]=Math.random()*255|0;return Xr}function Je(Xr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Xr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Xr)):Sr(new Uint8Array(Xr),Xr):Sr(new Array(Xr),Xr)}function Hr(){var Xr=Je(Ke);Xr[6]=Xr[6]&79|64,Xr[8]=Xr[8]&191|128;for(var yn="",vr=0;vr<Ke;++vr){var Or=Xr[vr];(vr===4||vr===6||vr===8)&&(yn+="-"),Or<16&&(yn+="0"),yn+=Or.toString(16).toLowerCase()}return yn}}function Mr(Ke){return Ke.__=void 0,delete Ke.__,Ke}})})(E||(E={}))},83437:function(Rr){(function(N,b){Rr.exports=b()})(this,function(){"use strict";function N(et,je,nt,De,It,hr){if(!(It-De<=nt)){var tr=De+It>>1;b(et,je,tr,De,It,hr%2),N(et,je,nt,De,tr-1,hr+1),N(et,je,nt,tr+1,It,hr+1)}}function b(et,je,nt,De,It,hr){for(;It>De;){if(It-De>600){var tr=It-De+1,j=nt-De+1,ie=Math.log(tr),Me=.5*Math.exp(2*ie/3),ye=.5*Math.sqrt(ie*Me*(tr-Me)/tr)*(j-tr/2<0?-1:1),it=Math.max(De,Math.floor(nt-j*Me/tr+ye)),lt=Math.min(It,Math.floor(nt+(tr-j)*Me/tr+ye));b(et,je,nt,it,lt,hr)}var Lt=je[2*nt+hr],Pt=De,Lr=It;for(re(et,je,De,nt),je[2*It+hr]>Lt&&re(et,je,De,It);Pt<Lr;){for(re(et,je,Pt,Lr),Pt++,Lr--;je[2*Pt+hr]<Lt;)Pt++;for(;je[2*Lr+hr]>Lt;)Lr--}je[2*De+hr]===Lt?re(et,je,De,Lr):(Lr++,re(et,je,Lr,It)),Lr<=nt&&(De=Lr+1),nt<=Lr&&(It=Lr-1)}}function re(et,je,nt,De){E(et,nt,De),E(je,2*nt,2*De),E(je,2*nt+1,2*De+1)}function E(et,je,nt){var De=et[je];et[je]=et[nt],et[nt]=De}function p(et,je,nt,De,It,hr,tr){for(var j=[0,et.length-1,0],ie=[],Me,ye;j.length;){var it=j.pop(),lt=j.pop(),Lt=j.pop();if(lt-Lt<=tr){for(var Pt=Lt;Pt<=lt;Pt++)Me=je[2*Pt],ye=je[2*Pt+1],Me>=nt&&Me<=It&&ye>=De&&ye<=hr&&ie.push(et[Pt]);continue}var Lr=Math.floor((Lt+lt)/2);Me=je[2*Lr],ye=je[2*Lr+1],Me>=nt&&Me<=It&&ye>=De&&ye<=hr&&ie.push(et[Lr]);var cn=(it+1)%2;(it===0?nt<=Me:De<=ye)&&(j.push(Lt),j.push(Lr-1),j.push(cn)),(it===0?It>=Me:hr>=ye)&&(j.push(Lr+1),j.push(lt),j.push(cn))}return ie}function me(et,je,nt,De,It,hr){for(var tr=[0,et.length-1,0],j=[],ie=It*It;tr.length;){var Me=tr.pop(),ye=tr.pop(),it=tr.pop();if(ye-it<=hr){for(var lt=it;lt<=ye;lt++)te(je[2*lt],je[2*lt+1],nt,De)<=ie&&j.push(et[lt]);continue}var Lt=Math.floor((it+ye)/2),Pt=je[2*Lt],Lr=je[2*Lt+1];te(Pt,Lr,nt,De)<=ie&&j.push(et[Lt]);var cn=(Me+1)%2;(Me===0?nt-It<=Pt:De-It<=Lr)&&(tr.push(it),tr.push(Lt-1),tr.push(cn)),(Me===0?nt+It>=Pt:De+It>=Lr)&&(tr.push(Lt+1),tr.push(ye),tr.push(cn))}return j}function te(et,je,nt,De){var It=et-nt,hr=je-De;return It*It+hr*hr}var ue=function(et){return et[0]},ae=function(et){return et[1]},Ne=function(je,nt,De,It,hr){nt===void 0&&(nt=ue),De===void 0&&(De=ae),It===void 0&&(It=64),hr===void 0&&(hr=Float64Array),this.nodeSize=It,this.points=je;for(var tr=je.length<65536?Uint16Array:Uint32Array,j=this.ids=new tr(je.length),ie=this.coords=new hr(je.length*2),Me=0;Me<je.length;Me++)j[Me]=Me,ie[2*Me]=nt(je[Me]),ie[2*Me+1]=De(je[Me]);N(j,ie,It,0,j.length-1,0)};Ne.prototype.range=function(je,nt,De,It){return p(this.ids,this.coords,je,nt,De,It,this.nodeSize)},Ne.prototype.within=function(je,nt,De){return me(this.ids,this.coords,je,nt,De,this.nodeSize)};var K={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(et){return et}},Qe=Math.fround||function(et){return function(je){return et[0]=+je,et[0]}}(new Float32Array(1)),xt=function(je){this.options=er(Object.create(K),je),this.trees=new Array(this.options.maxZoom+1)};xt.prototype.load=function(je){var nt=this.options,De=nt.log,It=nt.minZoom,hr=nt.maxZoom,tr=nt.nodeSize;De&&console.time("total time");var j="prepare "+je.length+" points";De&&console.time(j),this.points=je;for(var ie=[],Me=0;Me<je.length;Me++)!je[Me].geometry||ie.push($t(je[Me],Me));this.trees[hr+1]=new Ne(ie,q,Bt,tr,Float32Array),De&&console.timeEnd(j);for(var ye=hr;ye>=It;ye--){var it=+Date.now();ie=this._cluster(ie,ye),this.trees[ye]=new Ne(ie,q,Bt,tr,Float32Array),De&&console.log("z%d: %d clusters in %dms",ye,ie.length,+Date.now()-it)}return De&&console.timeEnd("total time"),this},xt.prototype.getClusters=function(je,nt){var De=((je[0]+180)%360+360)%360-180,It=Math.max(-90,Math.min(90,je[1])),hr=je[2]===180?180:((je[2]+180)%360+360)%360-180,tr=Math.max(-90,Math.min(90,je[3]));if(je[2]-je[0]>=360)De=-180,hr=180;else if(De>hr){var j=this.getClusters([De,It,180,tr],nt),ie=this.getClusters([-180,It,hr,tr],nt);return j.concat(ie)}for(var Me=this.trees[this._limitZoom(nt)],ye=Me.range(Gt(De),At(tr),Gt(hr),At(It)),it=[],lt=0,Lt=ye;lt<Lt.length;lt+=1){var Pt=Lt[lt],Lr=Me.points[Pt];it.push(Lr.numPoints?Jt(Lr):this.points[Lr.index])}return it},xt.prototype.getChildren=function(je){var nt=this._getOriginId(je),De=this._getOriginZoom(je),It="No cluster with the specified id.",hr=this.trees[De];if(!hr)throw new Error(It);var tr=hr.points[nt];if(!tr)throw new Error(It);for(var j=this.options.radius/(this.options.extent*Math.pow(2,De-1)),ie=hr.within(tr.x,tr.y,j),Me=[],ye=0,it=ie;ye<it.length;ye+=1){var lt=it[ye],Lt=hr.points[lt];Lt.parentId===je&&Me.push(Lt.numPoints?Jt(Lt):this.points[Lt.index])}if(Me.length===0)throw new Error(It);return Me},xt.prototype.getLeaves=function(je,nt,De){nt=nt||10,De=De||0;var It=[];return this._appendLeaves(It,je,nt,De,0),It},xt.prototype.getTile=function(je,nt,De){var It=this.trees[this._limitZoom(je)],hr=Math.pow(2,je),tr=this.options,j=tr.extent,ie=tr.radius,Me=ie/j,ye=(De-Me)/hr,it=(De+1+Me)/hr,lt={features:[]};return this._addTileFeatures(It.range((nt-Me)/hr,ye,(nt+1+Me)/hr,it),It.points,nt,De,hr,lt),nt===0&&this._addTileFeatures(It.range(1-Me/hr,ye,1,it),It.points,hr,De,hr,lt),nt===hr-1&&this._addTileFeatures(It.range(0,ye,Me/hr,it),It.points,-1,De,hr,lt),lt.features.length?lt:null},xt.prototype.getClusterExpansionZoom=function(je){for(var nt=this._getOriginZoom(je)-1;nt<=this.options.maxZoom;){var De=this.getChildren(je);if(nt++,De.length!==1)break;je=De[0].properties.cluster_id}return nt},xt.prototype._appendLeaves=function(je,nt,De,It,hr){for(var tr=this.getChildren(nt),j=0,ie=tr;j<ie.length;j+=1){var Me=ie[j],ye=Me.properties;if(ye&&ye.cluster?hr+ye.point_count<=It?hr+=ye.point_count:hr=this._appendLeaves(je,ye.cluster_id,De,It,hr):hr<It?hr++:je.push(Me),je.length===De)break}return hr},xt.prototype._addTileFeatures=function(je,nt,De,It,hr,tr){for(var j=0,ie=je;j<ie.length;j+=1){var Me=ie[j],ye=nt[Me],it=ye.numPoints,lt=void 0,Lt=void 0,Pt=void 0;if(it)lt=Ft(ye),Lt=ye.x,Pt=ye.y;else{var Lr=this.points[ye.index];lt=Lr.properties,Lt=Gt(Lr.geometry.coordinates[0]),Pt=At(Lr.geometry.coordinates[1])}var cn={type:1,geometry:[[Math.round(this.options.extent*(Lt*hr-De)),Math.round(this.options.extent*(Pt*hr-It))]],tags:lt},qr=void 0;it?qr=ye.id:this.options.generateId?qr=ye.index:this.points[ye.index].id&&(qr=this.points[ye.index].id),qr!==void 0&&(cn.id=qr),tr.features.push(cn)}},xt.prototype._limitZoom=function(je){return Math.max(this.options.minZoom,Math.min(+je,this.options.maxZoom+1))},xt.prototype._cluster=function(je,nt){for(var De=[],It=this.options,hr=It.radius,tr=It.extent,j=It.reduce,ie=It.minPoints,Me=hr/(tr*Math.pow(2,nt)),ye=0;ye<je.length;ye++){var it=je[ye];if(!(it.zoom<=nt)){it.zoom=nt;for(var lt=this.trees[nt+1],Lt=lt.within(it.x,it.y,Me),Pt=it.numPoints||1,Lr=Pt,cn=0,qr=Lt;cn<qr.length;cn+=1){var fi=qr[cn],Yt=lt.points[fi];Yt.zoom>nt&&(Lr+=Yt.numPoints||1)}if(Lr>Pt&&Lr>=ie){for(var he=it.x*Pt,Te=it.y*Pt,Ze=j&&Pt>1?this._map(it,!0):null,Oe=(ye<<5)+(nt+1)+this.points.length,Ot=0,ar=Lt;Ot<ar.length;Ot+=1){var ur=ar[Ot],Pr=lt.points[ur];if(!(Pr.zoom<=nt)){Pr.zoom=nt;var or=Pr.numPoints||1;he+=Pr.x*or,Te+=Pr.y*or,Pr.parentId=Oe,j&&(Ze||(Ze=this._map(it,!0)),j(Ze,this._map(Pr)))}}it.parentId=Oe,De.push(Ht(he/Lr,Te/Lr,Oe,Lr,Ze))}else if(De.push(it),Lr>1)for(var nn=0,C=Lt;nn<C.length;nn+=1){var V=C[nn],Ve=lt.points[V];Ve.zoom<=nt||(Ve.zoom=nt,De.push(Ve))}}}return De},xt.prototype._getOriginId=function(je){return je-this.points.length>>5},xt.prototype._getOriginZoom=function(je){return(je-this.points.length)%32},xt.prototype._map=function(je,nt){if(je.numPoints)return nt?er({},je.properties):je.properties;var De=this.points[je.index].properties,It=this.options.map(De);return nt&&It===De?er({},It):It};function Ht(et,je,nt,De,It){return{x:Qe(et),y:Qe(je),zoom:Infinity,id:nt,parentId:-1,numPoints:De,properties:It}}function $t(et,je){var nt=et.geometry.coordinates,De=nt[0],It=nt[1];return{x:Qe(Gt(De)),y:Qe(At(It)),zoom:Infinity,index:je,parentId:-1}}function Jt(et){return{type:"Feature",id:et.id,properties:Ft(et),geometry:{type:"Point",coordinates:[Et(et.x),bt(et.y)]}}}function Ft(et){var je=et.numPoints,nt=je>=1e4?Math.round(je/1e3)+"k":je>=1e3?Math.round(je/100)/10+"k":je;return er(er({},et.properties),{cluster:!0,cluster_id:et.id,point_count:je,point_count_abbreviated:nt})}function Gt(et){return et/360+.5}function At(et){var je=Math.sin(et*Math.PI/180),nt=.5-.25*Math.log((1+je)/(1-je))/Math.PI;return nt<0?0:nt>1?1:nt}function Et(et){return(et-.5)*360}function bt(et){var je=(180-et*360)*Math.PI/180;return 360*Math.atan(Math.exp(je))/Math.PI-90}function er(et,je){for(var nt in je)et[nt]=je[nt];return et}function q(et){return et.x}function Bt(et){return et.y}return xt})},48027:function(Rr){Rr.exports.RADIUS=6378137,Rr.exports.FLATTENING=1/298.257223563,Rr.exports.POLAR_RADIUS=63567523142e-4}}]);
